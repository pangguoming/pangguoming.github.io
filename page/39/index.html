<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Software make the information world run, and programer make the softeware run.">
<meta property="og:type" content="website">
<meta property="og:title" content="庞国明-博客">
<meta property="og:url" content="http://pangguoming.com/page/39/index.html">
<meta property="og:site_name" content="庞国明-博客">
<meta property="og:description" content="Software make the information world run, and programer make the softeware run.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="庞国明-博客">
<meta name="twitter:description" content="Software make the information world run, and programer make the softeware run.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://pangguoming.com/page/39/">





  <title>庞国明-博客</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">庞国明-博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">此心用度八千遍，不曾厌倦</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/dd14590e.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/dd14590e.html" itemprop="url">CentOS怎样查看系统信息</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-06-17T18:30:00+08:00">
                2015-06-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="exp-content-block"><br><br>## 一、查看系统版本和核心版本<br><br><div class="exp-content-body"><br><br>1.  <div class="list-icon">1<br><div class="content-list-text"><br><br>登陆CentOS，启动终端。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/e6c8503c062dcee54f1a18d0.html?picindex=1" target="_blank" rel="noopener"><img src="http://e.hiphotos.baidu.com/exp/w=500/sign=4b32edead200baa1ba2c47bb7710b9b1/d833c895d143ad4b051c66c681025aafa40f0681.jpg" alt="CentOS怎样查看系统信息"></a><br><br></div></div></div></div><br>2.  <div class="list-icon">2<br><div class="content-list-text"><br><br>登陆root帐户，输入 cat  /etc/redhat-release，即可显示系统版本。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/e6c8503c062dcee54f1a18d0.html?picindex=2" target="_blank" rel="noopener"><img src="http://g.hiphotos.baidu.com/exp/w=500/sign=9be3c62d0df41bd5da53e8f461db81a0/0b55b319ebc4b745a5549610ccfc1e178b8215f7.jpg" alt="CentOS怎样查看系统信息"></a><br><br></div></div></div></div><br>3.  <div class="list-icon">3<br><div class="content-list-text"><br><br>输入 uname  -r ，可以查询内核版本。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/e6c8503c062dcee54f1a18d0.html?picindex=3" target="_blank" rel="noopener"><img src="http://c.hiphotos.baidu.com/exp/w=500/sign=5944821dd70735fa91f04eb9ae500f9f/a8773912b31bb0510a45932e357adab44aede057.jpg" alt="CentOS怎样查看系统信息"></a><br><br><div class="last-item"><span class="last-item-end">END</span><br></div></div></div></div></div>

<div class="exp-content-block"><br><br>## 二、查看各分区使用情况<br><br><div class="exp-content-body"><br><br>1.  <div class="list-icon">1<br><div class="content-list-text"><br><br>输入 df  -h，可以查看各分区的使用情况。其中，从左到右各列的内容依次是：<br><br>文件系统、总大小、已使用大小、剩余大小、使用率、挂载点。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/e6c8503c062dcee54f1a18d0.html?picindex=4" target="_blank" rel="noopener"><img src="http://f.hiphotos.baidu.com/exp/w=500/sign=3541c475ae4bd11304cdb7326aaea488/b21c8701a18b87d6daab8b19040828381e30fdcf.jpg" alt="CentOS怎样查看系统信息"></a><br><br></div></div></div></div><br>2.  <div class="list-icon">2<br><div class="content-list-text"><br><br>输入du  -sh，则可以查看当前文件夹所占空间。它的功能等同于 du . -sh。而输入 du 目录名 -sh，则可以查看指定目录的大小。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/e6c8503c062dcee54f1a18d0.html?picindex=5" target="_blank" rel="noopener"><img src="http://g.hiphotos.baidu.com/exp/w=500/sign=5312c72570f082022d92913f7bfbfb8a/a08b87d6277f9e2ff9513e0e1c30e924b899f354.jpg" alt="CentOS怎样查看系统信息"></a><br><br><div class="last-item"><span class="last-item-end">END</span><br></div></div></div></div></div>

<div class="exp-content-block"><br><br>## 三、查看安装的软件包<br><br><div class="exp-content-body"><br><br>1.  <div class="list-icon"><br><div class="content-list-text"><br><br>输入 cat -n /root/install.log，可显示系统安装时所安装的软件包列表。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/e6c8503c062dcee54f1a18d0.html?picindex=6" target="_blank" rel="noopener"><img src="http://e.hiphotos.baidu.com/exp/w=500/sign=bf23fcf2b44543a9f51bfacc2e178a7b/7af40ad162d9f2d35b1606e9aaec8a136327ccb4.jpg" alt="CentOS怎样查看系统信息"></a><br><br></div></div></div></div><br>2.  <div class="list-icon"><br><div class="content-list-text"><br><br>当然，也可以使用 more  /root/install.log 分屏查看。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/e6c8503c062dcee54f1a18d0.html?picindex=7" target="_blank" rel="noopener"><img src="http://c.hiphotos.baidu.com/exp/w=500/sign=bb88ca62554e9258a63486eeac83d1d1/c9fcc3cec3fdfc0320eec1bed73f8794a4c22625.jpg" alt="CentOS怎样查看系统信息"></a><br><br></div></div></div></div><br>3.  <div class="list-icon"><br><div class="content-list-text"><br><br>输入 rpm -qa，则可以查看到现在为止已经安装了哪些软件包。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/e6c8503c062dcee54f1a18d0.html?picindex=8" target="_blank" rel="noopener"><img src="http://e.hiphotos.baidu.com/exp/w=500/sign=ff39bc52004f78f0800b9af349300a83/e824b899a9014c086ad20aa3097b02087af4f4ce.jpg" alt="CentOS怎样查看系统信息"></a><br><br></div></div></div></div><br>4.<br><br></div></div></div></div></div></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/9446d8b7.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/9446d8b7.html" itemprop="url">Ubuntu 14.04 分区方案</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-06-17T18:08:00+08:00">
                2015-06-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我磁盘大概还有70多G的空间吧，我全部拿来使用的。真实的双系统哦。</p>
<p>一般来讲，linux系统分区最少要包括/和/swap两个。这样据说会影响性能，没有这样安装过，就无从考证啦。其实就是重装系统的时候，数据会丢失，所以应该把/usr和/home分区独立出来。</p>
<p>下面是我75G的硬盘分区方案：</p>
<p>1、/boot  200M </p>
<p>2、/swap 6G 因为我内存是6G，所以就给了6G空间</p>
<p>3、/usr 10G</p>
<p>4、/opt 10G</p>
<p>5、/home 20G</p>
<p>6、/ 35G(剩下的全部)</p>
<p>以上分区不知道是否合理，大家可以给出自己的意见，便于下次修正。</p>
<p>/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</p>
<p>附：Linux各个分区的作用</p>
<p>/ 根目录，建议在根目录下面只有目录，不要直接有文件。</p>
<p>swap 交换空间，相当于Windows上的虚拟内存。</p>
<p>/boot 包含了操作系统的内核和在启动系统过程中所要用到的文件，建这个分区是有必要的，因为目前大多数的PC机要受到BIOS的限制, 况且如果有了一个单独的/boot启动分区，即使主要的根分区出现了问题，计算机依然能够启动。这个分区的大小约在60MB—120MB之间。</p>
<p>/home 用户的home目录所在地，这个分区的大小取决于有多少用户。如果是多用户共同使用一台电脑的话，这个分区是完全有必要的，况且根用户也可以很好地控制普通用户使用计算机，如对用户或者用户组实行硬盘限量使用，限制普通用户访问哪些文件等。</p>
<p>/tmp 用来存放临时文件。这对于多用户系统或者网络服务器来说是有必要的。这样即使程序运行时生成大量的临时文件，或者用户对系统进行了错误的操作，文件系统的其它部分仍然是安全的。因为文件系统的这一部分仍然还承受着读写操作，所以它通常会比其它的部分更快地发生问题。这个目录是任何人都能访问的，所以需要定期清理。</p>
<p>/usr Linux系统存放软件的地方，如有可能应将最大空间分给它。</p>
<p>/bin</p>
<p>/usr/bin</p>
<p>/usr/local/bin 存放标准系统实用程序。</p>
<p>/srv 一些服务启动之后，这些服务所需要访问的数据目录，如WWW服务器需要的网页数据就可以放在/srv/www中。</p>
<p>/etc 系统主要的设置文件几乎都放在这个目录内。</p>
<p>/lib</p>
<p>/usr/lib</p>
<p>/usr/local/lib 系统使用的函数库的目录。</p>
<p>/root 系统管理员的家目录。</p>
<p>/lost+found 该目录在大多数情况下都是空的，但当实然停电或者非正常关机后，有些文件临时存入在此。</p>
<p>/dev 设备文件，在Linux系统上，任何设备都以文件类型存放在这个目录中，如硬盘设备文件，软驱、光驱设备文件等。</p>
<p>/mnt</p>
<p>/media 挂载目录，用来临时挂载别的文件系统或者别的硬件设备（如光驱、软驱）。</p>
<p>/opt 用于存储第三方软件的目录，不过我们还是习惯放在/usr/local下。</p>
<p>/proc 此目录信息是在内存中由系统自行产生的，存储了一些当前的进程ID号和CPU、内存的映射等，因为这个目录下的数据都在内存中，所以本身不占任何硬盘空间。</p>
<p>/sbin</p>
<p>/usr/sbin</p>
<p>/usr/local/sbin 存放一些系统管理员才会用到的执行命令。</p>
<p>/var 主要放置系统执行过程中经常变化的文件，例如缓存（cache）或者是随时更改的登录文件（log file）。</p>
<p>/var/log 系统日志记录分区，如果设立了这一单独的分区，这样即使系统的日志文件出现了问题，它们也不会影响到操作系统的主分区。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/ee7cf289.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/ee7cf289.html" itemprop="url">ubuntu12.04 安装配置jdk1.7</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-04-24T13:13:00+08:00">
                2015-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="第一步：下载jdk-7-linux-i586-tar-gz"><a href="#第一步：下载jdk-7-linux-i586-tar-gz" class="headerlink" title="第一步：下载jdk-7-linux-i586.tar.gz"></a>第一步：下载jdk-7-linux-i586.tar.gz</h2><div class="dp-highlighter bg_plain"><br><br>1.  wget -c <a href="http://download.oracle.com/otn-pub/java/jdk/7/jdk-7-linux-i586.tar.gz" target="_blank" rel="noopener">http://download.oracle.com/otn-pub/java/jdk/7/jdk-7-linux-i586.tar.gz</a><br><br>(注：如果下载不下来，建议使用迅雷下载，然后拷贝到Linux系统上。)<br><br><div><br><br>## 第二步：解压安装<br><br><div class="dp-highlighter bg_plain"><br><br>1.  sudo mkdir /usr/lib/jvm<br>2.  sudo tar zxvf jdk-7u5-linux-x64.tar.gz -C /usr/lib/jvm<br><br>## 第三步：修改环境变量<br><br><div class="dp-highlighter bg_plain"><br><br>1.  sudo gedit /etc/profile<br>添加：<br><br><div class="dp-highlighter bg_plain"><br><br>1.  #set java environment<br>2.  export JAVA_HOME=/usr/lib/jvm/java-7-sun<br>3.  export JRE_HOME=${JAVA_HOME}/jre<br>4.  export CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib<br>5.  export PATH=${JAVA_HOME}/bin:$PATH<br><br>保存退出，输入以下命令使之立即生效。<br><br>1.  source ~/.bashrc<br><br>## 第四步：配置默认JDK版本<br><br><div>为了将我们安装的JDK设置为默认JDK版本，还要进行如下工作。<br>执行代码:<br><div class="dp-highlighter bg_plain"><br><br>1.  sudo update-alternatives –install /usr/bin/java java /usr/lib/jvm/java-7-sun/bin/java 300<br>2.  sudo update-alternatives –install /usr/bin/javac javac /usr/lib/jvm/java-7-sun/bin/javac 300<br><div>执行代码：<br><div class="dp-highlighter bg_plain"><br><br>1.  sudo update-alternatives –config java<br><div>系统会列出各种JDK版本，如下所示：<br><div class="dp-highlighter bg_plain"><br><br>1.  <a href="http://www.linuxidc.com@linux:~$" target="_blank" rel="noopener">www.linuxidc.com@linux:~$</a> sudo update-alternatives –config java<br>2.  有 3 个候选项可用于替换 java (提供 /usr/bin/java)。<br>3.<br>4.<br>5.    选择       路径                                    优先级  状态<br>6.  ————————————————————<br>7.  <em> 0            /usr/lib/jvm/java-6-openjdk/jre/bin/java   1061      自动模式<br>8.    1            /usr/lib/jvm/java-6-openjdk/jre/bin/java   1061      手动模式<br>9.    2            /usr/lib/jvm/java-6-sun/jre/bin/java       63        手动模式<br>10.    3            /usr/lib/jvm/java-7-sun/bin/java           300       手动模式<br>11.<br>12.<br>13.  要维持当前值[</em>]请按回车键，或者键入选择的编号：3<br>14.  update-alternatives: 使用 /usr/lib/jvm/java-7-sun/bin/java 来提供 /usr/bin/java (java)，于 手动模式 中。<br><br>## 第五步：测试<br><br><div class="dp-highlighter bg_plain"><br><br>1.  1.  java -version （会显示如下信息，说明已配置成功）<br>    2.  java version “1.7.0”<br>    3.  Java(TM) SE Runtime Environment (build 1.7.0-b147)<br>    4.  Java HotSpot(TM) Client VM (build 21.0-b17, mixed mode)</div></div></div></div></div></div></div></div></div></div></div></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/248267a1.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/248267a1.html" itemprop="url">Ubuntu下解决bash 没有那个文件或目录的方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-04-24T13:11:00+08:00">
                2015-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>因为之前电脑硬盘坏掉，维修换了新硬盘，今天重新安装了ubuntu，装好之后就赶紧搭建工作环境，将备份的资料拷贝进来，搭建交叉编译环境，但是发现，修改bashrc中PATH绝对路径指向交叉编译器后，在命令行下运行交叉编译器或出现说没有这个文件或者目录，但是按照绝对路径ls看又有这个文件，很是奇怪。</p>
<p>后来找到问题，这次安装的系统是64位的，而这些编译环境都是32位的程序，因此需要安装对32位程序的支持。</p>
<p>直接安装即可。</p>
<p>apt-get install ia32-libs</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/d8a5a745.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/d8a5a745.html" itemprop="url">Mongodb集群搭建的三种方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-04-15T08:52:00+08:00">
                2015-04-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div id="article_content" class="article_content"><br><br> Mongodb是时下流行的NoSql数据库，它的存储方式是文档式存储，并不是Key-Value形式。关于Mongodb的特点，这里就不多介绍了，大家可以去看看官方说明：<a href="http://docs.mongodb.org/manual/" target="_blank" rel="noopener">http://docs.mongodb.org/manual/</a><br><br><a href="http://docs.mongodb.org/manual/" target="_blank" rel="noopener"> </a><br><br>       今天主要来说说Mongodb的三种集群方式的搭建：Replica Set / Sharding / Master-Slaver。这里只说明最简单的集群搭建方式（生产环境），如果有多个节点可以此类推或者查看官方文档。OS是Ubuntu_x64系统，客户端用的是Java客户端。Mongodb版本是mongodb-linux-x86_64-2.2.2.tgz<br><br><strong>Replica Set</strong><br><br>       中文翻译叫做副本集，不过我并不喜欢把英文翻译成中文，总是感觉怪怪的。其实简单来说就是集群当中包含了多份数据，保证主节点挂掉了，备节点能继续提供数据服务，提供的前提就是数据需要和主节点一致。如下图：<br><br><img src="http://img.my.csdn.net/uploads/201301/13/1358056331_2790.png" alt=""><br><br>       Mongodb(M)表示主节点，Mongodb(S)表示备节点，Mongodb(A)表示仲裁节点。主备节点存储数据，仲裁节点不存储数据。客户端同时连接主节点与备节点，不连接仲裁节点。<br><br>       默认设置下，主节点提供所有增删查改服务，备节点不提供任何服务。但是可以通过设置使备节点提供查询服务，这样就可以减少主节点的压力，当客户端进行数据查询时，请求自动转到备节点上。这个设置叫做<a href="http://docs.mongodb.org/manual/applications/replication/#read-preference-modes" target="_blank" rel="noopener">Read Preference Modes</a>，同时Java客户端提供了简单的配置方式，可以不必直接对数据库进行操作。<br><br>       仲裁节点是一种特殊的节点，它本身并不存储数据，主要的作用是决定哪一个备节点在主节点挂掉之后提升为主节点，所以客户端不需要连接此节点。这里虽然只有一个备节点，但是仍然需要一个仲裁节点来提升备节点级别。我开始也不相信必须要有仲裁节点，但是自己也试过没仲裁节点的话，主节点挂了备节点还是备节点，所以咱们还是需要它的。<br><br>介绍完了集群方案，那么现在就开始搭建了。<br><br>1.建立数据文件夹<br><br>一般情况下不会把数据目录建立在mongodb的解压目录下，不过这里方便起见，就建在mongodb解压目录下吧。<br><br><div class="dp-highlighter bg_plain"><br><div class="bar"><br><div class="tools"><strong>[plain]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  mkdir -p /mongodb/data/master<br>2.  mkdir -p /mongodb/data/slaver<br>3.  mkdir -p /mongodb/data/arbiter<br>4.  #三个目录分别对应主，备，仲裁节点<br><br>2.建立配置文件<br><br>由于配置比较多，所以我们将配置写到文件里。<br><br><div class="dp-highlighter bg_plain"><br><div class="bar"><br><div class="tools"><strong>[plain]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  #master.conf<br>2.  dbpath=/mongodb/data/master<br>3.  logpath=/mongodb/log/master.log<br>4.  pidfilepath=/mongodb/master.pid<br>5.  directoryperdb=true<br>6.  logappend=true<br>7.  replSet=testrs<br>8.  bind_ip=10.10.148.130<br>9.  port=27017<br>10.  oplogSize=10000<br>11.  fork=true<br>12.  noprealloc=true<br><div class="dp-highlighter bg_plain"><br><div class="bar"><br><div class="tools"><strong>[plain]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  #slaver.conf<br>2.  dbpath=/mongodb/data/slaver<br>3.  logpath=/mongodb/log/slaver.log<br>4.  pidfilepath=/mongodb/slaver.pid<br>5.  directoryperdb=true<br>6.  logappend=true<br>7.  replSet=testrs<br>8.  bind_ip=10.10.148.131<br>9.  port=27017<br>10.  oplogSize=10000<br>11.  fork=true<br>12.  noprealloc=true<br><div class="dp-highlighter bg_plain"><br><div class="bar"><br><div class="tools"><strong>[plain]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  #arbiter.conf<br>2.  dbpath=/mongodb/data/arbiter<br>3.  logpath=/mongodb/log/arbiter.log<br>4.  pidfilepath=/mongodb/arbiter.pid<br>5.  directoryperdb=true<br>6.  logappend=true<br>7.  replSet=testrs<br>8.  bind_ip=10.10.148.132<br>9.  port=27017<br>10.  oplogSize=10000<br>11.  fork=true<br>12.  noprealloc=true<br>参数解释：<br><br>dbpath：数据存放目录<br><br>logpath：日志存放路径<br><br>pidfilepath：进程文件，方便停止mongodb<br><br>directoryperdb：为每一个数据库按照数据库名建立文件夹存放<br><br>logappend：以追加的方式记录日志<br><br>replSet：replica set的名字<br><br>bind_ip：mongodb所绑定的ip地址<br><br>port：mongodb进程所使用的端口号，默认为27017<br><br>oplogSize：mongodb操作日志文件的最大大小。单位为Mb，默认为硬盘剩余空间的5%<br><br>fork：以后台方式运行进程<br><br>noprealloc：不预先分配存储<br><br>3.启动mongodb<br><br>进入每个mongodb节点的bin目录下<br><br><div class="dp-highlighter bg_java"><br><div class="bar"><br><div class="tools"><strong>[java]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  ./monood -f master.conf<br>2.  ./mongod -f slaver.conf<br>3.  ./mongod -f arbiter.conf<br><br>注意配置文件的路径一定要保证正确，可以是相对路径也可以是绝对路径。<br><br>4.配置主，备，仲裁节点<br><br>可以通过客户端连接mongodb，也可以直接在三个节点中选择一个连接mongodb。<br><br><div class="dp-highlighter bg_plain"><br><div class="bar"><br><div class="tools"><strong>[plain]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  ./mongo 10.10.148.130:27017   #ip和port是某个节点的地址<br>2.  &gt;use admin<br>3.  &gt;cfg={ _id:”testrs”, members:[ {_id:0,host:’10.10.148.130:27017’,priority:2}, {_id:1,host:’10.10.148.131:27017’,priority:1},<br>4.  {_id:2,host:’10.10.148.132:27017’,arbiterOnly:true}] };<br>5.  &gt;rs.initiate(cfg)             #使配置生效<br>       cfg是可以任意的名字，当然最好不要是mongodb的关键字，conf，config都可以。最外层的_id表示replica set的名字，members里包含的是所有节点的地址以及优先级。优先级最高的即成为主节点，即这里的10.10.148.130:27017。特别注意的是，对于仲裁节点，需要有个特别的配置——arbiterOnly:true。这个千万不能少了，不然主备模式就不能生效。<br><br>      配置的生效时间根据不同的机器配置会有长有短，配置不错的话基本上十几秒内就能生效，有的配置需要一两分钟。如果生效了，执行rs.status()命令会看到如下信息：<br><br><div class="dp-highlighter bg_plain"><br><div class="bar"><br><div class="tools"><strong>[plain]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  {<br>2.          “set” : “testrs”,<br>3.          “date” : ISODate(“2013-01-05T02:44:43Z”),<br>4.          “myState” : 1,<br>5.          “members” : [<br>6.                  {<br>7.                          “_id” : 0,<br>8.                          “name” : “10.10.148.130:27017”,<br>9.                          “health” : 1,<br>10.                          “state” : 1,<br>11.                          “stateStr” : “PRIMARY”,<br>12.                          “uptime” : 200,<br>13.                          “optime” : Timestamp(1357285565000, 1),<br>14.                          “optimeDate” : ISODate(“2013-01-04T07:46:05Z”),<br>15.                          “self” : true<br>16.                  },<br>17.                  {<br>18.                          “_id” : 1,<br>19.                          “name” : “10.10.148.131:27017”,<br>20.                          “health” : 1,<br>21.                          “state” : 2,<br>22.                          “stateStr” : “SECONDARY”,<br>23.                          “uptime” : 200,<br>24.                          “optime” : Timestamp(1357285565000, 1),<br>25.                          “optimeDate” : ISODate(“2013-01-04T07:46:05Z”),<br>26.                          “lastHeartbeat” : ISODate(“2013-01-05T02:44:42Z”),<br>27.                          “pingMs” : 0<br>28.                  },<br>29.                  {<br>30.                          “_id” : 2,<br>31.                          “name” : “10.10.148.132:27017”,<br>32.                          “health” : 1,<br>33.                          “state” : 7,<br>34.                          “stateStr” : “ARBITER”,<br>35.                          “uptime” : 200,<br>36.                          “lastHeartbeat” : ISODate(“2013-01-05T02:44:42Z”),<br>37.                          “pingMs” : 0<br>38.                  }<br>39.          ],<br>40.          “ok” : 1<br>41.  }<br>如果配置正在生效，其中会包含如下信息：<br><br><div class="dp-highlighter bg_plain"><br><div class="bar"><br><div class="tools"><strong>[plain]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  “stateStr” : “RECOVERING”<br><br>同时可以查看对应节点的日志，发现正在等待别的节点生效或者正在分配数据文件。<br><br>       现在基本上已经完成了集群的所有搭建工作。至于测试工作，可以留给大家自己试试。一个是往主节点插入数据，能从备节点查到之前插入的数据（查询备节点可能会遇到某个问题，可以自己去网上查查看）。二是停掉主节点，备节点能变成主节点提供服务。三是恢复主节点，备节点也能恢复其备的角色，而不是继续充当主的角色。二和三都可以通过rs.status()命令实时查看集群的变化。<br><br>Sharding<br><br>和Replica Set类似，都需要一个仲裁节点，但是Sharding还需要配置节点和路由节点。就三种集群搭建方式来说，这种是最复杂的。部署图如下：<br><br><img src="http://img.my.csdn.net/uploads/201301/13/1358091861_1772.png" alt=""><br><br>1.启动数据节点<br><br><div class="dp-highlighter bg_plain"><br><div class="bar"><br><div class="tools"><strong>[plain]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  ./mongod –fork –dbpath ../data/set1/ –logpath ../log/set1.log –replSet test #192.168.4.43<br>2.  ./mongod –fork –dbpath ../data/set2/ –logpath ../log/set2.log –replSet test #192.168.4.44<br>3.  ./mongod –fork –dbpath ../data/set3/ –logpath ../log/set3.log –replSet test #192.168.4.45 决策 不存储数据<br><br>2.启动配置节点<br><br><div class="dp-highlighter bg_plain"><br><div class="bar"><br><div class="tools"><strong>[plain]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  ./mongod –configsvr –dbpath ../config/set1/ –port 20001 –fork –logpath ../log/conf1.log #192.168.4.30<br>2.  ./mongod –configsvr –dbpath ../config/set2/ –port 20002 –fork –logpath ../log/conf2.log #192.168.4.31<br><br>3.启动路由节点<br><br><div class="dp-highlighter bg_plain"><br><div class="bar"><br><div class="tools"><strong>[plain]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  ./mongos –configdb 192.168.4.30:20001,192.168.4.31:20002 –port 27017 –fork –logpath ../log/root.log #192.168.4.29<br><br>       这里我们没有用配置文件的方式启动，其中的参数意义大家应该都明白。一般来说一个数据节点对应一个配置节点，仲裁节点则不需要对应的配置节点。注意在启动路由节点时，要将配置节点地址写入到启动命令里。<br><br>4.配置Replica Set<br><br>       这里可能会有点奇怪为什么Sharding会需要配置Replica Set。其实想想也能明白，多个节点的数据肯定是相关联的，如果不配一个Replica Set，怎么标识是同一个集群的呢。这也是人家mongodb的规定，咱们还是遵守吧。配置方式和之前所说的一样，定一个cfg，然后初始化配置。<br><br><div class="dp-highlighter bg_plain"><br><div class="bar"><br><div class="tools"><strong>[plain]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  ./mongo 192.168.4.43:27017   #ip和port是某个节点的地址<br>2.  &gt;use admin<br>3.  &gt;cfg={ _id:”testrs”, members:[ {_id:0,host:’192.168.4.43:27017’,priority:2}, {_id:1,host:’192.168.4.44:27017’,priority:1},<br>4.  {_id:2,host:’192.168.4.45:27017’,arbiterOnly:true}] };<br>5.  &gt;rs.initiate(cfg)             #使配置生效<br><br>5.配置Sharding<br><br><div class="dp-highlighter bg_plain"><br><div class="bar"><br><div class="tools"><strong>[plain]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  ./mongo 192.168.4.29:27017   #这里必须连接路由节点<br>2.  &gt;sh.addShard(“test/192.168.4.43:27017”) #test表示replica set的名字 当把主节点添加到shard以后，会自动找到set里的主，备，决策节点<br>3.  &gt;db.runCommand({enableSharding:”diameter_test”})    #diameter_test is database name<br>4.  &gt;db.runCommand( { shardCollection: “diameter_test.dcca_dccr_test”,key:{“__avpSessionId”:1}})<br><br>       第一个命令很容易理解，第二个命令是对需要进行Sharding的数据库进行配置，第三个命令是对需要进行Sharding的Collection进行配置，这里的dcca_dccr_test即为Collection的名字。另外还有个key，这个是比较关键的东西，对于查询效率会有很大的影响，具体可以查看<a href="http://docs.mongodb.org/manual/core/sharding/#sharding-shard-key" target="_blank" rel="noopener">Shard Key Overview</a><br><br>       到这里Sharding也已经搭建完成了，以上只是最简单的搭建方式，其中某些配置仍然使用的是默认配置。如果设置不当，会导致效率异常低下，所以建议大家多看看官方文档再进行默认配置的修改。<br><br>Master-Slaver<br><br>这个是最简答的集群搭建，不过准确说也不能算是集群，只能说是主备。并且官方已经不推荐这种方式，所以在这里只是简单的介绍下吧，搭建方式也相对简单。<br><br><div class="dp-highlighter bg_plain"><br><div class="bar"><br><div class="tools"><strong>[plain]</strong> <a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="view plain" target="_blank" rel="noopener">view plain</a><a href="http://blog.csdn.net/luonanqin/article/details/8497860" title="copy" target="_blank" rel="noopener">copy</a><br><div><br><br>1.  ./mongod –master –dbpath /data/masterdb/      #主节点<br>2.<br>3.  ./mongod –slave –source <a href="masterip:masterport" target="_blank" rel="noopener">masterip:masterport</a> –dbpath /data/slavedb/     备节点<br><br>       基本上只要在主节点和备节点上分别执行这两条命令，Master-Slaver就算搭建完成了。我没有试过主节点挂掉后备节点是否能变成主节点，不过既然已经不推荐了，大家就没必要去使用了。<br><br>       以上三种集群搭建方式首选Replica Set，只有真的是大数据，Sharding才能显现威力，毕竟备节点同步数据是需要时间的。Sharding可以将多片数据集中到路由节点上进行一些对比，然后将数据返回给客户端，但是效率还是比较低的说。<br><br>       我自己有测试过，不过具体的机器配置已经不记得了。Replica Set的ips在数据达到1400w条时基本能达到1000左右，而Sharding在300w时已经下降到500ips了，两者的单位数据大小大概是10kb。大家在应用的时候还是多多做下性能测试，毕竟不像Redis有benchmark。<br><br>       Mongodb现在用的还是比较多的，但是个人觉得配置太多了。。。。我看官网都看了好多天，才把集群搭建的配置和注意要点弄明白。而且用过的人应该知道mongodb吃内存的问题，解决办法只能通过ulimit来控制内存使用量，但是如果控制不好的话，mongodb会挂掉。。。<br><br>过段时间我会写一篇关于项目里使用mongodb所涉及到的具体业务，各位有兴趣可以关注下。<br><br><div class="bdsharebuttonbox bdshare-button-style0-16" data-bd-bind="1429058603915"> </div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/18f733d1.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/18f733d1.html" itemprop="url">AngularJS 中文资料+工具+库+Demo 大搜集</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-03-19T14:25:00+08:00">
                2015-03-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="中文学习资料："><a href="#中文学习资料：" class="headerlink" title="中文学习资料："></a>中文学习资料：</h3><p>中文资料且成系统的就这么多，优酷上有个中文视频。</p>
<p><a href="http://www.cnblogs.com/lcllao/archive/2012/10/18/2728787.html" target="_blank" rel="noopener">http://www.cnblogs.com/lcllao/archive/2012/10/18/2728787.html</a>   翻译的官方的<a href="http://docs.angularjs.org/guide" target="_blank" rel="noopener">Guide</a></p>
<p><a href="http://www.ituring.com.cn/minibook/303" target="_blank" rel="noopener">http://www.ituring.com.cn/minibook/303</a>  翻译的官方的<a href="http://docs.angularjs.org/tutorial/" target="_blank" rel="noopener">tutorial</a></p>
<p><a href="http://www.lovelucy.info/angularjs-best-practices.html" target="_blank" rel="noopener">http://www.lovelucy.info/angularjs-best-practices.html</a>  Angular最佳实践</p>
<p><a href="http://zouyesheng.com/angular.html" target="_blank" rel="noopener">http://zouyesheng.com/angular.html</a>  angularjs的学习笔记</p>
<p><a href="http://www.sunzhongwei.com/angularjs.html" target="_blank" rel="noopener">http://www.sunzhongwei.com/angularjs.html</a> 另一个网友的笔记</p>
<p><a href="https://github.com/basestyle/angularjs-cn" target="_blank" rel="noopener">https://github.com/basestyle/angularjs-cn</a>  “AngularJS”中译本 -《AngularJS》</p>
<p><a href="https://github.com/jmcunningham/AngularJS-Learning/blob/master/CN-CN.md" target="_blank" rel="noopener">https://github.com/jmcunningham/AngularJS-Learning/blob/master/CN-CN.md</a>  github上的一个资料整理</p>
<h3 id="工具："><a href="#工具：" class="headerlink" title="工具："></a>工具：</h3><p><a href="https://chrome.google.com/webstore/detail/ighdmehidhipcmcojjgiloacoafjmpfk" target="_blank" rel="noopener">AngularJS WebInspector Extension for Chrome</a></p>
<p><a href="https://github.com/yeoman/generator-angular" target="_blank" rel="noopener">https://github.com/yeoman/generator-angular</a>   YeoMan的帮助创建angularjs APP</p>
<p><a href="https://github.com/johnlindquist/angularjs-plugin" target="_blank" rel="noopener">https://github.com/johnlindquist/angularjs-plugin</a> 适合Idea、WebStorm等Intellij平台的IDE插件</p>
<p><a href="https://github.com/angular-ui/AngularJS-sublime-package" target="_blank" rel="noopener">https://github.com/angular-ui/AngularJS-sublime-package</a>  Angularjs的Sublime插件</p>
<h3 id="库："><a href="#库：" class="headerlink" title="库："></a>库：</h3><p><a href="http://angular-ui.github.io/" target="_blank" rel="noopener">http://angular-ui.github.io/</a>  AngularUI - The companion suite for AngularJS</p>
<p><a href="http://twilson63.github.io/ngUpload/" target="_blank" rel="noopener">http://twilson63.github.io/ngUpload/</a>  上传文件的指令</p>
<p><a href="http://binarymuse.github.io/ngInfiniteScroll/" target="_blank" rel="noopener">http://binarymuse.github.io/ngInfiniteScroll/</a> 无限下拉</p>
<p><a href="https://github.com/btford/angular-dragon-drop" target="_blank" rel="noopener">https://github.com/btford/angular-dragon-drop</a>  拖拽的指令</p>
<h3 id="Demo："><a href="#Demo：" class="headerlink" title="Demo："></a>Demo：</h3><p>可以参考参考怎么组织代码</p>
<p><a href="https://github.com/tastejs/todomvc" target="_blank" rel="noopener">https://github.com/tastejs/todomvc</a>   帮助你选择MV* 框架，其中有一个angularjs的demo</p>
<p><a href="https://github.com/yearofmoo-articles/AngularJS-Animation-Article" target="_blank" rel="noopener">https://github.com/yearofmoo-articles/AngularJS-Animation-Article</a> </p>
<p><a href="https://github.com/zensh/jsgen" target="_blank" rel="noopener">https://github.com/zensh/jsgen</a>  angularjs+nodejs开发的一套社区软件</p>
<p><a href="https://github.com/btford/angular-express-seed" target="_blank" rel="noopener">https://github.com/btford/angular-express-seed</a> angularjs + express 骨架，想用这两者结合开发的可以参考下怎么组织代码结构</p>
<p><a href="https://github.com/btford/angular-express-blog" target="_blank" rel="noopener">https://github.com/btford/angular-express-blog</a> 用上面的框架写的一个简单的Blog系统</p>
<p><a href="https://github.com/bennadel/AngularJS-Routing" target="_blank" rel="noopener">https://github.com/bennadel/AngularJS-Routing</a> AngularJS - Deep Routing Example</p>
<p><a href="https://github.com/GoogleChrome/wReader-app" target="_blank" rel="noopener">https://github.com/GoogleChrome/wReader-app</a>  RSS Reader written using AngularJS</p>
<p><a href="https://github.com/btford/angular-socket-io-im" target="_blank" rel="noopener">https://github.com/btford/angular-socket-io-im</a>  angular + socket.io 开发的简单的Demo</p>
<p><a href="https://github.com/saberma/19wu" target="_blank" rel="noopener">https://github.com/saberma/19wu</a> 19屋源码 rails + angularjs</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/f1817f75.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/f1817f75.html" itemprop="url">Android 反编译apk 详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-03-06T15:27:00+08:00">
                2015-03-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>测试环境：</p>
<pre><code>win 7 
</code></pre><p>使用工具：</p>
<pre><code>CSDN上下载地址：

  **apktool （资源文件获取）  [下载](http://download.csdn.net/detail/vipzjyno1/7025111)  **
</code></pre><p><strong>       dex2jar（源码文件获取） <a href="http://download.csdn.net/detail/vipzjyno1/7025127" target="_blank" rel="noopener">下载</a></strong></p>
<p><strong>       jd-gui  （源码查看） <a href="http://download.csdn.net/detail/vipzjyno1/7025145" target="_blank" rel="noopener">下载</a></strong></p>
<p><strong>       </strong>Android反编译整合工具包（最新） <strong><a href="http://download.csdn.net/detail/vipzjyno1/7025729" target="_blank" rel="noopener">下载</a></strong></p>
<pre><code>官方最新版本下载地址：
</code></pre><p><strong>       </strong><a href="https://code.google.com/p/android-apktool/downloads/list" target="_blank" rel="noopener">apktool</a>（google code）</p>
<p><strong><a href="https://code.google.com/p/android-apktool/downloads/list" target="_blank" rel="noopener"> </a> </strong><a href="http://code.google.com/p/dex2jar/downloads/list" target="_blank" rel="noopener"><strong>dex2jar</strong></a>（google code）<strong>  </strong></p>
<p><a href="https://code.google.com/p/android-apktool/downloads/list" target="_blank" rel="noopener">  </a><strong> </strong><a href="http://code.google.com/p/innlab/downloads/list" target="_blank" rel="noopener">jd-gui</a>（google code）最新版请见<a href="http://java.decompiler.free.fr/?q=jdgui" target="_blank" rel="noopener">官方</a></p>
<p>工具介绍：</p>
<p><strong>apktool  </strong></p>
<p><strong>**     </strong>作用：资源文件获取，可以提取出图片文件和布局文件进行使用查看**</p>
<p><strong>dex2jar</strong></p>
<p><strong>     作用：将apk反编译成java源码（classes.dex转化成jar文件）</strong></p>
<p><strong>jd-gui</strong></p>
<p><strong>**     </strong>作用：查看APK中classes.dex转化成出的jar文件，即源码文件**</p>
<hr>
<p><strong>反编译流程：</strong></p>
<p><strong>一、apk</strong>反编译得到<strong>程序的源代码、图片、XML配置、语言资源等文件</strong></p>
<p>下载上述工具中的apktool，解压得到3个文件：aapt.exe，apktool.bat，apktool.jar ，将需要反编译的APK文件放到该目录下，</p>
<p><strong>打开命令行界面（运行-CMD） </strong>，定位到apktool文件夹，输入以下命令：<strong>apktool.bat d -f  test.apk  test    </strong></p>
<p><strong><img src="http://pangguoming.com/blog/images/63ee0c7f-03ee-49a3-833c-9664c46dfe62.jpg" alt="">  
</strong></p>
<p>（命令中test.apk指的是要反编译的APK文件全名，test为反编译后资源文件存放的目录名称，即为：apktool.bat   d  -f    [apk文件 ]   [输出文件夹]）</p>
<p><strong><img src="http://pangguoming.com/blog/images/bfa99221-3350-48a3-88e0-93774bf9ab14.jpg" alt=""></strong></p>
<p>说明获取成功，之后发现在文件夹下多了个test文件，点击便可以查看该应用的所有资源文件了。</p>
<p>如果你想将反编译完的文件重新打包成apk，那你可以：输入<strong>apktool.bat   b    test</strong>（你编译出来文件夹）便可，效果如下：</p>
<p><img src="http://pangguoming.com/blog/images/79f378ea-af08-43bc-9162-4a77b8cefa84.jpg" alt=""></p>
<p>之后在之前的test文件下便可以发现多了2个文件夹:</p>
<p>build</p>
<p>dist(里面存放着打包出来的APK文件)</p>
<p>二、Apk<strong>反编译</strong>得到Java源代码</p>
<p>下载上述工具中的dex2jar和<strong>jd-gui**</strong> ，解压**</p>
<p>将要反编译的APK后缀名改为.rar或则 .zip，并解压，得到其中的额classes.dex文件（它就是java文件编译再通过dx工具打包而成的），将获取到的<strong>classes.dex放到之前解压出来的工具dex2jar-0.0.9.15 文件夹内，</strong></p>
<p>在命令行下定位到dex2jar.bat所在目录，输入dex2jar.bat   classes.dex，效果如下：</p>
<p><strong><img src="http://pangguoming.com/blog/images/64650a08-d784-4602-b933-58ed7eef7a11.jpg" alt=""></strong></p>
<p><strong>在改目录下会生成一个</strong>classes_dex2jar.jar的文件，然后打开工具jd-gui文件夹里的jd-gui.exe，之后用该工具打开之前生成的classes_dex2jar.jar文件，便可以看到源码了，效果如下：</p>
<p><img src="http://pangguoming.com/blog/images/77ee2336-4d3d-42ee-8bdf-81000664290e.jpg" alt=""></p>
<p>被混淆过的效果图（类文件名称以及里面的方法名称都会以a,b,c….之类的样式命名）：</p>
<p><img src="http://pangguoming.com/blog/images/42c4162f-4b8b-457d-b714-35eb0e47af92.jpg" alt=""></p>
<p><strong>三、 图形化反编译apk（本人未使用过）</strong></p>
<p>上述步骤一、二讲述了命令行反编译apk，现在提供一种图形化反编译工具：Androidfby</p>
<p>首先，下载上述反编译工具包，打开Androidfby目录，双击Android反编译工具.exe，就可以浏览打开要反编译的apk</p>
<p><img src="http://pangguoming.com/blog/images/705c4482-aa25-44ba-9241-7d9cf1ddeb56.jpg" alt=""></p>
<p>通过反编译，你可以获知该应用用到了什么第3方的库文件，它的代码是如何编写的等等。</p>
<p>然而，如果该APK进行了混淆处理，那么你看到的类文件名称以及里面的方法名称都会以a,b,c….之类的样式命名，所以你可以想找到你所想得知的界面代码可能会十分费劲，找到了代码可能看起来也会很费劲，可是一个大体的思路会获得，有了这个思路，你就可以自己去尝试了。</p>
<p>本人曾经想写一个类似唱吧的名人界面布局，可是当初第一次接触不知道如何去写，进进行了反编译，即使他的那个代码是混淆过的，我也看出来他是通过LISTVIEW的TYPE设定不同的ITEM布局实现了。可能好多引用都是采用重写VIEW来实现效果，你可以得到他的大体思路对你的开发有益无害。</p>
<p>还有处于一个开发者辛辛苦苦将自己的应用开发出来被别人一反编译便成为了他自己的东西，所以要进行混淆处理：</p>
<p>以下是我转载的混淆的教程：<a href="http://blog.csdn.net/vipzjyno1/article/details/21042823" target="_blank" rel="noopener">http://blog.csdn.net/vipzjyno1/article/details/21042823</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/8a8702a8.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/8a8702a8.html" itemprop="url">Node.js 开发模式（设计模式）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-02-26T14:28:00+08:00">
                2015-02-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Asynchronous-code-amp-Synchronous-code"><a href="#Asynchronous-code-amp-Synchronous-code" class="headerlink" title="Asynchronous code &amp; Synchronous code"></a>Asynchronous code &amp; Synchronous code</h2><p>As we have seen in an earlier post (<a href="http://thejackalofjavascript.com/nodejs/" title="What is Nodejs" target="_blank" rel="noopener">here</a>), how node does things Asynchronously. For a “Traditional programmer”, this can be a tough pill to swallow. So lets take a look at how things can be done async.</p>
<p>Tradition programming</p>
<div id="crayon-54ee73aac25d6541546407" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">Sync Operation</span></span><br><div class="crayon-tools"><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac25d6541546407-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac25d6541546407-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac25d6541546407-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac25d6541546407-4">4<br><div class="crayon-num" data-line="crayon-54ee73aac25d6541546407-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac25d6541546407-6">6<br><div class="crayon-num" data-line="crayon-54ee73aac25d6541546407-7">7<br><br></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac25d6541546407-1" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">result<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">db<span class="crayon-sy">.<span class="crayon-e">query<span class="crayon-sy">(<span class="crayon-s">“select <em> from someTable”<span class="crayon-sy">)<span class="crayon-sy">;</span></span></em></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac25d6541546407-2" class="crayon-line crayon-striped-line"><span class="crayon-c">// use the result here and do something</span><br><div id="crayon-54ee73aac25d6541546407-3" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">doSomething<span class="crayon-h">  <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac25d6541546407-4" class="crayon-line crayon-striped-line"><span class="crayon-h">   <span class="crayon-c">// doing something totally unrelated to the db call.</span></span><br><div id="crayon-54ee73aac25d6541546407-5" class="crayon-line"><span class="crayon-sy">}<span class="crayon-sy">;</span></span><br><div id="crayon-54ee73aac25d6541546407-6" class="crayon-line crayon-striped-line"><br><div id="crayon-54ee73aac25d6541546407-7" class="crayon-line"><span class="crayon-e">doSomething<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;<span class="crayon-h"> <span class="crayon-c">// This will be blocked till the db response has arrived.</span></span></span></span></span></span><br><br></div></div></div></div></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>Here the  <span id="crayon-54ee73aac25ea974056651" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-e">doSomething<span class="crayon-sy">(<span class="crayon-sy">) executes a set of statements that are not dependent on the response of the db call. But it has to wait till the db operation is completed. This is why we have a server like Node to take care of all the I/O threads separately.</span></span></span></span></span><br><br>So in an async world, the same will be written like this<br><br><div id="crayon-54ee73aac25f2329723749" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">Async</span></span><br><div class="crayon-tools"><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac25f2329723749-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac25f2329723749-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac25f2329723749-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac25f2329723749-4">4<br><div class="crayon-num" data-line="crayon-54ee73aac25f2329723749-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac25f2329723749-6">6<br><div class="crayon-num" data-line="crayon-54ee73aac25f2329723749-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac25f2329723749-8">8<br><div class="crayon-num" data-line="crayon-54ee73aac25f2329723749-9">9<br><br></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac25f2329723749-1" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">result<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">db<span class="crayon-sy">.<span class="crayon-e">query<span class="crayon-sy">(<span class="crayon-s">“select  from someTable”<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac25f2329723749-2" class="crayon-line crayon-striped-line"><span class="crayon-c">// use the result here and do something</span><br><div id="crayon-54ee73aac25f2329723749-3" class="crayon-line"><span class="crayon-sy">}<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span><br><div id="crayon-54ee73aac25f2329723749-4" class="crayon-line crayon-striped-line"><br><div id="crayon-54ee73aac25f2329723749-5" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">doSomething<span class="crayon-h">  <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac25f2329723749-6" class="crayon-line crayon-striped-line"><span class="crayon-h">   <span class="crayon-c">// doing something totally unrelated to the db call.</span></span><br><div id="crayon-54ee73aac25f2329723749-7" class="crayon-line"><span class="crayon-sy">}<span class="crayon-sy">;</span></span><br><div id="crayon-54ee73aac25f2329723749-8" class="crayon-line crayon-striped-line"><br><div id="crayon-54ee73aac25f2329723749-9" class="crayon-line"><span class="crayon-e">doSomething<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;<span class="crayon-h"> <span class="crayon-c">// The DB request gets fired and doSomething() will get executed after that.</span></span></span></span></span></span><br><br></div></div></div></div></div></div></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>Here, the DB request gets fired and <span id="crayon-54ee73aac25fa560147026" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-e">doSomething<span class="crayon-sy">(<span class="crayon-sy">)  will get executed immediately after that. All the actions happen async. Its Node’s event loop’s responsibility to take care of I/O operations and fire the registered callback.</span></span></span></span></span><br><br>Now, life is always not that simple is it? (<em>tell me about it!..</em>) Take a look at this example<br><br><div id="crayon-54ee73aac2601959606597" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">Complex Async</span></span><br><div class="crayon-tools"><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac2601959606597-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2601959606597-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac2601959606597-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2601959606597-4">4<br><div class="crayon-num" data-line="crayon-54ee73aac2601959606597-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2601959606597-6">6<br><br></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac2601959606597-1" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">result<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">db<span class="crayon-sy">.<span class="crayon-e">query<span class="crayon-sy">(<span class="crayon-s">“select <em> from someTable”<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">data<span class="crayon-sy">)<span class="crayon-sy">{</span></span></span></span></span></span></span></em></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2601959606597-2" class="crayon-line crayon-striped-line"><span class="crayon-h">   <span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">userId<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">data<span class="crayon-sy">.<span class="crayon-e">get<span class="crayon-sy">(<span class="crayon-cn">1<span class="crayon-sy">)<span class="crayon-sy">.<span class="crayon-v">id<span class="crayon-sy">;<span class="crayon-h">  </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2601959606597-3" class="crayon-line"><span class="crayon-h">   <span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">subQResult<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">db<span class="crayon-sy">.<span class="crayon-e">query<span class="crayon-sy">(<span class="crayon-s">“select  from someOtherTable where id=”<span class="crayon-o">+<span class="crayon-v">userId<span class="crayon-o">+<span class="crayon-s">“;”<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">userData<span class="crayon-sy">)<span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2601959606597-4" class="crayon-line crayon-striped-line"><span class="crayon-h">      <span class="crayon-c">// some more info.. and the fire another db call! </span></span><br><div id="crayon-54ee73aac2601959606597-5" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}<span class="crayon-sy">)<span class="crayon-sy">;<span class="crayon-h">       </span></span></span></span></span><br><div id="crayon-54ee73aac2601959606597-6" class="crayon-line crayon-striped-line"><span class="crayon-sy">}<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span><br><br></div></div></div></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>or<br><br><div id="crayon-54ee73aac2608748380267" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">Complex file reader</span></span><br><div class="crayon-tools"><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac2608748380267-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2608748380267-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac2608748380267-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2608748380267-4">4<br><div class="crayon-num" data-line="crayon-54ee73aac2608748380267-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2608748380267-6">6<br><div class="crayon-num" data-line="crayon-54ee73aac2608748380267-7">7<br><br></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac2608748380267-1" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">file<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">fs<span class="crayon-sy">.<span class="crayon-e">readFile<span class="crayon-sy">(<span class="crayon-s">“/usr/bin”<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">data<span class="crayon-sy">)<span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2608748380267-2" class="crayon-line crayon-striped-line"><span class="crayon-h">   <span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">listOfFiles<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">data<span class="crayon-sy">.<span class="crayon-e">getContents<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2608748380267-3" class="crayon-line"><span class="crayon-h">   <span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">anotherFile<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">fs<span class="crayon-sy">.<span class="crayon-e">readFile<span class="crayon-sy">(<span class="crayon-v">listOfFiles<span class="crayon-sy">[<span class="crayon-cn">0<span class="crayon-sy">]<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">userIDs<span class="crayon-sy">)<span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2608748380267-4" class="crayon-line crayon-striped-line"><span class="crayon-h">       <span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">user<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">userIds<span class="crayon-sy">[<span class="crayon-cn">0<span class="crayon-sy">]<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2608748380267-5" class="crayon-line"><span class="crayon-h">       <span class="crayon-c">// Call db and get the data for this user</span></span><br><div id="crayon-54ee73aac2608748380267-6" class="crayon-line crayon-striped-line"><span class="crayon-h">   <span class="crayon-sy">}<span class="crayon-sy">)<span class="crayon-sy">;<span class="crayon-h">    </span></span></span></span></span><br><div id="crayon-54ee73aac2608748380267-7" class="crayon-line"><span class="crayon-sy">}<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span><br><br></div></div></div></div></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>Very nested and convoluted? So can we fix this whole nested thing? Yes, you can use any of the following modules<br><br><em>   <a href="http://github.com/willconant/flow-js" target="_blank" rel="noopener">flow-js</a>
</em>   <a href="https://github.com/FuturesJS/FuturesJS" target="_blank" rel="noopener">future js</a><br><em>   <a href="https://github.com/fjakobs/async.js" target="_blank" rel="noopener">async.js</a><br><br>So our code will turn into<br><br><div id="crayon-54ee73aac2610892665424" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">Flowjs - Async Simplification</span></span><br><div class="crayon-tools"><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac2610892665424-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2610892665424-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac2610892665424-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2610892665424-4">4<br><div class="crayon-num" data-line="crayon-54ee73aac2610892665424-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2610892665424-6">6<br><div class="crayon-num" data-line="crayon-54ee73aac2610892665424-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2610892665424-8">8<br><div class="crayon-num" data-line="crayon-54ee73aac2610892665424-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2610892665424-10">10<br><div class="crayon-num" data-line="crayon-54ee73aac2610892665424-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2610892665424-12">12<br><div class="crayon-num" data-line="crayon-54ee73aac2610892665424-13">13<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac2610892665424-1" class="crayon-line"><span class="crayon-v">flow<span class="crayon-sy">.<span class="crayon-e">exec<span class="crayon-sy">(</span></span></span></span><br><div id="crayon-54ee73aac2610892665424-2" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span><br><div id="crayon-54ee73aac2610892665424-3" class="crayon-line"><span class="crayon-h">        <span class="crayon-e">readFile<span class="crayon-sy">(<span class="crayon-s">“/usr/bin”<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-r">this<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2610892665424-4" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-c">// process data</span></span><br><div id="crayon-54ee73aac2610892665424-5" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}<span class="crayon-sy">,<span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">url<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2610892665424-6" class="crayon-line crayon-striped-line"><span class="crayon-h">       <span class="crayon-c">// get some other file       </span></span><br><div id="crayon-54ee73aac2610892665424-7" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}<span class="crayon-sy">,<span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">userIDs<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2610892665424-8" class="crayon-line crayon-striped-line"><span class="crayon-h">       <span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">user<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">userIds<span class="crayon-sy">[<span class="crayon-cn">0<span class="crayon-sy">]<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2610892665424-9" class="crayon-line"><span class="crayon-h">        <span class="crayon-c">// and so on      </span></span><br><div id="crayon-54ee73aac2610892665424-10" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}<span class="crayon-sy">,<span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2610892665424-11" class="crayon-line"><span class="crayon-h">        <span class="crayon-e">completedAll<span class="crayon-sy">(<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-54ee73aac2610892665424-12" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-54ee73aac2610892665424-13" class="crayon-line"><span class="crayon-sy">)<span class="crayon-sy">;</span></span><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>Now, lets take a look at Node’s Modules.<br><br>## Node Modules<br><br>If you have interacted with programming languages like C, C++, Java, .Net or PHP, you would have seen statements like <span id="crayon-54ee73aac2617409485493" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-v">import  <span id="crayon-54ee73aac261e863556876" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-v">using  <span id="crayon-54ee73aac2624351756492" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-p">#include  <span id="crayon-54ee73aac262a928504263" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-v">include or  <span id="crayon-54ee73aac2630480765997" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-v">require to get external files/libraries to your current file. Since the code is isolated in these programming languages, we need to explicitly include the required libraries.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><br>But, Javascript runs everything in the global scope and does not have a partition between variables/functions or variables/functions of a file. In simple, there is no namespacing!.<br><br>If you have 3 files, <span id="crayon-54ee73aac2637548951009" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-v">fileOne<span class="crayon-sy">.<span class="crayon-v">js , <span id="crayon-54ee73aac263e880108362" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-v">fileTwo<span class="crayon-sy">.<span class="crayon-v">js  &amp; <span id="crayon-54ee73aac2655334011921" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-v">fileThree<span class="crayon-sy">.<span class="crayon-v">js  and you loaded them in your browser in the same order, The function definition or variable values of the prior will be overridden by the later without any warnings.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><br>Lets say fileOne has a method called <span id="crayon-54ee73aac265c582847751" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-e">add<span class="crayon-sy">(<span class="crayon-v">num1<span class="crayon-sy">,<span class="crayon-v">num2<span class="crayon-sy">)<span class="crayon-sy">;  which adds two numbers &amp; fileTwo has a method called <span id="crayon-54ee73aac2663349407189" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-e">add<span class="crayon-sy">(<span class="crayon-v">str1<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">str2<span class="crayon-sy">)<span class="crayon-sy">;  which concats’ two strings. And fileThree is calling the<span id="crayon-54ee73aac266a740479976" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-e">add<span class="crayon-sy">(<span class="crayon-cn">5<span class="crayon-sy">,<span class="crayon-cn">4<span class="crayon-sy">)<span class="crayon-sy">;  expecting the method to return the sum. But instead, it receives a concatenated string.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><br>This phenomenon in the programming world is called as the </div></div></div></div></div></em>“spaghetti code”. <em>Unless you are careful about your variables names, you might override someone else’s code or some one might override yours!<br><br>So we need to use a dependency management system, that will take care of things like these. Node uses **</em>CommonJs Modules<strong><em> for handling dependency.<br><br>CommonJS dependency management revolves around two methods <span id="crayon-54ee73aac2671306674567" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-v">exports  &amp;  <span id="crayon-54ee73aac267a053267867" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-v">require.</span></span></span></span></span></span><br><br>Let’s reconsider the above example, and implement the same via CommonJs modules.<br><br>fileOne.js<br><br><div id="crayon-54ee73aac2682765474727" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">fileOne.js</span></span><br><div class="crayon-tools"><br><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><br><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><br><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><br><div class="crayon-button crayon-copy-button" title="Copy"><br><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><br><span class="crayon-language">JavaScript</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac2682765474727-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2682765474727-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac2682765474727-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2682765474727-4">4<br><div class="crayon-num" data-line="crayon-54ee73aac2682765474727-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2682765474727-6">6<br><br></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac2682765474727-1" class="crayon-line"><span class="crayon-v">exports<span class="crayon-sy">.<span class="crayon-v">add<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">a<span class="crayon-sy">,<span class="crayon-v">b<span class="crayon-sy">)<span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2682765474727-2" class="crayon-line crayon-striped-line"><span class="crayon-st">if<span class="crayon-sy">(<span class="crayon-o">!<span class="crayon-e">isNaN<span class="crayon-sy">(<span class="crayon-v">a<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-o">&amp;&amp;<span class="crayon-h"> <span class="crayon-o">!<span class="crayon-e">isNaN<span class="crayon-sy">(<span class="crayon-v">b<span class="crayon-sy">)<span class="crayon-sy">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2682765474727-3" class="crayon-line"><span class="crayon-h"> <span class="crayon-st">return<span class="crayon-h"> <span class="crayon-r">parseInt<span class="crayon-sy">(<span class="crayon-v">a<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-o">+<span class="crayon-h"> <span class="crayon-r">parseInt<span class="crayon-sy">(<span class="crayon-v">b<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2682765474727-4" class="crayon-line crayon-striped-line"><span class="crayon-st">else</span><br><div id="crayon-54ee73aac2682765474727-5" class="crayon-line"><span class="crayon-h"> <span class="crayon-st">return<span class="crayon-h"> <span class="crayon-s">“Invalid data”<span class="crayon-sy">;</span></span></span></span></span><br><div id="crayon-54ee73aac2682765474727-6" class="crayon-line crayon-striped-line"><span class="crayon-sy">}<span class="crayon-sy">;</span></span><br><br></div></div></div></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>fileTwo.js<br><br><div id="crayon-54ee73aac268c767736495" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">fileTwo.js</span></span><br><div class="crayon-tools"><br><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><br><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><br><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><br><div class="crayon-button crayon-copy-button" title="Copy"><br><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><br><span class="crayon-language">JavaScript</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac268c767736495-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac268c767736495-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac268c767736495-3">3<br><br></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac268c767736495-1" class="crayon-line"><span class="crayon-v">exports<span class="crayon-sy">.<span class="crayon-v">add<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">a<span class="crayon-sy">,<span class="crayon-v">b<span class="crayon-sy">)<span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac268c767736495-2" class="crayon-line crayon-striped-line"><span class="crayon-h"> <span class="crayon-st">return<span class="crayon-h"> <span class="crayon-v">a<span class="crayon-h"> <span class="crayon-o">+<span class="crayon-h"> <span class="crayon-v">b<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac268c767736495-3" class="crayon-line"><span class="crayon-sy">}<span class="crayon-sy">;</span></span><br><br></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>and now in fileThree.js<br><br><div id="crayon-54ee73aac2694791977855" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">fileThree.js</span></span><br><div class="crayon-tools"><br><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><br><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><br><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><br><div class="crayon-button crayon-copy-button" title="Copy"><br><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><br><span class="crayon-language">JavaScript</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac2694791977855-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2694791977855-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac2694791977855-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac2694791977855-4">4<br><br></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac2694791977855-1" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">moduleOne<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-e">require<span class="crayon-sy">(<span class="crayon-s">“./fileOne”<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2694791977855-2" class="crayon-line crayon-striped-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">moduleTwo<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-e">require<span class="crayon-sy">(<span class="crayon-s">“./fileTwo”<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac2694791977855-3" class="crayon-line"><br><div id="crayon-54ee73aac2694791977855-4" class="crayon-line crayon-striped-line"><span class="crayon-v">console<span class="crayon-sy">.<span class="crayon-e">log<span class="crayon-sy">(<span class="crayon-v">moduleOne<span class="crayon-sy">.<span class="crayon-e">add<span class="crayon-sy">(<span class="crayon-cn">5<span class="crayon-sy">,<span class="crayon-cn">4<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;<span class="crayon-h"> <span class="crayon-c">// This will be the sum for sure!!</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><br></div></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>Neat right? Node uses this for its dependency management &amp; name-spacing and you need to when you are developing code around Node.<br><br>## Javascript’s Callback

</div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></em>A call back basically is a function that will get invoked after the initiated task is completed.<em><br><br>That means, I want do something after some other thing is completed. Like, after 5 seconds fire an alert.<br><br><div id="crayon-54ee73aac269d039485506" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">SetTimeOut</span></span><br><div class="crayon-tools"><br><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><br><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><br><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><br><div class="crayon-button crayon-copy-button" title="Copy"><br><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><br><span class="crayon-language">JavaScript</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac269d039485506-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac269d039485506-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac269d039485506-3">3<br><br></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac269d039485506-1" class="crayon-line"><span class="crayon-e">setTimeOut<span class="crayon-sy">(<span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">{</span></span></span></span></span></span><br><div id="crayon-54ee73aac269d039485506-2" class="crayon-line crayon-striped-line"><span class="crayon-h">  <span class="crayon-r">alert<span class="crayon-sy">(<span class="crayon-s">“I had to wait for 521ms before I am shown!”<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span><br><div id="crayon-54ee73aac269d039485506-3" class="crayon-line"><span class="crayon-sy">}<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-cn">521<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span><br><br></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>Or in Node, since everything is async, the callback gets fired on completion of an I/O operation.<br><br><div id="crayon-54ee73aac26a4566447520" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">Node I/O</span></span><br><div class="crayon-tools"><br><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><br><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><br><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><br><div class="crayon-button crayon-copy-button" title="Copy"><br><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><br><span class="crayon-language">JavaScript</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac26a4566447520-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26a4566447520-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac26a4566447520-3">3<br><br></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac26a4566447520-1" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">results<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">db<span class="crayon-sy">.<span class="crayon-e">query<span class="crayon-sy">(<span class="crayon-s">“select </span></span></span></span></span></span></span></span></span></span></span></div></div></td></tr></tbody></table></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></em> from someTable”<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">data<span class="crayon-sy">)<span class="crayon-sy">{</span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26a4566447520-2" class="crayon-line crayon-striped-line"><span class="crayon-h"> <span class="crayon-c">// I am a callback!!. I will be fired only after the query operation is completed.</span></span><br><div id="crayon-54ee73aac26a4566447520-3" class="crayon-line"><span class="crayon-sy">}<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span><br><br></div></div></strong></div></div><br><br><br><br><br>Callback function can be named or anonymous.<br><br>As we have seen earlier, nesting callbacks can be a nightmare for code readability. We have also seen libraries like async would help clean the code for us. Another way to implement the same without any external module is<br><br><div id="crayon-54ee73aac26ac441349307" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">Callback Named Functions</span></span><br><div class="crayon-tools"><br><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><br><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><br><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><br><div class="crayon-button crayon-expand-button" title="Expand Code"><br><div class="crayon-button crayon-copy-button" title="Copy"><br><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><br><span class="crayon-language">JavaScript</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac26ac441349307-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ac441349307-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac26ac441349307-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ac441349307-4">4<br><div class="crayon-num" data-line="crayon-54ee73aac26ac441349307-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ac441349307-6">6<br><div class="crayon-num" data-line="crayon-54ee73aac26ac441349307-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ac441349307-8">8<br><div class="crayon-num" data-line="crayon-54ee73aac26ac441349307-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ac441349307-10">10<br><div class="crayon-num" data-line="crayon-54ee73aac26ac441349307-11">11<br><br></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac26ac441349307-1" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">result<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">db<span class="crayon-sy">.<span class="crayon-e">query<span class="crayon-sy">(<span class="crayon-s">“select <em> from someTable”<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">processData<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></em></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ac441349307-2" class="crayon-line crayon-striped-line"><br><div id="crayon-54ee73aac26ac441349307-3" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">processData<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">data<span class="crayon-sy">)</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ac441349307-4" class="crayon-line crayon-striped-line"><span class="crayon-sy">{</span><br><div id="crayon-54ee73aac26ac441349307-5" class="crayon-line"><span class="crayon-h">  <span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">userId<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">data<span class="crayon-sy">.<span class="crayon-e">get<span class="crayon-sy">(<span class="crayon-cn">1<span class="crayon-sy">)<span class="crayon-sy">.<span class="crayon-v">id<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ac441349307-6" class="crayon-line crayon-striped-line"><span class="crayon-h">  <span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">subQResult<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">db<span class="crayon-sy">.<span class="crayon-e">query<span class="crayon-sy">(<span class="crayon-s">“select  from someOtherTable where id=”<span class="crayon-o">+<span class="crayon-v">userId<span class="crayon-o">+<span class="crayon-s">“;”<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">processSomeMoreData<span class="crayon-sy">)<span class="crayon-sy">;<span class="crayon-h">  </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ac441349307-7" class="crayon-line"><span class="crayon-sy">}<span class="crayon-sy">;</span></span><br><div id="crayon-54ee73aac26ac441349307-8" class="crayon-line crayon-striped-line"><br><div id="crayon-54ee73aac26ac441349307-9" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">processSomeMoreData<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">userData<span class="crayon-sy">)<span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ac441349307-10" class="crayon-line crayon-striped-line"><span class="crayon-h">  <span class="crayon-c">// some more info.. and the fire another db call! </span></span><br><div id="crayon-54ee73aac26ac441349307-11" class="crayon-line"><span class="crayon-sy">}<span class="crayon-sy">;</span></span><br><br></div></div></div></div></div></div></div></div></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>*Any async function in node accepts a callback as it’s last parameter.<em>**<br><br>So, this is what you can expect from Node.<br><br><div id="crayon-54ee73aac26b3076688727" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">Node Callback</span></span><br><div class="crayon-tools"><br><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><br><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><br><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><br><div class="crayon-button crayon-copy-button" title="Copy"><br><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><br><span class="crayon-language">JavaScript</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac26b3076688727-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26b3076688727-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac26b3076688727-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26b3076688727-4">4<br><br></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac26b3076688727-1" class="crayon-line"><span class="crayon-e">myNodeFunction<span class="crayon-sy">(<span class="crayon-v">arg1<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">arg2<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">callback<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26b3076688727-2" class="crayon-line crayon-striped-line"><span class="crayon-e">myOtherNodeFunction<span class="crayon-sy">(<span class="crayon-v">arg1<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">arg2<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">arg3<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">callback<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26b3076688727-3" class="crayon-line"><br><div id="crayon-54ee73aac26b3076688727-4" class="crayon-line crayon-striped-line"><span class="crayon-t">function<span class="crayon-h"> <span class="crayon-e">callback<span class="crayon-sy">(<span class="crayon-v">err<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">result<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{<span class="crayon-h"> <span class="crayon-sy">.<span class="crayon-sy">.<span class="crayon-sy">.<span class="crayon-h"> <span class="crayon-sy">}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><br></div></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>And the callback function’s first argument is always an error object (if there an error, else null) and the second argument is the results from the parent Function.<br><br>## The Event Emitter Pattern<br><br>Let’s take a look at some sample code first<br><br><div id="crayon-54ee73aac26ba696065222" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">Event Driven</span></span><br><div class="crayon-tools"><br><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><br><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><br><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><br><div class="crayon-button crayon-copy-button" title="Copy"><br><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><br><span class="crayon-language">JavaScript</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac26ba696065222-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ba696065222-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac26ba696065222-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ba696065222-4">4<br><div class="crayon-num" data-line="crayon-54ee73aac26ba696065222-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ba696065222-6">6<br><div class="crayon-num" data-line="crayon-54ee73aac26ba696065222-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ba696065222-8">8<br><div class="crayon-num" data-line="crayon-54ee73aac26ba696065222-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ba696065222-10">10<br><div class="crayon-num" data-line="crayon-54ee73aac26ba696065222-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ba696065222-12">12<br><div class="crayon-num" data-line="crayon-54ee73aac26ba696065222-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ba696065222-14">14<br><div class="crayon-num" data-line="crayon-54ee73aac26ba696065222-15">15<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ba696065222-16">16<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac26ba696065222-1" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">net<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-e">require<span class="crayon-sy">(<span class="crayon-s">‘net’<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ba696065222-2" class="crayon-line crayon-striped-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">port<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-cn">1235<span class="crayon-sy">;</span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ba696065222-3" class="crayon-line"><br><div id="crayon-54ee73aac26ba696065222-4" class="crayon-line crayon-striped-line"><span class="crayon-v">net<span class="crayon-sy">.<span class="crayon-e">createServer<span class="crayon-sy">(<span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">socket<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{<span class="crayon-h">    </span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ba696065222-5" class="crayon-line"><span class="crayon-h">    <span class="crayon-v">console<span class="crayon-sy">.<span class="crayon-e">log<span class="crayon-sy">(<span class="crayon-s">‘A new client connected’<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ba696065222-6" class="crayon-line crayon-striped-line"><br><div id="crayon-54ee73aac26ba696065222-7" class="crayon-line"><span class="crayon-h">    <span class="crayon-v">socket<span class="crayon-sy">.<span class="crayon-e">on<span class="crayon-sy">(<span class="crayon-s">‘data’<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">data<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ba696065222-8" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-v">console<span class="crayon-sy">.<span class="crayon-e">log<span class="crayon-sy">(<span class="crayon-s">‘Data received from client : ‘<span class="crayon-o">+<span class="crayon-v">data<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ba696065222-9" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span><br><div id="crayon-54ee73aac26ba696065222-10" class="crayon-line crayon-striped-line"><span class="crayon-h">     <span class="crayon-v">socket<span class="crayon-sy">.<span class="crayon-e">on<span class="crayon-sy">(<span class="crayon-s">‘close’<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-v">data<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ba696065222-11" class="crayon-line"><span class="crayon-h">        <span class="crayon-v">console<span class="crayon-sy">.<span class="crayon-e">log<span class="crayon-sy">(<span class="crayon-s">‘A client disconnected’<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ba696065222-12" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span><br><div id="crayon-54ee73aac26ba696065222-13" class="crayon-line"><br><div id="crayon-54ee73aac26ba696065222-14" class="crayon-line crayon-striped-line"><span class="crayon-sy">}<span class="crayon-sy">)<span class="crayon-sy">.<span class="crayon-e">listen<span class="crayon-sy">(<span class="crayon-v">port<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-s">“localhost”<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ba696065222-15" class="crayon-line"><br><div id="crayon-54ee73aac26ba696065222-16" class="crayon-line crayon-striped-line"><span class="crayon-v">console<span class="crayon-sy">.<span class="crayon-e">log<span class="crayon-sy">(<span class="crayon-s">“Server Running on “<span class="crayon-o">+<span class="crayon-v">port<span class="crayon-o">+<span class="crayon-s">“.\nLaunch <a href="http://localhost:&quot;" target="_blank" rel="noopener">http://localhost:&quot;</a><span class="crayon-o">+<span class="crayon-v">port<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>The above code is a simple TCP server. Lines 4,7 &amp; 10 register events. And the server gets created. When a client navigates to  <span id="crayon-54ee73aac26c1462071907" class="crayon-syntax crayon-syntax-inline crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-v">http<span class="crayon-o">:<span class="crayon-c">//localhost:1235 the server starts to listen to the new client. And registers events when a data comes in &amp; when a client disconnects from the server.</span></span></span></span></span><br><br>So when a client connects, we see a console log about the connection. We wait.. wait.. wait.. and then the client emits a data event, the server logs it &amp; finally the client disconnects.<br><br>This model is also called as the “</div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></em>PubSub” -<em> A publisher-subscriber. For all you jQuery devs out there, you know this!! (You register an event on a button click and write some code and wait for the button click). Some call this as </em>Observable <em>pattern. You can figure this out <a href="http://stackoverflow.com/a/15596131/1015046" title="PubSub vs Observer" target="_blank" rel="noopener">here</a>.<br><br>So, In simple, our server code will get executed only if there is an action.This is a simple example of event driven development in Node.<br><br>Node provides an option to write &amp; trigger custom event too. Take an example of a baseball<br><br><div id="crayon-54ee73aac26ca740922325" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">Event Emitter</span></span><br><div class="crayon-tools"><br><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><br><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><br><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><br><div class="crayon-button crayon-copy-button" title="Copy"><br><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><br><span class="crayon-language">JavaScript</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac26ca740922325-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ca740922325-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac26ca740922325-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ca740922325-4">4<br><div class="crayon-num" data-line="crayon-54ee73aac26ca740922325-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ca740922325-6">6<br><div class="crayon-num" data-line="crayon-54ee73aac26ca740922325-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ca740922325-8">8<br><div class="crayon-num" data-line="crayon-54ee73aac26ca740922325-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ca740922325-10">10<br><div class="crayon-num" data-line="crayon-54ee73aac26ca740922325-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ca740922325-12">12<br><div class="crayon-num" data-line="crayon-54ee73aac26ca740922325-13">13<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac26ca740922325-1" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">events<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-e">require<span class="crayon-sy">(<span class="crayon-s">‘events’<span class="crayon-sy">)<span class="crayon-sy">;<span class="crayon-h"> <span class="crayon-c">// require events</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ca740922325-2" class="crayon-line crayon-striped-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">eventEmitter<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-r">new<span class="crayon-h"> <span class="crayon-v">events<span class="crayon-sy">.<span class="crayon-e">EventEmitter<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;<span class="crayon-h"> <span class="crayon-c">// create a new instance</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ca740922325-3" class="crayon-line"><br><div id="crayon-54ee73aac26ca740922325-4" class="crayon-line crayon-striped-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">homeRun<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-sy">)</span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ca740922325-5" class="crayon-line"><span class="crayon-sy">{</span><br><div id="crayon-54ee73aac26ca740922325-6" class="crayon-line crayon-striped-line"><span class="crayon-h">  <span class="crayon-v">console<span class="crayon-sy">.<span class="crayon-e">log<span class="crayon-sy">(<span class="crayon-s">‘Home Run!!’<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ca740922325-7" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-54ee73aac26ca740922325-8" class="crayon-line crayon-striped-line"><br><div id="crayon-54ee73aac26ca740922325-9" class="crayon-line"><span class="crayon-c">// Register an event for ‘swing’</span><br><div id="crayon-54ee73aac26ca740922325-10" class="crayon-line crayon-striped-line"><span class="crayon-v">eventEmitter<span class="crayon-sy">.<span class="crayon-e">on<span class="crayon-sy">(<span class="crayon-s">‘swing’<span class="crayon-sy">,<span class="crayon-v">homeRun<span class="crayon-sy">)<span class="crayon-sy">;<span class="crayon-h"> <span class="crayon-c">// yay!!</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ca740922325-11" class="crayon-line"><br><div id="crayon-54ee73aac26ca740922325-12" class="crayon-line crayon-striped-line"><span class="crayon-c">// Ball pitched.. So lets emit a ‘swing’ </span><br><div id="crayon-54ee73aac26ca740922325-13" class="crayon-line"><span class="crayon-e">event <span class="crayon-v">eventEmitter<span class="crayon-sy">.<span class="crayon-e">emit<span class="crayon-sy">(<span class="crayon-s">‘swing’<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>What happened here?

</div></div></div></div></div></div></div></div></div></div></em>   We created a response ( <span id="crayon-54ee73aac26d1536885971" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-e">homeRun<span class="crayon-sy">(<span class="crayon-sy">))</span></span></span></span></span><br><em>   We registered an event (‘ <span id="crayon-54ee73aac26d7961963973" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-v">swing’) passing the callback ( <span id="crayon-54ee73aac26dd266621577" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-e">homeRun<span class="crayon-sy">(<span class="crayon-sy">))</span></span></span></span></span></span></span></span>
</em>   We Emitted the event (‘ <span id="crayon-54ee73aac26e3197192534" class="crayon-syntax crayon-syntax-inline  crayon-theme-arduino-ide crayon-theme-arduino-ide-inline crayon-font-droid-sans-mono"><span class="crayon-pre crayon-code"><span class="crayon-v">swing’)</span></span></span><br><br>Apart from the above way of implementing the eventEmitter, we can inherit the same too. What do I mean? Take a look at this<br><br><div id="crayon-54ee73aac26ea334329181" class="crayon-syntax crayon-theme-arduino-ide crayon-font-droid-sans-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><br><div class="crayon-toolbar" data-settings=" show"><span class="crayon-title"><span class="crayon-title">Baseball Swing</span></span><br><div class="crayon-tools"><br><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><br><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><br><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><br><div class="crayon-button crayon-expand-button" title="Expand Code"><br><div class="crayon-button crayon-copy-button" title="Copy"><br><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><br><span class="crayon-language">JavaScript</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-54ee73aac26ea334329181-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ea334329181-2">2<br><div class="crayon-num" data-line="crayon-54ee73aac26ea334329181-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ea334329181-4">4<br><div class="crayon-num" data-line="crayon-54ee73aac26ea334329181-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ea334329181-6">6<br><div class="crayon-num" data-line="crayon-54ee73aac26ea334329181-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ea334329181-8">8<br><div class="crayon-num" data-line="crayon-54ee73aac26ea334329181-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ea334329181-10">10<br><div class="crayon-num" data-line="crayon-54ee73aac26ea334329181-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ea334329181-12">12<br><div class="crayon-num" data-line="crayon-54ee73aac26ea334329181-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ea334329181-14">14<br><div class="crayon-num" data-line="crayon-54ee73aac26ea334329181-15">15<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ea334329181-16">16<br><div class="crayon-num" data-line="crayon-54ee73aac26ea334329181-17">17<br><div class="crayon-num crayon-striped-num" data-line="crayon-54ee73aac26ea334329181-18">18<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-54ee73aac26ea334329181-1" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">events<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-e">require<span class="crayon-sy">(<span class="crayon-s">‘events’<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ea334329181-2" class="crayon-line crayon-striped-line"><br><div id="crayon-54ee73aac26ea334329181-3" class="crayon-line"><span class="crayon-t">function<span class="crayon-h"> <span class="crayon-e">Batter<span class="crayon-sy">(<span class="crayon-r">name<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ea334329181-4" class="crayon-line crayon-striped-line"><span class="crayon-h">  <span class="crayon-r">this<span class="crayon-sy">.<span class="crayon-v">name<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-r">name<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ea334329181-5" class="crayon-line"><span class="crayon-h">  <span class="crayon-v">events<span class="crayon-sy">.<span class="crayon-v">EventEmitter<span class="crayon-sy">.<span class="crayon-e">call<span class="crayon-sy">(<span class="crayon-r">this<span class="crayon-sy">)<span class="crayon-sy">;<span class="crayon-h"> <span class="crayon-c">// making the Batter class a event emitter. </span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ea334329181-6" class="crayon-line crayon-striped-line"><span class="crayon-c">//Invoking the EventEmitter’s constructor with Batter.</span><br><div id="crayon-54ee73aac26ea334329181-7" class="crayon-line"><span class="crayon-h">  <span class="crayon-r">this<span class="crayon-sy">.<span class="crayon-v">swing<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-sy">)</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ea334329181-8" class="crayon-line crayon-striped-line"><span class="crayon-h">  <span class="crayon-sy">{</span></span><br><div id="crayon-54ee73aac26ea334329181-9" class="crayon-line"><span class="crayon-h">   <span class="crayon-r">this<span class="crayon-sy">.<span class="crayon-e">emit<span class="crayon-sy">(<span class="crayon-s">‘swing’<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ea334329181-10" class="crayon-line crayon-striped-line"><span class="crayon-h">  <span class="crayon-sy">}</span></span><br><div id="crayon-54ee73aac26ea334329181-11" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-54ee73aac26ea334329181-12" class="crayon-line crayon-striped-line"><span class="crayon-v">Batter<span class="crayon-sy">.<span class="crayon-v">prototype<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">events<span class="crayon-sy">.<span class="crayon-v">EventEmitter<span class="crayon-sy">;<span class="crayon-h"> <span class="crayon-c">// Inheriting EventEmitters methods into Batter. ex: ‘on’, as user below</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ea334329181-13" class="crayon-line"><span class="crayon-t">var<span class="crayon-h"> <span class="crayon-v">batter<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-r">new<span class="crayon-h"> <span class="crayon-e">Batter<span class="crayon-sy">(<span class="crayon-s">‘Babe Ruth’<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ea334329181-14" class="crayon-line crayon-striped-line"><br><div id="crayon-54ee73aac26ea334329181-15" class="crayon-line"><span class="crayon-v">batter<span class="crayon-sy">.<span class="crayon-e">on<span class="crayon-sy">(<span class="crayon-s">‘swing’<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">function<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ea334329181-16" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-v">console<span class="crayon-sy">.<span class="crayon-e">log<span class="crayon-sy">(<span class="crayon-s">‘It is a Strrikkkeee!!!!’<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span><br><div id="crayon-54ee73aac26ea334329181-17" class="crayon-line"><span class="crayon-h">  <span class="crayon-sy">}<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span><br><div id="crayon-54ee73aac26ea334329181-18" class="crayon-line crayon-striped-line"><span class="crayon-v">batter<span class="crayon-sy">.<span class="crayon-e">swing<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>Pretty neat right? Now you can have your own class that is invisible.<br><br>So these are some of the ways, in which node <em>should</em> be implemented. Depending on our requirement, you can pick from above.<br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/dfa1fb2e.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/dfa1fb2e.html" itemprop="url">Comet：基于 HTTP 长连接的“服务器推”技术</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-02-21T20:15:00+08:00">
                2015-02-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><h2 id="基于客户端套接口的“服务器推”技术"><a href="#基于客户端套接口的“服务器推”技术" class="headerlink" title="基于客户端套接口的“服务器推”技术"></a>基于客户端套接口的“服务器推”技术</h2><h3 id="Flash-XMLSocket"><a href="#Flash-XMLSocket" class="headerlink" title="Flash XMLSocket"></a>Flash XMLSocket</h3><p>如果 Web 应用的用户接受应用只有在安装了 Flash 播放器才能正常运行， 那么使用 Flash 的 XMLSocket 也是一个可行的方案。</p>
<p>这种方案实现的基础是：</p>
<ol>
<li>Flash 提供了 XMLSocket 类。</li>
<li>JavaScript 和 Flash 的紧密结合：在 JavaScript 可以直接调用 Flash 程序提供的接口。</li>
</ol>
<p>具体实现方法：在 HTML 页面中内嵌入一个使用了 XMLSocket 类的 Flash 程序。JavaScript 通过调用此 Flash 程序提供的套接口接口与服务器端的套接口进行通信。JavaScript 在收到服务器端以 XML 格式传送的信息后可以很容易地控制 HTML 页面的内容显示。</p>
<p>关于如何去构建充当了 JavaScript 与 Flash XMLSocket 桥梁的 Flash 程序，以及如何在 JavaScript 里调用 Flash 提供的接口，我们可以参考 AFLAX（Asynchronous Flash and XML）项目提供的 Socket Demo 以及 SocketJS（请参见 <a href="http://www.ibm.com/developerworks/cn/web/wa-lo-comet/#resources" target="_blank" rel="noopener">参考资源</a>）。</p>
<p>Javascript 与 Flash 的紧密结合，极大增强了客户端的处理能力。从 Flash 播放器 V7.0.19 开始，已经取消了 XMLSocket 的端口必须大于 1023 的限制。Linux 平台也支持 Flash XMLSocket 方案。但此方案的缺点在于：</p>
<ol>
<li>客户端必须安装 Flash 播放器；</li>
<li>因为 XMLSocket 没有 HTTP 隧道功能，XMLSocket 类不能自动穿过防火墙；</li>
<li>因为是使用套接口，需要设置一个通信端口，防火墙、代理服务器也可能对非 HTTP 通道端口进行限制；</li>
</ol>
<p>不过这种方案在一些网络聊天室，网络互动游戏中已得到广泛使用。</p>
<h3 id="Java-Applet-套接口"><a href="#Java-Applet-套接口" class="headerlink" title="Java Applet 套接口"></a>Java Applet 套接口</h3><p>在客户端使用 Java Applet，通过 <code>java.net.Socket</code> 或 <code>java.net.DatagramSocket</code> 或 <code>java.net.MulticastSocket</code> 建立与服务器端的套接口连接，从而实现“服务器推”。</p>
<p>这种方案最大的不足在于 Java applet 在收到服务器端返回的信息后，无法通过 JavaScript 去更新 HTML 页面的内容。</p>
<div class="ibm-alternate-rule"><br><br><a href="http://www.ibm.com/developerworks/cn/web/wa-lo-comet/#ibm-pcon" target="_blank" rel="noopener">回页首</a><br><br>## 基于 HTTP 长连接的“服务器推”技术<br><br>### Comet 简介<br><br>浏览器作为 Web 应用的前台，自身的处理功能比较有限。浏览器的发展需要客户端升级软件，同时由于客户端浏览器软件的多样性，在某种意义上，也影响了浏览器新技术的推广。在 Web 应用中，浏览器的主要工作是发送请求、解析服务器返回的信息以不同的风格显示。AJAX 是浏览器技术发展的成果，通过在浏览器端发送异步请求，提高了单用户操作的响应性。但 Web 本质上是一个多用户的系统，对任何用户来说，可以认为服务器是另外一个用户。现有 AJAX 技术的发展并不能解决在一个多用户的 Web 应用中，将更新的信息实时传送给客户端，从而用户可能在“过时”的信息下进行操作。而 AJAX 的应用又使后台数据更新更加频繁成为可能。<br><br>##### 图 1. 传统的 Web 应用模型与基于 AJAX 的模型之比较<br><br><img src="http://pangguoming.com/blog/images/92b538ad-4442-49ca-aa07-edf8843fc5ea.jpg" alt="图 1. 传统的 Web 应用模型与基于 AJAX 的模型之比较"><br><br>“服务器推”是一种很早就存在的技术，以前在实现上主要是通过客户端的套接口，或是服务器端的远程调用。因为浏览器技术的发展比较缓慢，没有为“服务器推”的实现提供很好的支持，在纯浏览器的应用中很难有一个完善的方案去实现“服务器推”并用于商业程序。最近几年，因为 AJAX 技术的普及，以及把 IFrame 嵌在“htmlfile“的 ActiveX 组件中可以解决 IE 的加载显示问题，一些受欢迎的应用如 meebo，gmail+gtalk 在实现中使用了这些新技术；同时“服务器推”在现实应用中确实存在很多需求。因为这些原因，基于纯浏览器的“服务器推”技术开始受到较多关注，Alex Russell（Dojo Toolkit 的项目 Lead）称这种基于 HTTP 长连接、无须在浏览器端安装插件的“服务器推”技术为“Comet”。目前已经出现了一些成熟的 Comet 应用以及各种开源框架；一些 Web 服务器如 Jetty 也在为支持大量并发的长连接进行了很多改进。关于 Comet 技术最新的发展状况请参考关于 Comet 的 wiki。<br><br>下面将介绍两种 Comet 应用的实现模型。<br><br>### 基于 AJAX 的长轮询（long-polling）方式<br><br>如 <a href="http://www.ibm.com/developerworks/cn/web/wa-lo-comet/#fig001" target="_blank" rel="noopener">图 1</a> 所示，AJAX 的出现使得 JavaScript 可以调用 XMLHttpRequest 对象发出 HTTP 请求，JavaScript 响应处理函数根据服务器返回的信息对 HTML 页面的显示进行更新。使用 AJAX 实现“服务器推”与传统的 AJAX 应用不同之处在于：<br><br>1.  服务器端会阻塞请求直到有数据传递或超时才返回。<br>2.  客户端 JavaScript 响应处理函数会在处理完服务器返回的信息后，再次发出请求，重新建立连接。<br>3.  当客户端处理接收的数据、重新建立连接时，服务器端可能有新的数据到达；这些信息会被服务器端保存直到客户端重新建立连接，客户端会一次把当前服务器端所有的信息取回。<br><br>##### 图 2. 基于长轮询的服务器推模型<br><br><img src="http://pangguoming.com/blog/images/86f63a21-a377-4945-b88a-4ba72da2fb3b.jpg" alt="图 2. 基于长轮询的服务器推模型"><br><br>一些应用及示例如 “Meebo”, “Pushlet Chat” 都采用了这种长轮询的方式。相对于“轮询”（poll），这种长轮询方式也可以称为“拉”（pull）。因为这种方案基于 AJAX，具有以下一些优点：请求异步发出；无须安装插件；IE、Mozilla FireFox 都支持 AJAX。<br><br>在这种长轮询方式下，客户端是在 XMLHttpRequest 的 readystate 为 4（即数据传输结束）时调用回调函数，进行信息处理。当 readystate 为 4 时，数据传输结束，连接已经关闭。Mozilla Firefox 提供了对 Streaming AJAX 的支持， 即 readystate 为 3 时（数据仍在传输中），客户端可以读取数据，从而无须关闭连接，就能读取处理服务器端返回的信息。IE 在 readystate 为 3 时，不能读取服务器返回的数据，目前 IE 不支持基于 Streaming AJAX。<br><br>### 基于 Iframe 及 htmlfile 的流（streaming）方式<br><br>iframe 是很早就存在的一种 HTML 标记， 通过在 HTML 页面里嵌入一个隐蔵帧，然后将这个隐蔵帧的 SRC 属性设为对一个长连接的请求，服务器端就能源源不断地往客户端输入数据。<br><br>##### 图 3. 基于流方式的服务器推模型<br><br><img src="http://pangguoming.com/blog/images/15700b1a-5dd2-493d-a3d8-edbdd97394d8.jpg" alt="图 3. 基于流方式的服务器推模型"><br><br>上节提到的 AJAX 方案是在 JavaScript 里处理 XMLHttpRequest 从服务器取回的数据，然后 Javascript 可以很方便的去控制 HTML 页面的显示。同样的思路用在 iframe 方案的客户端，iframe 服务器端并不返回直接显示在页面的数据，而是返回对客户端 Javascript 函数的调用，如“<code>&lt;script type=&quot;text/javascript&quot;&gt;js_func(“data from server ”)&lt;/script&gt;</code>”。服务器端将返回的数据作为客户端 JavaScript 函数的参数传递；客户端浏览器的 Javascript 引擎在收到服务器返回的 JavaScript 调用时就会去执行代码。<br><br>从 <a href="http://www.ibm.com/developerworks/cn/web/wa-lo-comet/#fig003" target="_blank" rel="noopener">图 3</a> 可以看到，每次数据传送不会关闭连接，连接只会在通信出现错误时，或是连接重建时关闭（一些防火墙常被设置为丢弃过长的连接， 服务器端可以设置一个超时时间， 超时后通知客户端重新建立连接，并关闭原来的连接）。<br><br>使用 iframe 请求一个长连接有一个很明显的不足之处：IE、Morzilla Firefox 下端的进度栏都会显示加载没有完成，而且 IE 上方的图标会不停的转动，表示加载正在进行。Google 的天才们使用一个称为“htmlfile”的 ActiveX 解决了在 IE 中的加载显示问题，并将这种方法用到了 gmail+gtalk 产品中。Alex Russell 在 “What else is burried down in the depth’s of Google’s amazing JavaScript?”文章中介绍了这种方法。Zeitoun 网站提供的 comet-iframe.tar.gz，封装了一个基于 iframe 和 htmlfile 的 JavaScript comet 对象，支持 IE、Mozilla Firefox 浏览器，可以作为参考。（请参见<a href="http://www.ibm.com/developerworks/cn/web/wa-lo-comet/#resources" target="_blank" rel="noopener">参考资源</a>）<br><br><div class="ibm-alternate-rule"><br><br><a href="http://www.ibm.com/developerworks/cn/web/wa-lo-comet/#ibm-pcon" target="_blank" rel="noopener">回页首</a><br><br>## 使用 Comet 模型开发自己的应用<br><br>上面介绍了两种基于 HTTP 长连接的“服务器推”架构，更多描述了客户端处理长连接的技术。对于一个实际的应用而言，系统的稳定性和性能是非常重要的。将 HTTP 长连接用于实际应用，很多细节需要考虑。<br><br>### 不要在同一客户端同时使用超过两个的 HTTP 长连接<br><br>我们使用 IE 下载文件时会有这样的体验，从同一个 Web 服务器下载文件，最多只能有两个文件同时被下载。第三个文件的下载会被阻塞，直到前面下载的文件下载完毕。这是因为 HTTP 1.1 规范中规定，客户端不应该与服务器端建立超过两个的 HTTP 连接， 新的连接会被阻塞。而 IE 在实现中严格遵守了这种规定。<br><br>HTTP 1.1 对两个长连接的限制，会对使用了长连接的 Web 应用带来如下现象：在客户端如果打开超过两个的 IE 窗口去访问同一个使用了长连接的 Web 服务器，第三个 IE 窗口的 HTTP 请求被前两个窗口的长连接阻塞。<br><br>所以在开发长连接的应用时， 必须注意在使用了多个 frame 的页面中，不要为每个 frame 的页面都建立一个 HTTP 长连接，这样会阻塞其它的 HTTP 请求，在设计上考虑让多个 frame 的更新共用一个长连接。<br><br>### 服务器端的性能和可扩展性<br><br>一般 Web 服务器会为每个连接创建一个线程，如果在大型的商业应用中使用 Comet，服务器端需要维护大量并发的长连接。在这种应用背景下，服务器端需要考虑负载均衡和集群技术；或是在服务器端为长连接作一些改进。<br><br>应用和技术的发展总是带来新的需求，从而推动新技术的发展。HTTP 1.1 与 1.0 规范有一个很大的不同：1.0 规范下服务器在处理完每个 Get/Post 请求后会关闭套接口连接； 而 1.1 规范下服务器会保持这个连接，在处理两个请求的间隔时间里，这个连接处于空闲状态。 Java 1.4 引入了支持异步 IO 的 java.nio 包。当连接处于空闲时，为这个连接分配的线程资源会返还到线程池，可以供新的连接使用；当原来处于空闲的连接的客户发出新的请求，会从线程池里分配一个线程资源处理这个请求。 这种技术在连接处于空闲的机率较高、并发连接数目很多的场景下对于降低服务器的资源负载非常有效。<br><br>但是 AJAX 的应用使请求的出现变得频繁，而 Comet 则会长时间占用一个连接，上述的服务器模型在新的应用背景下会变得非常低效，线程池里有限的线程数甚至可能会阻塞新的连接。Jetty 6 Web 服务器针对 AJAX、Comet 应用的特点进行了很多创新的改进，请参考文章“AJAX，Comet and Jetty”（请参见 <a href="http://www.ibm.com/developerworks/cn/web/wa-lo-comet/#resources" target="_blank" rel="noopener">参考资源</a>）。<br><br>### 控制信息与数据信息使用不同的 HTTP 连接<br><br>使用长连接时，存在一个很常见的场景：客户端网页需要关闭，而服务器端还处在读取数据的堵塞状态，客户端需要及时通知服务器端关闭数据连接。服务器在收到关闭请求后首先要从读取数据的阻塞状态唤醒，然后释放为这个客户端分配的资源，再关闭连接。<br><br>所以在设计上，我们需要使客户端的控制请求和数据请求使用不同的 HTTP 连接，才能使控制请求不会被阻塞。<br><br>在实现上，如果是基于 iframe 流方式的长连接，客户端页面需要使用两个 iframe，一个是控制帧，用于往服务器端发送控制请求，控制请求能很快收到响应，不会被堵塞；一个是显示帧，用于往服务器端发送长连接请求。如果是基于 AJAX 的长轮询方式，客户端可以异步地发出一个 XMLHttpRequest 请求，通知服务器端关闭数据连接。<br><br>### 在客户和服务器之间保持“心跳”信息<br><br>在浏览器与服务器之间维持一个长连接会为通信带来一些不确定性：因为数据传输是随机的，客户端不知道何时服务器才有数据传送。服务器端需要确保当客户端不再工作时，释放为这个客户端分配的资源，防止内存泄漏。因此需要一种机制使双方知道大家都在正常运行。在实现上：<br><br>1.  服务器端在阻塞读时会设置一个时限，超时后阻塞读调用会返回，同时发给客户端没有新数据到达的心跳信息。此时如果客户端已经关闭，服务器往通道写数据会出现异常，服务器端就会及时释放为这个客户端分配的资源。<br>2.  如果客户端使用的是基于 AJAX 的长轮询方式；服务器端返回数据、关闭连接后，经过某个时限没有收到客户端的再次请求，会认为客户端不能正常工作，会释放为这个客户端分配、维护的资源。<br>3.  当服务器处理信息出现异常情况，需要发送错误信息通知客户端，同时释放资源、关闭连接。<br><br>### Pushlet - 开源 Comet 框架<br><br>Pushlet 是一个开源的 Comet 框架，在设计上有很多值得借鉴的地方，对于开发轻量级的 Comet 应用很有参考价值。<br><br><strong>观察者模型</strong><br><br>Pushlet 使用了观察者模型：客户端发送请求，订阅感兴趣的事件；服务器端为每个客户端分配一个会话 ID 作为标记，事件源会把新产生的事件以多播的方式发送到订阅者的事件队列里。<br><br><strong>客户端 JavaScript 库</strong><br><br>pushlet 提供了基于 AJAX 的 JavaScript 库文件用于实现长轮询方式的“服务器推”；还提供了基于 iframe 的 JavaScript 库文件用于实现流方式的“服务器推”。<br><br>JavaScript 库做了很多封装工作：<br><br>1.  定义客户端的通信状态：<code>STATE_ERROR</code>、<code>STATE_ABORT</code>、<code>STATE_NULL</code>、<code>STATE_READY</code>、<code>STATE_JOINED</code>、<code>STATE_LISTENING</code>；<br>2.  保存服务器分配的会话 ID，在建立连接之后的每次请求中会附上会话 ID 表明身份；<br>3.  提供了 <code>join()</code>、<code>leave()</code>、<code>subscribe()</code>、 <code>unsubsribe()</code>、<code>listen()</code> 等 API 供页面调用；<br>4.  提供了处理响应的 JavaScript 函数接口 <code>onData()</code>、<code>onEvent()</code>…<br><br>网页可以很方便地使用这两个 JavaScript 库文件封装的 API 与服务器进行通信。<br><br><strong>客户端与服务器端通信信息格式</strong><br><br>pushlet 定义了一套客户与服务器通信的信息格式，使用 XML 格式。定义了客户端发送请求的类型：<code>join</code>、<code>leave</code>、<code>subscribe</code>、<code>unsubscribe</code>、<code>listen</code>、<code>refresh</code>；以及响应的事件类型：<code>data</code>、<code>join_ack</code>、<code>listen_ack</code>、<code>refresh</code>、<code>heartbeat</code>、<code>error</code>、<code>abort</code>、<code>subscribe_ack</code>、<code>unsubscribe_ack</code>。<br><br><strong>服务器端事件队列管理</strong><br><br>pushlet 在服务器端使用 Java Servlet 实现，其数据结构的设计框架仍可适用于 PHP、C 编写的后台客户端。<br><br>Pushlet 支持客户端自己选择使用流、拉（长轮询）、轮询方式。服务器端根据客户选择的方式在读取事件队列（fetchEvents）时进行不同的处理。“轮询”模式下 <code>fetchEvents()</code> 会马上返回。”流“和”拉“模式使用阻塞的方式读事件，如果超时，会发给客户端发送一个没有新信息收到的“heartbeat“事件，如果是“拉”模式，会把“heartbeat”与“refresh”事件一起传给客户端，通知客户端重新发出请求、建立连接。<br><br><strong>客户服务器之间的会话管理</strong><br><br>服务端在客户端发送 <code>join</code> 请求时，会为客户端分配一个会话 ID， 并传给客户端，然后客户端就通过此会话 ID 标明身份发出 <code>subscribe</code> 和<code>listen</code> 请求。服务器端会为每个会话维护一个订阅的主题集合、事件队列。<br><br>服务器端的事件源会把新产生的事件以多播的方式发送到每个会话（即订阅者）的事件队列里。<br><br><div class="ibm-alternate-rule"><br><br><a href="http://www.ibm.com/developerworks/cn/web/wa-lo-comet/#ibm-pcon" target="_blank" rel="noopener">回页首</a><br><br>## 小结<br><br>本文介绍了如何在现有的技术基础上选择合适的方案开发一个“服务器推”的应用，最优的方案还是取决于应用需求的本身。相对于传统的 Web 应用， 目前开发 Comet 应用还是具有一定的挑战性。<br><br>“服务器推”存在广泛的应用需求，为了使 Comet 模型适用于大规模的商业应用，以及方便用户构建 Comet 应用，最近几年，无论是服务器还是浏览器都出现了很多新技术，同时也出现了很多开源的 Comet 框架、协议。需求推动技术的发展，相信 Comet 的应用会变得和 AJAX 一样普及。<br></div></div></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/a52f7113.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/a52f7113.html" itemprop="url">基于NodeJS的全栈式开发</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-02-21T19:52:00+08:00">
                2015-02-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>随着不同终端(Pad/Mobile/PC)的兴起，对开发人员的要求越来越高，纯<a href="http://www.chinabyte.com/keyword/%E6%B5%8F%E8%A7%88%E5%99%A8/" target="_blank" rel="noopener">浏览器</a>端的响应式已经不能满足用户体验的高要求，我们往往需要针对不同的终端开发定制的版本。为了提升开发效率，前后端分离的需求越来越被重视，后端负责业务/数据接口，前端负责展现/交互逻辑，同一份数据接口，我们可以定制开发多个版本。</p>
<p> 这个话题最近被讨论得比较多，阿里有些BU也在进行一些尝试。讨论了很久之后，我们团队决定探索一套基于NodeJS的前后端分离<a href="http://solution.chinabyte.com/new/" target="_blank" rel="noopener">方案</a>，过程中有一些不断变化的认识以及思考，记录在这里，也希望看到的同学参与讨论，帮我们完善。</p>
<p> 一、什么是前后端分离？</p>
<p> 最开始组内讨论的过程中我发现，每个人对前后端分离的理解不一样，为了保证能在同一个频道讨论，先就什么是”前后端分离”达成一致。</p>
<p> 大家一致认同的前后端分离的例子就是SPA(Single-page application)，所有用到的展现数据都是后端通过异步接口(AJAX/JSONP)的方式提供的，前端只管展现。</p>
<p> 从某种意义上来说，SPA确实做到了前后端分离，但这种方式存在两个问题：</p>
<p> WEB服务中，SPA类占的比例很少。很多场景下还有同步/同步+异步混合的模式，SPA不能作为一种通用的解决方案。</p>
<p> 现阶段的SPA开发模式，接口通常是按照展现逻辑来提供的，有时候为了提高效率，后端会帮我们处理一些展现逻辑，这就意味着后端还是涉足了View层的工作，不是真正的前后端分离。</p>
<p> SPA式的前后端分离，是从物理层做区分(认为只要是客户端的就是前端，<a href="http://server.chinabyte.com/" target="_blank" rel="noopener">服务器</a>端的就是后端)，这种分法已经无法满足我们前后端分离的需求，我们认为从职责上划分才能满足目前我们的使用场景：</p>
<p> 前端：负责View和Controller层。</p>
<p> 后端：只负责Model层，业务处理/数据等。</p>
<p> 为什么去做这种职责的划分，后面会继续探讨。</p>
<p> 二、为什么要前后端分离？</p>
<p> 关于这个问题，玉伯的文章Web研发模式演变中解释得非常全面，我们再大概理一下：</p>
<p> 2.1 现有开发模式的适用场景</p>
<p> 玉伯提到的几种开发模式，各有各的适用场景，没有哪一种<a href="http://www.chinabyte.com/keyword/%E5%AE%8C%E5%85%A8%E5%8F%96%E4%BB%A3/" target="_blank" rel="noopener">完全取代</a>另外一种。</p>
<p> 比如后端为主的MVC，做一些同步展现的业务效率很高，但是遇到同步异步结合的页面，与后端开发沟通起来就会比较麻烦。</p>
<p> Ajax为主SPA型开发模式，比较适合开发APP类型的场景，但是只适合做APP，因为<a href="http://www.chinabyte.com/keyword/SEO/" target="_blank" rel="noopener">SEO</a>等问题不好解决，对于很多类型的系统，这种开发方式也过重。</p>
<p> 2.2 前后端职责不清</p>
<p> 在业务逻辑复杂的系统里，我们最怕维护前后端混杂在一起的代码，因为没有约束，M-V-C每一层都可能出现别的层的代码，日积月累，完全没有维护性可言。</p>
<p> 虽然前后端分离没办法完全解决这种问题，但是可以大大缓解。因为从物理层次上保证了你不可能这么做。</p>
<p> 2.3 开发效率问题</p>
<p> <a href="http://com.chinabyte.com/taobao/" target="_blank" rel="noopener">淘宝</a>的Web基本上都是基于MVC框架webx，架构决定了前端只能依赖后端。</p>
<p> 所以我们的开发模式依然是，前端写好静态demo，后端翻译成VM模版，这种模式的问题就不说了，被吐槽了很久。</p>
<p> 直接基于后端环境开发也很痛苦，配置安装使用都很麻烦。为了解决这个问题，我们发明了各种工具，比如VMarket，但是前端还是要写VM，而且依赖后端数据，效率依然不高。</p>
<p> 另外，后端也没法摆脱对展现的强关注，从而专心于业务逻辑层的开发。</p>
<p> 2.4 对前端发挥的局限</p>
<p> 性能优化如果只在前端做空间非常有限，于是我们经常需要后端合作才能碰撞出火花，但由于后端框架限制，我们很难使用Comet、Bigpipe等技术方案来优化性能。</p>
<p> 为了解决以上提到的一些问题，我们进行了很多尝试，开发了各种工具，但始终没有太多起色，主要是因为我们只能在后端给我们划分的那一小块空间去发挥。只有真正做到前后端分离，我们才能彻底解决以上问题。</p>
<p> 三、怎么做前后端分离？</p>
<p> 怎么做前后端分离，其实第一节中已经有了答案：</p>
<p> 前端：负责View和Controller层。</p>
<p> 后端：负责Model层，业务处理/数据等。</p>
<p><img src="http://pangguoming.com/blog/images/0b6d009d-a5a9-4a2d-a40b-34419815f1c9.jpg" alt="MVC分"></p>
<p> 试想一下，如果前端掌握了Controller，我们可以做url design，我们可以根据场景决定在服务端同步渲染，还是根据view层数据输出json数据，我们还可以根据表现层需求很容易的做Bigpipe,Comet,Socket等等，完全是需求决定使用方式。</p>
<p> 3.1 基于NodeJS“全栈”式开发</p>
<p> 如果想实现上图的分层，就必然需要一种web服务帮我们实现以前后端做的事情，于是就有了标题提到的“基于NodeJS的全栈式开发”</p>
<p><img src="http://pangguoming.com/blog/images/c9c5640e-a367-459b-a08a-c03b112d4ba0.jpg" alt="Node 带来的全栈时代"></p>
<p> 这张图看起来简单而且很好理解，但没尝试过，会有很多疑问。</p>
<p> SPA模式中，后端已供了所需的数据接口，view前端已经可以控制，为什么要多加NodeJS这一层？</p>
<p> 多加一层，性能怎么样？</p>
<p> 多加一层，前端的工作量是不是增加了？</p>
<p> 多加一层就多一层风险，怎么破？</p>
<p> NodeJS什么都能做，为什么还要JAVA？</p>
<p> 这些问题要说清楚不容易，下面说下我的认识过程。</p>
<p> 3.2 为什么要增加一层NodeJS？</p>
<p> 现阶段我们主要以后端MVC的模式进行开发，这种模式严重阻碍了前端开发效率，也让后端不能专注于业务开发。</p>
<p> 解决方案是让前端能控制Controller层，但是如果在现有技术体系下很难做到，因为不可能让所有前端都学java，安装后端的开发环境，写VM。</p>
<p> NodeJS就能很好的解决这个问题，我们无需学习一门新的语言，就能做到以前开发帮我们做的事情，一切都显得那么自然。</p>
<p> 3.3 性能问题</p>
<p> 分层就涉及每层之间的通讯，肯定会有一定的性能损耗。但是合理的分层能让职责清晰、也方便协作，会大大提高开发效率。分层带来的损失，一定能在其他方面的收益弥补回来。</p>
<p> 另外，一旦决定分层，我们可以通过优化通讯方式、通讯协议，尽可能把损耗<a href="http://www.chinabyte.com/keyword/%E9%99%8D%E5%88%B0%E6%9C%80%E4%BD%8E/" target="_blank" rel="noopener">降到最低</a>。</p>
<p> 举个例子：</p>
<p> 淘宝宝贝详情页静态化之后，还是有不少需要实时获取的信息，比如物流、促销等等，因为这些信息在不同业务系统中，所以需要前端发送5，6个异步请求来回填这些内容。</p>
<p> 有了NodeJS之后，前端可以在NodeJS中去代理这5个异步请求，还能很容易的做Bigpipe,这块的优化能让整个渲染效率提升很多。</p>
<p> 可能在PC上你觉得发5,6个异步请求也没什么，但是在<a href="http://www.chinabyte.com/keyword/%E6%97%A0%E7%BA%BF/" target="_blank" rel="noopener">无线</a>端，在客户<a href="http://www.chinabyte.com/keyword/%E6%89%8B%E6%9C%BA/" target="_blank" rel="noopener">手机</a>上建立一个HTTP请求开销很大，有了这个优化，性能一下提升好几倍。</p>
<p> 淘宝详情基于NodeJS的优化我们正在进行中，上线之后我会分享一下优化的过程。</p>
<p> 3.4 前端的工作量是否增加了？</p>
<p> 相对于只切页面/做demo，肯定是增加了一点，但是当前模式下有联调、沟通环节，这个过程非常花时间，也容易出bug，还很难维护。</p>
<p> 所以，虽然工作量会增加一点，但是总体开发效率会提升很多。</p>
<p> 另外，测试成本可以节省很多。以前开发的接口都是针对表现层的，很难写测试用例。如果做了前后端分离，甚至测试<a href="http://www.chinabyte.com/keyword/%E9%83%BD%E5%8F%AF%E4%BB%A5/" target="_blank" rel="noopener">都可以</a>分开，一拨人专门测试接口，一拨人专注测试UI(这部分工作甚至可以用工具代替)。</p>
<p> 3.5 增加Node层带来的风险怎么控制？</p>
<p> 随着Node大规模使用，系统/运维/安全部门的同学也一定会加入到基础建设中，他们会帮助我们去完善各个环节可能出现的问题，保障系的稳定性。</p>
<p> 3.6 Node什么都能做，为什么还要JAVA？</p>
<p> 我们的初衷是做前后端分离，如果考虑这个问题就有点违背我们的初衷了。即使用Node替代Java，我们也没办法保证不出现今天遇到的种种问题，比如职责不清。我们的目的是分层开发，专业的人，专注做专业的事。基于JAVA的基础架构已经非常强大而且稳定，而且更适合做现在架构的事情。</p>
<p> 四、淘宝基于Node的前后端分离</p>
<p><img src="http://pangguoming.com/blog/images/96fb386d-8b8e-4257-9a5b-0e638c4bd4c8.jpg" alt="淘宝基于NodeJS的前后端分离"></p>
<p> 上图是我理解的淘宝基于Node的前后端分离分层，以及Node的职责范围。简单解释下：</p>
<p> 最上端是服务端，就是我们常说的后端。后端对于我们来说，就是一个接口的集合，服务端提供各种各样的接口供我们使用。因为有Node层，也不用局限是什么形式的服务。对于后端开发来说，他们只用关心业务代码的接口实现。</p>
<p> 服务端下面是Node应用。</p>
<p> Node应用中有一层Model Proxy与服务端进行通讯。这一层主要目前是抹平我们对不同接口的调用方式，<a href="http://www.chinabyte.com/keyword/%E5%B0%81%E8%A3%85/" target="_blank" rel="noopener">封装</a>一些view层需要的Model。</p>
<p> Node层还能轻松实现原来vmcommon,tms(引用淘宝内容管理系统)等需求。</p>
<p> Node层要使用什么框架由开发者自己决定。不过推荐使用express+xTemplate的组合，xTemplate能做到前后端公用。</p>
<p> 怎么用Node大家自己决定，但是令人兴奋的是，我们终于可以使用Node轻松实现我们想要的输出方式:JSON/JSONP/RESTful/HTML/BigPipe/Comet/Socket/同步、异步，想怎么整就怎么整，完全根据你的场景决定。</p>
<p> 浏览器层在我们这个架构中没有变化，也不希望因为引入Node改变你以前在浏览器中开发的认知。</p>
<p> 引入Node，只是把本该就前端控制的部分交由前端掌控。</p>
<p> 这种模式我们已经有两个项目在开发中，虽然还没上线，但是无论是在开发效率，还是在性能优化方面，我们都已经尝到了甜头。</p>
<p> 五、我们还需要要做什么？</p>
<p> 把Node的开发流程集成到淘宝现有的<a href="http://www.chinabyte.com/keyword/SCM/" target="_blank" rel="noopener">SCM</a>流程中。</p>
<p> 基础设施建设，比如<a href="http://www.chinabyte.com/keyword/session/" target="_blank" rel="noopener">session</a>,logger等通用<a href="http://www.chinabyte.com/keyword/%E6%A8%A1%E5%9D%97/" target="_blank" rel="noopener">模块</a>。</p>
<p> 最佳开发实践</p>
<p> 线上成功案例</p>
<p> 大家对Node前后端分离概念的认识</p>
<p> 安全</p>
<p> 性能</p>
<p> …</p>
<p> 技术上不会有太多需要去创新和研究的，已经有非常多现成的积累。其实关键是一些流程的打通和通用解决方案的积累，相信随着更多的项目实践，这块慢慢会变成一个稳定的流程。</p>
<p> 六、“中途岛”</p>
<p> 虽然“基于NodeJS的全栈式开发”模式很让人兴奋，但是把基于Node的全栈开发变成一个稳定，让大家都能接受的东西还有很多路要走，我们正在进行的“中途岛”项目就是为了解决这个问题。虽然我们起步不久，但是离目标已经越来越近!</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/38/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/38/">38</a><span class="page-number current">39</span><a class="page-number" href="/page/40/">40</a><span class="space">&hellip;</span><a class="page-number" href="/page/42/">42</a><a class="extend next" rel="next" href="/page/40/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4" alt="庞国明">
            
              <p class="site-author-name" itemprop="name">庞国明</p>
              <p class="site-description motion-element" itemprop="description">Software make the information world run, and programer make the softeware run.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">420</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">267</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/pangguoming" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:pangguoming@yeah.net" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/pangguoming" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/1570700/pangguoming" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/pangguoming" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i>Instagram</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">庞国明</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  

  

  
  

  

  

  

</body>
</html>
