<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Software make the information world run, and programer make the softeware run.">
<meta property="og:type" content="website">
<meta property="og:title" content="庞国明-博客">
<meta property="og:url" content="http://pangguoming.com/page/9/index.html">
<meta property="og:site_name" content="庞国明-博客">
<meta property="og:description" content="Software make the information world run, and programer make the softeware run.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="庞国明-博客">
<meta name="twitter:description" content="Software make the information world run, and programer make the softeware run.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://pangguoming.com/page/9/">





  <title>庞国明-博客</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">庞国明-博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">此心用度八千遍，不曾厌倦</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/d4e17029.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/d4e17029.html" itemprop="url">Spring mvc整合freemarker详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-04T10:28:00+08:00">
                2018-07-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-什么是FreeMarker"><a href="#1-什么是FreeMarker" class="headerlink" title="1.什么是FreeMarker"></a>1.什么是FreeMarker</h1><p>FreeMarker是一个模板引擎，一个基于模板生成文本输出的通用工具，使用纯Java编写<br>FreeMarker被设计用来生成HTML Web页面，特别是基于MVC模式的应用程序<br>虽然FreeMarker具有一些编程的能力，但通常由Java程序准备要显示的数据，由FreeMarker生成页面，通过模板显示准备的数据（如下图）<br><img src="https://img-blog.csdn.net/20160713215630876" alt="这里写图片描述"></p>
<h1 id="2-FreeMarker特性"><a href="#2-FreeMarker特性" class="headerlink" title="2.FreeMarker特性"></a>2.FreeMarker特性</h1><p>能够生成各种文本：HTML、XML、RTF、Java源代码等等<br>易于嵌入到你的产品中：轻量级；不需要Servlet环境<br>插件式模板载入器：可以从任何源载入模板，如本地文件、数据库等等<br>你可以按你所需生成文本：保存到本地文件；作为Email发送；从Web应用程序发送它返回给Web浏览器</p>
<h1 id="3-springMVC整合Freemarker"><a href="#3-springMVC整合Freemarker" class="headerlink" title="3. springMVC整合Freemarker"></a>3. springMVC整合Freemarker</h1><h2 id="1-添加jar包"><a href="#1-添加jar包" class="headerlink" title="1.添加jar包"></a>1.添加jar包</h2><p>添加freemarker的jar，还需要额外添加spring-content-support的jar包，不然会报错。</p>
<h2 id="2-然后再Spring的配置文件中添加对freemarker的配置"><a href="#2-然后再Spring的配置文件中添加对freemarker的配置" class="headerlink" title="2.然后再Spring的配置文件中添加对freemarker的配置"></a>2.然后再Spring的配置文件中添加对freemarker的配置</h2><p><code class="hljs xml has-numbering"><span class="hljs-comment"><!-- 配置freeMarker的模板路径 --><br>         <span class="hljs-tag">&lt;<span class="hljs-title">bean <span class="hljs-attribute">class=<span class="hljs-value">“org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer”&gt;<br>            <span class="hljs-tag">&lt;<span class="hljs-title">property <span class="hljs-attribute">name=<span class="hljs-value">“templateLoaderPath” <span class="hljs-attribute">value=<span class="hljs-value">“WEB-INF/ftl/“ /&gt;<br>            <span class="hljs-tag">&lt;<span class="hljs-title">property <span class="hljs-attribute">name=<span class="hljs-value">“defaultEncoding” <span class="hljs-attribute">value=<span class="hljs-value">“UTF-8” /&gt;<br>         <span class="hljs-tag">&lt;/<span class="hljs-title">bean&gt;<br>         <span class="hljs-comment"><!-- freemarker视图解析器 --><br>         <span class="hljs-tag">&lt;<span class="hljs-title">bean <span class="hljs-attribute">class=<span class="hljs-value">“org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver”&gt;<br>            <span class="hljs-tag">&lt;<span class="hljs-title">property <span class="hljs-attribute">name=<span class="hljs-value">“suffix” <span class="hljs-attribute">value=<span class="hljs-value">“.html” /&gt;<br>            <span class="hljs-tag">&lt;<span class="hljs-title">property <span class="hljs-attribute">name=<span class="hljs-value">“contentType” <span class="hljs-attribute">value=<span class="hljs-value">“text/html;charset=UTF-8” /&gt;<br>            <span class="hljs-comment"><!-- 此变量值为pageContext.request, 页面使用方法：rc.contextPath --><br>            <span class="hljs-tag">&lt;<span class="hljs-title">property <span class="hljs-attribute">name=<span class="hljs-value">“requestContextAttribute” <span class="hljs-attribute">value=<span class="hljs-value">“rc” /&gt;<br>         <span class="hljs-tag">&lt;/<span class="hljs-title">bean&gt; </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*   1</span><br><span class="line">*   2</span><br><span class="line">*   3</span><br><span class="line">*   4</span><br><span class="line">*   5</span><br><span class="line">*   6</span><br><span class="line">*   7</span><br><span class="line">*   8</span><br><span class="line">*   9</span><br><span class="line">*   10</span><br><span class="line">*   11</span><br><span class="line">*   12</span><br><span class="line"></span><br><span class="line">## 3.写一个User类：</span><br><span class="line"></span><br><span class="line">&lt;pre name=&quot;code&quot; class=&quot;prettyprint&quot;&gt;&lt;code class=&quot;hljs cs has-numbering&quot;&gt;package com.my.springmvc.bean;</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;class User &#123;</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;private String username;</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;private String password;</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;public String &lt;span class=&quot;hljs-title&quot;&gt;getUsername() &#123;</span><br><span class="line">        &lt;span class=&quot;hljs-keyword&quot;&gt;return username;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;setUsername(String username) &#123;</span><br><span class="line">        &lt;span class=&quot;hljs-keyword&quot;&gt;this.username = username;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;public String &lt;span class=&quot;hljs-title&quot;&gt;getPassword() &#123;</span><br><span class="line">        &lt;span class=&quot;hljs-keyword&quot;&gt;return password;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;setPassword(String password) &#123;</span><br><span class="line">        &lt;span class=&quot;hljs-keyword&quot;&gt;this.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;</span><br></pre></td></tr></table></figure></p>
<pre><code>*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19

## 4.一个FreeMarkerController类：

&lt;pre name=&quot;code&quot; class=&quot;prettyprint&quot;&gt;&lt;code class=&quot;hljs java has-numbering&quot;&gt;&lt;span class=&quot;hljs-annotation&quot;&gt;@Controller
&lt;span class=&quot;hljs-annotation&quot;&gt;@RequestMapping(&lt;span class=&quot;hljs-string&quot;&gt;&quot;/home&quot;)
&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class &lt;span class=&quot;hljs-title&quot;&gt;FreeMarkerController {

    &lt;span class=&quot;hljs-annotation&quot;&gt;@RequestMapping(&lt;span class=&quot;hljs-string&quot;&gt;&quot;/index&quot;)
    &lt;span class=&quot;hljs-keyword&quot;&gt;public ModelAndView &lt;span class=&quot;hljs-title&quot;&gt;Add(HttpServletRequest request,HttpServletResponse response){
        User user = &lt;span class=&quot;hljs-keyword&quot;&gt;new User();
        user.setUsername(&lt;span class=&quot;hljs-string&quot;&gt;&quot;sg&quot;);
        user.setPassword(&lt;span class=&quot;hljs-string&quot;&gt;&quot;1234&quot;);
        List&lt;User&gt; users  = &lt;span class=&quot;hljs-keyword&quot;&gt;new ArrayList&lt;User&gt;();
        users.add(user);

        ModelAndView mv = &lt;span class=&quot;hljs-keyword&quot;&gt;new ModelAndView();
        mv.setViewName(&lt;span class=&quot;hljs-string&quot;&gt;&quot;index&quot;);
        mv.addObject(&lt;span class=&quot;hljs-string&quot;&gt;&quot;users&quot;,users);
        &lt;span class=&quot;hljs-keyword&quot;&gt;return mv;
    }
}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    *   1</span><br><span class="line">    *   2</span><br><span class="line">    *   3</span><br><span class="line">    *   4</span><br><span class="line">    *   5</span><br><span class="line">    *   6</span><br><span class="line">    *   7</span><br><span class="line">    *   8</span><br><span class="line">    *   9</span><br><span class="line">    *   10</span><br><span class="line">    *   11</span><br><span class="line">    *   12</span><br><span class="line">    *   13</span><br><span class="line">    *   14</span><br><span class="line">    *   15</span><br><span class="line">    *   16</span><br><span class="line">    *   17</span><br><span class="line">    *   18</span><br><span class="line"></span><br><span class="line">    ## 5.然后再WEB-INF/ftl目录下创建一个index.html文件：</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line"></span><br><span class="line">    &lt;pre name=&quot;code&quot; class=&quot;prettyprint&quot;&gt;&lt;code class=&quot;hljs xml has-numbering&quot;&gt;&lt;span class=&quot;hljs-doctype&quot;&gt;&lt;!DOCTYPE html&gt;</span><br><span class="line">    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;html&gt;</span><br><span class="line">    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;head&gt;</span><br><span class="line">    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;meta &lt;span class=&quot;hljs-attribute&quot;&gt;charset=&lt;span class=&quot;hljs-value&quot;&gt;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;title&gt;another&lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;title&gt;</span><br><span class="line">    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;head&gt;</span><br><span class="line">    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;body&gt;  </span><br><span class="line">    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;#list &lt;span class=&quot;hljs-attribute&quot;&gt;users &lt;span class=&quot;hljs-attribute&quot;&gt;as &lt;span class=&quot;hljs-attribute&quot;&gt;user&gt;  </span><br><span class="line">    username : $&#123;user.username&#125;&lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;br/&gt;  </span><br><span class="line">    password : $&#123;user.password&#125;  </span><br><span class="line">    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;#list&gt;  </span><br><span class="line">    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;body&gt;  </span><br><span class="line">    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;html&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;</span><br></pre></td></tr></table></figure>

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13

## 结果：
</code></pre><p><img src="https://img-blog.csdn.net/20160713220156728" alt="这里写图片描述"></p>
<pre><code># 4.freemarker语法介绍：

## 1. FreeMarker模板文件主要由如下4个部分组成
</code></pre><p>文本：直接输出的部分<br>注释：&lt;#– … –&gt; 格式部分，不会输出<br>插值：即 ${…} 或 #{…} 格式的部分，将使用数据模型中的部分替代输出<br>指令：FreeMarker 指定，和 HTML 标记类似，名字前加 # 予以区分，不会输出</p>
<pre><code>&lt;pre name=&quot;code&quot; class=&quot;prettyprint&quot;&gt;&lt;code class=&quot;hljs xml has-numbering&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;html&gt;
&lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;head&gt;
    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;title&gt;Welcome!&lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;title&gt;
&lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;head&gt;
&lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;body&gt;
    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;#-- 注释部分 &lt;span class=&quot;hljs-attribute&quot;&gt;--&gt;
    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;#-- 下面使用插值 &lt;span class=&quot;hljs-attribute&quot;&gt;--&gt;
    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;h1&gt;Welcome ${username} !&lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;h1&gt;

    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;p&gt;We have these animals:&lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;p&gt;
    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;u1&gt;
        &lt;span class=&quot;hljs-comment&quot;&gt;&lt;!-- 使用FTL指令 --&gt;
        &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;#list &lt;span class=&quot;hljs-attribute&quot;&gt;animals &lt;span class=&quot;hljs-attribute&quot;&gt;as &lt;span class=&quot;hljs-attribute&quot;&gt;animal&gt;
        &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;li&gt;${animal.name} for ${animal.price} Euros&lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;li&gt;
        &lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;#list&gt;
    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;u1&gt;
&lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;body&gt;
&lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;html
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*   1</span><br><span class="line">*   2</span><br><span class="line">*   3</span><br><span class="line">*   4</span><br><span class="line">*   5</span><br><span class="line">*   6</span><br><span class="line">*   7</span><br><span class="line">*   8</span><br><span class="line">*   9</span><br><span class="line">*   10</span><br><span class="line">*   11</span><br><span class="line">*   12</span><br><span class="line">*   13</span><br><span class="line">*   14</span><br><span class="line">*   15</span><br><span class="line">*   16</span><br><span class="line">*   17</span><br><span class="line">*   18</span><br><span class="line">*   19</span><br><span class="line"></span><br><span class="line">## 2.控制语句</span><br><span class="line"></span><br><span class="line">&lt;pre name=&quot;code&quot; class=&quot;prettyprint&quot;&gt;&lt;code class=&quot;hljs r has-numbering&quot;&gt;&lt;&lt;span class=&quot;hljs-comment&quot;&gt;#if condition&gt; </span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;... </span><br><span class="line">&lt;&lt;span class=&quot;hljs-comment&quot;&gt;#elseif condition2&gt; </span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;... </span><br><span class="line">&lt;&lt;span class=&quot;hljs-comment&quot;&gt;#elseif condition3&gt; </span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;... </span><br><span class="line">&lt;&lt;span class=&quot;hljs-comment&quot;&gt;#else&gt;</span><br><span class="line">&lt;&lt;span class=&quot;hljs-comment&quot;&gt;#switch value&gt; </span><br><span class="line">    &lt;&lt;span class=&quot;hljs-comment&quot;&gt;#case refValue1&gt; </span><br><span class="line">        &lt;span class=&quot;hljs-keyword&quot;&gt;... </span><br><span class="line">        &lt;&lt;span class=&quot;hljs-comment&quot;&gt;#break&gt; </span><br><span class="line">    &lt;&lt;span class=&quot;hljs-comment&quot;&gt;#case refValue2&gt; </span><br><span class="line">        &lt;span class=&quot;hljs-keyword&quot;&gt;... </span><br><span class="line">        &lt;&lt;span class=&quot;hljs-comment&quot;&gt;#break&gt; </span><br><span class="line">    &lt;&lt;span class=&quot;hljs-comment&quot;&gt;#case refValueN&gt; </span><br><span class="line">        &lt;span class=&quot;hljs-keyword&quot;&gt;... </span><br><span class="line">        &lt;&lt;span class=&quot;hljs-comment&quot;&gt;#break&gt; </span><br><span class="line">    &lt;&lt;span class=&quot;hljs-comment&quot;&gt;#default&gt; </span><br><span class="line">        &lt;span class=&quot;hljs-keyword&quot;&gt;... </span><br><span class="line">&lt;/&lt;span class=&quot;hljs-comment&quot;&gt;#switch&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;</span><br></pre></td></tr></table></figure>

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20

## 3判断变量是否存在

&lt;pre name=&quot;code&quot; class=&quot;prettyprint&quot;&gt;&lt;code class=&quot;hljs cs has-numbering&quot;&gt;&lt;&lt;span class=&quot;hljs-preprocessor&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;if readonly??&gt;&lt;/#&lt;span class=&quot;hljs-keyword&quot;&gt;if&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    *   1</span><br><span class="line"></span><br><span class="line">    ## 4.防止空指针报错</span><br><span class="line"></span><br><span class="line">变量名后用 ! 加默认值：$&#123;foo!”Default”&#125;，如果 foo 为 null 则输出 Default</span><br><span class="line"></span><br><span class="line">    ## 5.普通的变量</span><br><span class="line"></span><br><span class="line">这是最简单的情况，直接&lt;span id=&quot;MathJax-Element-1-Frame&quot; class=&quot;MathJax&quot; data-mathml=&quot;&lt;math xmlns=&quot; http://www.w3.org/1998/math/mathml&quot;=&quot;&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;变&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;量&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;名&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;称&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;，&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;如&lt;/mo&gt;&lt;/mrow&gt;&quot;&gt;&lt;span id=&quot;MathJax-Span-1&quot; class=&quot;math&quot;&gt;&lt;span id=&quot;MathJax-Span-2&quot; class=&quot;mrow&quot;&gt;&lt;span id=&quot;MathJax-Span-3&quot; class=&quot;texatom&quot;&gt;&lt;span id=&quot;MathJax-Span-4&quot; class=&quot;mrow&quot;&gt;&lt;span id=&quot;MathJax-Span-5&quot; class=&quot;texatom&quot;&gt;&lt;span id=&quot;MathJax-Span-6&quot; class=&quot;mrow&quot;&gt;&lt;span id=&quot;MathJax-Span-7&quot; class=&quot;mo&quot;&gt;变&lt;span id=&quot;MathJax-Span-8&quot; class=&quot;texatom&quot;&gt;&lt;span id=&quot;MathJax-Span-9&quot; class=&quot;mrow&quot;&gt;&lt;span id=&quot;MathJax-Span-10&quot; class=&quot;mo&quot;&gt;量&lt;span id=&quot;MathJax-Span-11&quot; class=&quot;texatom&quot;&gt;&lt;span id=&quot;MathJax-Span-12&quot; class=&quot;mrow&quot;&gt;&lt;span id=&quot;MathJax-Span-13&quot; class=&quot;mo&quot;&gt;名&lt;span id=&quot;MathJax-Span-14&quot; class=&quot;texatom&quot;&gt;&lt;span id=&quot;MathJax-Span-15&quot; class=&quot;mrow&quot;&gt;&lt;span id=&quot;MathJax-Span-16&quot; class=&quot;mo&quot;&gt;称&lt;span id=&quot;MathJax-Span-17&quot; class=&quot;texatom&quot;&gt;&lt;span id=&quot;MathJax-Span-18&quot; class=&quot;mrow&quot;&gt;&lt;span id=&quot;MathJax-Span-19&quot; class=&quot;mo&quot;&gt;，&lt;span id=&quot;MathJax-Span-20&quot; class=&quot;texatom&quot;&gt;&lt;span id=&quot;MathJax-Span-21&quot; class=&quot;mrow&quot;&gt;&lt;span id=&quot;MathJax-Span-22&quot; class=&quot;mo&quot;&gt;如&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;MJX_Assistive_MathML&quot;&gt;变量名称，如&#123;name&#125;&lt;/span&gt;&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">需要注意的是有的变量是需要转义的如双引号</span><br><span class="line"></span><br><span class="line">    ## 6..遍历List集合</span><br><span class="line"></span><br><span class="line">    &lt;pre name=&quot;code&quot; class=&quot;prettyprint&quot;&gt;&lt;code class=&quot;hljs smalltalk has-numbering&quot;&gt;&lt;&lt;span class=&quot;hljs-symbol&quot;&gt;#list [&lt;span class=&quot;hljs-comment&quot;&gt;&quot;克里斯埃文斯&quot;, &lt;span class=&quot;hljs-comment&quot;&gt;&quot;斯嘉丽约翰逊&quot;, &lt;span class=&quot;hljs-comment&quot;&gt;&quot;小罗伯特唐尼&quot;]  as x&gt;  </span><br><span class="line">    &lt;span class=&quot;hljs-char&quot;&gt;$&#123;x&#125;  </span><br><span class="line">    &lt;/&lt;span class=&quot;hljs-symbol&quot;&gt;#list&gt;  </span><br><span class="line">    &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;</span><br></pre></td></tr></table></figure>

*   1
*   2
*   3
*   4
</code></pre><p>此外,迭代集合对象时,还包含两个特殊的循环变量:<br>item_index:当前变量的索引值<br>item_has_next:是否存在下一个对象<br>也可以使用&lt;#break&gt;指令跳出迭代</p>
<pre><code>## 7.运算符
</code></pre><p>FreeMarker表达式中完全支持算术运算,FreeMarker支持的算术运算符包括:+, - , * , / , %<br>比较运算符</p>
<p>表达式中支持的比较运算符有如下几个:<br>1,=或者==:判断两个值是否相等.<br>2,!=:判断两个值是否不等.<br>3,&gt;或者gt:判断左边值是否大于右边值<br>4,&gt;=或者gte:判断左边值是否大于等于右边值<br>5,&lt;或者lt:判断左边值是否小于右边值<br>6,&lt;=或者lte:判断左边值是否小于等于右边值</p>
<p>注意:=和!=可以用于字符串,数值和日期来比较是否相等,但=和!=两边必须是相同类型的值,否则会产生错误,而且FreeMarker是精确比较,”x”,”x “,”X”是不等的.其它的运行符可以作用于数字和日期,但不能作用于字符串,大部分的时候,使用gt等字母运算符代替&gt;会有更好的效果,因为FreeMarker会把&gt;解释成FTL标签的结束字符,当然,也可以使用括号来避免这种情况,如:&lt;#if (x&gt;y)&gt;</p>
<p>逻辑运算符</p>
<p>和普通程序一样，freemarker也有&amp;&amp;，|| ，!三种</p>
<pre><code>## 8.变量的声明
</code></pre><p>&lt;#assign num=0/&gt;</p>
<pre><code>## 9.include指令
</code></pre><p>include指令的作用类似于JSP的包含指令,用于包含指定页.include指令的语法格式如下:<br>&lt;#include filename [options]&gt;<br>在上面的语法格式中,两个参数的解释如下:<br>filename:该参数指定被包含的模板文件<br>options:该参数可以省略,指定包含时的选项,包含encoding和parse两个选项,其中encoding指定包含页面时所用的解码集,而parse指定被包含文件是否作为FTL文件来解析,如果省略了parse选项值,则该选项默认是true.</p>
<pre><code>## 10.import指令
</code></pre><p>该指令用于导入FreeMarker模板中的所有变量,并将该变量放置在指定的Map对象中,import指令的语法格式如下:<br>&lt;#import “/lib/common.ftl” as com&gt;<br>上面的代码将导入/lib/common.ftl模板文件中的所有变量,交将这些变量放置在一个名为com的Map对象中.</p>
<pre><code>## 11 macro的使用
</code></pre><p>这个可以用来实现自定义指令，一般用来做公共组件，例如分页条<br>最后说下list中含有map的遍历，这种情况可以使用点语法或方括号语法.假如有下面的数据模型:<br>Map root = new HashMap();<br>Book book = new Book();<br>Author author = new Author();<br>author.setName(“annlee”);<br>author.setAddress(“gz”);<br>book.setName(“struts2”);<br>book.setAuthor(author);<br>root.put(“info”,”struts”);<br>root.put(“book”, book);</p>
<p>为了访问数据模型中名为struts2的书的作者的名字,可以使用如下语法:<br>book.author.name //全部使用点语法<br>book[“author”].name<br>book.author[“name”] //混合使用点语法和方括号语法<br>book[“author”][“name”] //全部使用方括号语法</p>
<p>参考：<br><a href="http://blog.csdn.net/walkcode/article/details/26393211" target="_blank" rel="noopener">http://blog.csdn.net/walkcode/article/details/26393211</a><br><a href="http://blog.csdn.net/win_man/article/details/51317957" target="_blank" rel="noopener">http://blog.csdn.net/win_man/article/details/51317957</a><br><a href="http://rongjih.blog.163.com/blog/static/3357446120127632757911/" target="_blank" rel="noopener">http://rongjih.blog.163.com/blog/static/3357446120127632757911/</a><br><a href="http://qtdebug.com/spring-web/11.%20Freemarker%20%E8%AF%AD%E6%B3%95%E7%AE%80%E4%BB%8B.html" target="_blank" rel="noopener">http://qtdebug.com/spring-web/11.%20Freemarker%20%E8%AF%AD%E6%B3%95%E7%AE%80%E4%BB%8B.html</a><br><a href="http://blog.csdn.net/walkcode/article/details/26393211" target="_blank" rel="noopener">http://blog.csdn.net/walkcode/article/details/26393211</a><br><a href="http://blog.csdn.net/shimiso/article/details/8778793" target="_blank" rel="noopener">http://blog.csdn.net/shimiso/article/details/8778793</a><br></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/90d7057.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/90d7057.html" itemprop="url">kafka 主要内容介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-28T09:20:00+08:00">
                2018-06-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-kafka介绍"><a href="#1-kafka介绍" class="headerlink" title="1.       kafka介绍"></a>1.       kafka介绍</h2><h3 id="1-1-主要功能"><a href="#1-1-主要功能" class="headerlink" title="1.1.       主要功能"></a>1.1.       主要功能</h3><p>根据官网的介绍，ApacheKafka®是<em>一个分布式流媒体平台</em>，它主要有3种功能：</p>
<p> 1：It lets you publish and subscribe to streams of records.发布和订阅消息流，这个功能类似于消息队列，这也是kafka归类为消息队列框架的原因</p>
<p> 2：It lets you store streams of records in a fault-tolerant way.以容错的方式记录消息流，kafka以文件的方式来存储消息流</p>
<p> 3：It lets you process streams of records as they occur.可以再消息发布的时候进行处理</p>
<h3 id="1-2-使用场景"><a href="#1-2-使用场景" class="headerlink" title="1.2.       使用场景"></a>1.2.       使用场景</h3><p>1：Building real-time streaming data pipelines that reliably get data between systems or applications.在系统或应用程序之间构建可靠的用于传输实时数据的管道，消息队列功能</p>
<p>2：Building real-time streaming applications that transform or react to the streams of data。构建实时的流数据处理程序来变换或处理数据流，数据处理功能</p>
<h3 id="1-3-详细介绍"><a href="#1-3-详细介绍" class="headerlink" title="1.3.       详细介绍"></a>1.3.       详细介绍</h3><p>Kafka目前主要作为一个分布式的发布订阅式的消息系统使用，下面简单介绍一下kafka的基本机制</p>
<p><strong> 1.3.1 消息传输流程</strong></p>
<p><img src="http://pangguoming.com/blog/images/91dd84a6-c6f7-4586-9b1f-3bd20a1c0d21.png" alt=""></p>
<p> <strong>Producer</strong>即生产者，向Kafka集群发送消息，在发送消息之前，会对消息进行分类，即Topic，上图展示了两个producer发送了分类为topic1的消息，另外一个发送了topic2的消息。</p>
<p> <strong>Topic</strong>即主题，通过对消息指定主题可以将消息分类，消费者可以只关注自己需要的Topic中的消息</p>
<p> <strong>Consumer</strong>即消费者，消费者通过与kafka集群建立长连接的方式，不断地从集群中拉取消息，然后可以对这些消息进行处理。</p>
<p> 从上图中就可以看出同一个Topic下的消费者和生产者的数量并不是对应的。</p>
<p><strong> 1.3.2 kafka**</strong>服务器消息存储策略**</p>
<p> <img src="http://pangguoming.com/blog/images/bbd929a8-fbf5-4baf-86c8-893d5ba40105.png" alt=""></p>
<p> 谈到kafka的存储，就不得不提到分区，即partitions，创建一个topic时，同时可以指定分区数目，分区数越多，其吞吐量也越大，但是需要的资源也越多，同时也会导致更高的不可用性，kafka在接收到生产者发送的消息之后，会根据均衡策略将消息存储到不同的分区中。</p>
<p> <img src="http://pangguoming.com/blog/images/91b0b1e8-ca3b-4cf7-9c30-f87b8ef47599.png" alt=""></p>
<p> 在每个分区中，消息以顺序存储，最晚接收的的消息会最后被消费。</p>
<p><strong> 1.3.3 与生产者的交互</strong></p>
<p> <img src="http://pangguoming.com/blog/images/4f255d92-bbac-4bdf-88db-589ca0445236.png" alt=""></p>
<p> 生产者在向kafka集群发送消息的时候，可以通过指定分区来发送到指定的分区中</p>
<p> 也可以通过指定均衡策略来将消息发送到不同的分区中</p>
<p> 如果不指定，就会采用默认的随机均衡策略，将消息随机的存储到不同的分区中</p>
<p><strong> 1.3.4  与消费者的交互</strong></p>
<p> <img src="http://pangguoming.com/blog/images/2785a3a2-c9b5-4cd2-a74a-dfccc7a5f856.png" alt=""> </p>
<p> 在消费者消费消息时，kafka使用offset来记录当前消费的位置</p>
<p> 在kafka的设计中，可以有多个不同的group来同时消费同一个topic下的消息，如图，我们有两个不同的group同时消费，他们的的消费的记录位置offset各不项目，不互相干扰。</p>
<p> 对于一个group而言，消费者的数量不应该多余分区的数量，因为在一个group中，每个分区至多只能绑定到一个消费者上，即一个消费者可以消费多个分区，一个分区只能给一个消费者消费</p>
<p> 因此，若一个group中的消费者数量大于分区数量的话，多余的消费者将不会收到任何消息。</p>
<div><br><br>## 2.       Kafka安装与使用<br><br>### 2.1.       下载<br><br> 你可以在kafka官网 <a href="http://kafka.apache.org/downloads" target="_blank" rel="noopener">http://kafka.apache.org/downloads</a>下载到最新的kafka安装包，选择下载二进制版本的tgz文件，根据网络状态可能需要fq，这里我们选择的版本是0.11.0.1，目前的最新版<br><br>### 2.2.       安装<br><br> Kafka是使用scala编写的运行与jvm虚拟机上的程序，虽然也可以在windows上使用，但是kafka基本上是运行在linux服务器上，因此我们这里也使用linux来开始今天的实战。<br><br> 首先确保你的机器上安装了jdk，kafka需要java运行环境，以前的kafka还需要zookeeper，新版的kafka已经内置了一个zookeeper环境，所以我们可以直接使用<br><br> 说是安装，如果只需要进行最简单的尝试的话我们只需要解压到任意目录即可，这里我们将kafka压缩包解压到/home目录<br><br>### 2.3.       配置<br><br> 在kafka解压目录下下有一个config的文件夹，里面放置的是我们的配置文件<br><br> consumer.properites 消费者配置，这个配置文件用于配置于2.5节中开启的消费者，此处我们使用默认的即可<br><br> producer.properties 生产者配置，这个配置文件用于配置于2.5节中开启的生产者，此处我们使用默认的即可<br><br> server.properties kafka服务器的配置，此配置文件用来配置kafka服务器，目前仅介绍几个最基础的配置<br><br>1.  1.  broker.id 申明当前kafka服务器在集群中的唯一ID，需配置为integer,并且集群中的每一个kafka服务器的id都应是唯一的，我们这里采用默认配置即可<br>    2.  listeners 申明此kafka服务器需要监听的端口号，如果是在本机上跑虚拟机运行可以不用配置本项，默认会使用localhost的地址，如果是在远程服务器上运行则必须配置，例如：<br><br> listeners=PLAINTEXT:// 192.168.180.128:9092。并确保服务器的9092端口能够访问<br><br> 3.zookeeper.connect 申明kafka所连接的zookeeper的地址 ，需配置为zookeeper的地址，由于本次使用的是kafka高版本中自带zookeeper，使用默认配置即可<br><br> zookeeper.connect=localhost:2181<br><br>### 2.4.       运行<br><br>1.  启动zookeeper<br><br>cd进入kafka解压目录，输入<br><br><code>bin/zookeeper-server-start.sh config/zookeeper.properties</code><br><br><code>启动zookeeper成功后会看到如下的输出</code><br><br><img src="http://pangguoming.com/blog/images/3e66ac10-cd5c-470d-a7f4-24c0449cadfd.png" alt=""><br><br> 2.启动kafka<br><br>cd进入kafka解压目录，输入<br><br><code>bin/kafka-server-start.sh config/server.properties</code><br><br><code>启动kafka成功后会看到如下的输出</code><br><br> <img src="http://pangguoming.com/blog/images/61257e77-9a4a-4a31-8668-b184716f5b1c.png" alt=""><br><br>### 2.5.       第一个消息<br><br> 2.5.1   创建一个topic<br><br> Kafka通过topic对同一类的数据进行管理，同一类的数据使用同一个topic可以在处理数据时更加的便捷<br><br> 在kafka解压目录打开终端，输入<br><br><code>bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic `</code>test<code></code> 创建一个名为test的topic<code>![](http://pangguoming.com/blog/images/fdb953d2-392b-492a-ac3d-b46f9dabe583.png)

        在创建topic后可以通过输入</code>bin/kafka-topics.sh –list –zookeeper localhost:2181<code></code>   <code>来查看已经创建的topic`

` 2.4.2</code>创建一个消息消费者<code></code> 在kafka解压目录打开终端，输入<code></code> bin/kafka-console-consumer.sh –bootstrap-server localhost:9092 –topic <code>test` `--from-beginning`

` 可以创建一个用于消费topic为test的消费者`

 ![](http://pangguoming.com/blog/images/0b3f99cb-c30e-4e48-90aa-9060581e44e5.png)

         消费者创建完成之后，因为还没有发送任何数据，因此这里在执行后没有打印出任何数据

         不过别着急，不要关闭这个终端，打开一个新的终端，接下来我们创建第一个消息生产者

 2.4.3         创建一个消息生产者

 在kafka解压目录打开一个新的终端，输入

` bin/kafka-console-producer.sh --broker-list localhost:9092 --topic</code>test<code></code> 在执行完毕后会进入的编辑器页面<code></code><img src="http://pangguoming.com/blog/images/39baf7bf-ea46-4a6c-9069-f1557281966d.png" alt="">`<br><br>在发送完消息之后，可以回到我们的消息消费者终端中，可以看到，终端中已经打印出了我们刚才发送的消息<br><br><img src="http://pangguoming.com/blog/images/5cdf13d4-55a3-4593-a1ad-b0b4a2f1ec9e.png" alt=""><br><br><div><br><br>## 3.       使用java程序<br><br> 跟上节中一样，我们现在在java程序中尝试使用kafka<br><br> <strong>3.1  创建Topic</strong><br><br>public static void main(String[] args) {<br>    //创建topic<br>    Properties props = new Properties();<br>    props.put(“bootstrap.servers”, “192.168.180.128:9092”);<br>    AdminClient adminClient = AdminClient.<em>create</em>(props);<br>    ArrayList<newtopic> topics = new ArrayList<newtopic>();<br>    NewTopic newTopic = new NewTopic(“topic-test”, 1, (short) 1);<br>    topics.add(newTopic);<br>    CreateTopicsResult result = adminClient.createTopics(topics);<br>    try {<br>        result.all().get();<br>    } catch (InterruptedException e) {<br>        e.printStackTrace();<br>    } catch (ExecutionException e) {<br>        e.printStackTrace();<br>    }<br>}<br><br> 使用AdminClient API可以来控制对kafka服务器进行配置，我们这里使用NewTopic(String name, int numPartitions, short replicationFactor)的构造方法来创建了一个名为“topic-test”，分区数为1，复制因子为1的Topic.<br><br><strong>3.2  Producer生产者发送消息</strong><br><br>public static void main(String[] args){<br>    Properties props = new Properties();<br>    props.put(“bootstrap.servers”, “192.168.180.128:9092”);<br>    props.put(“acks”, “all”);<br>    props.put(“retries”, 0);<br>    props.put(“batch.size”, 16384);<br>    props.put(“linger.ms”, 1);<br>    props.put(“buffer.memory”, 33554432);<br>    props.put(“key.serializer”, “org.apache.kafka.common.serialization.StringSerializer”);<br>    props.put(“value.serializer”, “org.apache.kafka.common.serialization.StringSerializer”);<br><br>    Producer&lt;String, String&gt; producer = new KafkaProducer&lt;String, String&gt;(props);<br>    for (int i = 0; i &lt; 100; i++)<br>        producer.send(new ProducerRecord&lt;String, String&gt;(“topic-test”, Integer.<em>toString</em>(i), Integer.<em>toString</em>(i)));<br><br>    producer.close();<br><br>}<br><br>使用producer发送完消息可以通过2.5中提到的服务器端消费者监听到消息。也可以使用接下来介绍的java消费者程序来消费消息<br><br><strong>3.3 Consumer消费者消费消息</strong><br><br>public static void main(String[] args){<br>    Properties props = new Properties();<br>    props.put(“bootstrap.servers”, “192.168.12.65:9092”);<br>    props.put(“group.id”, “test”);<br>    props.put(“enable.auto.commit”, “true”);<br>    props.put(“auto.commit.interval.ms”, “1000”);<br>    props.put(“key.deserializer”, “org.apache.kafka.common.serialization.StringDeserializer”);<br>    props.put(“value.deserializer”, “org.apache.kafka.common.serialization.StringDeserializer”);<br>    final KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;String,String&gt;(props);<br>    consumer.subscribe(Arrays.<em>asList</em>(“topic-test”),new ConsumerRebalanceListener() {<br>        public void onPartitionsRevoked(Collection<topicpartition> collection) {<br>        }<br>        public void onPartitionsAssigned(Collection<topicpartition> collection) {<br>            //将偏移设置到最开始<br>            consumer.seekToBeginning(collection);<br>        }<br>    });<br>    while (true) {<br>        ConsumerRecords&lt;String, String&gt; records = consumer.poll(100);<br>        for (ConsumerRecord&lt;String, String&gt; record : records)<br>            System.<em>out</em>.printf(“offset = %d, key = %s, value = %s%n”, record.offset(), record.key(), record.value());<br>    }<br>}<br><br>这里我们使用Consume API 来创建了一个普通的java消费者程序来监听名为“topic-test”的Topic，每当有生产者向kafka服务器发送消息，我们的消费者就能收到发送的消息。<br><br><div><br><br>## 4.       使用spring-kafka<br><br>Spring-kafka是正处于孵化阶段的一个spring子项目，能够使用spring的特性来让我们更方便的使用kafka<br><br><strong>4.1   基本配置信息</strong><br><br>与其他spring的项目一样，总是离不开配置，这里我们使用java配置来配置我们的kafka消费者和生产者。<br><br>1.  引入pom文件<br><br><!--kafka start--><br><dependency><br>    <groupid>org.apache.kafka</groupid><br>    <artifactid>kafka-clients</artifactid><br>    <version>0.11.0.1</version><br></dependency><br><dependency><br>    <groupid>org.apache.kafka</groupid><br>    <artifactid>kafka-streams</artifactid><br>    <version>0.11.0.1</version><br></dependency><br><dependency><br>    <groupid>org.springframework.kafka</groupid><br>    <artifactid>spring-kafka</artifactid><br>    <version>1.3.0.RELEASE</version><br></dependency><br><br>1.  创建配置类<br><br>我们在主目录下新建名为KafkaConfig的类<br><br>@Configuration<br>@EnableKafka<br>public class KafkaConfig {<br><br>}<br><br>1.  配置Topic<br><br>在kafkaConfig类中添加配置<br><br>//topic config Topic的配置开始<br>    @Bean<br>    public KafkaAdmin admin() {<br>        Map&lt;String, Object&gt; configs = new HashMap&lt;String, Object&gt;();<br>        configs.put(AdminClientConfig.<em>BOOTSTRAP_SERVERS_CONFIG</em>,”192.168.180.128:9092”);<br>        return new KafkaAdmin(configs);<br>    }<br><br>    @Bean<br>    public NewTopic topic1() {<br>        return new NewTopic(“foo”, 10, (short) 2);<br>    }<br>//topic的配置结束<br><br>1.  配置生产者Factort及Template<br><br>//producer config start<br>    @Bean<br>    public ProducerFactory&lt;Integer, String&gt; producerFactory() {<br>        return new DefaultKafkaProducerFactory&lt;Integer,String&gt;(producerConfigs());<br>    }<br>    @Bean<br>    public Map&lt;String, Object&gt; producerConfigs() {<br>        Map&lt;String, Object&gt; props = new HashMap&lt;String,Object&gt;();<br>        props.put(ProducerConfig.<em>BOOTSTRAP_SERVERS_CONFIG</em>, “192.168.180.128:9092”);<br>        props.put(“acks”, “all”);<br>        props.put(“retries”, 0);<br>        props.put(“batch.size”, 16384);<br>        props.put(“linger.ms”, 1);<br>        props.put(“buffer.memory”, 33554432);<br>        props.put(“key.serializer”, “org.apache.kafka.common.serialization.IntegerSerializer”);<br>        props.put(“value.serializer”, “org.apache.kafka.common.serialization.StringSerializer”);<br>        return props;<br>    }<br>    @Bean<br>    public KafkaTemplate&lt;Integer, String&gt; kafkaTemplate() {<br>        return new KafkaTemplate&lt;Integer, String&gt;(producerFactory());<br>    }<br>//producer config end<br><br>5.配置ConsumerFactory<br><br>//consumer config start<br>    @Bean<br>    public ConcurrentKafkaListenerContainerFactory&lt;Integer,String&gt; kafkaListenerContainerFactory(){<br>        ConcurrentKafkaListenerContainerFactory&lt;Integer, String&gt; factory = new ConcurrentKafkaListenerContainerFactory&lt;Integer, String&gt;();<br>        factory.setConsumerFactory(consumerFactory());<br>        return factory;<br>    }<br><br>    @Bean<br>    public ConsumerFactory&lt;Integer,String&gt; consumerFactory(){<br>        return new DefaultKafkaConsumerFactory&lt;Integer, String&gt;(consumerConfigs());<br>    }<br><br>    @Bean<br>    public Map&lt;String,Object&gt; consumerConfigs(){<br>        HashMap&lt;String, Object&gt; props = new HashMap&lt;String, Object&gt;();<br>        props.put(“bootstrap.servers”, “192.168.180.128:9092”);<br>        props.put(“group.id”, “test”);<br>        props.put(“enable.auto.commit”, “true”);<br>        props.put(“auto.commit.interval.ms”, “1000”);<br>        props.put(“key.deserializer”, “org.apache.kafka.common.serialization.IntegerDeserializer”);<br>        props.put(“value.deserializer”, “org.apache.kafka.common.serialization.StringDeserializer”);<br>        return props;<br>    }<br>//consumer config end<br><br><strong>4.2  创建消息生产者</strong><br><br>//使用spring-kafka的template发送一条消息 发送多条消息只需要循环多次即可<br>public static void main(String[] args) throws ExecutionException, InterruptedException {<br>    AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext(KafkaConfig.class);<br>    KafkaTemplate&lt;Integer, String&gt; kafkaTemplate = (KafkaTemplate&lt;Integer, String&gt;) ctx.getBean(“kafkaTemplate”);<br>        String data=”this is a test message”;<br>        ListenableFuture&lt;SendResult&lt;Integer, String&gt;&gt; send = kafkaTemplate.send(“topic-test”, 1, data);<br>        send.addCallback(new ListenableFutureCallback&lt;SendResult&lt;Integer, String&gt;&gt;() {<br>            public void onFailure(Throwable throwable) {<br><br>            }<br><br>            public void onSuccess(SendResult&lt;Integer, String&gt; integerStringSendResult) {<br><br>            }<br>        });<br>}<br><br><strong>4.3    创建消息消费者</strong><br><br>我们首先创建一个一个用于消息监听的类，当名为”topic-test”的topic接收到消息之后，我们的这个listen方法就会调用。<br><br>public class SimpleConsumerListener {<br>    private final static Logger <em>logger </em>= LoggerFactory.<em>getLogger</em>(SimpleConsumerListener.class);<br>    private final CountDownLatch latch1 = new CountDownLatch(1);<br><br>    @KafkaListener(id = “foo”, topics = “topic-test”)<br>    public void listen(byte[] records) {<br>        //do something here<br>        this.latch1.countDown();<br>    }<br>}<br><br>         我们同时也需要将这个类作为一个Bean配置到KafkaConfig中<br><br>@Bean<br>public SimpleConsumerListener simpleConsumerListener(){<br>    return new SimpleConsumerListener();<br>}<br><br>默认spring-kafka会为每一个监听方法创建一个线程来向kafka服务器拉取消息<br><br>#<br><br></div></topicpartition></topicpartition></newtopic></newtopic></div></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/1e33e198.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/1e33e198.html" itemprop="url">C#异步编程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-24T14:32:00+08:00">
                2018-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="什么是异步编程"><a href="#什么是异步编程" class="headerlink" title="什么是异步编程"></a>什么是异步编程</h1><p>什么是异步编程呢？举个简单的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">using System.Net.Http;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using static System.Console;</span><br><span class="line"></span><br><span class="line">namespace Core</span><br><span class="line">&#123;</span><br><span class="line">    class Async</span><br><span class="line">    &#123;</span><br><span class="line">        static void Main()</span><br><span class="line">        &#123;</span><br><span class="line">            Start();</span><br><span class="line">            End();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        static void Wait()=&gt;WriteLine(&quot;waiting...&quot;);</span><br><span class="line">        static void End()=&gt;WriteLine(&quot;end...&quot;);</span><br><span class="line">        static int Start()</span><br><span class="line">        &#123;</span><br><span class="line">            WriteLine(&quot;start...&quot;);</span><br><span class="line">            HttpClient client = new HttpClient();</span><br><span class="line">            Waiting();</span><br><span class="line">            var result = client.GetStringAsync(&quot;https://www.visualstudio.com/&quot;);</span><br><span class="line">            string str = result.Result;</span><br><span class="line">            return str.Length;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面这段代码中，Main方法中的代码是按照自上而下的顺序执行的。网络状况不佳时，<code>Start()</code>方法是比较耗时（注意，这里在<code>Start</code>方法中调用了异步方法<code>GetStringAsync</code>，但该方法在此处是以同步方式执行的，具体原因下文会进行说明），在<code>Start()</code>方法执行完毕之前，整个程序处于阻塞状态。而异步编程可以很好的解决这个问题，一句简单的话来概括异步编程就是，<strong>程序无须按照代码顺序自上而下的执行</strong>。</p>
<h1 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h1><p><strong>C#5.0新增了async和await关键字，使用这两个关键字可以大大简化异步编程</strong></p>
<p>使用 <strong>async</strong> 关键字可将方法、<a href="https://msdn.microsoft.com/zh-cn/library/bb397687.aspx" target="_blank" rel="noopener">lambda 表达式</a>或<a href="https://msdn.microsoft.com/zh-cn/library/0yw3tz5k.aspx" target="_blank" rel="noopener">匿名方法</a><strong>标记为异步，</strong>即，方法中应该包含一个或多个await表达式，但async关键字本身不会创建异步操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public async Task Asy()</span><br><span class="line">&#123;</span><br><span class="line">　　//do something...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里需要注意一点，若使用async关键字标记的方法中没有使用await关键字（编译器会给出警告但不报错），那么该方法将会以同步方式执行。</p>
<h1 id="定义异步方法的几点要求"><a href="#定义异步方法的几点要求" class="headerlink" title="定义异步方法的几点要求"></a>定义异步方法的几点要求</h1><p>定义一个异步方法应满足以下几点：</p>
<ul>
<li>使用async关键字来修饰方法</li>
<li>在异步方法中使用await关键字（不使用编译器会给出警告但不报错），否则异步方法会以同步方式执行</li>
<li>尽量不使用void作为返回类型，若希望异步方法返回void类型，请使用Task</li>
<li>异步方法名称以Async结尾</li>
<li>异步方法中不能声明使用ref或out关键字修饰的变量</li>
</ul>
<p>下面定义一个异步方法<code>StartAsync()</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">static async Task&lt;int&gt; StartAsync()</span><br><span class="line">&#123;</span><br><span class="line">    HttpClient client = new HttpClient();</span><br><span class="line">    var str = await client.GetStringAsync(&quot;https://www.visualstudio.com/&quot;);</span><br><span class="line">    return str.Length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="异步方法的返回类型"><a href="#异步方法的返回类型" class="headerlink" title="异步方法的返回类型"></a>异步方法的返回类型</h1><ul>
<li><p>Task<t><br>如果在调用匿名方法时使用了<strong>await</strong>关键字，且匿名方法的返回类型是Task<t>，那么我们得到的返回类型是T。若未使用<strong>await</strong>关键字，则返回类型是Task。未使用await，调用GetStringAsync方法时result是Task类型。</t></t></p>
<p><img src="http://pangguoming.com/blog/images/8f2312da-a35d-4e23-9b6c-63cd1b5827a8.png" alt=""></p>
</li>
</ul>
<p>从上图我们可以看到调用GetStringAsync方法时未使用await关键字，result是Task类型，我们可以通过GetType()方法来获取result的详细类型信息：</p>
<div class="image-package imagebubble"><img src="https://upload-images.jianshu.io/upload_images/1458860-36624514d5ee5c6c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><br>从上图可以看到result的类型全名是System.Threading.Tasks.Task<br><br><div class="image-package imagebubble"><img src="https://upload-images.jianshu.io/upload_images/1458860-2e3248c3d8c31d06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><br><div class="image-caption"><br><br>从上图我们可以看到使用await关键字时，result是string类型，而匿名方法GetStringAsync的返回类型是Task<string><br><br><em><br><br>Task<br>如果在调用匿名方法时使用了<strong>await</strong>关键字，且匿名方法的返回类型是Task，那么我们得到的返回类型是void。若为使用await关键字，则得到的返回类型是Task。

</em><br><br>void<br>不建议使用void作为异步方法的返回值。<br>因为使用Task或Task<tresult>任务作为返回值，其属性携带有关其状态和历史记录的信息，如任务是否完成、异步方法是否导致异常或已取消以及最终结果是什么。而await运算符可访问这些属性。<br><br># 异步方法执行流程<br><br><div class="image-package imagebubble"><img src="https://upload-images.jianshu.io/upload_images/1458860-83f79cb9d52b86d9.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><br><div class="image-caption">异步程序执行流程<br><br>上图是微软官方提供的讲解异步程序<a href="https://msdn.microsoft.com/zh-cn/library/mt674882.aspx" target="_blank" rel="noopener">执行流程</a>的图示，并附有解释说明：<br><br>&gt; The numbers in the diagram correspond to the following steps.<br>&gt;<br>&gt; 1.  An event handler calls and awaits the AccessTheWebAsync async method.<br>&gt; 2.  AccessTheWebAsync creates an <a href="https://msdn.microsoft.com/zh-cn/library/system.net.http.httpclient.aspx" target="_blank" rel="noopener">HttpClient</a> instance and calls the <a href="https://msdn.microsoft.com/zh-cn/library/hh551746.aspx" target="_blank" rel="noopener">GetStringAsync</a>asynchronous method to download the contents of a website as a string.<br>&gt; 3.  Something happens in <strong>GetStringAsync</strong> that suspends its progress. Perhaps it must wait for a website to download or some other blocking activity. To avoid blocking resources, <strong>GetStringAsync</strong> yields control to its caller, AccessTheWebAsync.<br>&gt; <strong>GetStringAsync</strong> returns a <a href="https://msdn.microsoft.com/zh-cn/library/dd321424.aspx" target="_blank" rel="noopener">Task<tresult></tresult></a> where <strong>TResult </strong>is a string, and AccessTheWebAsync assigns the task to thegetStringTask variable. The task represents the ongoing process for the call to <strong>GetStringAsync</strong>, with a commitment to produce an actual string value when the work is complete.<br>&gt; 4.  Because getStringTask hasn’t been awaited yet, AccessTheWebAsync can continue with other work that doesn’t depend on the final result from <strong>GetStringAsync</strong>. That work is represented by a call to the synchronous method DoIndependentWork.<br>&gt; 5.  DoIndependentWork is a synchronous method that does its work and returns to its caller.<br>&gt; 6.  AccessTheWebAsync has run out of work that it can do without a result from getStringTask. AccessTheWebAsync next wants to calculate and return the length of the downloaded string, but the method can’t calculate that value until the method has the string.<br>&gt; Therefore, AccessTheWebAsync uses an await operator to suspend its progress and to yield control to the method that called AccessTheWebAsync. AccessTheWebAsync returns a <strong>Task<int></int></strong> to the caller. The task represents a promise to produce an integer result that’s the length of the downloaded string.<br>&gt; <blockquote><br>&gt;<br>&gt; <strong>Note</strong><br>&gt; If <strong>GetStringAsync</strong> (and therefore getStringTask) is complete before AccessTheWebAsync awaits it, control remains inAccessTheWebAsync. The expense of suspending and then returning to AccessTheWebAsync would be wasted if the called asynchronous process (getStringTask) has already completed and AccessTheWebSync doesn’t have to wait for the final result.<br>&gt; Inside the caller (the event handler in this example), the processing pattern continues. The caller might do other work that doesn’t depend on the result from AccessTheWebAsync before awaiting that result, or the caller might await immediately. The event handler is waiting for AccessTheWebAsync, and AccessTheWebAsync is waiting for <strong>GetStringAsync</strong>.<br>&gt;<br>&gt; </blockquote><br>&gt;<br>&gt; 7.  <strong>GetStringAsync</strong> completes and produces a string result. The string result isn’t returned by the call to <strong>GetStringAsync</strong> in the way that you might expect. (Remember that the method already returned a task in step Instead, the string result is stored in the task that represents the completion of the method, getStringTask. The await operator retrieves the result from getStringTask. The assignment statement assigns the retrieved result to urlContents.<br>&gt; 8.  When AccessTheWebAsync has the string result, the method can calculate the length of the string. Then the work ofAccessTheWebAsync is also complete, and the waiting event handler can resume. In the full example at the end of the topic, you can confirm that the event handler retrieves and prints the value of the length result.<br>&gt; If you are new to asynchronous programming, take a minute to consider the difference between synchronous and asynchronous behavior. A synchronous method returns when its work is complete (step 5), but an async method returns a task value when its work is suspended (steps 3 and 6). When the async method eventually completes its work, the task is marked as completed and the result, if any, is stored in the task.<br><br>解释虽是英文，但并没有太难的单词，是可以看懂其意思的。通过上面的说明，我们可以知道：<br>在遇到<strong>awiat</strong>关键字之前，程序是按照代码顺序自上而下以同步方式执行的。<br>在遇到<strong>await</strong>关键字之后，系统做了以下工作：<br><br>1.  异步方法将被挂起<br>2.  将控制权返回给调用者<br>3.  使用线程池中的线程（而非额外创建新的线程）来计算await表达式的结果，所以await不会造成程序的阻塞<br>4.  完成对await表达式的计算之后，若await表达式后面还有代码则由执行await表达式的线程（不是调用方所在的线程）继续执行这些代码<br><br>使用一段代码来进行验证：<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">static void Main()</span><br><span class="line">&#123;</span><br><span class="line">    Task&lt;int&gt; task = StartAsync();</span><br><span class="line">    Thread.Sleep(5000);</span><br><span class="line">    End();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static async Task&lt;int&gt; StartAsync()</span><br><span class="line">&#123;</span><br><span class="line">    WriteLine(&quot;start...&quot;);</span><br><span class="line">    HttpClient client = new HttpClient();</span><br><span class="line">    var result = client.GetStringAsync(&quot;https://www.visualstudio.com/&quot;);</span><br><span class="line">    string str = await result;</span><br><span class="line">    return str.Length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>执行代码<br><br><div class="image-package imagebubble"><img src="https://upload-images.jianshu.io/upload_images/1458860-c6ce4499f00271f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><br>从上图左侧的调用栈中可以看到，在遇到await关键字之前，异步方法<code>StartAsync</code>自上而下同步执行。注意，这里异步方法<code>GetStringAsync</code>方法是被挂起的，不会造成程序的阻塞，控制权回到调用者<code>StartAsync</code>中，仔细看英文解释中的第3步。<br>然后在Debug Console中输入<code>System.Threading.Thread.Current</code>查看当前工作线程信息，以及<code>System.Threading.Thread.CurrentThread.IsThreadPoolThread</code>查看当前线程是否在线程池中。<br><br><div class="image-package imagebubble"><img src="https://upload-images.jianshu.io/upload_images/1458860-a0480dc37f942cb6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><br><div class="image-caption"><br><br>从上图我们看到，当前线程Id是1，不在线程池中。继续执行程序：<br><br><div class="image-package imagebubble"><img src="https://upload-images.jianshu.io/upload_images/1458860-0872a2014f5f118b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><br>遇到await关键字后，异步方法<code>StartAsync</code>被挂起，控制权也回到了调用者Main方法中。<br><br><div class="image-package imagebubble"><img src="https://upload-images.jianshu.io/upload_images/1458860-7640b9783f9438bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><br>从上图我们可以看到异步方法<code>StartAsync</code>中的result变量的Status属性值是<code>WaitingForActivation</code>，Result属性值是<code>Not yet computed</code>。<br><br>代码继续执行，将Main方法所在线程接挂起5秒，系统使用线程池中的线程计算await表达式的值：<br><br><div class="image-package imagebubble"><img src="https://upload-images.jianshu.io/upload_images/1458860-58a677be2d2da045.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><br>从上图我们可以看到，程序已经成功计算出await表达式的值，变量result的Status属性值变成了<code>RanToCompletion</code>。完成对await表达式的计算之后，程序继续执行后面的代码(<code>return str.Length</code>)。<br><br>再看此时的工作线程信息：<br><br><div class="image-package imagebubble"><img src="https://upload-images.jianshu.io/upload_images/1458860-115e1968e2cf96c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><br>我们看到，当前线程Id是5且存在于线程池中。<br><br>从这里我们可以得知<strong>异步是借助于多线程来实现的</strong>。<br><br># Task<br><br><a href="https://msdn.microsoft.com/en-us/library/system.threading.tasks.task.aspx" target="_blank" rel="noopener">Task</a>类拥有执行异步方法的两个方法：<code>Task.Run()</code>,<code>Task.Run&lt;T&gt;</code>，<code>Task.Run</code>以及<code>Task.Run&lt;T&gt;</code>使用线程池中的线程来执行代码，它和使用await关键字的区别是：Task.Run直接使用线程池中的线程，而使用await的异步方法是在遇到await关键字后才使用多线程。<br><br># Thread<br><br><a href="https://msdn.microsoft.com/en-us/library/system.threading.thread(v=vs.110" target="_blank" rel="noopener">线程</a>.aspx)是前面所说的异步（async/await）和任务（Task）的基础。和线程紧密相关的另外一个概念是进程，这里不多赘述。<br><br># ThreadPool<br><br>线程也是对象，频繁的创建和销毁线程比较影响性能，.NET提供<a href="https://msdn.microsoft.com/zh-cn/library/system.threading.threadpool(v=vs.110" target="_blank" rel="noopener">线程池</a>.aspx)使得我们能够复用线程对象从而避免频繁创建和销毁线程。<br><br># 结语<br><br>自己创建线程比较麻烦但能够更好的控制程序的运行，使用async/await关键字来编码显得较为简洁，但对程序的控制力度会有所降低。<br><br># 参考文章：<br><br><a href="https://msdn.microsoft.com/zh-cn/library/mt674882.aspx" target="_blank" rel="noopener">Asynchronous Programming with async and await (C#)</a><br><a href="https://msdn.microsoft.com/zh-cn/library/hh156513.aspx" target="_blank" rel="noopener">async</a><br><a href="https://msdn.microsoft.com/zh-cn/library/hh156528.aspx" target="_blank" rel="noopener">await</a><br><a href="http://www.cnblogs.com/liqingwen/p/5831951.html" target="_blank" rel="noopener">走进异步编程的世界 - 开始接触 async/await</a><br><a href="http://www.cnblogs.com/durow/p/4826653.html" target="_blank" rel="noopener">C#执行异步操作的几种方式比较和总结</a><br><a href="http://blog.csdn.net/huwei2003/article/details/47167235" target="_blank" rel="noopener">thread task parallel plinq async await多线程 任务及异步编程</a><br><a href="http://www.cnblogs.com/liqingwen/p/5877042.html" target="_blank" rel="noopener">走进异步编程的世界 - 在 GUI 中执行异步操作</a><br><br><a href="https://msdn.microsoft.com/en-us/magazine/jj991977.aspx" target="_blank" rel="noopener">Async/Await - Best Practices in Asynchronous Programming</a><br><br><div><br><br>### 版权声明<br><br></div></div></div></div></div></div></div></div></div></div></tresult></string></div></div></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/125f6c25.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/125f6c25.html" itemprop="url">mongodb 按配置文件mongodb.conf启动</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-18T18:33:00+08:00">
                2018-06-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>命令如下</p>
<p>mongod –config /etc/mongodb.conf<code>`</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/87881984.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/87881984.html" itemprop="url">Maven镜像更换为阿里云中央仓库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-18T09:03:00+08:00">
                2018-06-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>maven仓库默认在国外，使用难免很慢，尤其是下载依赖的时候，换为国内镜像，让你感受飞一般的感觉。国内支持maven镜像的有阿里云，开源中国等，这里换为阿里云的。</p>
<h2 id="更换"><a href="#更换" class="headerlink" title="更换"></a>更换</h2><p>修改maven配置文件settings.xml (当然也可以在用户home目录.m2下面添加一个settings.xml文件)</p>
<p><code class="hljs bash has-numbering">$ <span class="hljs-built_in">cd  <span class="hljs-variable">$M2_HOME/conf/<br>    $ <span class="hljs-built_in">sudo vim settings.xml</span></span></span></code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">在中加入</span><br><span class="line"></span><br><span class="line">    &lt;pre name=&quot;code&quot; class=&quot;prettyprint&quot;&gt;&lt;code class=&quot;hljs xml has-numbering&quot;&gt;&lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;mirror&gt;</span><br><span class="line">            &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;id&gt;nexus-aliyun&lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;id&gt;</span><br><span class="line">            &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;mirrorOf&gt;central&lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;mirrorOf&gt;</span><br><span class="line">            &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;name&gt;Nexus aliyun&lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;name&gt;</span><br><span class="line">            &lt;span class=&quot;hljs-tag&quot;&gt;&lt;&lt;span class=&quot;hljs-title&quot;&gt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;url&gt;</span><br><span class="line">    &lt;span class=&quot;hljs-tag&quot;&gt;&lt;/&lt;span class=&quot;hljs-title&quot;&gt;mirror&gt;</span><br><span class="line">    &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;</span><br></pre></td></tr></table></figure></p>
<p>保存即可。</p>
<pre><code>## 结束语
</code></pre><p>好了，开始享受100倍下载速度吧<br></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/e9348c48.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/e9348c48.html" itemprop="url">Vue项目碰到"‘webpack-dev-server’不是内部或外部命令，也不是可运行的程序或批处理文件"报错</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-15T11:01:00+08:00">
                2018-06-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近公司里做vue项目，svn了前端同事的项目代码，装好环境，运行项目（安装步骤随便百度一下，很详细），控制台里报错“‘webpack-dev-server’不是内部或外部命令，也不是可运行的程序或批处理文件，随机百度解决方法，有的说需要重新装依赖包，有的说扩展用户权限，都做了，但是报错依旧。</p>
<p><img src="http://pangguoming.com/blog/images/9408bd5b-7296-4d82-a8c0-792aa119f40f.jpg" alt=""></p>
<p>原因：</p>
<p>随机自己新建一个vue项目（<a href="https://segmentfault.com/a/1190000009871504），发现没有报错，于是可以肯定是svn下来的项目代码有问题，" target="_blank" rel="noopener">https://segmentfault.com/a/1190000009871504），发现没有报错，于是可以肯定是svn下来的项目代码有问题，</a></p>
<p>解决办法：</p>
<p>最后将项目里的“node_modules”文件夹删除，然后在cmd中cd到项目目录，依次运行命令：npm install和npm run build，最后运行npm run dev后项目成功运行。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/2a08fb3a.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/2a08fb3a.html" itemprop="url">mysql启动报错cannot allocate memory for the buffer pool处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-13T10:42:00+08:00">
                2018-06-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天启动mysql服务器时失败了。去/var/log/mysql/查看error.log，报错信息如下：</p>
<p>160123 22:29:26 InnoDB: Initializing buffer pool, size = 200.0M</p>
<p>InnoDB: mmap(214630400 bytes) failed; errno 12<br>160123 22:29:26 InnoDB: Completed initialization of buffer pool</p>
<p>160123 22:29:26 InnoDB: Fatal error: cannot allocate memory for the buffer pool</p>
<p>原来是无法给innodb分配足够的内存，</p>
<p>我的阿里云服务器是最低配的，总共就500M内存，于是到/etc/mysql/my.cnf中改了如下选项：</p>
<p>innodb_buffer_pool_size=50M</p>
<p>再重新运行/etc/init.d/mysql start就成功了。</p>
<p>看来需要好好学习一下mysqll </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/11bb85fd.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/11bb85fd.html" itemprop="url">免费桌面视频录像工具OBS的简单操作介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-01T18:36:00+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <table cellspacing="0" cellpadding="0"><br><tbody><br><tr><br><td id="postmessage_188719473" class="t_f"><span class="pstatus">本帖最后由 felix0911 于 2014-5-21 09:32 编辑<br><br><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="color: navy;"><em><span style="font-family: 黑体;"><span style="font-size: x-large;">0起点，傻瓜操作，为什么不尝试录制一个自己的游戏视频，来展现自己牛逼风骚的操作呢？(本教学不包括后期制作，特效背景音乐等部分）</span></span></em></span><br><br>  视频录制程序</span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><em>Open Broadcaster Software </em>OBS对于很多经常接触实况直播主的玩家来说肯定不能再熟。良好亲民的操作性，完全免费的程序，上佳的录像质量，生成文件无需特别转码可以直接被各大视频网站接收，使得frap、屏幕录像专家、</span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;">Camtasia Studio之类的收费共享软件可以直接搬去大街上睡了。<br><br><span style="font-size: large;">不会英文的玩家也不用担心，OBS官网提供的就是国际版，可以自行更改语言。<br></span><br><span style="font-size: large;">1.1  下载与安装   (地球人都明白的就不累赘了）</span><br><span style="font-size: large;"><a href="https://obsproject.com/download" target="_blank" rel="noopener">https://obsproject.com/download</a>     点击绿色download下载安装程序<br><br></span>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/081339lltsfi6wofhvoniq.png.thumb.jpg" alt="2014-05-21_021320.png" title="2014-05-21_021320.png"><br><span style="font-size: large;">1.2  配置程序</span><br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/081015uyfrouh2jqmros66.png.thumb.jpg" alt="2014-05-21_020904.png" title="2014-05-21_020904.png"><br><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;">安装完成首先进入的应该是这样的程序界面，<br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/0817412thlqp3lpp9vvopo.png.thumb.jpg" alt="2014-05-21_021700.png" title="2014-05-21_021700.png"><br></span></span></span></span></span><br><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;">我们选中第二个按钮settings（选项）<br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/081846huw0c07rx55thdfm.png.thumb.jpg" alt="2014-05-21_021828.png" title="2014-05-21_021828.png"><br>在language(语言)选单里找中文，确定之后重启。<br></span></span></span></span></span></span></span></span>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/0820015vhjavtxrjvgvgnz.png.thumb.jpg" alt="2014-05-21_021946.png" title="2014-05-21_021946.png"><br><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;">然后就可以继续我们的初始配置了<br><br></span></span></span></span></span><br><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;">1.3  一般<br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/0823432icick5qiqiikbtt.png.thumb.jpg" alt="2014-05-21_022328.png" title="2014-05-21_022328.png"><br></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;">我们在这里不需要做太多的更改，</span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;"><em>设定档名称</em></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;"> 指的是你这个设定档配置的名称，因为这个版本不支持多个设定档添加的内容所以不做更改也无所谓<br><br>去掉<em> 显示日志窗口 </em>的选项可以不用在每次开启时花时间去关掉日志，没有理由不去掉吧。</span></span></span></span></span></span></span></span><br></span></span><br><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;">1.4  编码</span></span></span></span></span><br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/082930wwn3s8zfrcanllfn.png.thumb.jpg" alt="2014-05-21_022915.png" title="2014-05-21_022915.png"><br><br><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;">编码部分，主要影响的是采样数据，比特率越高采得视频数据就越清晰，音频就越自然。这个数值其实是为在线视频直播准备的，因为采样率直接影响传输数据大小，设定合理采样率对一个在线直播播放播主非常重要，通常会根据网络和供应商提供的数据进行设定，扯的比较远。</span></span></span></span></span></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;">我们可以跳过这个条目<br><br></span></span></span></span></span></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;">1.5  广播设定<br><br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/0836300x0chx90x8pv0av0.png.thumb.jpg" alt="2014-05-21_023604.png" title="2014-05-21_023604.png"><br></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;">初始设定是默认为在线直播模式，我们录制单机视频需要将模式切换到“<em>只输出文件</em>”选项<br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/083842ascsbgssm9wu9hgs.png.thumb.jpg" alt="2014-05-21_023827.png" title="2014-05-21_023827.png"><br><em>档案路径  </em>就是录制结束后视频存放的地点和名称<br><br></span></span></span></span></span></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;">1.5  广播设定</span></span></span></span></span><br><br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/084324rhy0iejq07mhh650.png.thumb.jpg" alt="2014-05-21_024047.png" title="2014-05-21_024047.png"><br><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;"><em><br>基本解析度 </em></span></span></span></span></span></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;">就是你希望录制视频原始未压缩的视频的清晰度，低清：640<em>480 </em></span></span></span></span></span></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;">即我们所说的480P</span></span></span></span></span></span></span></span></span></span> 普清：1280720 即我们所说的720P  高清：1920<em>1080 </em></span></span></span></span></span></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;">即我们所说的1080P 视网络情况及硬件能力自行设定，我一般选720P的普清  
<br>压缩分辨率<em> 指实际显示的视频大小，真实大小还是按照你在基本解析率里设定的大小，实际大小小于基本解析率设定的大小之后，多出部分会按黑边显示，所以建议设定“无”即不压缩  

</em>FPS<em> 即我们所说的视频帧数，所谓：D3野蛮人一个完整投掷动作花费40F的F指的就是这个概念，通常电影电视都会以60帧每秒的形式呈现，每秒30帧以上人眼就感觉不到钝滞感了。这个值会影响到视频的流畅清晰度，建议设定60帧  
</em><br>启用时停用Aero<em> Aero就是win7 vista的毛玻璃特效，勾选可以大幅减少录制视频时的计算机的计算，减少CPU负荷<br><br></em></span></span></span></span></span></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;">1.6  音效/高级/麦克风噪音闸<br><br></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;">不需要做出额外设置，使用初始值就好<br><br></span></span></span></span></span></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;">2.1  录像准备<br><br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/090211gqwbgqeppwwqqwgg.png.thumb.jpg" alt="2014-05-21_030155.png" title="2014-05-21_030155.png"><br></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;">场景：录制多个目标时需要设置这个选项来更改录制目标，我们可以不用管<br>来源：录制对象。我们需要选择建立一个游戏源<em> 选项卡来对付D3<br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/090552qqwvawwwq48t4qz1.png.thumb.jpg" alt="2014-05-21_030540.png" title="2014-05-21_030540.png"><br>来源栏空白处右键，添加—游戏源<br><br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/091052f6ufbbtb21243taz.png.thumb.jpg" alt="2014-05-21_031033.png" title="2014-05-21_031033.png"><br>应用程序里选中diablo3 确定   也可以是你想录的任何游戏，录制游戏使用游戏源特制的插件效果会更好<br><br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/091838rojzf5ft1zf37yje.png.thumb.jpg" alt="2014-05-21_031823.png" title="2014-05-21_031823.png"><br>单击麦克风或者扬声器图标可以禁止录制过程中的麦克风声音或者内置音乐被录制进视频，当然如果你想要保留解说，你可以适当调低内置音乐的声音；或者像我一样录制展示视频，直接禁用麦克风的声音。<br></em></span></span></span></span></span></span></span></span></span></span><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;">2.2  录制<br><br></span></span></span></span></span>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/0920375w8vht2tthv420qh.png.thumb.jpg" alt="2014-05-21_032025.png" title="2014-05-21_032025.png"><br><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-size: large;"><span style="font-family: 微软雅黑;"><span style="font-size: xx-large;"><span style="font-family: 黑体;"><span style="font-size: x-large;"><span style="color: darkred;">在设定里勾选“总是在最上层”，确保你可以直接对它面板进行操作<br><br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/092151k9fcmxem1hmkeqz4.png.thumb.jpg" alt="2014-05-21_032128.png" title="2014-05-21_032128.png"><br><br>全部准备妥当之后，点击 开始录制<em> ，当缩略视频出现之后就表示程序正常工作了，<br>&lt;ignore_js_op&gt;<img src="http://bbs-f.d.163.com/forum/201405/21/0923433082l1spk9jp59ja.png.thumb.jpg" alt="2014-05-21_032333.png" title="2014-05-21_032333.png"><br><br>全部录制结束的时候，点击 </em>停止录制 *视频就完成了。<br><br><span style="color: black;">最后在开始设定的目录下寻找录制完成的视频，观察效果然后上传整个步骤就全部完成了。</span><br><br><span style="font-size: xx-large;">你也打算录一个视频来为自己的帖子增光添彩吗？试试OBS吧，你不会失望的</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></td><br><br></tr><br><br></tbody><br></table>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/169b92a0.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/169b92a0.html" itemprop="url">CentOS7下zip解压和unzip压缩文件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-01T08:43:00+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、安装zip、unzip应用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install zip unzip</span><br></pre></td></tr></table></figure>
<p><img src="http://pangguoming.com/blog/images/1773653c-8203-423a-b475-fc11621c4160.jpg" alt=""></p>
<p>2、压缩和解压文件</p>
<p> 以下命令均在/home目录下操作<br> cd /home #进入/home目录<br> a、把/home目录下面的mydata目录压缩为mydata.zip<br> zip -r mydata.zip mydata #压缩mydata目录<br> b、把/home目录下面的mydata.zip解压到mydatabak目录里面<br> unzip mydata.zip -d mydatabak<br> c、把/home目录下面的abc文件夹和123.txt压缩成为abc123.zip<br> zip -r abc123.zip abc 123.txt<br> d、把/home目录下面的wwwroot.zip直接解压到/home目录里面<br> unzip wwwroot.zip<br> e、把/home目录下面的abc12.zip、abc23.zip、abc34.zip同时解压到/home目录里面<br> unzip abc*.zip<br> f、查看把/home目录下面的wwwroot.zip里面的内容<br> unzip -v wwwroot.zip<br> g、验证/home目录下面的wwwroot.zip是否完整<br> unzip -t wwwroot.zip<br> h、把/home目录下面wwwroot.zip里面的所有文件解压到第一级目录<br> unzip -j wwwroot.zip</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/bad2908a.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/bad2908a.html" itemprop="url">ElasticSearch客户端注解使用介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-31T10:49:00+08:00">
                2018-05-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>The best elasticsearch highlevel java rest api—–<a href="https://www.oschina.net/p/bboss-elastic" target="_blank" rel="noopener">bboss</a></em> </p>
<h1 id="1-ElasticSearch客户端bboss提供了一系列注解"><a href="#1-ElasticSearch客户端bboss提供了一系列注解" class="headerlink" title="1.ElasticSearch客户端bboss提供了一系列注解"></a>1.ElasticSearch客户端bboss提供了一系列注解</h1><p>@ESId  用于标识实体对象中作为docid的属性，该注解只有一个persistent 布尔值属性，用于控制被本注解标注的字段属性是否作为普通文档属性保存，默认为true-保存，false不保存，字段名称为属性名称。ESId可用于添加和修改文档</p>
<p>@ESParentId 用于标识实体对象中作为parentid的属性，该注解只有一个persistent 布尔值属性，用于控制被本注解标注的字段属性是否作为普通文档属性保存，默认为true-保存，false不保存，字段名称为属性名称。ESParentId可用于添加和修改文档</p>
<p>@ESVersion 用于标识实体对象中作为文档版本信息的属性，该注解只有一个persistent 布尔值属性，用于控制被本注解标注的字段属性是否作为普通文档属性保存，true-保存，默认为false不保存，字段名称为属性名称。ESVersion可用于添加/修改文档操作</p>
<p>@ESVersionType 用于标识实体对象中作为文档版本类型信息的属性，该注解只有一个persistent 布尔值属性，用于控制被本注解标注的字段属性是否作为普通文档属性保存，true-保存，默认为false不保存，字段名称为属性名称。ESVersionType可用于添加/修改文档操作</p>
<p>@ESRetryOnConflict 用于标识实体对象中作为文档修改操作版本冲突重试次数信息的属性，数字类型。该注解只有一个persistent 布尔值属性，用于控制被本注解标注的字段属性是否作为普通文档属性保存，true-保存，默认为false不保存，字段名称为属性名称。ESRetryOnConflict可用于添加/修改文档操作</p>
<p>@ESRouting  用于标识实体对象中作为文档添加/修改操作路由信息的属性，字符串或者数字类型。该注解只有一个persistent 布尔值属性，用于控制被本注解标注的字段属性是否作为普通文档属性保存，true-保存，默认为false不保存，字段名称为属性名称。ESRouting可用于添加/修改文档操作</p>
<p>@ESDocAsUpsert 用于标识实体对象中控制文档修改操作时，文档不存在时是否添加文档的信息的属性，布尔值。该注解只有一个persistent 布尔值属性，用于控制被本注解标注的字段属性是否作为普通文档属性保存，true-保存，默认为false不保存，字段名称为属性名称。ESDocAsUpsert可用于添加/修改文档操作</p>
<p>@ESSource 用于标识实体对象中控制文档修改操作时，返回值是否包含文档source数据的控制变量的属性，布尔值。该注解只有一个persistent 布尔值属性，用于控制被本注解标注的字段属性是否作为普通文档属性保存，true-保存，默认为false不保存，字段名称为属性名称。ESSource可用于修改文档操作</p>
<p>@Column 该注解用于指定日期格式，和JsonFormat属性结合一起使用：</p>
<p><span class="hljs-variable">@JsonFormat(pattern = <span class="hljs-string">“yyyy-MM-dd HH:mm:ss.SSS”)<br>    <span class="hljs-variable">@Column(dataformat = <span class="hljs-string">“yyyy-MM-dd HH:mm:ss.SSS”)</span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@JsonIgnore 标注实体属性不作为es字段保存，使用示例：</span><br><span class="line"></span><br><span class="line">@JsonIgnore  </span><br><span class="line">private Integer sqlEndElapsed;</span><br><span class="line"></span><br><span class="line">    # 2.注解的使用示例</span><br><span class="line"></span><br><span class="line">    &lt;pre class=&quot;hljs java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@ESId(persistent = &lt;span class=&quot;hljs-keyword&quot;&gt;false)</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;protected String id;</span><br><span class="line">    &lt;span class=&quot;hljs-meta&quot;&gt;@ESParentId</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;protected String parentId;</span><br><span class="line">    &lt;span class=&quot;hljs-meta&quot;&gt;@ESVersion</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;protected &lt;span class=&quot;hljs-keyword&quot;&gt;int version;</span><br><span class="line">    &lt;span class=&quot;hljs-meta&quot;&gt;@ESVersionType</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;protected String versionType;</span><br><span class="line">    &lt;span class=&quot;hljs-meta&quot;&gt;@ESRetryOnConflict</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;protected &lt;span class=&quot;hljs-keyword&quot;&gt;int retryOnConflict;</span><br><span class="line">    &lt;span class=&quot;hljs-meta&quot;&gt;@ESRouting</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;protected String routing;</span><br><span class="line">    &lt;span class=&quot;hljs-meta&quot;&gt;@ESDocAsUpsert</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;protected &lt;span class=&quot;hljs-keyword&quot;&gt;boolean docAsUpsert;</span><br><span class="line">    &lt;span class=&quot;hljs-meta&quot;&gt;@ESSource</span><br><span class="line">    &lt;span class=&quot;hljs-keyword&quot;&gt;protected &lt;span class=&quot;hljs-keyword&quot;&gt;boolean returnSource;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure></p>
<pre><code># 3.结合控制注解的批量文档修改操作

&lt;pre class=&quot;hljs cs&quot;&gt;&lt;code class=&quot;language-java hljs&quot;&gt;    &lt;span class=&quot;hljs-meta&quot;&gt;@&lt;span class=&quot;hljs-function&quot;&gt;Test&lt;span class=&quot;hljs-function&quot;&gt;
    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;span class=&quot;hljs-function&quot;&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;span class=&quot;hljs-function&quot;&gt; &lt;span class=&quot;hljs-title&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-title&quot;&gt;testOrmBulk&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;(&lt;span class=&quot;hljs-params&quot;&gt;){
        ClientInterface clientUtil = ElasticSearchHelper.getRestClientUtil();
        List&lt;OnlineGoodsInfoUpdateParams&gt; onlineGoodsInfoUpdateParamss = &lt;span class=&quot;hljs-keyword&quot;&gt;new ArrayList&lt;&gt;();
        OnlineGoodsInfoUpdateParams onlineGoodsInfoUpdateParams = &lt;span class=&quot;hljs-keyword&quot;&gt;new OnlineGoodsInfoUpdateParams();
        onlineGoodsInfoUpdateParams.setId(&lt;span class=&quot;hljs-string&quot;&gt;&quot;aa&quot;);
        onlineGoodsInfoUpdateParams.setParentId(&lt;span class=&quot;hljs-string&quot;&gt;&quot;ppaa&quot;);
        onlineGoodsInfoUpdateParams.setType(&lt;span class=&quot;hljs-string&quot;&gt;&quot;tt&quot;);
        onlineGoodsInfoUpdateParams.setIndex(&lt;span class=&quot;hljs-string&quot;&gt;&quot;ddd&quot;);

        onlineGoodsInfoUpdateParams.setGoodsName(&lt;span class=&quot;hljs-string&quot;&gt;&quot;dddd&quot;);
        onlineGoodsInfoUpdateParams.setDocAsUpsert(&lt;span class=&quot;hljs-keyword&quot;&gt;&lt;span class=&quot;hljs-literal&quot;&gt;true);
        onlineGoodsInfoUpdateParams.setRetryOnConflict(&lt;span class=&quot;hljs-number&quot;&gt;3);
        onlineGoodsInfoUpdateParams.setReturnSource(&lt;span class=&quot;hljs-keyword&quot;&gt;&lt;span class=&quot;hljs-literal&quot;&gt;true);
        onlineGoodsInfoUpdateParams.setRouting(&lt;span class=&quot;hljs-string&quot;&gt;&quot;test&quot;);
        onlineGoodsInfoUpdateParams.setVersion(&lt;span class=&quot;hljs-number&quot;&gt;1);
        onlineGoodsInfoUpdateParams.setVersionType(ClientInterface.VERSION_TYPE_INTERNAL);

        onlineGoodsInfoUpdateParamss.add(onlineGoodsInfoUpdateParams);

        onlineGoodsInfoUpdateParams = &lt;span class=&quot;hljs-keyword&quot;&gt;new OnlineGoodsInfoUpdateParams();
        onlineGoodsInfoUpdateParams.setId(&lt;span class=&quot;hljs-string&quot;&gt;&quot;aa&quot;);
        onlineGoodsInfoUpdateParams.setParentId(&lt;span class=&quot;hljs-string&quot;&gt;&quot;ppaa&quot;);
        onlineGoodsInfoUpdateParams.setType(&lt;span class=&quot;hljs-string&quot;&gt;&quot;tt&quot;);
        onlineGoodsInfoUpdateParams.setIndex(&lt;span class=&quot;hljs-string&quot;&gt;&quot;ddd&quot;);

        onlineGoodsInfoUpdateParams.setGoodsName(&lt;span class=&quot;hljs-string&quot;&gt;&quot;dddd&quot;);

        &lt;span class=&quot;hljs-comment&quot;&gt;/**
         * 设置更新文档控制变量
         */
        onlineGoodsInfoUpdateParams.setDocAsUpsert(&lt;span class=&quot;hljs-keyword&quot;&gt;&lt;span class=&quot;hljs-literal&quot;&gt;true);
        onlineGoodsInfoUpdateParams.setRetryOnConflict(&lt;span class=&quot;hljs-number&quot;&gt;3);
        onlineGoodsInfoUpdateParams.setReturnSource(&lt;span class=&quot;hljs-keyword&quot;&gt;&lt;span class=&quot;hljs-literal&quot;&gt;true);
        onlineGoodsInfoUpdateParams.setRouting(&lt;span class=&quot;hljs-string&quot;&gt;&quot;test&quot;);
        onlineGoodsInfoUpdateParams.setVersion(&lt;span class=&quot;hljs-number&quot;&gt;1);
        onlineGoodsInfoUpdateParams.setVersionType(ClientInterface.VERSION_TYPE_INTERNAL);
        onlineGoodsInfoUpdateParamss.add(onlineGoodsInfoUpdateParams);
        String response = clientUtil.updateDocuments(&lt;span class=&quot;hljs-string&quot;&gt;&quot;aa&quot;,&lt;span class=&quot;hljs-string&quot;&gt;&quot;tt&quot;,onlineGoodsInfoUpdateParamss);
        System.&lt;span class=&quot;hljs-keyword&quot;&gt;out.println(response);
    }&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> 我们可以看到执行updateDocuments方法时，生成的原生bulk报文如下，注意其中的控制参数信息：</span><br><span class="line"></span><br><span class="line">&lt;pre class=&quot;hljs json&quot;&gt;&lt;code class=&quot;language-json hljs&quot;&gt;&#123; &lt;span class=&quot;hljs-attr&quot;&gt;&quot;update&quot; : &#123; &lt;span class=&quot;hljs-attr&quot;&gt;&quot;_index&quot; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;aa&quot;, &lt;span class=&quot;hljs-attr&quot;&gt;&quot;_type&quot; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;tt&quot;, &lt;span class=&quot;hljs-attr&quot;&gt;&quot;_id&quot; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;aa&quot;, &lt;span class=&quot;hljs-attr&quot;&gt;&quot;parent&quot; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;ppaa&quot;, &lt;span class=&quot;hljs-attr&quot;&gt;&quot;_routing&quot; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;test&quot;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;retry_on_conflict&quot;:&lt;span class=&quot;hljs-number&quot;&gt;3,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;_version&quot;:&lt;span class=&quot;hljs-number&quot;&gt;1,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;_version_type&quot;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;internal&quot; &#125; &#125;</span><br><span class="line">&#123;&lt;span class=&quot;hljs-attr&quot;&gt;&quot;doc&quot;:&#123;&lt;span class=&quot;hljs-attr&quot;&gt;&quot;parentId&quot;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;ppaa&quot;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;type&quot;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;tt&quot;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;index&quot;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;ddd&quot;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;routing&quot;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;test&quot;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;goodsName&quot;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;dddd&quot;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;brandId&quot;:&lt;span class=&quot;hljs-number&quot;&gt;0,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;brandName&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;shopCustomCategoryId&quot;:&lt;span class=&quot;hljs-number&quot;&gt;0,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;goodsType&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;quantityOfPacking&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;freePostage&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;postage&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;goodsDescription&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;packingDescription&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;salesUnit&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;minimumUnit&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;minSalesPrice&quot;:&lt;span class=&quot;hljs-number&quot;&gt;0.0&#125;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;doc_as_upsert&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;true,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;_source&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;true&#125;</span><br><span class="line">&#123; &lt;span class=&quot;hljs-attr&quot;&gt;&quot;update&quot; : &#123; &lt;span class=&quot;hljs-attr&quot;&gt;&quot;_index&quot; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;aa&quot;, &lt;span class=&quot;hljs-attr&quot;&gt;&quot;_type&quot; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;tt&quot;, &lt;span class=&quot;hljs-attr&quot;&gt;&quot;_id&quot; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;aa&quot;, &lt;span class=&quot;hljs-attr&quot;&gt;&quot;parent&quot; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;ppaa&quot;, &lt;span class=&quot;hljs-attr&quot;&gt;&quot;_routing&quot; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;test&quot;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;retry_on_conflict&quot;:&lt;span class=&quot;hljs-number&quot;&gt;3,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;_version&quot;:&lt;span class=&quot;hljs-number&quot;&gt;1,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;_version_type&quot;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;internal&quot; &#125; &#125;</span><br><span class="line">&#123;&lt;span class=&quot;hljs-attr&quot;&gt;&quot;doc&quot;:&#123;&lt;span class=&quot;hljs-attr&quot;&gt;&quot;parentId&quot;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;ppaa&quot;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;type&quot;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;tt&quot;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;index&quot;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;ddd&quot;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;routing&quot;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;test&quot;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;goodsName&quot;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;dddd&quot;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;brandId&quot;:&lt;span class=&quot;hljs-number&quot;&gt;0,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;brandName&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;shopCustomCategoryId&quot;:&lt;span class=&quot;hljs-number&quot;&gt;0,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;goodsType&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;quantityOfPacking&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;freePostage&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;postage&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;goodsDescription&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;packingDescription&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;salesUnit&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;minimumUnit&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;null,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;minSalesPrice&quot;:&lt;span class=&quot;hljs-number&quot;&gt;0.0&#125;,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;doc_as_upsert&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;true,&lt;span class=&quot;hljs-attr&quot;&gt;&quot;_source&quot;:&lt;span class=&quot;hljs-literal&quot;&gt;true&#125;</span><br><span class="line">&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;</span><br></pre></td></tr></table></figure>
</code></pre><p>reponse报文这里不做介绍，如果被标准的returnSource属性为true，那么在response中将包含文档的source字段信息。</p>
<pre><code># 4.参考资料
</code></pre><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/docs-bulk.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.2/docs-bulk.html</a></p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/docs-update.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.2/docs-update.html</a></p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/docs-index_.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.2/docs-index_.html</a></p>
<p><a href="https://my.oschina.net/bboss/blog/1556866" target="_blank" rel="noopener">https://my.oschina.net/bboss/blog/1556866</a></p>
<p><a href="https://my.oschina.net/bboss/blog/1801273" target="_blank" rel="noopener">https://my.oschina.net/bboss/blog/1801273</a><br></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/42/">42</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4" alt="庞国明">
            
              <p class="site-author-name" itemprop="name">庞国明</p>
              <p class="site-description motion-element" itemprop="description">Software make the information world run, and programer make the softeware run.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">420</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">267</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/pangguoming" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:pangguoming@yeah.net" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/pangguoming" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/1570700/pangguoming" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/pangguoming" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i>Instagram</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">庞国明</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  

  

  
  

  

  

  

</body>
</html>
