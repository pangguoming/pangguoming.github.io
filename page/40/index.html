<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Software make the information world run, and programer make the softeware run.">
<meta property="og:type" content="website">
<meta property="og:title" content="庞国明-博客">
<meta property="og:url" content="http://pangguoming.com/page/40/index.html">
<meta property="og:site_name" content="庞国明-博客">
<meta property="og:description" content="Software make the information world run, and programer make the softeware run.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="庞国明-博客">
<meta name="twitter:description" content="Software make the information world run, and programer make the softeware run.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://pangguoming.com/page/40/">





  <title>庞国明-博客</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">庞国明-博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">此心用度八千遍，不曾厌倦</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/97f17e5a.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/97f17e5a.html" itemprop="url">node.js应用Redis数据库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-02-14T21:25:00+08:00">
                2015-02-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>node.js下使用Redis，首先：</p>
<p>1、有一台安装了Redis的服务器，当然，安装在本机也行</p>
<p>2、本机，也就是客户端，要装node.js</p>
<p>3、项目要安装nodejs_redis模块</p>
<p>注意第 3 点，不是在本机安装就行了，而是说，要在项目中安装（引用）。</p>
<p>方法是，DOS窗口，在项目目录下，输入</p>
<p>npm install redis</p>
<p>这样就将nodejs_redis下载一份，放到当前目录下了。看看，多了一个文件夹：node_modules\redis</p>
<p>编写以下代码，保存到当前目录下\hello.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">var redis = require(&quot;redis&quot;),//召唤redis</span><br><span class="line">    /*</span><br><span class="line">        连接redis数据库，createClient(port,host,options);</span><br><span class="line">        如果REDIS在本机，端口又是默认，直接写createClient()即可</span><br><span class="line">        redis.createClient() = redis.createClient(6379, &apos;127.0.0.1&apos;, &#123;&#125;)</span><br><span class="line">    */</span><br><span class="line">    client = redis.createClient(6379,&apos;192.168.159.128&apos;,&#123;&#125;);</span><br><span class="line">    //如果需要验证，还要进行验证</span><br><span class="line">    //client.auth(password, callback);</span><br><span class="line"></span><br><span class="line">    // if you&apos;d like to select database 3, instead of 0 (default), call</span><br><span class="line">    // client.select(3, function() &#123; /* ... */ &#125;);</span><br><span class="line"></span><br><span class="line">    //错误监听？</span><br><span class="line">    client.on(&quot;error&quot;, function (err) &#123;</span><br><span class="line">        console.log(&quot;Error &quot; + err);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    client.set(&quot;string key&quot;, &quot;string val&quot;, redis.print);//set &quot;string key&quot; &quot;string val&quot;</span><br><span class="line">    /*</span><br><span class="line">        redis.print，回调函数，将redis的返回值显示出来。上一句执行结果，将返回“OK”    </span><br><span class="line">    */</span><br><span class="line">    client.hset(&quot;hash key&quot;, &quot;hashtest 1&quot;, &quot;some value&quot;, redis.print);</span><br><span class="line">    client.hset([&quot;hash key&quot;, &quot;hashtest 2&quot;, &quot;some other value&quot;], redis.print);</span><br><span class="line">    //遍历哈希表&quot;hash key&quot;</span><br><span class="line">    client.hkeys(&quot;hash key&quot;, function (err, replies) &#123;</span><br><span class="line">        console.log(replies.length + &quot; replies:&quot;);</span><br><span class="line">        replies.forEach(function (reply, i) &#123;</span><br><span class="line">            console.log(&quot;    &quot; + i + &quot;: &quot; + reply);</span><br><span class="line">        &#125;);</span><br><span class="line">    client.hget(&quot;hash key&quot;,&quot;hashtest 1&quot;,redis.print);    </span><br><span class="line"></span><br><span class="line">    /*两种都可以断掉与redis的连接，</span><br><span class="line">    end()很粗暴，不管3721，一下子退出来了，上面那句获取哈希表&quot;hash key&quot;的某个元素值的表达式将没有结果返回</span><br><span class="line">    而quit()则是先将语句处理完毕再干净地退出，斯文得很</span><br><span class="line">    */</span><br><span class="line">    //client.end();</span><br><span class="line">    client.quit();</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/d3630417.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/d3630417.html" itemprop="url">Ubuntu安装nodeJS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-31T15:38:00+08:00">
                2015-01-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a><span style="font-size: 14px; line-height: 1.5;">安装环境</span></h1><div class="postBody"><br><div id="cnblogs_post_body"><br><br>ubuntu12.04 64bit<br><br>nodejs-v0.8.14.tar.gz<br><br>Node.js是一个基于google v8+javascript的服务端编程框架。但是Node.js又不是js应用，应该说是js的运行平台。它采用事件驱动、异步编程，为网络服务而设。<br><br>Node.js的性能不错，按照创始人Ryan Dahl的说法，性能是Node.js考虑的重要因素，选择c++和v8而不是ruby或者其他的虚拟机也是基于性能的目的。Node.js在设计上也是比较大胆，它以单进程、单线程模式运行，事件驱动机制是Node.js通过内部单线程高效率地维护事件循环队列来实现的，没有多线程的资源占用和上下文切换，这意味着面对大规模的http请求，Node.js凭借事件驱动搞定一切。<br><br>安装步骤：<br><br>首先确保系统安装来python,gcc,g++,如果没有则安装：<br><br>$ sudo apt-get install python<br><br>$ sudo apt-get install build-essential<br><br>$ sudo apt-get install gcc<br><br>$ sudo apt-get install g++<br><br>从nodeJS官网<a href="http://nodejs.org/" target="_blank" rel="noopener">http://nodejs.org/</a>下载最新源代码包：node-v0.8.14.tar.gz<br><br>解压：<br><br>$ tar -zxf node-v0.8.14.tar.gz<br><br>$ cd node-v0.8.14<br><br>默认安装：<br><br>$ ./configure<br><br>$ make<br><br>$ sudo make install<br><br>选择目录方式安装：<br><br>$ ./configure –prefix=/usr/node<br><br>$ make -j 5 #5=CPU核数+1<br><br>$ sudo make install<br><br>安装结束，可以用下面的命令检查安装的版本：<br><br>$ node –version<br><br>v0.8.14<br><br>安装成功后，你就可以开始用nodeJS做一些好玩的事情了。<br><br>在这个<a href="http://wenku.baidu.com/view/22a03f6d011ca300a6c39092.html" target="_blank" rel="noopener">http://wenku.baidu.com/view/22a03f6d011ca300a6c39092.html</a>链接中有很好的入门文档<br><br></div></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/49eb9d1a.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/49eb9d1a.html" itemprop="url">Ubuntu 系统下 mongodb 安装和配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-31T15:36:00+08:00">
                2015-01-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安装-MongoDB"><a href="#安装-MongoDB" class="headerlink" title="安装 MongoDB"></a><span lang="zh-CN">安装 MongoDB</span></h2><p> sudo apt-get install mongodb</p>
<p> sudo apt-get install mongodb</p>
<h3 id="关闭／启动"><a href="#关闭／启动" class="headerlink" title="关闭／启动"></a><span lang="zh-CN">关闭／启动</span></h3><p> sudo service mongodb stop<br> sudo service mongodb start</p>
<h3 id="设置数据库连接密码："><a href="#设置数据库连接密码：" class="headerlink" title="设置数据库连接密码："></a><span lang="zh-CN">设置数据库连接密码：</span></h3><p> <span lang="zh-CN">在跟目录创建文件夹： data/db</span></p>
<p> <span lang="zh-CN">关闭现有服务。</span></p>
<p> sudo service mongodb stop</p>
<p> <span lang="zh-CN">重新启动服务</span></p>
<p> $ mongod –auth</p>
<p> <span lang="zh-CN">创建连接用户</span></p>
<p> $ mongo</p>
<blockquote>
<p>use admin</p>
</blockquote>
<p> switched to db admin</p>
<blockquote>
<p>db.addUser(“root”,”1983”)</p>
</blockquote>
<p> <span lang="zh-CN">关闭服务（直接在 mongod <span lang="zh-CN">启动的命令窗口 “ctrl + C”<span lang="zh-CN">）</span></span></span></p>
<p> <span lang="zh-CN">重启服务：</span></p>
<p> $: mongod –auth</p>
<p> <span lang="zh-CN">查看是否开始验证：、</span></p>
<p> $ mongo</p>
<p> MongoDB shell version: 2.0.4</p>
<p> connecting to: test</p>
<blockquote>
<p>use admin</p>
</blockquote>
<p> switched to db admin</p>
<blockquote>
<p>show collections</p>
</blockquote>
<p> Fri Mar 14 09:07:08 uncaught exception: error: {</p>
<p> “$err” : “unauthorized db:admin lock type:-1 client:127.0.0.1”,</p>
<p> “code” : 10057</p>
<p> }</p>
<p> <span lang="zh-CN">有提示 链接错误。</span></p>
<p> <span lang="zh-CN">进行用户验证：</span></p>
<blockquote>
<p>db.auth(“root”,”1983”)</p>
</blockquote>
<p> 1</p>
<p> <span lang="zh-CN">重新查看就可以查看数据集</span></p>
<blockquote>
<p>show collections</p>
</blockquote>
<p> system.indexes</p>
<p> system.users</p>
<h3 id="设置客户端连接："><a href="#设置客户端连接：" class="headerlink" title="设置客户端连接："></a><span lang="zh-CN">设置客户端连接：</span></h3><p> <span lang="zh-CN">默认安装的话只允许 127.0.0.1 <span lang="zh-CN">的IP <span lang="zh-CN">连接.</span></span></span></p>
<p> <span lang="zh-CN">需要修改/etc/mongodb.conf <span lang="zh-CN">注释下列记录：</span></span></p>
<p> <span lang="zh-CN">打开文件：</span></p>
<p> $ sudo gedit /etc/mongodb.conf</p>
<p> <span lang="zh-CN">注释记录：</span></p>
<p> #bind_ip = 0.0.0.0 </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/ce29cfed.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/ce29cfed.html" itemprop="url">使用AndroidStudio编译NDK的方法及错误解决方案</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-31T14:52:00+08:00">
                2015-01-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div><strong>参考资料：</strong><br><div>【android ndk】macos环境下Android Studio中利用gradle编译jni模块及配置：<a href="http://demo.netfoucs.com/ashqal/article/details/21869151" target="_blank" rel="noopener">http://demo.netfoucs.com/ashqal/article/details/21869151</a><br><div>ANDROID STUDIO, GRADLE AND NDK INTEGRATION：<a href="http://ph0b.com/android-studio-gradle-and-ndk-integration/" target="_blank" rel="noopener">http://ph0b.com/android-studio-gradle-and-ndk-integration/</a><br><div>Gradle Plugin User Guide：<a href="http://tools.android.com/tech-docs/new-build-system/user-guide" target="_blank" rel="noopener">http://tools.android.com/tech-docs/new-build-system/user-guide</a><br><div>New Build System：<a href="http://tools.android.com/tech-docs/new-build-system" target="_blank" rel="noopener">http://tools.android.com/tech-docs/new-build-system</a><br><div><br><div><strong>实践证明：</strong><br><div>0.4.2只有在gradle1.10版本下创建只包含AndroidLibrary模块的工程时才能正常编译，gradle1.9版本不可以。<br><div>0.4.6使用gradle1.10可以。<br><div>0.5.0无论是gradle1.10还是gradle1.11版本都可以生成so库。<br><div>0.5.5的不能编译NDK，无论是gradle1.10还是gradle1.11版本都不能生成so库，屙血尿脓。<br><div><br><div><strong>下载AndroidStudio</strong>：<br><div>AndroidStudio的历史版本下载列表：<a href="http://tools.android.com/download/studio/canary" target="_blank" rel="noopener">http://tools.android.com/download/studio/canary</a><br><div><br><div><strong>下载NDK：</strong><br><div>下载链接：<a href="http://developer.android.com/tools/sdk/ndk/index.html" target="_blank" rel="noopener">http://developer.android.com/tools/sdk/ndk/index.html</a>，注意NDK一定要r9+版本的，否则编译时会出现如下<strong>错误：</strong><br><div><br><div><br><br>Execution failed for task ‘:hellojni:compileDebugNdk’.<br>    &gt; com.android.ide.common.internal.LoggedErrorException: Failed to run command:<br>        D:\ndk\ndk-build.cmd NDK_PROJECT_PATH=null APP_BUILD_SCRIPT=F:\androidstudio\test\hellojni\build\ndk\debug\Android.mk APP_PLATFORM=android-19 NDK_OUT=F:\androidstudio\test\hellojni\build\ndk\debug\obj NDK_LIBS_OUT=F:\androidstudio\test\hellojni\build\ndk\debug\lib APP_ABI=armeabi,armeabi-v7a<br>    Error Code:<br>        2<br>    Output:<br>        D:/ndk/build/core/setup-app.mk:63: <strong><em> Android NDK: Aborting    .  Stop.<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div&gt;**下载gradle：**</span><br><span class="line">&lt;div&gt;gradle-1.9-all.zip：[http://download.csdn.net/detail/xxhongdev/6834859](http://download.csdn.net/detail/xxhongdev/6834859)</span><br><span class="line">&lt;div&gt;gradle-1.10-all.zip：[http://download.csdn.net/detail/xinghuacheng/7026815](http://download.csdn.net/detail/xinghuacheng/7026815)</span><br><span class="line">&lt;div&gt;gradle-1.11-all.zip：[http://download.csdn.net/detail/d1387968/7097249](http://download.csdn.net/detail/d1387968/7097249)</span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;** **</span><br><span class="line">&lt;div&gt;通过“AndroidStudio历史版本下载列表”下载的历史版本通常是绿色的压缩包，可以直接解压缩使用，但是不包含SDK，需要额外下载SDK，由于之前下载了ADT(版本：adt20131030)，所以后面直接使用ADT目录下的SDK。通过[http://developer.android.com/sdk/installing/studio.html](http://developer.android.com/sdk/installing/studio.html)首页下载的AndroidStudio为安装版本，包含了SDK，可以下载后直接安装，首次使用创建项目会比较慢，可以参考“[AndroidStudio创建项目时一直处于building“project name”gradle project info的解决办法](http://blog.csdn.net/asmcvc/article/details/24313425)”来解决。</span><br><span class="line">&lt;div&gt;** **</span><br><span class="line">&lt;div&gt;**创建项目：**</span><br><span class="line">&lt;div&gt;运行AndroidStudio后，创建新项目，新项目会有一个默认的Module，这里项目名称为JNIDemo，Module为app。</span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;然后通过向导完成项目的创建。</span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;AndroidStudio还是非常慢的，长时间处于这种状态：</span><br><span class="line">&lt;div&gt;![](http://pangguoming.com/blog/images/4fbc7e63-6876-4a24-acfc-a20d959c1b37.png)</span><br><span class="line">&lt;div&gt;经过漫长的等待后终于完成项目的创建，然后在这个项目下创建一个Module，New Module-&gt;Android Library：</span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;不勾选“Create activity”然后点击“Finish”完成创建，此时项目结构如图：</span><br><span class="line">&lt;div&gt;![](http://pangguoming.com/blog/images/bb4fa397-eba0-49a0-9a72-dbaddb52782a.png)</span><br><span class="line">&lt;div&gt;app和hellojni均为JNIDemo下的两个Module，这里把hellojni作为生成so库的NDK开发层，把app作为调用so库的APK引用开发层。</span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;在hellojni模块的src/main下创建jni目录，并在jni目录下新建文件main.cpp，代码如下：</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;pre&gt;#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;jni.h&gt;</span><br><span class="line">#include &lt;assert.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;android/log.h&gt;</span><br><span class="line"></span><br><span class="line">#define LOG_TAG &quot;Hellojni&quot;</span><br><span class="line">#define LOGE(...)  __android_log_print(ANDROID_LOG_ERROR, LOG_TAG, __VA_ARGS__)</span><br><span class="line">#define LOGI(...)  __android_log_print(ANDROID_LOG_INFO, LOG_TAG, __VA_ARGS__)</span><br><span class="line"></span><br><span class="line">//注册native api的类#define JNIREG_CLASS &quot;com/example/test9/app/MainActivity&quot;</span><br><span class="line"></span><br><span class="line">extern &quot;C&quot; &#123;</span><br><span class="line">    JNIEXPORT void msg(JNIEnv *env, jobject  clazz, jstring str);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//jstring to char* char* jstringTostring(JNIEnv* env, jstring jstr) </span><br><span class="line">&#123; </span><br><span class="line">    char* rtn = NULL; </span><br><span class="line">    jclass clsstring = env-&gt;FindClass(&quot;java/lang/String&quot;); </span><br><span class="line">    jstring strencode = env-&gt;NewStringUTF(&quot;utf-8&quot;); </span><br><span class="line">    jmethodID mid = env-&gt;GetMethodID(clsstring, &quot;getBytes&quot;, &quot;(Ljava/lang/String;)[B&quot;); </span><br><span class="line">    jbyteArray barr= (jbyteArray)env-&gt;CallObjectMethod(jstr, mid, strencode); </span><br><span class="line">    jsize alen = env-&gt;GetArrayLength(barr); </span><br><span class="line">    jbyte* ba = env-&gt;GetByteArrayElements(barr, JNI_FALSE); </span><br><span class="line">    if (alen &gt; 0) </span><br><span class="line">    &#123; </span><br><span class="line">        rtn = (char*)malloc(alen + 1); </span><br><span class="line">        memcpy(rtn, ba, alen); </span><br><span class="line">        rtn[alen] = 0; </span><br><span class="line">    &#125; </span><br><span class="line">    env-&gt;ReleaseByteArrayElements(barr, ba, 0); </span><br><span class="line">    return rtn; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JNIEXPORT void msg(JNIEnv *env, jobject  clazz, jstring str)</span><br><span class="line">&#123;</span><br><span class="line">    char *pszstr = NULL; </span><br><span class="line"></span><br><span class="line">    pszstr = jstringTostring(env, str);</span><br><span class="line">    LOGI(&quot;%s&quot;, pszstr);</span><br><span class="line">    free(pszstr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* Table of methods associated with a single class.</span><br><span class="line">*/static JNINativeMethod gMethods[] = &#123;</span><br><span class="line">    &#123; &quot;msg&quot;, &quot;(Ljava/lang/String;)V&quot;, (void*)msg&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">* Register native methods for all classes we know about.</span><br><span class="line">*/static int registerNativeMethods(JNIEnv* env)</span><br><span class="line">&#123;</span><br><span class="line">    int nError = 0;</span><br><span class="line">    jclass clazz = NULL;</span><br><span class="line"></span><br><span class="line">    clazz = env-&gt;FindClass(JNIREG_CLASS);</span><br><span class="line">    if (clazz == NULL) &#123;</span><br><span class="line">        LOGE(&quot;clazz is null&quot;);</span><br><span class="line">        return JNI_FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    nError = env-&gt;RegisterNatives(clazz, gMethods, sizeof(gMethods) / sizeof(gMethods[0]) );</span><br><span class="line">    if ( nError &lt; 0 ) &#123;</span><br><span class="line">        LOGE(&quot;RegisterNatives error: %d num: %d&quot;,nError, sizeof(gMethods) / sizeof(gMethods[0]) );</span><br><span class="line">        return JNI_FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return JNI_TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">* Set some test stuff up.</span><br><span class="line">*</span><br><span class="line">* Returns the JNI version on success, -1 on failure.</span><br><span class="line">*/</span><br><span class="line">JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM* vm, void* reserved)</span><br><span class="line">&#123;</span><br><span class="line">    JNIEnv* env = NULL;</span><br><span class="line">    jint result = -1;</span><br><span class="line"></span><br><span class="line">    if(vm-&gt;GetEnv((void**) &amp;env,JNI_VERSION_1_6) != JNI_OK)&#123;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">    assert(env != NULL);</span><br><span class="line"></span><br><span class="line">    if (!registerNativeMethods(env)) &#123;</span><br><span class="line">        LOGE(&quot;registerNativeMethods failed&quot;);</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* success -- return valid version number */</span><br><span class="line">    result = JNI_VERSION_1_6;</span><br><span class="line"></span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>    这里只导出一个msg函数打印传递进来的字符串，仅作测试。再在jni目录下新建一个empty.cpp文件，内容为空，这个是为了解决NDK的bug所作的，以防编译出错。<br>    <div><br>    <div>打开local.properties，设置正确的SDK路径和NDK路径：<br>    <div><br>    <pre>sdk.dir=D\:/adt20131030/sdk<br>    ndk.dir=D\:/ndk<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div&gt;打开项目gradle/wrapper目录下的gradle-wrapper.properties文件，修改：</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;pre&gt;#Wed Apr 10 15:27:10 PDT 2013</span><br><span class="line">distributionBase=GRADLE_USER_HOME</span><br><span class="line">distributionPath=wrapper/dists</span><br><span class="line">zipStoreBase=GRADLE_USER_HOME</span><br><span class="line">zipStorePath=wrapper/dists</span><br><span class="line">distributionUrl=http\://services.gradle.org/distributions/gradle-1.9-all.zip</span><br></pre></td></tr></table></figure><br><br>    为：<br>    <div><br>    <div><br>    <pre>#Wed Apr 10 15:27:10 PDT 2013<br>    distributionBase=GRADLE_USER_HOME<br>    distributionPath=wrapper/dists<br>    zipStoreBase=GRADLE_USER_HOME<br>    zipStorePath=wrapper/dists<br>    distributionUrl=http\://services.gradle.org/distributions/gradle-1.10-all.zip<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">并打开项目根目录下的build.gradle文件，修改：</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;pre&gt;// Top-level build file where you can add configuration options common to all sub-projects/modules.</span><br><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath &apos;com.android.tools.build:gradle:0.7.+&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>    为（指定使用gradle1.10则修改为0.9.+，指定使用gradle1.11则修改为0.9.2）：<br>    <div><br>    <div><br>    <pre>// Top-level build file where you can add configuration options common to all sub-projects/modules.<br>    buildscript {<br>        repositories {<br>            mavenCentral()<br>        }<br>        dependencies {<br>            classpath ‘com.android.tools.build:gradle:0.9.+’<br>        }<br>    }<br><br>    allprojects {<br>        repositories {<br>            mavenCentral()<br>        }<br>    }<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">解释：参考[http://tools.android.com/tech-docs/new-build-system](http://tools.android.com/tech-docs/new-build-system)知道</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;pre&gt;0.7.0</span><br><span class="line">Requires Gradle 1.9</span><br><span class="line">Requires Studio 0.4.0</span><br></pre></td></tr></table></figure><br><br>    <div><br>    <div><br>    <pre>0.9.0<br>    Compatible with Gradle 1.10 and 1.11<br>    Using Gradle 1.11 requires Android Studio 0.5.0<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果配置的是0.7.+则默认使用gradle1.9，如果设置为0.9.+则默认使用gradle1.10。</span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;另外还需要注意的是gradle1.9下没有buildTypes标签，需要将debug、release标签直接放在android标签内，在gradle1.10下debug、release需要放在buildTypes标签内，buildTypes在android内。这里hellojni配置的build.gradle文件内容如下：</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;pre&gt;assert gradle.gradleVersion &gt;= &quot;1.10&quot;</span><br><span class="line"></span><br><span class="line">apply plugin: &apos;android-library&apos;</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion 19</span><br><span class="line">    buildToolsVersion &quot;19.0.3&quot;</span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        minSdkVersion 8</span><br><span class="line">        targetSdkVersion 16</span><br><span class="line">        versionCode 1</span><br><span class="line">        versionName &quot;1.0&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            runProguard false</span><br><span class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.txt&apos;</span><br><span class="line">            ndk &#123;</span><br><span class="line">                moduleName &quot;hellojni&quot;</span><br><span class="line">                abiFilters &quot;armeabi&quot;, &quot;armeabi-v7a&quot;, &quot;x86&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        debug &#123;</span><br><span class="line">            ndk &#123;</span><br><span class="line">                moduleName &quot;hellojni&quot;</span><br><span class="line">                //stl &quot;stlport_shared&quot;</span><br><span class="line">                ldLibs &quot;log&quot;, &quot;z&quot;, &quot;m&quot;</span><br><span class="line">                //cFlags &quot;-Wall -Wextra -I &quot; + projectDir + &quot;/src/main/jni/include&quot;</span><br><span class="line">                abiFilters &quot;armeabi&quot;, &quot;armeabi-v7a&quot;, &quot;x86&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        x86 &#123;</span><br><span class="line">            versionCode Integer.parseInt(&quot;6&quot; + defaultConfig.versionCode)</span><br><span class="line">            ndk &#123;</span><br><span class="line">                abiFilter &quot;x86&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mips &#123;</span><br><span class="line">            versionCode Integer.parseInt(&quot;4&quot; + defaultConfig.versionCode)</span><br><span class="line">            ndk &#123;</span><br><span class="line">                abiFilter &quot;mips&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        armv7 &#123;</span><br><span class="line">            versionCode Integer.parseInt(&quot;2&quot; + defaultConfig.versionCode)</span><br><span class="line">            ndk &#123;</span><br><span class="line">                abiFilter &quot;armeabi-v7a&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        arm &#123;</span><br><span class="line">            versionCode Integer.parseInt(&quot;1&quot; + defaultConfig.versionCode)</span><br><span class="line">            ndk &#123;</span><br><span class="line">                abiFilters &quot;armeabi&quot;, &quot;armeabi-v7a&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        fat</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;com.android.support:appcompat-v7:19.+&apos;</span><br><span class="line">    compile fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>    然后选择hellojni项目右键“Make Module hellojni”，等待一段时间后会在项目下生成build-ndk目录，目录下会有一些不同版本的so库文件生成，如图：<br>    <div><img src="http://pangguoming.com/blog/images/c164cc7a-1f55-4c61-88f5-2c4e62b335c8.png" alt=""><br>    <div>注意这里的Android.mk文件每次编译都会重新由工具自动生成，而非手动编辑的，我觉得这一点设计就比较差劲。例如如果想要使用log输出函数__android_log_print，需要添加“LOCAL_LDLIBS :=  -llog”，则在build.gradle文件中添加如下的配置：<br>    <div><br>    <div><br>    <pre>        debug {<br>                ndk {<br>                    ldLibs “log”<br>                }<br>            }<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">由gradle根据配置再去生成Android.mk文件，最后再调用ndk进行编译。</span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;右键工程选择Open Module Settings，选择Modules-app，打开Dependencies选项卡点击“+”号，选择Module dependency，在打开的对话框中选择hellojni。</span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;但是测试发现设置依赖没有效果，如果直接编译app，hellojni并没有编译，仍需要手动编译hellojni。</span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;**调用native函数：**</span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;app项目中，在MainActivity类中声明native函数：</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;pre&gt;public native void msg(String str);</span><br></pre></td></tr></table></figure><br><br>    并添加静态代码加载hellojni库：<br>    <div><br>    <pre>    static {<br>            System.loadLibrary(“hellojni”);<br>        }<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div&gt;在MainActivity::onCreate中调用native函数打印一句log：</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;pre&gt;    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        **msg(&quot;MainActivity onCreate&quot;);**</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><br><br>    <div><br>    <div>还需要将hellojni生成的so库文件打包进apk，仍需要配置build.gradle文件，添加：<br>    <div><br>    <div><br>    <pre>task copyNativeLibs(type: Copy) {<br>        from fileTree(dir: ‘../hellojni/build/ndk/arm/debug/lib’, include: ‘armeabi/</pre></div></div></div></div></pre></div></pre></div></div></div></div></pre></div></div></pre></div></div></pre></div></div></pre></div></div></div></em>.so’) into ‘build/lib’<br>    }<br>    tasks.withType(Compile) {<br>        compileTask -&gt; compileTask.dependsOn copyNativeLibs<br>    }<br>    clean.dependsOn ‘cleanCopyNativeLibs’<br>    tasks.withType(com.android.build.gradle.tasks.PackageApplication) { pkgTask -&gt;<br>        pkgTask.jniFolders = [new File(buildDir, ‘lib’)]<br>    }<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div&gt;参考：“Android Studio添加so库”[http://blog.csdn.net/caesardadi/article/details/18264399](http://blog.csdn.net/caesardadi/article/details/18264399)</span><br><span class="line">其中copyNativeLibs任务是从相对app的项目路径&apos;../hellojni/build/ndk/arm/debug/lib&apos;下复制所有armeabi子目录的so文件到本项目build目录下的lib目录中，执行效果：</span><br><span class="line">&lt;div&gt;![](http://pangguoming.com/blog/images/33b51ad3-a1e9-44b1-8efd-f0da192dfcfc.png)</span><br><span class="line">&lt;div&gt;这样最后打包生成的apk包才会包含有hellojni的so库文件。</span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;**测试：**</span><br><span class="line">&lt;div&gt;** **</span><br><span class="line">&lt;div&gt;编译运行app，apk安装完毕运行时输出log信息：</span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;后面列出了可能出现的gradle错误以及解决方案，以供参考。</span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;**错误：**</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;pre&gt;Execution failed for task &apos;:hellojni:compileDebugNdk&apos;.</span><br><span class="line">&gt; com.android.ide.common.internal.LoggedErrorException: Failed to run command:</span><br><span class="line">    D:\ndk\ndk-build.cmd NDK_PROJECT_PATH=null APP_BUILD_SCRIPT=F:\androidstudio\test\hellojni\build\ndk\debug\Android.mk APP_PLATFORM=android-19 NDK_OUT=F:\androidstudio\test\hellojni\build\ndk\debug\obj NDK_LIBS_OUT=F:\androidstudio\test\hellojni\build\ndk\debug\lib APP_ABI=armeabi,armeabi-v7a</span><br><span class="line">Error Code:</span><br><span class="line">    2</span><br><span class="line">Output:</span><br><span class="line">    make.exe: *** No rule to make target `F:\androidstudio\test\hellojni\build\ndk\debug\obj/local/armeabi/objs/jnimain/F_\androidstudio\test\hellojni\src\main\jni&apos;, needed by `F:\androidstudio\test\hellojni\build\ndk\debug\obj/local/armeabi/objs/jnimain/F_\androidstudio\test\hellojni\src\main\jni\hellojni.o&apos;.  Stop.</span><br></pre></td></tr></table></figure>

    </strong>解决方案：<strong><br>    <div>这是NDK在Windows下一个bug，当只编译一个文件时出现，解决方法就是再添加一个空的文件即可。<br>    <div>原文见<a href="http://ph0b.com/android-studio-gradle-and-ndk-integration/" target="_blank" rel="noopener">http://ph0b.com/android-studio-gradle-and-ndk-integration/</a>：<br>    <div><br>    <div><br>    <pre>This may come from a current NDK bug on Windows, when there is only one source file to compile. You only need to add one empty source to make it work again.<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;**错误：**</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;pre&gt;Could not determine the dependencies of task &apos;:hellojni:compileArmDebugJava&apos;.</span><br><span class="line">&gt; failed to find Build Tools revision 19.0.3</span><br></pre></td></tr></table></figure><br><br>    <div></div></pre></div></div></div></div></strong>解决方案：<strong><br>    <div>这个Build Tools是指“Android SDK Build-tools”，打开SDK Manager勾选相应版本（例如这里是19.0.3）安装即可。<br><br><img src="http://pangguoming.com/blog/images/3eb4f7a5-019c-43c8-8956-fc90eb7ae7a1.png" alt=""><br><br>    <div>  
</div></div></strong><br><strong><br>    <div></div></strong> <strong><br>    <div></div></strong>错误：<strong><br>    <div><br>    <pre>FAILURE: Build failed with an exception.<br><br>    <em> What went wrong:<br>    Task ‘assembleArmDebug’ not found in project ‘:hellojni’. Some candidates are: ‘assembleDebug’.

    </em> Try:<br>    Run gradle tasks to get a list of available tasks. Run with –stacktrace option to get the stack trace. Run with –info or –debug option to get more log output.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div&gt;**解决方案**：</span><br><span class="line">&lt;div&gt;在**android &#123; &#125;**中添加：</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;pre&gt;    productFlavors&#123;</span><br><span class="line">        arm &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><br><br>    若有类似错误可以参考加入相应的标签：<br>    <div><br>    <div><br>    <pre>    productFlavors {<br>            x86 {<br>                versionCode Integer.parseInt(“6” + defaultConfig.versionCode)<br>                ndk {<br>                    abiFilter “x86”<br>                }<br>            }<br>            mips {<br>                versionCode Integer.parseInt(“4” + defaultConfig.versionCode)<br>                ndk {<br>                    abiFilter “mips”<br>                }<br>            }<br>            armv7 {<br>                versionCode Integer.parseInt(“2” + defaultConfig.versionCode)<br>                ndk {<br>                    abiFilter “armeabi-v7a”<br>                }<br>            }<br>            arm {<br>                versionCode Integer.parseInt(“1” + defaultConfig.versionCode)<br>                ndk {<br>                    abiFilter “armeabi”<br>                    //abiFilters “armeabi”, “armeabi-v7a”<br>                }<br>            }<br>            fat<br>        }<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;div&gt;**错误：**</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;pre&gt;Execution failed for task &apos;:hellojni:compileDebugNdk&apos;.</span><br><span class="line">&gt; java.io.IOException: Cannot run program &quot;D:\ndk\ndk-build&quot;: CreateProcess error=193, %1 ??????Ч?? Win32 ??ó</span><br></pre></td></tr></table></figure>

    </pre></div></div></pre></div></strong>解决方案：<strong><br>    <div>在使用gradle1.9版本时遇到，使用gradle1.10版本来解决。<br>    <div><br>    <div><br>    <div></div></div></div></div></strong>错误：<strong><br>    <div><br>    <div><br>    <pre>A problem occurred evaluating project ‘:app’.<br>    &gt; Could not create plugin of type ‘AppPlugin’.<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**解决方案：**</span><br><span class="line">&lt;div&gt;Don’t use latest Gradle (version 1.10), downgrade to 1.9。参考：[http://blog.vyvazil.eu/tag/android-studio/](http://blog.vyvazil.eu/tag/android-studio/)</span><br><span class="line">&lt;div&gt;但是如果我们使用gradle1.9版本的话又会出现**错误：**</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;pre&gt;Execution failed for task &apos;:hellojni:compileDebugNdk&apos;.</span><br><span class="line">&gt; java.io.IOException: Cannot run program &quot;D:\ndk\ndk-build&quot;: CreateProcess error=193, %1 ??????Ч?? Win32 ??ó</span><br></pre></td></tr></table></figure><br><br>    <div>无论使用哪个版本都有问题，后来仔细查看了下’AppPlugin’这个错误是出现在‘app’模块上的而非‘hellojni’模块上，于是考虑新建工程项目并且只在该工程下建立一个库模块，不再创建app模块，如图：<br>    <div><br>    <div>这里不勾选“Create custom launcher icon”和“Create activity”，直接finish完成，其他配置参考前述，最后编译后可以生成so库文件：<br>    <div><img src="http://pangguoming.com/blog/images/4cf64f61-983a-4700-8826-c28f5bae68fa.png" alt=""><br>    <div><br>    <div><br>    <div></div></div></div></div></div></div></div></pre></div></div></strong>错误：<strong><br>    <div>这个错误忘记记录了囧<br>    <div><br>    <div></div></div></div></strong>解决方案：**<br>    <div>File-Settings-Gradle-Gradle VM options：-Xmx512m<br>    <div> </div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><br>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/f013d78d.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/f013d78d.html" itemprop="url">NodeJS 各websocket框架性能分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-28T21:43:00+08:00">
                2015-01-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="section-content"><br><div class="section-inner layoutSingleColumn"><br><br>For a current project at <a href="http://www.whoscored.com/" target="_blank" rel="noopener">WhoScored</a>, I needed to learn JavaScript, Node.js and WebSocket channel, after seven years of writing web applications with Java and Spring framework. We wanted an application that can send data to thousands of concurrent users, and <a href="http://www.toptal.com/nodejs/why-the-hell-would-i-use-node-js" target="_blank" rel="noopener">Node.js appeared to be the right way of doing it</a> with its event-driven, non-blocking I/O model that can scale up easily.<br><br>Firstly, to learn JavaScript I started doing the tutorials in <a href="http://www.codecademy.com/" target="_blank" rel="noopener">Code Academy</a> and reading D. Crockford’s <a href="http://shop.oreilly.com/product/9780596517748.do" target="_blank" rel="noopener">JavaScript: The Good Parts</a> book. In parallel, I read J. R. Wilson’s <a href="http://pragprog.com/book/jwnode/node-js-the-right-way" target="_blank" rel="noopener">Node.js the Right Way</a> as well. It was a great read: by using some great modules like async, Q, ZMQ, Express, and methods like Promises and Generators, the book explains how to build scalable Node applications. It also covers sockets with Pub/Sub, Req/Res and Push/Pull patterns which shaped the WebSocket applications that I wrote.<br><br>### System structure<br><br>After some trials, errors, and brainstorming sessions, the final structure looks like this:<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 440px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/782/1*NF1K_nSf9f18SMvJWzKsDQ.png" alt=""><br><br>A client connects for a specific key/resource, let’s say “matchesfeed/8/matchcentre”. WebSocket server’s responsibility is to return some JSON data for this key. If it doesn’t have data for this key in its memory, it requests it from “Fetcher” via a Push socket implemented with <a href="https://npmjs.org/package/zmq" target="_blank" rel="noopener">ZMQ library</a> over a TCP connection. Fetcher receives this request, and adds it to a queue of jobs. Worker processes (implemented with <a href="http://nodejs.org/api/cluster.html#cluster_cluster_fork_env" target="_blank" rel="noopener">Node.js clusters</a>) check this queue constantly, get a job, and make an HTTP call to an API that has the actual JSON data for this key. When response is received by a worker, it passes the data to master process, which sends it to WebSocket server, and puts the job back into queue. When WebSocket server receives data, it publishes to clients who are connected for that key. All applications are open source, and you can find web socket server <a href="https://github.com/denizozger/node-websocket" target="_blank" rel="noopener">here</a>, fetcher <a href="https://github.com/denizozger/node-fetcher" target="_blank" rel="noopener">here</a> and the data provider <a href="https://github.com/denizozger/node-dataprovider" target="_blank" rel="noopener">here</a>. Node.js version used in all applications are 0.10.<br><br>### einaros / ws (v 0.4)<br><br>Based on <a href="https://github.com/heroku-examples/node-ws-test" target="_blank" rel="noopener">Heroku’s WebSocket demo</a>, I began with <a href="https://github.com/einaros/ws" target="_blank" rel="noopener">einaros/ws</a> implementation. It didn’t have as much as documentation that other frameworks had, but the development went smooth and I had something working in a short time.<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 104px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/765/1*dzS6cW-11XxS3sKwi5TH8A.png" alt=""><br>Client beautifully connects via WebSockets<br><br>Then I wrote <a href="https://github.com/denizozger/node-websocket/blob/master/loadtest.js" target="_blank" rel="noopener">a load tes</a>t to see the performance. The test basically connects clients every half a second, all requesting the same data. Data is <strong class="markup--strong markup--p-strong">165KB<strong>, and is sent <strong class="markup--strong markup--p-strong">every second.</strong> With <strong class="markup--strong markup--p-strong">120 concurrent clients<strong>, the application allocates around 210MB of RAM, and data sent appears to be around 35 MB/second. The test machine is a 3.4 Ghz Intel i7 (8 processors) with 16GB of RAM, running OSX v10.9.<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 366px; max-height: 106px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/800/1*ho2lGmulhn-ElpN-km49vw.png" alt=""><br><br>I monitored the process with <a href="https://npmjs.org/package/strong-agent" target="_blank" rel="noopener">Strongloop’s agent</a>, I find it pretty impressive.<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 832px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/700/1*LoD0vHyf--qeo_6_yT73tw.png" alt=""><br><br>At this point, the biggest drawback for me was it being a pure WebSocket implementation: if the client browser did not support WebSockets, it would not work. This made me try <a href="http://socket.io/" target="_blank" rel="noopener">Socket.IO</a>.<br><br>### Socket.IO (v. 0.9)<br><br>Socket.IO seemed like the perfect solution, as it selects the most capable transport at runtime: it tries to connect to server via WebSockets first, if it doesn’t work, it <strong class="markup--strong markup--p-strong">downgrades</strong> by trying XHR-polling, if it doesn’t work, continues with flash sockets etc. Moreover, it would try to <strong class="markup--strong markup--p-strong">reconnect<strong> sockets if connection fails, and it supports <strong class="markup--strong markup--p-strong">rooms</strong> so that I could cluster connections based on what information they asked for, without any custom implementation. So I re-implemented the application by keeping everything the same but web socket framework.<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 548px; max-height: 198px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/800/1*Tj6lWTMf_dWl993x9eGZhw.png" alt=""><br>Client connects to Socket.IO server<br><br>Indeed, when the server is down, Socket.IO tries to connect back with decreasing frequency.<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 554px; max-height: 246px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/800/1*XKFMQnM3r07Zt4sia2OsWg.png" alt=""><br><br>And when the server is up, WebSocket connection is re-established:<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 550px; max-height: 130px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/800/1*1cDuBI9hO8rWvPphpwTWEA.png" alt=""><br><br>Load test results are below, it is the same test I executed for ws/einaros implementation with the same data:<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 826px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/700/1*WAVyS8_ODWQL0r9uYG0UJw.png" alt=""><br><br>The data output looks like:<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 367px; max-height: 98px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/800/1*QU1hX4iLJrmtG__MCnaurA.png" alt=""><br>In WS, average load was 35 MBs<br><br>#### Performance limit<br><br>However, when I connect <strong class="markup--strong markup--p-strong">140<strong> <strong class="markup--strong markup--p-strong">clients</strong>, the memory usage starts to increment without the number of clients or the data size changing. Garbage Collector kicks in very frequently and gets more aggressive over time (sometimes a couple of times per second), eating up CPU time and desperately trying to free memory. Memory usage would reach ~1GB, then heartbeats would fail and clients would start to lose connection.<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 125px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/783/1*VSpub4TEOxu4RRnOtJ0uXg.png" alt=""><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 829px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/700/1*pMFOD0TlXv0aiq2VbdnDOQ.png" alt=""><br>Heap size stops increasing when connections start dropping, and keeps stable as Socket.IO clients tries to connect back. Also notice the very low event loop latency.<br><div class="aspectRatioPlaceholder is-locked" style="max-width: 366px; max-height: 97px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/800/1*uqQLvLCtsaADgJbWGxay_Q.png" alt=""><br><br>It’s time to debug!<br><br>I used <a href="https://hacks.mozilla.org/2012/11/tracking-down-memory-leaks-in-node-js-a-node-js-holiday-season/" target="_blank" rel="noopener">Mozilla’s memwatch module</a> to detect memory leaks and take heap dumps to inspect the data. I found out that somehow 10MB Buffer objects would stack up constantly, you can find more details in <a href="http://stackoverflow.com/questions/20566673/memory-leak-when-emitting-messages-with-socket-io-node-js-zmq" target="_blank" rel="noopener">my Stackoverflow Question</a>. I couldn’t figure out why this would happen, but I think due to some cumulative CPU intensive operations, event loop response slows down and operations (sending messages) stack up in the queue. Being stuck, I decided to try out <a href="https://github.com/sockjs/sockjs-client" target="_blank" rel="noopener">Sock.</a>js.<br><br>I must admit my Sock.js adventure didn’t last long after discovering that Sock.js does not support connection query strings. This would mean that I’d need to amend my code so that after clients connect, they’d need to send a seperate message to pass the parameter(s), and this was a bit turn off. Next, I decided to give <a href="https://github.com/LearnBoost/engine.io" target="_blank" rel="noopener">Engine.IO</a> a try.<br><br>### Engine.IO (v 0.7.12)<br><br>As far as I’ve seen, both Engine.IO and Socket.IO are mainly developed by <a href="https://github.com/guille" target="_blank" rel="noopener">Guillermo Rauch</a>, and Engine.IO is a lower level library. Socket.IO v0.9 appears to be somewhat outdated and Engine.IO is the interim successor until Socket.IO v1.0 is released — which will use Engine.IO. One major difference is that Engine.IO always establishes a long-polling connection first, then tries to <strong class="markup--strong markup--p-strong">upgrade<strong> to better transports. This makes it resilient to firewalls and proxies, gives more predictable results and less frequent reconnecting. All other differences are very well listed on <a href="https://github.com/LearnBoost/engine.io#goals" target="_blank" rel="noopener">project’s readme</a>. As you see, Engine.IO first started to connect via long-polling, then connected via WebSockets:<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 212px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/935/1*bpiyQzS3nXssOps_RXG9QQ.png" alt=""><br>Notice the ‘transport’ parameter<br><br>However its client library <strong class="markup--strong markup--p-strong">does not try to reconnect</strong> when connection terminates.<br><br>Same load test with same values (<strong class="markup--strong markup--p-strong">160KB sent every second to 120 clients)<strong> looks like:<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 833px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/700/1*sAStZUaDk2kbVs8_7g3P2A.png" alt=""><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 371px; max-height: 97px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/800/1*gRssPL3bttWdamv3oLd9SA.png" alt=""><br><br>#### Performance limit<br><br>Let’s see what happens when we increase connection size. Engine.IO’s performance proved to be better for my application: I could load test with <strong class="markup--strong markup--p-strong">230 concurrent connections</strong>, with (again) each one sent 165KB of data every second. Any number above 230 connections resulted in the application using massive amounts of data — up to 2GB (the same issue with Socket.IO implementation). Then connections would start dropping until 160 connections are remaining, and obviously this results in less resource usage. You can see this drop in the charts below. Remember in Engine.IO client implementation, clients don’t reconnect once they are disconnected.<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 830px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/700/1*VmsuyauLLwN_uDOmcop6Vw.png" alt=""><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 369px; max-height: 103px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/800/1*45gGF8eycV9Q1MwWBsBnBg.png" alt=""><br><br>### Primus (v 1.5.0)<br><br>When I was about to end my research and development, I came across <a href="http://primus.io/" target="_blank" rel="noopener">Primus</a>. It is developed by <a href="https://github.com/3rd-Eden" target="_blank" rel="noopener">Arnout Kazemier</a> who is an active collabrator in some of the projects mentioned above. Primus actually lets you do what I have done all this time (changing WebSocket technologies for the business logic) dead easy: only with a single line of code. It has a similar syntax with all of the other frameworks, reconnects clients when connection terminates, and has lots of cool methods and structures — like rooms.<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 156px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/716/1*0vgMgH7VO7tAtG5z_m_UoQ.png" alt=""><br>Primus connects<br><br>Here are the test results for <strong class="markup--strong markup--p-strong">einaros/ws<strong> library with Primus (<strong class="markup--strong markup--p-strong">160KB sent every second to 120 clients)</strong>:<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 831px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/700/1*UA6v1l5csnkmGJQ2B4x46A.png" alt=""><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 372px; max-height: 101px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/800/1*HvoLp6qUWXItPtXC3JYlwg.png" alt=""><br><br>Compared to native implementation, it has a higher CPU usage and event loop latency, but a bit lower memory consumption. However, something unexpected happens after 10 minutes pass:<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 841px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/700/1*Y7qKnDCQYAuDmFobs4xHUg.png" alt=""><br><br>Event loop average drops to almost 0ms, but memory allocation starts to stack up, reaching GBs in minutes. This happened twice in two of my tries. I decided to leave this instead of digging deeper. (<em class="markup--em markup--p-em">Please see Arnout’s comment about this issue on the right hand side<em>)<br><br>As Primus is a wrapper for socket libraries, I decided to use a native library just to have things on a lower level.<br><br>### <strong class="markup--strong markup--h3-strong">Looking back: Performance limit of einaros/ws**<br><br>At this point, I wanted to look back and see at what rate <em class="markup--em markup--p-em">einaros/ws</em> implementation (which I ditched as it doesn’t support other connection types) would crash.<br><br>By handling <strong class="markup--strong markup--p-strong">410<strong> concurrent connections, sending 165KB data to each every second, <em class="markup--em markup--p-em">einaros/ws*’s performance was far more superior than any other framework I tried. Compare it with Socket.IO’s max <strong class="markup--strong markup--p-strong">140</strong> connections and Engine.IO’s max <strong class="markup--strong markup--p-strong">230<strong> connections. <em class="markup--em markup--p-em">einaros/ws<em> would fail at 415 connections in the same way with other implementations: memory usage would stack up seemingly almost indefinitely (I waited until 8GB consumption before killing the process).<br><br><div class="aspectRatioPlaceholder">![](<a href="https://d262ilb51hltx0.cloudfront.net/max/800/1" target="_blank" rel="noopener">https://d262ilb51hltx0.cloudfront.net/max/800/1</a></div></em>0V-fb_dFkoxsBAneeIG–w.png)<br><div class="aspectRatioPlaceholder is-locked" style="max-width: 369px; max-height: 97px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/800/1*e0d2NB7dIRexSSagezudPw.png" alt=""><br><br>### Final decision on the framework<br><br>In summary, these test results showed that <strong class="markup--strong markup--p-strong">Engine.IO</strong> looks like the better choice for my application. It supports different connection types apart from WebSockets, and has a significantly better memory usage compared to others.<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 129px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/724/1*OlkZJXDjJ62aelM9Zlc_Dg.png" alt=""><br><br>The difference in memory seems like a good trade of for losing the functionality of clients not reconnecting in a connection failure. At least, until Socket.IO 1.0 is released.<br><br>### Changing the flow based on limitations<br><br>The aim when starting this project was to have a system that can support thousands, even 10 thousand concurrent users. It seems, with 165KB of data sent every second, this won’t be possible. This made me decide to decrease the data size, and introduce a delta model, in which the application would send only the new JSON content instead of the whole object each time.<br><br>### Test 1: The impact of data size<br><br>I ran the a load test that uses <strong class="markup--strong markup--p-strong">5KB of data, sent to 4000 users every second<strong>. 5KB of JSON makes around 200 lines of data with reasonable string length. I’ve also modified the test so that 10 new clients connect every second. The data throughput is equivalent to 20MB sent per second.<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 828px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/700/1*beMMwc93qJV0rX1qwhoYxQ.png" alt=""><br><br>We will take these values as a base and see what happens when we keep throughput same and change some variables.<br><br>### Test 2: The impact of concurrent connection size<br><br>In this test, <strong class="markup--strong markup--p-strong">2000 users</strong> connected to the server, and received <strong class="markup--strong markup--p-strong">10KBs<strong> <strong class="markup--strong markup--p-strong">of data every second</strong>. Again in this case, 20MB is sent every second.<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 833px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/700/1*mYnz2FhmPkLXTJWLDf9EoQ.png" alt=""><br><br>Compare these results with test one. As you see, <strong class="markup--strong markup--p-strong">doubling the data size and decreasing the connection size by half ended up in 20% lower memory consumption, 35% lower CPU usage and 75% less event loop latency<strong>.<br><br>### Test 3: The impact of data broadcasting frequency<br><br>In this test, <strong class="markup--strong markup--p-strong">4000</strong> <strong class="markup--strong markup--p-strong">users<strong> connected to the server, and received <strong class="markup--strong markup--p-strong">10KB of data every 2 seconds</strong>. Again, this equals to 20MB sent every second.<br><br><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 833px;"><img src="https://d262ilb51hltx0.cloudfront.net/max/700/1*Y91GPYv2Mg6FYiOqDq2TKQ.png" alt=""><br><br>Compare these results with the first test. It seems <strong class="markup--strong markup--p-strong">doubling data size and decreasing frequency of data sent by half results in 25% lower CPU usage, but more or less the same memory consumption and event loop latency.<strong><br><br>### Conclusion<br><br>We do not really have a direct control over how many connections the application will have <strong class="markup--strong markup--p-strong">if we have one server</strong>, thus it seems we can only play around with the size of data sent, and how frequent we send this data. These tests show that <strong class="markup--strong markup--p-strong">for a constant throughput, (at least) for Engine.IO,<strong> <strong class="markup--strong markup--p-strong">the number of connections have the biggest impact on performance</strong>, <strong class="markup--strong markup--p-strong">then comes reducing size of data, and lastly reducing frequency of data sent<strong>. Sending larger data in less frequency appears to yield better performance. It’s a double-sided sword though: increasing size of data packets was what made my applications crash as well.<br><br>So I think the best way of balancing it is to estimate the max number of concurrent users in the long run (at least a couple of years forward), finding the maximum data size that can be used with that number, and then decrease the frequency of sending data if possible — but as said this is not that critical. After this point, as connection number has the biggest impact on the performance, by using a load balancer, adding <strong class="markup--strong markup--p-strong">more application instances</strong> should increase the performance more than any other method.<br><br><div class="section-divider layoutSingleColumn"><br><br><em> </em> <em><br><br><div class="section-content"><br><div class="section-inner layoutSingleColumn"><br><br><a href="https://news.ycombinator.com/item?id=7030100" target="_blank" rel="noopener">Discuss this on Hacker News</a><br><br><em class="markup--em markup--p-em">Acknowledgements: </em><a href="https://github.com/kkoopa" target="_blank" rel="noopener"><em class="markup--em markup--p-em">Benjamin Byholm*</em></a><em class="markup--em markup--p-em">for reviewing and commenting on this article with his insights on caching, multiple servers, and V8 memory usage. <em>[<em class="markup--em markup--p-em">Arnout Kazemier</em></em>](<a href="https://medium.com/@3rdEden" target="_blank" rel="noopener">https://medium.com/@3rdEden</a> “Go to the profile of Arnout Kazemier”)<em class="markup--em markup--p-em"> for his helpful comments, <em>[<em class="markup--em markup--p-em">Nico Kaiser</em></em>](<a href="https://github.com/nicokaiser" target="_blank" rel="noopener">https://github.com/nicokaiser</a>)<em class="markup--em markup--p-em"> for his feedback, <em>[<em class="markup--em markup--p-em">Guillermo Rauch</em></em>](<a href="https://github.com/guille" target="_blank" rel="noopener">https://github.com/guille</a>)<em class="markup--em markup--p-em"> and <em>[<em class="markup--em markup--p-em">David Halls</em></em>](<a href="https://github.com/davedoesdev" target="_blank" rel="noopener">https://github.com/davedoesdev</a>)<em class="markup--em markup--p-em"> for taking the time to read the draft.*<br><br></em></em></em></em></em></div></div></em></div></strong></strong></strong></strong></strong></strong></div></strong></strong></strong></strong></div></strong></strong></div></strong></strong></div></div></em></strong></strong></em></strong></strong></strong></em></em></div></div></div></strong></strong></div></div></div></div></div></strong></strong></div></strong></strong></div></div></div></strong></strong></div></div></div></div></div></strong></strong></div></div></strong></strong></strong></strong></div></div></div></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/ee73af8b.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/ee73af8b.html" itemprop="url">PHP 启动 cURL模块以及启动失败的解决方案</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-23T11:07:00+08:00">
                2015-01-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>配置方法：</strong></p>
<p>php_curl.dll<br> libeay32.dll<br> ssleay32.dll</p>
<p>php5ts.dll</p>
<p>复制到 %windir%/system32 以及php 目录的ext目录 下<br> 并且找到php.ini（phpinfo里显示的那个php.ini文件）<br> 修改了extension=php_curl.dll 并把前面的分号去掉<br> 还重起了APACHE / IIS<br> 这些DLL 5.2.4PHP版本可以在这里找 <a href="http://edm.ceiea.com/userfiles/breezexu/php5.2.4.zip" target="_blank" rel="noopener">下载</a></p>
<p>有时侯好象还是不行，就把php_curl.dll libeay32.dll ssleay32.dll都复制到ext目录 下，然后把PHP目录还有PHP/ext目录 都加到环境变量即可。好像可以。</p>
<p>参考地址：<a href="http://www.blueidea.com/tech/program/2010/7348.asp" target="_blank" rel="noopener">http://www.blueidea.com/tech/program/2010/7348.asp</a> </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/d4616f81.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/d4616f81.html" itemprop="url">HTML5 game engines</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-22T20:13:00+08:00">
                2015-01-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><p>The following are few examples of game engines implemented with HTML5 and JavaScript:</p>
<ul>
<li><a href="http://www.scirra.com/" target="_blank" rel="noopener">Construct 2</a>: One of the first WebGL enabled HTML5 game engines. Exports purely to HTML5 and JavaScript. Uses Canvas only and is extensible with JavaScript plugins.</li>
<li><a href="http://www.isogenicengine.com/" target="_blank" rel="noopener">Isongenic Engine</a>: One of the most promising engines out there today. Massively multiplayer networking built in, uses Node.js and MongoDB, and has canvas or DOM-based graphics.</li>
<li><a href="http://impactjs.com/" target="_blank" rel="noopener">Impact</a></li>
<li><a href="http://cutjs.org/" target="_blank" rel="noopener">CutJS</a>: Lightweight, fast, interactable 2D HTML5 rendering engine for game development. Open-source and cross-platform.</li>
<li><a href="http://www.canvace.com/" target="_blank" rel="noopener">Canvace</a></li>
<li><a href="http://craftyjs.com/" target="_blank" rel="noopener">Crafty</a></li>
<li><a href="http://playcanvas.com/" target="_blank" rel="noopener">PlayCanvas</a>: A collaborative, cloud-hosted game engine with a visual editor, in-browser code editing and one click publishing.</li>
<li><a href="http://mightyfingers.com/" target="_blank" rel="noopener">MightyEngine</a>: 2D game engine supporting Web, Android, iOS platforms. Build in editor to manage projects, assets, maps.</li>
<li><a href="http://www.compilgames.net" target="_blank" rel="noopener">Game Develop</a>: A game development software exporting to native and HTML5 games. Uses Pixi.js to render using WebGL or canvas.</li>
<li><a href="http://enchantjs.com/" target="_blank" rel="noopener">EnchantJS</a>: A simple Javascript framework for creating 2D and 3D HTML5 games. Has good documentation and easy to follow tutorials for getting started</li>
<li><a href="http://www.wimi5.com" target="_blank" rel="noopener">WiMi5</a>: A video game platform that eases the creation, publication and monetization processes of HTML5 games, using a cloud based editor.</li>
<li><a href="http://phaser.io" target="_blank" rel="noopener">Phaser</a>: 2D game enginge supporting Web, Android, IOS platforms</li>
</ul>
<h2 id="HTML5-game-tools"><a href="#HTML5-game-tools" class="headerlink" title="HTML5 game tools"></a>HTML5 game tools</h2><ul>
<li><a href="http://clay.io/development-tools" target="_blank" rel="noopener">Clay.io</a>: Distribution, Retention, Social and Monetization tools. Easy integration of user accounts, high scores, achievements, cross promotion, in-game payments, analytics etc…</li>
<li><a href="https://github.com/GoodBoyDigital/pixi.js" target="_blank" rel="noopener">Pixi.js</a>: 2D rendering engine using WebGL with a canvas fallback.</li>
<li><a href="https://github.com/mrdoob/stats.js" target="_blank" rel="noopener">stat.js</a>: Simple JavaScript performance monitor</li>
</ul>
<h2 id="Useful-technologies"><a href="#Useful-technologies" class="headerlink" title="Useful technologies"></a>Useful technologies</h2><p>The following can be useful in developing games based on Web technologies.</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas" target="_blank" rel="noopener">Canvas</a>: 2-D graphics.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/WebGL" target="_blank" rel="noopener">WebGL</a>: 3-D graphics.</li>
<li>Audio: HTML5 <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio" target="_blank" rel="noopener">  </a> element, <a href="https://developer.mozilla.org/en-US/docs/Web_Audio_API" target="_blank" rel="noopener">Web Audio API</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/WebSockets" target="_blank" rel="noopener">WebSockets</a>: can be used for real-time communication between a player and the game server, to support multi-player games.</li>
<li><a href="http://nodejs.org/" target="_blank" rel="noopener">Node.js</a>: Node is often used as a multiplayer game server, controlling the logic and handling the WebSockets connections to the players. It can be used for player authentication and the storage of data so game play can persist over multiple game sessions. This is all made relatively easy with great third-party modules, like Socket.IO for WebSockets, and others that handle Redis and MongoDB for storage, for example.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/DOM/Storage" target="_blank" rel="noopener">DOM Storage</a> is great for storing data locally on the player’s device. This way you can cache game data and allow the game to pick up where the player left off.</li>
<li>The <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/DOM/Using_full_screen_mode" target="_blank" rel="noopener">Full Screen API</a> allows you to expand any HTML element to ﬁll the user’s screen, even if the browser isn’t running full-screen itself.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/HTML/Using_the_application_cache" target="_blank" rel="noopener">Application Cache</a> and the <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker_API" target="_blank" rel="noopener">ServiceWorker API</a>: One of the main differences between Web apps and native apps is that native apps can be run offline. Technologies such as Application Cache and Service Worker allow for a website or a Web app to cache necessary assets so it can still run while offline. This includes things like JavaScript ﬁles, CSS and images. Combining this technique with intelligent use of things like localStorage will allow your game to continue working even if the Internet connection goes down. You just sync up all the changes when it gets connected again.</li>
<li><a href="http://en.wikipedia.org/wiki/Emscripten" target="_blank" rel="noopener">Emscripten</a> enables you to port a game written in C or C++ over to JavaScript. The <a href="https://developer.mozilla.org/en-US/demos/detail/bananabread" target="_blank" rel="noopener">Bananabread</a> demo used Emscripten.</li>
<li>The <a href="https://developer.mozilla.org/en-US/docs/API/Gamepad/Using_Gamepad_API" target="_blank" rel="noopener">Gamepad API</a> is available in latest versions of Firefox and Chrome. What is most interesting about the Gamepad API is that it might be just what ﬁnally justifies HTML5 gaming on a TV or console. Who wants to use a keyboard and mouse while sitting on the sofa?</li>
<li>The <a href="https://developer.mozilla.org/en-US/docs/WebAPI/Pointer_Lock" target="_blank" rel="noopener">Pointer Lock API</a> is an attempt to improve the mouse as an input device, used in situations such as games and 3D visualizations where the mouse position rotates or moves you around a 3D space. As it stands, there would still be a cursor moving around the screen causing all sorts of trouble when you want to click on something in your game. With this API, you can lock your mouse position and stop it from getting in the way and being a nuisance.</li>
</ul>
<p>Not every browser supports every part of HTML5. For example, Canvas isn’t supported out of the box by any Internet Explorer below version 9. However, you can use Explorer Canvas to replicate canvas functionality (but that is not ideal and does not perform as well). WebSockets is supported by IE only in IE 10, and it isn’t supported in the stock browser of Android. But again, you can fake this by using Flash for the sockets, such as with Socket.IO. While supported in the latest versions of every other browser, WebGL in Internet Explorer requires at least version 11.</p>
<h2 id="Game-template"><a href="#Game-template" class="headerlink" title="Game template"></a>Game template</h2><p>You can use the <a href="https://github.com/mozilla/mortar-game-stub" target="_blank" rel="noopener">Mortar Game Stub</a> template to get a quick start on an HTML5 game, or you can use it to get ideas on best practices.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/6449a92.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/6449a92.html" itemprop="url">NodeJS几个值得学习的开源框架</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-19T08:50:00+08:00">
                2015-01-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div style="margin: 10px;"><br><br><strong>1.<a href="http://primus.io/" target="_blank" rel="noopener">Primus</a></strong><br><br>Primus，是Transformer的创造者，并且也被称为通用包装器实时框架。Primus里包含了大量的用于Node.js的实时框架，并 且它们都拥有各种不同的实时功能。此外，Primus还提供了通用的低级别接口用于各个实时框架之间进行通信。Primus开源，并且托管在<a href="https://github.com/primus/primus" target="_blank" rel="noopener">Github</a>上。<br><br><a href="http://pangguoming.com/blog/images/4eb59a15-6f33-4704-850f-1cd607d61fdd.jpg"><img src="http://pangguoming.com/blog/images/4eb59a15-6f33-4704-850f-1cd607d61fdd.jpg" alt=""></a><br><br><strong>2.<a href="http://geddyjs.org/" target="_blank" rel="noopener">Geddy</a></strong><br><br>Geddy是一个非常简单的基于Node.js的结构化MVC框架。你可以使用它快速的构建Web应用和JSON API。如果你使用过Ruby on Rails或者PHP的codelgniter，那么Geddy和他们非常类似。它拥有一个RESTful的路由、模板渲染、控制器和模型。<br><br>想学Geddy的开发者可以去<a href="http://fleegix.org/" target="_blank" rel="noopener">Fleegix</a>看看，上面有大量关于Geddy的使用<a href="http://fokkezb.nl/2013/11/27/geddy-on-openshift/" target="_blank" rel="noopener">教程</a>和学习资料，并且这个博客就是采用Geddy开发的。<br><br><a href="http://pangguoming.com/blog/images/9a054bab-2909-4b0b-a483-be157ea05a20.jpg"><img src="http://pangguoming.com/blog/images/9a054bab-2909-4b0b-a483-be157ea05a20.jpg" alt=""></a><br><br><strong>3.<a href="http://locomotivejs.org/" target="_blank" rel="noopener">Locomotive</a></strong><br><br>Locomotive是个强大的Node.js的MVC框架，支持RESTfu，可以无缝连接任何数据库和模版引擎。Locomotive是在Express的基础上建立的，保持了Node.js 强大而简单的功能。<br><br><a href="http://pangguoming.com/blog/images/74852eb8-7046-431e-932f-fe2142b74961.jpg"><img src="http://pangguoming.com/blog/images/74852eb8-7046-431e-932f-fe2142b74961.jpg" alt=""></a><br><br><strong>4.<a href="http://keystonejs.com/" target="_blank" rel="noopener">KeystoneJS </a></strong><br><br>KeystoneJS是一个基于Express与Mongoose的Node.js CMS内容管理平台和Web应用平台。使用它可以方便快速建立基于数据库驱动的网站应用，还提供了安全认证和会话管理、动态路由、能够对密码自动加密、表 单校验处理、自动产生管理界面、Email邮件发送等。<br><br><a href="http://pangguoming.com/blog/images/d2702ec2-838a-4206-aa99-1e604880f704.jpg"><img src="http://pangguoming.com/blog/images/d2702ec2-838a-4206-aa99-1e604880f704.jpg" alt=""></a><br><br><strong>5.<a href="http://tuxychandru.github.io/grasshopper/" target="_blank" rel="noopener">Grasshopper </a></strong><br><br>Grasshopper是一款功能丰富且非常灵活的Node.js框架，基本上支持所有的Web开发特性。推荐一个学习<a href="http://howtonode.org/grasshopper-shoutbox" target="_blank" rel="noopener">示例</a>给大家。<br><br><a href="http://pangguoming.com/blog/images/33d9eca5-e057-47ce-8a18-77343341adb4.jpg"><img src="http://pangguoming.com/blog/images/33d9eca5-e057-47ce-8a18-77343341adb4.jpg" alt=""></a><br><br><strong>6.<a href="http://dozerjs.com/" target="_blank" rel="noopener">DozerJS</a></strong><br><br>DozerJS是一款旨在开发可扩展的RESTful风格的API和Web服务来支持前端开发。下面推荐两个DozerJS教程给大家，一个是<a href="http://www.fluidbyte.net/getting-started-with-dozerjs/" target="_blank" rel="noopener">入门教程</a>，一个是<a href="http://www.fluidbyte.net/simple-todo-list-app-with-dozerjs/" target="_blank" rel="noopener">DozerJS开发示例</a>。<br><br><a href="http://pangguoming.com/blog/images/7695a4df-ee4f-4e8b-89e8-86e8e41c2768.jpg"><img src="http://pangguoming.com/blog/images/7695a4df-ee4f-4e8b-89e8-86e8e41c2768.jpg" alt=""></a><br><br><strong>7.<a href="https://chocolatejs.org/" target="_blank" rel="noopener">Chocolate.js</a></strong><br><br>Chocolate.js是一个基于Node.js，使用CoffeeScript构建的简单的Web应用框架（集合）。 想学习该框架的同学可以到<a href="http://blog.nodefly.com/post/48617959144/nodefly-buzz-chocolate-js-with-jean-claude-levy" target="_blank" rel="noopener">这里</a>对其进行全面了解，并且里面有大量的示例。<br><br><a href="http://pangguoming.com/blog/images/8959b78f-9705-47f1-90b8-73b763418392.jpg"><img src="http://pangguoming.com/blog/images/8959b78f-9705-47f1-90b8-73b763418392.jpg" alt=""></a><br><br><strong>8.<a href="https://datachannel.io/" target="_blank" rel="noopener">Datachannel.io</a></strong><br><br>Datachannel.io是一款受socket.io框架启发，使用WebRTC技术实现的实时通信Web应用程序。可以直接进行数据连接，并且无需通过服务器即可进行数据交换操作。<br><br><a href="http://pangguoming.com/blog/images/caf8943c-f92f-4841-b237-072f446524d0.jpg"><img src="http://pangguoming.com/blog/images/caf8943c-f92f-4841-b237-072f446524d0.jpg" alt=""></a><br><br><strong>9.<a href="http://strongloop.com/" target="_blank" rel="noopener">StrongLoop</a></strong><br><br>StrongLoop是一个基于Node.js开发的API服务，它最著名的一款实时性能监测产品叫StrongOps，通常也叫做Nodefly。StrongLoop套件包含了LookBack、StrongOps、StrongNode这三个产品。<br><br><a href="http://pangguoming.com/blog/images/e0bd93b5-b094-4c8b-ac82-b823a953fcdf.jpg"><img src="http://pangguoming.com/blog/images/e0bd93b5-b094-4c8b-ac82-b823a953fcdf.jpg" alt=""></a><br><br><strong>10.<a href="http://marijnhaverbeke.nl//uglifyjs" target="_blank" rel="noopener">UglifyJS</a></strong><br><br>UglifyJS是一个服务端Node.js的压缩程序，里面包含了所有必要的工具和可扩展的文档来帮助开发者提高代码效率。<br><br><a href="http://pangguoming.com/blog/images/99b36d91-9090-4e1d-bba7-18c452eb917e.jpg"><img src="http://pangguoming.com/blog/images/99b36d91-9090-4e1d-bba7-18c452eb917e.jpg" alt=""></a><br><br><strong>11.<a href="http://derbyjs.com/" target="_blank" rel="noopener">Derby</a></strong><br><br>Derby是一个MVC框架，帮助编写实时，交互的应用。可以运行在Node.js或者浏览器环境中。还拥有一个数据同步引擎Racer。推荐两个学习资源给大家：<a href="http://webapplog.com/node-js-mvc-express-js-derby-hello-world-tutorial/" target="_blank" rel="noopener">Node.js MVC：Express.js+Derby.js Hello World教程</a>、使用<a href="http://tech.pro/tutorial/1387/developing-with-derby-js-installation" target="_blank" rel="noopener">Derby.js开发教程</a>。<br><br><a href="http://pangguoming.com/blog/images/c4a957b7-2a66-4e81-bf57-abe715ebd040.jpg"><img src="http://pangguoming.com/blog/images/c4a957b7-2a66-4e81-bf57-abe715ebd040.jpg" alt=""></a><br><br><strong>12.<a href="http://dojotoolkit.org/" target="_blank" rel="noopener">Dojo Toolkit</a></strong><br><br>Dojo Tookkit是一款功能非常强大的JavaScript类库，可以实现任何功能。这里提供一个使用Node.js与Dojo开发的<a href="http://dojotoolkit.org/documentation/tutorials/1.9/node/" target="_blank" rel="noopener">教程</a>。<br><br><a href="http://pangguoming.com/blog/images/edc21a85-50d9-462d-b89c-c2119e5e06ef.jpg"><img src="http://pangguoming.com/blog/images/edc21a85-50d9-462d-b89c-c2119e5e06ef.jpg" alt=""></a><br><br><strong>13.<a href="http://compoundjs.com/" target="_blank" rel="noopener">CompoundJS</a></strong><br><br>CompoundJS 是一个Node.js的MVC框架，开发者使用它在几分钟内即可构建一款Web应用。快速入门<a href="https://github.com/compoundjs/guides/blob/master/basics/crash-course.md" target="_blank" rel="noopener">教程</a>。<br><br><a href="http://pangguoming.com/blog/images/0f633054-3752-41b9-a5f0-c3ab2065c0f3.jpg"><img src="http://pangguoming.com/blog/images/0f633054-3752-41b9-a5f0-c3ab2065c0f3.jpg" alt=""></a><br><br><strong>14.<a href="http://knockoutjs.com/" target="_blank" rel="noopener">KnockoutJS</a></strong><br><br>KnockoutJS是一个轻量级的UI类库，通过应用MVVM模式使JavaScript前端UI简单化。比如列表数据项增减后，不需要重新刷新整个控件片段或自己写JS增删节点，只要预先定义模板和符合其语法定义的属性即可。简单的说，开发者只需要关注数据的存取。<br><br><a href="http://pangguoming.com/blog/images/0e9358c4-a3e4-4314-9f0a-fefaf14794a1.jpg"><img src="http://pangguoming.com/blog/images/0e9358c4-a3e4-4314-9f0a-fefaf14794a1.jpg" alt=""></a><br><br>文章来自：<a href="http://codecondo.com/10-web-application-frameworks-for-node-js/" target="_blank" rel="noopener">CODECONDO</a><br></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/3c717fc0.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/3c717fc0.html" itemprop="url">微软Azure云平台Hbase 的使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-18T09:52:00+08:00">
                2015-01-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="In-this-article"><a href="#In-this-article" class="headerlink" title="In this article"></a>In this article</h2><ul>
<li><a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-hbase-get-started/#hbaseintro" target="_blank" rel="noopener">What is HBase?</a></li>
<li><a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-hbase-get-started/#prerequisites" target="_blank" rel="noopener">Prerequisites</a></li>
<li><a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-hbase-get-started/#create-hbase-cluster" target="_blank" rel="noopener">Provision HBase clusters using Azure Management portal</a></li>
<li><a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-hbase-get-started/#create-sample-table" target="_blank" rel="noopener">Mange HBase tables using HBase shell</a></li>
<li><a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-hbase-get-started/#hive-query" target="_blank" rel="noopener">Use HiveQL to query HBase tables</a></li>
<li><a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-hbase-get-started/#hbase-powershell" target="_blank" rel="noopener">Use the Microsoft HBase REST client library to manage HBase tabels</a></li>
<li><a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-hbase-get-started/#seealso" target="_blank" rel="noopener">See also</a></li>
</ul>
<h2 id="What-is-HBase"><a href="#What-is-HBase" class="headerlink" title="What is HBase?"></a>What is HBase?</h2><p>HBase is a low-latency NoSQL database that allows online transactional processing of big data. HBase is offered as a managed cluster integrated into the Azure environment. The clusters are configured to store data directly in Azure Blob storage, which provides low latency and increased elasticity in performance/cost choices. This enables customers to build interactive websites that work with large datasets, to build services that store sensor and telemetry data from millions of end points, and to analyze this data with Hadoop jobs. For more information on HBase and the scenarios it can be used for, see<span class="Apple-converted-space"> <a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-hbase-overview/" target="_blank" rel="noopener">HDInsight HBase overview</a>.</span></p>
<div class="wa-note wa-note-default"><br><br>##### NOTE:<br><br>HBase (version 0.98.0) is only available for use with HDInsight 3.1 clusters on HDInsight (based on Apache Hadoop and YARN 2.4.0). For version information, see<span class="Apple-converted-space"> <a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-component-versioning/" target="_blank" rel="noopener">What’s new in the Hadoop cluster versions provided by HDInsight?</a></span><br><br>## Prerequisites<br><br>Before you begin this tutorial, you must have the following:<br><br><em>   <strong>An Azure subscription</strong><span class="Apple-converted-space"> For more information about obtaining a subscription, see<span class="Apple-converted-space"> <a href="http://azure.microsoft.com/en-us/pricing/purchase-options/" target="_blank" rel="noopener">Purchase Options</a>,<span class="Apple-converted-space"> <a href="http://azure.microsoft.com/en-us/pricing/member-offers/" target="_blank" rel="noopener">Member Offers</a>, or<span class="Apple-converted-space"> <a href="http://azure.microsoft.com/en-us/pricing/free-trial/" target="_blank" rel="noopener">Free Trial</a>.</span></span></span></span>
</em>   <strong>An Azure storage account</strong><span class="Apple-converted-space"> For instructions, see<span class="Apple-converted-space"> <a href="http://azure.microsoft.com/en-us/documentation/articles/storage-create-storage-account/" target="_blank" rel="noopener">How To Create a Storage Account</a>.</span></span><br><em>   <strong>A workstation</strong><span class="Apple-converted-space"> with Visual Studio 2013 installed. For instructions, see<span class="Apple-converted-space"> <a href="http://msdn.microsoft.com/en-us/library/e2h7fzkw.aspx" target="_blank" rel="noopener">Installing Visual Studio</a>.</span></span><br><br>## Provision an HBase cluster on the Azure portal<br><br>This section describes how to provision an HBase cluster using the Azure Management portal.<br><br><div class="wa-note wa-note-default"><br><br>##### NOTE:<br><br>The steps in this article create an HDInsight cluster using basic configuration settings. For information on other cluster configuration settings, such as using Azure Virtual Network or a metastore for Hive and Oozie, see<span class="Apple-converted-space"> <a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-provision-clusters/" target="_blank" rel="noopener">Provision an HDInsight cluster</a>.</span><br><br><strong>To provision an HDInsight cluster in the Azure Management portal</strong><br><br>1.  Sign in to the<span class="Apple-converted-space"> <a href="https://manage.windowsazure.com/" target="_blank" rel="noopener">Azure Management Portal</a>.</span><br>2.  Click<span class="Apple-converted-space"> <strong>NEW</strong><span class="Apple-converted-space"> on the lower left, and then click<span class="Apple-converted-space"> <strong>DATA SERVICES</strong>,<span class="Apple-converted-space"> <strong>HDINSIGHT</strong>,<span class="Apple-converted-space"> <strong>HBASE</strong>.</span></span></span></span></span><br>3.<br><br>Enter<span class="Apple-converted-space"> <strong>CLUSTER NAME</strong>,<span class="Apple-converted-space"> <strong>CLUSTER SIZE</strong>, CLUSTER USER PASSWORD, and<span class="Apple-converted-space"> <strong>STORAGE ACCOUNT</strong>.</span></span></span><br><br><img src="http://pangguoming.com/blog/images/01615e31-3416-4305-9c58-b7a5ca857bc8.png" alt="Choosing and HBase cluster type and entering cluster login credentials."><br><br>4.<br><br>Click on the check icon on the lower left to create the HBase cluster.<br><br>## Create an HBase sample table from the HBase shell<br><br>This section describes how to enable and use the Remote Desktop Protocol (RDP) to access the HBase shell and then use it to create an HBase sample table, add rows, and then list the rows in the table.<br><br>It assumes you have completed the procedure outlined in the first section, and so have already successfully created an HBase cluster.<br><br><strong>To enable the RDP connection to the HBase cluster</strong><br><br>1.  From the Management portal, click<span class="Apple-converted-space"> <strong>HDINSIGHT</strong><span class="Apple-converted-space"> from the left to view the list of the existing clusters.</span></span><br>2.  Click the HBase cluster where you want to open HBase Shell.<br>3.  Click<span class="Apple-converted-space"> <strong>CONFIGURATION</strong><span class="Apple-converted-space"> from the top.</span></span><br>4.  Click<span class="Apple-converted-space"> <strong>ENABLE REMOTE</strong><span class="Apple-converted-space"> from the bottom.</span></span><br>5.  Enter the RDP user name and password. The user name must be different from the cluster user name you used when provisioning the cluster. The<strong>EXPIRES ON</strong><span class="Apple-converted-space"> data can be up to seven days from today.</span><br>6.  Click the check on the lower right to enable remote desktop.<br>7.  After the RPD is enabled, click<span class="Apple-converted-space"> <strong>CONNECT</strong><span class="Apple-converted-space"> from the bottom of the<span class="Apple-converted-space"> <strong>CONFIGURATION</strong><span class="Apple-converted-space"> tab, and follow the instructions.</span></span></span></span><br><br><strong>To open the HBase Shell</strong><br><br>1.<br><br>Within your RDP session, click on the<span class="Apple-converted-space"> <strong>Hadoop Command Line</strong><span class="Apple-converted-space"> shortcut located on the desktop.</span></span><br><br>2.<br><br>Change the folder to the HBase home directory:<br><br><span class="pln">cd <span class="pun">%<span class="pln">HBASE_HOME<span class="pun">%<span class="pln">\b<span class="kwd">in</span></span></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3.  </span><br><span class="line"></span><br><span class="line">Open the HBase shell:</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;pln&quot;&gt;hbase shell&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br><strong>To create a sample table, add data and retrieve the data</strong><br><br>1.<br><br>Create a sample table:<br><br><span class="pln">create <span class="str">‘sampletable’<span class="pun">,<span class="pln"> <span class="str">‘cf1’</span></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2.  </span><br><span class="line"></span><br><span class="line">Add a row to the sample table:</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;pln&quot;&gt;put &lt;span class=&quot;str&quot;&gt;&apos;sampletable&apos;&lt;span class=&quot;pun&quot;&gt;,&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;str&quot;&gt;&apos;row1&apos;&lt;span class=&quot;pun&quot;&gt;,&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;str&quot;&gt;&apos;cf1:col1&apos;&lt;span class=&quot;pun&quot;&gt;,&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;str&quot;&gt;&apos;value1&apos;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br>3.<br><br>List the rows in the sample table:<br><br><span class="pln">scan <span class="str">‘sampletable’</span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**Check cluster status in the HBase WebUI**</span><br><span class="line"></span><br><span class="line">HBase also ships with a WebUI that helps monitoring your cluster, for example by providing request statistics or information about regions. On the HBase cluster you can find the WebUI under the address of the zookeepernode.</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;pln&quot;&gt;http&lt;span class=&quot;pun&quot;&gt;:&lt;span class=&quot;com&quot;&gt;//zookeepernode:60010/master-status&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br>In a HighAvailability (HA) cluster, you will find a link to the current active HBase master node hosting the WebUI.<br><br><strong>Bulk load a sample table</strong><br><br>    1.<br><br>Create samplefile1.txt containing the following data, and upload to Azure Blob Storage to /tmp/samplefile1.txt:<br><br>    <pre class="prettyprint  prettyprinted"><span class="pln">row1    c1  c2<br>    row2    c1  c2<br>    row3    c1  c2<br>    row4    c1  c2<br>    row5    c1  c2<br>    row6    c1  c2<br>    row7    c1  c2<br>    row8    c1  c2<br>    row9    c1  c2<br>    row10    c1 c2</span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    &lt;/pre&gt;</span><br><span class="line">    2.  </span><br><span class="line"></span><br><span class="line">Change the folder to the HBase home directory:</span><br><span class="line"></span><br><span class="line">    &lt;pre class=&quot;prettyprint  prettyprinted&quot;&gt;&lt;span class=&quot;pln&quot;&gt;cd &lt;span class=&quot;pun&quot;&gt;%&lt;span class=&quot;pln&quot;&gt;HBASE_HOME&lt;span class=&quot;pun&quot;&gt;%&lt;span class=&quot;pln&quot;&gt;\b&lt;span class=&quot;kwd&quot;&gt;in&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br>    </pre><br>    3.<br><br>Execute ImportTsv:<br><br>    <pre class="prettyprint  prettyprinted"><span class="pln">hbase org<span class="pun">.<span class="pln">apache<span class="pun">.<span class="pln">hadoop<span class="pun">.<span class="pln">hbase<span class="pun">.<span class="pln">mapreduce<span class="pun">.<span class="typ">ImportTsv<span class="pln"> <span class="pun">-<span class="typ">Dimporttsv<span class="pun">.<span class="pln">columns<span class="pun">=<span class="str">“HBASE_ROW_KEY,a:b,a:c”<span class="pln"> <span class="pun">-<span class="typ">Dimporttsv<span class="pun">.<span class="pln">bulk<span class="pun">.<span class="pln">output<span class="pun">=<span class="str">/tmpOutput sampletable2 /<span class="pln">tmp<span class="pun">/<span class="pln">samplefile1<span class="pun">.<span class="pln">txt</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    &lt;/pre&gt;</span><br><span class="line">    4.  </span><br><span class="line"></span><br><span class="line">Load the output from prior command into HBase:</span><br><span class="line"></span><br><span class="line">    &lt;pre class=&quot;prettyprint  prettyprinted&quot;&gt;&lt;span class=&quot;pln&quot;&gt;hbase org&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;pln&quot;&gt;apache&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;pln&quot;&gt;hadoop&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;pln&quot;&gt;hbase&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;pln&quot;&gt;mapreduce&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;typ&quot;&gt;LoadIncrementalHFiles&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;pun&quot;&gt;/&lt;span class=&quot;pln&quot;&gt;tmpOutput sampletable2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br>    </pre><br><br>    ## Use Hive to query an HBase table<br><br>Now you have an HBase cluster provisioned and have created an HBase table, you can query it using Hive. This section creates a Hive table that maps to the HBase table and uses it to queries the data in your HBase table.<br><br><strong>To open cluster dashboard</strong><br><br>    1.  Sign in to the<span class="Apple-converted-space"> <a href="https://manage.windowsazure.com/" target="_blank" rel="noopener">Azure Management Portal</a>.</span><br>    2.  Click<span class="Apple-converted-space"> <strong>HDINSIGHT</strong><span class="Apple-converted-space"> from the left pane. You shall see a list of clusters created including the one you just created in the last section.</span></span><br>    3.  Click the cluster name where you want to run the Hive job.<br>    4.  Click<span class="Apple-converted-space"> <strong>QUERY CONSOLE</strong><span class="Apple-converted-space"> from the bottom of the page to open cluster dashboard. It opens a Web page on a different browser tab.<br></span></span><br>    5.  Enter the Hadoop User account username and password. The default username is<span class="Apple-converted-space"> <strong>admin</strong>, the password is what you entered during the provision process. A new browser tab is opened.</span><br>    6.<br><br>Click<span class="Apple-converted-space"> <strong>Hive Editor</strong><span class="Apple-converted-space"> from the top. The Hive Editor looks like :</span></span><br><br><img src="http://pangguoming.com/blog/images/9dac18a8-b602-4c44-94cf-51340d8d8459.png" alt="HDInsight cluster dashboard."><br><br><strong>To run Hive queries</strong><br><br>    1.<br><br>Enter the HiveQL script below into Hive Editor and click<span class="Apple-converted-space"> <strong>SUBMIT</strong><span class="Apple-converted-space"> to create an Hive Table mapping to the HBase table. Make sure that you have created the sampletable table referenced here in HBase using the HBase Shell before executing this statement.</span></span><br><br>    <pre class="prettyprint  prettyprinted"><span class="pln">CREATE EXTERNAL TABLE hbasesampletable<span class="pun">(<span class="pln">rowkey STRING<span class="pun">,<span class="pln"> col1 STRING<span class="pun">,<span class="pln"> col2 STRING<span class="pun">)<span class="pln"><br>    STORED BY <span class="str">‘org.apache.hadoop.hive.hbase.HBaseStorageHandler’<span class="pln"><br>    WITH SERDEPROPERTIES <span class="pun">(<span class="str">‘hbase.columns.mapping’<span class="pln"> <span class="pun">=<span class="pln"> <span class="str">‘:key,cf1:col1,cf1:col2’<span class="pun">)<span class="pln"><br>    TBLPROPERTIES <span class="pun">(<span class="str">‘hbase.table.name’<span class="pln"> <span class="pun">=<span class="pln"> <span class="str">‘sampletable’<span class="pun">);</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Wait until the&lt;span class=&quot;Apple-converted-space&quot;&gt; **Status**&lt;span class=&quot;Apple-converted-space&quot;&gt; is updated to&lt;span class=&quot;Apple-converted-space&quot;&gt; **Completed**.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/pre&gt;</span><br><span class="line">    2.  </span><br><span class="line"></span><br><span class="line">Enter the HiveQL script below into Hive Editor, and then click&lt;span class=&quot;Apple-converted-space&quot;&gt; **SUBMIT**&lt;span class=&quot;Apple-converted-space&quot;&gt; button. The Hive query queries the data in the HBase table:&lt;/span&gt;&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">    &lt;pre class=&quot;prettyprint  prettyprinted&quot;&gt;&lt;span class=&quot;pln&quot;&gt;SELECT count&lt;span class=&quot;pun&quot;&gt;(*)&lt;span class=&quot;pln&quot;&gt; FROM hbasesampletable&lt;span class=&quot;pun&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br>    </pre><br>    3.<br><br>To retrieve the results of the Hive query, click on the<span class="Apple-converted-space"> <strong>View Details</strong><span class="Apple-converted-space"> link in the<span class="Apple-converted-space"> <strong>Job Session</strong><span class="Apple-converted-space"> window when the job finishes executing. The Job Output shall be 1 because you only put one record into the HBase table.</span></span></span></span><br><br><strong>To browse the output file</strong><br><br>    1.  From Query Console, click<span class="Apple-converted-space"> <strong>File Browser</strong><span class="Apple-converted-space"> from the top.</span></span><br>    2.  Click the Azure Storage account used as the default file system for the HBase cluster.<br>    3.  Click the HBase cluster name. The default Azure storage account container uses the cluster name.<br>    4.  Click<span class="Apple-converted-space"> <strong>user</strong>.</span><br>    5.  Click<span class="Apple-converted-space"> <strong>admin</strong>. This is the Hadoop user name.</span><br>    6.  Click the job name with the<span class="Apple-converted-space"> <strong>Last Modified</strong><span class="Apple-converted-space"> time matching the time when the SELECT Hive query ran.</span></span><br>    7.<br><br>Click<span class="Apple-converted-space"> <strong>stdout</strong>. Save the file and open the file with Notepad. The output shall be 1.</span><br><br><img src="http://pangguoming.com/blog/images/6b72e66c-9994-4899-9860-ce35837bf4f4.png" alt="HDInsight HBase Hive Editor File Browser"><br><br>    ## Use HBase REST Client Library for .NET C# APIs to create an HBase table and retrieve data from the table<br><br>The Microsoft HBase REST Client Library for .NET project must be downloaded from GitHub and the project built to use the HBase .NET SDK. The following procedure includes the instructions for this task.<br><br>    1.  Create a new C# Visual Studio Windows Desktop Console application.<br>    2.  Open NuGet Package Manager Console by click the<span class="Apple-converted-space"> <strong>TOOLS</strong><span class="Apple-converted-space"> menu,<span class="Apple-converted-space"> <strong>NuGet Package Manager</strong>,<span class="Apple-converted-space"> <strong>Package Manager Console</strong>.</span></span></span></span><br>    3.<br><br>Run the following NuGet command in the console:<br><br>Install-Package Microsoft.HBase.Client<br><br>    4.<br><br>Add the following using statements on the top of the file:<br><br>    <pre class="prettyprint  prettyprinted"><span class="kwd">using<span class="pln"> <span class="typ">Microsoft<span class="pun">.<span class="typ">HBase<span class="pun">.<span class="typ">Client<span class="pun">;<span class="pln"><br>    <span class="kwd">using<span class="pln"> org<span class="pun">.<span class="pln">apache<span class="pun">.<span class="pln">hadoop<span class="pun">.<span class="pln">hbase<span class="pun">.<span class="pln">rest<span class="pun">.<span class="pln">protobuf<span class="pun">.<span class="pln">generated<span class="pun">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">    &lt;/pre&gt;</span><br><span class="line">    5.  </span><br><span class="line"></span><br><span class="line">Replace the Main function with the following:</span><br><span class="line"></span><br><span class="line">    &lt;pre class=&quot;prettyprint  prettyprinted&quot;&gt;&lt;span class=&quot;kwd&quot;&gt;static&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;kwd&quot;&gt;void&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;typ&quot;&gt;Main&lt;span class=&quot;pun&quot;&gt;(&lt;span class=&quot;kwd&quot;&gt;string&lt;span class=&quot;pun&quot;&gt;[]&lt;span class=&quot;pln&quot;&gt; args&lt;span class=&quot;pun&quot;&gt;)&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;pun&quot;&gt;&#123;&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;kwd&quot;&gt;string&lt;span class=&quot;pln&quot;&gt; clusterURL &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;str&quot;&gt;&quot;https://&lt;yourHBaseClusterName&gt;.azurehdinsight.net&quot;&lt;span class=&quot;pun&quot;&gt;;&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;kwd&quot;&gt;string&lt;span class=&quot;pln&quot;&gt; hadoopUsername&lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;str&quot;&gt;&quot;&lt;yourHadoopUsername&gt;&quot;&lt;span class=&quot;pun&quot;&gt;;&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;kwd&quot;&gt;string&lt;span class=&quot;pln&quot;&gt; hadoopUserPassword &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;str&quot;&gt;&quot;&lt;yourHadoopUserPassword&gt;&quot;&lt;span class=&quot;pun&quot;&gt;;&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;span class=&quot;kwd&quot;&gt;string&lt;span class=&quot;pln&quot;&gt; hbaseTableName &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;str&quot;&gt;&quot;sampleHbaseTable&quot;&lt;span class=&quot;pun&quot;&gt;;&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;span class=&quot;com&quot;&gt;// Create a new instance of an HBase client.&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;typ&quot;&gt;ClusterCredentials&lt;span class=&quot;pln&quot;&gt; creds &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;kwd&quot;&gt;new&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;typ&quot;&gt;ClusterCredentials&lt;span class=&quot;pun&quot;&gt;(&lt;span class=&quot;kwd&quot;&gt;new&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;typ&quot;&gt;Uri&lt;span class=&quot;pun&quot;&gt;(&lt;span class=&quot;pln&quot;&gt;clusterURL&lt;span class=&quot;pun&quot;&gt;),&lt;span class=&quot;pln&quot;&gt; hadoopUsername&lt;span class=&quot;pun&quot;&gt;,&lt;span class=&quot;pln&quot;&gt; hadoopUserPassword&lt;span class=&quot;pun&quot;&gt;);&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;typ&quot;&gt;HBaseClient&lt;span class=&quot;pln&quot;&gt; hbaseClient &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;kwd&quot;&gt;new&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;typ&quot;&gt;HBaseClient&lt;span class=&quot;pun&quot;&gt;(&lt;span class=&quot;pln&quot;&gt;creds&lt;span class=&quot;pun&quot;&gt;);&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;span class=&quot;com&quot;&gt;// Retrieve the cluster version&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;kwd&quot;&gt;var&lt;span class=&quot;pln&quot;&gt; version &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; hbaseClient&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;typ&quot;&gt;GetVersion&lt;span class=&quot;pun&quot;&gt;();&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;typ&quot;&gt;Console&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;typ&quot;&gt;WriteLine&lt;span class=&quot;pun&quot;&gt;(&lt;span class=&quot;str&quot;&gt;&quot;The HBase cluster version is &quot;&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;pun&quot;&gt;+&lt;span class=&quot;pln&quot;&gt; version&lt;span class=&quot;pun&quot;&gt;);&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;span class=&quot;com&quot;&gt;// Create a new HBase table.&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;typ&quot;&gt;TableSchema&lt;span class=&quot;pln&quot;&gt; testTableSchema &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;kwd&quot;&gt;new&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;typ&quot;&gt;TableSchema&lt;span class=&quot;pun&quot;&gt;();&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        testTableSchema&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;pln&quot;&gt;name &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; hbaseTableName&lt;span class=&quot;pun&quot;&gt;;&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        testTableSchema&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;pln&quot;&gt;columns&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;typ&quot;&gt;Add&lt;span class=&quot;pun&quot;&gt;(&lt;span class=&quot;kwd&quot;&gt;new&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;typ&quot;&gt;ColumnSchema&lt;span class=&quot;pun&quot;&gt;()&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;pun&quot;&gt;&#123;&lt;span class=&quot;pln&quot;&gt; name &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;str&quot;&gt;&quot;d&quot;&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;pun&quot;&gt;&#125;);&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        testTableSchema&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;pln&quot;&gt;columns&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;typ&quot;&gt;Add&lt;span class=&quot;pun&quot;&gt;(&lt;span class=&quot;kwd&quot;&gt;new&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;typ&quot;&gt;ColumnSchema&lt;span class=&quot;pun&quot;&gt;()&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;pun&quot;&gt;&#123;&lt;span class=&quot;pln&quot;&gt; name &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;str&quot;&gt;&quot;f&quot;&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;pun&quot;&gt;&#125;);&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        hbaseClient&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;typ&quot;&gt;CreateTable&lt;span class=&quot;pun&quot;&gt;(&lt;span class=&quot;pln&quot;&gt;testTableSchema&lt;span class=&quot;pun&quot;&gt;);&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;span class=&quot;com&quot;&gt;// Insert data into the HBase table.&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;kwd&quot;&gt;string&lt;span class=&quot;pln&quot;&gt; testKey &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;str&quot;&gt;&quot;content&quot;&lt;span class=&quot;pun&quot;&gt;;&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;kwd&quot;&gt;string&lt;span class=&quot;pln&quot;&gt; testValue &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;str&quot;&gt;&quot;the force is strong in this column&quot;&lt;span class=&quot;pun&quot;&gt;;&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;typ&quot;&gt;CellSet&lt;span class=&quot;pln&quot;&gt; cellSet &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;kwd&quot;&gt;new&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;typ&quot;&gt;CellSet&lt;span class=&quot;pun&quot;&gt;();&lt;span class=&quot;pln&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;typ&quot;&gt;CellSet&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;typ&quot;&gt;Row&lt;span class=&quot;pln&quot;&gt; cellSetRow &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;kwd&quot;&gt;new&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;typ&quot;&gt;CellSet&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;typ&quot;&gt;Row&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;pun&quot;&gt;&#123;&lt;span class=&quot;pln&quot;&gt; key &lt;span class=&quot;pun&quot;&gt;=&lt;span class=&quot;pln&quot;&gt; &lt;span class=&quot;typ&quot;&gt;Encoding&lt;span class=&quot;pun&quot;&gt;.&lt;span class=&quot;pln&quot;&gt;UTF8&lt;span class=&quot;pun&quot;&gt;.GetBytes(testKey) &#125;;</span><br><span class="line">        cellSet.rows.Add(cellSetRow);</span><br><span class="line"></span><br><span class="line">        Cell value = new Cell &#123; column = Encoding.UTF8.GetBytes(&quot;d:starwars&quot;), data = Encoding.UTF8.GetBytes(testValue) &#125;;</span><br><span class="line">        cellSetRow.values.Add(value);</span><br><span class="line">        hbaseClient.StoreCells(hbaseTableName, cellSet);</span><br><span class="line"></span><br><span class="line">        // Retrieve a cell by its key.</span><br><span class="line">        cellSet = hbaseClient.GetCells(hbaseTableName, testKey);</span><br><span class="line">        Console.WriteLine(&quot;The data with the key &apos;&quot; + testKey + &quot;&apos; is: &quot; + Encoding.UTF8.GetString(cellSet.rows[0].values[0].data));</span><br><span class="line">        // with the previous insert, it should yield: &quot;the force is strong in this column&quot;</span><br><span class="line"></span><br><span class="line">        //Scan over rows in a table. Assume the table has integer keys and you want data between keys 25 and 35. </span><br><span class="line">        Scanner scanSettings = new Scanner()</span><br><span class="line">        &#123;</span><br><span class="line">            batch = 10,</span><br><span class="line">            startRow = BitConverter.GetBytes(25),</span><br><span class="line">            endRow = BitConverter.GetBytes(35)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ScannerInformation scannerInfo = hbaseClient.CreateScanner(hbaseTableName, scanSettings);</span><br><span class="line">        CellSet next = null;</span><br><span class="line">        Console.WriteLine(&quot;Scan results&quot;);</span><br><span class="line"></span><br><span class="line">        while ((next = hbaseClient.ScannerGetNext(scannerInfo)) != null)</span><br><span class="line">        &#123;</span><br><span class="line">            foreach (CellSet.Row row in next.rows)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(row.key + &quot; : &quot; + Encoding.UTF8.GetString(row.values[0].data));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(&quot;Press ENTER to continue ...&quot;);</span><br><span class="line">        Console.ReadLine();</span><br><span class="line">    &#125;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br>    </pre><br>    6.<br><br>Set the first three variables in the Main function.<br><br>    7.<br><br>Press<span class="Apple-converted-space"> <strong>F5</strong><span class="Apple-converted-space"> to run the application.</span></span><br><br>    ## What’s Next?<br><br>In this tutorial, you have learned how to provision an HBase cluster, how to create tables, and and view the data in those tables from the HBase shell. You also learned how use Hive to query the data in HBase tables and how to use the HBase C# APIs to create an HBase table and retrieve data from the table.<br><br>To learn more, see:

    </div></em>   <a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-hbase-overview/" target="_blank" rel="noopener">HDInsight HBase overview</a>: HBase is an Apache open source NoSQL database built on Hadoop that provides random access and strong consistency for large amounts of unstructured and semi-structured data.<br>    <em>   <a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-hbase-provision-vnet" target="_blank" rel="noopener">Provision HBase clusters on Azure Virtual Network</a>: With the virtual network integration, HBase clusters can be deployed to the same virtual network as your applications so that applications can communicate with HBase directly.
    </em>   <a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-hbase-analyze-twitter-sentiment/" target="_blank" rel="noopener">Analyze Twitter sentiment with HBase in HDInsight</a>: Learn how to do real-time<span class="Apple-converted-space"> <a href="http://en.wikipedia.org/wiki/Sentiment_analysis" target="_blank" rel="noopener">sentiment analysis</a><span class="Apple-converted-space"> of big data using HBase in an Hadoop cluster in HDInsight.</span></span><br></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/ab6169ed.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/ab6169ed.html" itemprop="url">sql server 导出数据到 Azure Hbase / Hive 详细步骤</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-17T14:35:00+08:00">
                2015-01-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="The-Hadoop-on-Azure-Sqoop-Import-Sample-Tutorial"><a href="#The-Hadoop-on-Azure-Sqoop-Import-Sample-Tutorial" class="headerlink" title="The Hadoop on Azure Sqoop Import Sample Tutorial"></a>The Hadoop on Azure Sqoop Import Sample Tutorial</h1><div class="table-of-contents"><br><br>## Table of Contents<br><br><div class="hierarchy-list-header"><br><br><em>   <a href="http://social.technet.microsoft.com/wiki/contents/articles/13817.the-hadoop-on-azure-sqoop-import-sample-tutorial.aspx#Overview" target="_blank" rel="noopener">Overview</a><br><div class="hierarchy-list-header"> 

    </div></em>   <a href="http://social.technet.microsoft.com/wiki/contents/articles/13817.the-hadoop-on-azure-sqoop-import-sample-tutorial.aspx#Goals" target="_blank" rel="noopener">Goals</a><br>    <em>   <a href="http://social.technet.microsoft.com/wiki/contents/articles/13817.the-hadoop-on-azure-sqoop-import-sample-tutorial.aspx#technologies" target="_blank" rel="noopener">Key technologies</a>
    </em>   <a href="http://social.technet.microsoft.com/wiki/contents/articles/13817.the-hadoop-on-azure-sqoop-import-sample-tutorial.aspx#setup" target="_blank" rel="noopener">Setup and Configuration</a><br><div class="hierarchy-list-footer"><br></div></div><br><em>   <a href="http://social.technet.microsoft.com/wiki/contents/articles/13817.the-hadoop-on-azure-sqoop-import-sample-tutorial.aspx#Tutorial" target="_blank" rel="noopener">Tutorial</a><br><div class="hierarchy-list-header"> 

    </div></em>   <a href="http://social.technet.microsoft.com/wiki/contents/articles/13817.the-hadoop-on-azure-sqoop-import-sample-tutorial.aspx#segment1" target="_blank" rel="noopener">How to set up a SQL database</a><br>    <em>   <a href="http://social.technet.microsoft.com/wiki/contents/articles/13817.the-hadoop-on-azure-sqoop-import-sample-tutorial.aspx#segment2" target="_blank" rel="noopener">How to use Sqoop from Hadoop on Azure to import SQL Database query results to the HDFS cluster in Hadoop On Azure.</a><br><div class="hierarchy-list-footer"><br></div></em></div>
   <a href="http://social.technet.microsoft.com/wiki/contents/articles/13817.the-hadoop-on-azure-sqoop-import-sample-tutorial.aspx#summary" target="_blank" rel="noopener">Summary</a><br><div class="hierarchy-list-footer"><br><br># Overview<br><br>This tutorial shows how to use Sqoop to import data from a SQL database on Windows Azure to an Hadoop on Azure HDFS cluster.<br><br>While Hadoop is a natural choice for processing unstructured and semi-structured data, such as logs and files, there may also be a need to process structured data stored in relational databases.<br><br>Sqoop is a tool designed to transfer data between Hadoop and relational databases. You can use it to import data from a relational database management system (RDBMS) such as SQL or MySQL or Oracle into the Hadoop Distributed File System (HDFS), transform the data in Hadoop with MapReduce or Hive, and then export the data back into an RDBMS. In this tutorial, you are using a SQL Database for your relational database.<br><br><span style="color: #2a2a2a;">Sqoop is an open source software product of Cloudera, Inc. <span style="color: #2a2a2a;">Software development for Sqoop has recently moved from gitHub to the <a href="http://sqoop.apache.org/" target="_blank" rel="noopener">Apache Sqoop <img src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" alt="" title="This link is external to TechNet Wiki. It will open in a new window."> </a><span style="color: #2a2a2a;"> site.<br><br> In Hadoop on Azure, Sqoop is deployed from the Hadoop Command Shell on the head node of the HDFS cluster. You use the Remote Desktop feature available in the Hadoop on Azure portal to access the head node of the cluster for this deployment.</span></span></span><br><br>## Goals<br><br>In this tutorial, you see three things:<br><br>1.<br><br>How to set up a SQL database on Windows Azure for use with the tutorial.<br><br>2.<br><br>How to use the Remote Desktop feature in Hadoop on Azure to access the head node of the HDFS cluster.<br><br>3.<br><br>How to import relational data from SQL Server to a Hadoop on Azure HDFS cluster by using Sqoop.<br><br>## Key technologies<br><br><em>   <a href="http://www.windowsazure.com/" target="_blank" rel="noopener">Windows Azure <img src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" alt="" title="This link is external to TechNet Wiki. It will open in a new window."> </a>

</em>   <a href="http://www.hadooponazure.com/" target="_blank" rel="noopener">Hadoop on Azure <img src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" alt="" title="This link is external to TechNet Wiki. It will open in a new window."> </a><br><em>   <a href="http://www.microsoft.com/en-us/download/details.aspx?id=27584" target="_blank" rel="noopener">Sqoop <img src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" alt="" title="This link is external to TechNet Wiki. It will open in a new window."> </a><br><br>## Setup and Configuration<br><br>You must have an account to access Hadoop on Azure and have created a cluster to work through this tutorial. To obtain an account and create an Hadoop cluster, follow the instructions outlined in the </em>Getting started with Microsoft Hadoop on Azure<em> section of the </em>Introduction to Hadoop on Azure<em> topic.<br><br>You will also need your outward facing IP address for your current location when configuring your firewall on SQL Database. To obtain it, go to the site <a href="http://www.whatismyip.com/" target="_blank" rel="noopener">WhatIsMyIP <img src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" alt="" title="This link is external to TechNet Wiki. It will open in a new window."> </a> and make a note of it. Later in the procedure, you also need the outward facing IP address for the head of the Hadoop cluster. You can obtain this IP address in the same way.

</em> <em> </em><br><br># Tutorial<br><br>This tutorial is composed of the following segments:<br><br>1.<br><br><a href="http://social.technet.microsoft.com/wiki/contents/articles/13817.the-hadoop-on-azure-sqoop-import-sample-tutorial/edit.aspx#segment1" target="_blank" rel="noopener">How to set up a SQL database</a>.<br><br>2.<br><br><a href="http://social.technet.microsoft.com/wiki/contents/articles/13817.the-hadoop-on-azure-sqoop-import-sample-tutorial/edit.aspx#segment2" target="_blank" rel="noopener">How to use Sqoop from Hadoop on Azure to import data to the HDFS cluster</a>.<br><br>## How to set up a SQL database<br><br>Log in into your Windows Azure account. To create a database server, click the <strong>Database</strong> icon in the lower left-hand corner on the page.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5466.WindowsAzureCreateNewDb.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5466.WindowsAzureCreateNewDb.PNG" alt=" "></a><br><br>On the <strong>Getting Started</strong> page, click the <strong>Create a new SQL Database Server</strong> option.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/0880.WindowsAzure_2D00_CreateNewSqlAzureServer.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/0880.WindowsAzure_2D00_CreateNewSqlAzureServer.PNG" alt=" "></a><br><br>Select the type of subscription (such as <strong>Pay-As-You-Go</strong>) associated with you account in the <strong>Create Server</strong> window and press <strong>Next</strong>.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8103.WindowsAzure_2D00_CreateServerWindow.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8103.WindowsAzure_2D00_CreateServerWindow.PNG" alt=" "></a><br><br>Select the appropriate <strong>Region</strong> in the <strong>Create Server</strong> window and click <strong>Next</strong>.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8741.WindowsAzure_2D00_CreateServerWindow_2D00_Region.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8741.WindowsAzure_2D00_CreateServerWindow_2D00_Region.PNG" alt=" "></a><br><br>Specify the login and password of the server-level principal of your SQL Database server and then press <strong>Next</strong>.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3465.WindowsAzure_2D00_CreateServer_2D00_Credentials.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3465.WindowsAzure_2D00_CreateServer_2D00_Credentials.PNG" alt=" "></a><br><br>Press <strong>Add</strong> to specify a firewall rule that allows your current location access to SQL Database to upload the AdventureWorks database. The firewall grants access based on the originating IP address of each request. Use the IP address found with the configuration preliminaries of this tutorial for the values to add. Specify a Rule name, such as shown, but remember to use your IP address, not the one used for illustration purposes below. (You must also add the outward IP address of the head node in you Hadoop cluster. If you know it already, add it now.) Then press the <strong> Finish</strong> button.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7026.SqoopAddFirewallRule.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7026.SqoopAddFirewallRule.PNG" alt=" "></a><br><br>Download the AdventureWorks2012 database onto your local machine from Recommended Downloads link on the Adventure Works for SQL Database site.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1185.AdventureWorksForSqlAzureDownload.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1185.AdventureWorksForSqlAzureDownload.PNG" alt=" "></a><br><br>Unzip the file, open an Administrator Command Prompt, and navigate to the AdventureWorks directory inside the AdventureWorks2012ForSQLAzure folder.<br><br>Run <strong>CreateAdventureWorksForSQLAzure.cmd</strong> by typing the following:<br><br><code>CreateAdventureWorksForSQLAzure.cmd servername username password</code><br><br>For example, if the assigned SQL Database server is named b1gl33p, the administrator user name “Fred”, and the password “Secret”, you would type the following:<br><br><code>CreateAdventureWorksForSQLAzure.cmd b1gl33p.database.windows.net Fred@b1gl33p Secret</code><br><br>The script creates the database, installs the schema, and populates the database with sample data.<br><br>Return to the <strong>WindowsAzurePlatform</strong> portal page, click your subscription on the left-hand side (<strong>Pay-As-You-Go</strong> in the example below) and select your database (here named wq6xlbyoq0). The AventureWorks2012 should be listed in the <strong>Database Name</strong> column. Select it and press the <strong>Manage</strong> icon at the top of the page.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6646.SqlAzureManageAdventureWorks.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6646.SqlAzureManageAdventureWorks.PNG" alt=" "></a><br><br>Enter the credentials for the SQL database when prompted and press <strong>Log on</strong>.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1185.SqlAzureLogon.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1185.SqlAzureLogon.PNG" alt=" "></a><br><br>This opens the Web interface for the Adventure Works database on SQL Database. Press the <strong>New Query</strong> icon at the top to open the query editor.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1374.adventure_2D00_works_2D00_web_2D00_interface.png" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1374.adventure_2D00_works_2D00_web_2D00_interface.png" alt=" "></a><br><br>Since Sqoop currently adds square brackets to the table name, we need to add a synonym to support two-part naming for SQL Server tables. To do so, run the following query:<br><br><code>CREATE SYNONYM [Sales.SalesOrderDetail] FOR Sales.SalesOrderDetail</code><br><br>Run the following query and review its result.<br><br><code>select top 200 * from [Sales.SalesOrderDetail]</code><br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6428.AdventureWorksQueryResults.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6428.AdventureWorksQueryResults.PNG" alt=" "></a><br><br>## How to use Sqoop from Hadoop on Azure to import SQL Database query results to the HDFS cluster in Hadoop<br> On Azure.<br><br>From your Account page, scroll down to the <strong>Open Ports</strong> icon in the <strong>Your cluster</strong> section and click the icon to open the ODBC Server port on the head node in your cluster.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3010.accountpageyourcluster.png" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3010.accountpageyourcluster.png" alt=" "></a><br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6445.ConfigurePortsOpenODBC.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6445.ConfigurePortsOpenODBC.PNG" alt=" "></a><br><br>Return to your Account page, scroll down to the <strong>Your cluster</strong> section and click the <strong>Remote Desktop</strong> icon this time to open the head node in your cluster.<br><br>Select <strong>Open</strong> when prompted to open the .rdp file.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5327.RemoteDesktopOpenRpdFile.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5327.RemoteDesktopOpenRpdFile.PNG" alt=" "></a><br><br>Select <strong>Connect</strong> in the Remote Desktop Connection window.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8015.RemoteDesktopConnectionWindow.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8015.RemoteDesktopConnectionWindow.PNG" alt=" "></a><br><br>Enter your credentials for the Hadoop cluster (not your Hadoop on Azure account) into the <strong>Windows Security</strong> window and select <strong>OK</strong>.<br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6303.RemoteDesktopWindowsSecurity.PNG" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6303.RemoteDesktopWindowsSecurity.PNG" alt=" "></a><br><br>Open Internet Explorer and go to the site <a href="http://www.whatismyip.com/" target="_blank" rel="noopener"> WhatIsMyIP <img src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" alt="" title="This link is external to TechNet Wiki. It will open in a new window."> </a> to obtain the outward facing IP address for the head node of the cluster. Return the SQL Database management page and add a firewall rule that allows your Hadoop cluster access to SQL Database. The firewall grants access based on the originating IP address of each request.<br><br>Double-click on the <strong>Hadoop Command Shell</strong> icon in the upper left hand of the Desktop to open it. Navigate to the <em>“c:\Apps\dist\sqoop\bin”</em> directory and run the following command:<br><br> sqoop import –connect “jdbc:sqlserver://[serverName].database.windows.net;username=[userName]@[serverName];password=[password];database=AdventureWorks2012” –table Sales.SalesOrderDetail –target-dir /data/lineitemData -m 1<br><br>So, for example, for the following values:<br> <em> server name: wq6xlbyoq0  
 </em> username: HadoopOnAzureSqoopAdmin<br> <em> password: Pa$$w0rd<br><br>The sqoop command is:<br><br> sqoop import –connect “jdbc:sqlserver://wq6xlbyoq0.database.windows.net;username=HadoopOnAzureSqoopAdmin@wq6xlbyoq0;password=Pa$$w0rd;;database=AdventureWorks2012” –table Sales.SalesOrderDetail –target-dir /data/lineitemData -m 1<br><br>Return to the <strong>Accounts</strong> page of the Hadoop on Azure portal and open the <strong>Interactive Console</strong> this time. Run the #lsr command from the JavaScript console to list the files and directories on your HDFS cluster.<br><br> <a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/0537.resultofscoopimport.png" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/0537.resultofscoopimport.png" alt=" "></a><br><br>Run the #tail command to view selected results from the <strong>part-m-0000</strong> file.<br><br> <code>tail /user/RAdmin/data/SalesOrderDetail/part-m-00000</code><br><br><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6472.ScoopTailCmdResults.png" target="_blank" rel="noopener"><img src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6472.ScoopTailCmdResults.png" alt=" "></a>

</em> <em> </em><br><br># Summary<br><br>In this tutorial, you have seen how to use Sqoop to import data from a SQL database on Windows Azure to an Hadoop on Azure HDFS cluster.<br></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/39/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/39/">39</a><span class="page-number current">40</span><a class="page-number" href="/page/41/">41</a><a class="page-number" href="/page/42/">42</a><a class="extend next" rel="next" href="/page/41/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4" alt="庞国明">
            
              <p class="site-author-name" itemprop="name">庞国明</p>
              <p class="site-description motion-element" itemprop="description">Software make the information world run, and programer make the softeware run.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">420</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">267</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/pangguoming" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:pangguoming@yeah.net" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/pangguoming" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/1570700/pangguoming" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/pangguoming" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i>Instagram</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">庞国明</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  

  

  
  

  

  

  

</body>
</html>
