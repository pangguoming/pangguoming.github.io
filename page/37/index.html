<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Software make the information world run, and programer make the softeware run.">
<meta property="og:type" content="website">
<meta property="og:title" content="庞国明-博客">
<meta property="og:url" content="http://pangguoming.com/page/37/index.html">
<meta property="og:site_name" content="庞国明-博客">
<meta property="og:description" content="Software make the information world run, and programer make the softeware run.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="庞国明-博客">
<meta name="twitter:description" content="Software make the information world run, and programer make the softeware run.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://pangguoming.com/page/37/">





  <title>庞国明-博客</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">庞国明-博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">此心用度八千遍，不曾厌倦</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/1ef30ac9.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/1ef30ac9.html" itemprop="url">Ubuntu下VIM的安装和基本用法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-02-23T20:59:00+08:00">
                2016-02-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><div id="article_content" class="article_content"> <span><span>1.用root账户登录Ubuntu，命令行中输入vim，如果未安装会得到下面的提示：<br></span></span></div></p>
<p><div></div></p>
<p><div>程序“vim”已包含在下列软件包中：</div></p>
<p><div> * vim</div></p>
<p><div> * vim-gnome</div></p>
<p><div> * vim-tiny</div></p>
<p><div> * vim-gtk</div></p>
<p><div> * vim-nox</div></p>
<p><div>请尝试：apt-get install &lt;选定的软件包&gt;</div></p>
<div>  

<p><div>按照提示输入apt-get install vim安装。</div></p>
<div>  

<p><div>2.安装完成后，输入vim会进入vim的标准模式，这时按键盘的i进入插入模式，在里面写点什么吧。</div></p>
<div>  

<p><div>3.按Esc推出插入模式，进入标准模式，在这个模式下有几个基本命令要掌握。</div></p>
<div>

<ul>
<li>:wq 保存推出</li>
<li>i 进入插入模式</li>
<li>x 删除当前光标的字符</li>
<li>dd 删除当前行，并且保存当前行到剪切板</li>
<li>p 粘贴</li>
<li>:help <command> 查看命令的帮助</li>
<li>上下左右移动光标<br><div>4.输入:w filename 保存文件到当前目录。</div></li>
</ul>
<div>  

<p><div>5.:q退出vim页面。</div></p>
<div>  

<p><div>6.下次输入vim filename就可以编辑或者查看这个文件了。</div></p>
</div></div></div></div></div></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/6f868127.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/6f868127.html" itemprop="url">Ubuntu 修复windows启动项</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-02-23T20:37:00+08:00">
                2016-02-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>打开终端输入命令<br>sudo gedit /etc/default/grub<br>修改GRUB_TIMEOUT=”10”<br>然后在终端中输入sudo update-grub<br>update 命令会自动找到 windows 7 启动项。并且自动更新 /boot/grub/grub.cfg 文件。这样重启就能进windows了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/64720224.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/64720224.html" itemprop="url">制作ubuntu安装u盘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-02-23T14:22:00+08:00">
                2016-02-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="exp-content-block"><br><div class="exp-content-body exp-brief-step"><br><div class="exp-content-listblock"><br><div class="content-listblock-text"><br><br>Ubuntu官方中文译名为友帮拓，是一款开源免费的linux操作系统。与其他的linux操作系统不同之处在于Ubuntu的软件包清单只包含那些高质量的重要应用程序，因此深受广大linux用户的喜爱，那么ubuntu怎样安装呢？下面就跟小编一起来看看怎么用u盘安装ubuntu系统（因为现在很多的台式电脑已经没有光驱了）。<br><br><div class="exp-content-block"><br><br>## 工具/原料<br><br><div class="exp-content-body"><br><br>*   <div class="content-list-text"><br><br>U盘，ubuntu操作系统的iso文件，UltraISO软件。<br><br></div>

<div class="exp-content-block"><br><br>## 安装步骤<br><br><div class="exp-content-body"><br><br>1.  <div class="list-icon"><br><div class="content-list-text"><br><br>首先我们要来下载Ubuntu操作系统，操作系统的下载可以到Ubuntu的中文官方网站进行下载，也可以到其他的软件网站进行下载，但是到其他地方下载的时候一定要注意到大型的软件网站，以免中毒，下载的时候注意下载ISO格式的。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/a3761b2b66fe141577f9aa51.html?picindex=1" target="_blank" rel="noopener"><img src="http://h.hiphotos.baidu.com/exp/w=500/sign=aff8b84665380cd7e61ea2ed9145ad14/9c16fdfaaf51f3deab09fe9294eef01f3b297988.jpg" alt="怎么用u盘安装ubuntu"></a><br><br></div></div></div></div><br>2.  <div class="list-icon"><br><div class="content-list-text"><br><br>接着我们就要下载UltraISO软碟通，用于制作U盘启动盘。这个软件小编没有找到官网，我们只有到各大软件网站进行下载，还是那句话，下载的时候一定要小心。完成下载之后，我们就可以进行软件的安装了，安装过程很简单，小编不再复述了。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/a3761b2b66fe141577f9aa51.html?picindex=2" target="_blank" rel="noopener"><img src="http://b.hiphotos.baidu.com/exp/w=500/sign=4dd4fed601e9390156028d3e4bed54f9/0823dd54564e9258e004c0189c82d158ccbf4e17.jpg" alt="怎么用u盘安装ubuntu"></a><br><br></div></div></div></div><br>3.  <div class="list-icon"><br><div class="content-list-text"><br><br>安装之后我们打开软件，点击文件打开，找到我们刚才进行下载的Ubuntu的ISO文件，然后点击打开，完成ISO文件的加载。接着我们插入U盘，点击UltraISO启动选项，然后找到写入硬盘映像选项，点击它进入到将要进行操作的界面。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/a3761b2b66fe141577f9aa51.html?picindex=3" target="_blank" rel="noopener"><img src="http://h.hiphotos.baidu.com/exp/w=500/sign=096618a60c3387449cc52f7c610ed937/b3b7d0a20cf431ad34ad05cf4b36acaf2fdd98cd.jpg" alt="怎么用u盘安装ubuntu"></a><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/a3761b2b66fe141577f9aa51.html?picindex=4" target="_blank" rel="noopener"><img src="http://d.hiphotos.baidu.com/exp/w=500/sign=3a9bcb5fa9014c08193b28a53a7a025b/0b46f21fbe096b63259b18a60c338744eaf8ac42.jpg" alt="怎么用u盘安装ubuntu"></a><br><br></div></div></div></div></div><br>4.  <div class="list-icon"><br><div class="content-list-text"><br><br>此时如果你插入了U盘就可以看到，如果你插入的U盘很多的话，一定要注意选择自己需要进行操作的U盘，然后点击便捷启动，写入新的驱动器引导区写入新的驱动器引导区写入新的驱动器引导区写入新的驱动器引导区–Syslinux，然后点击确定。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/a3761b2b66fe141577f9aa51.html?picindex=5" target="_blank" rel="noopener"><img src="http://h.hiphotos.baidu.com/exp/w=500/sign=faa8a50ea786c91708035239f93c70c6/962bd40735fae6cd14ebea970fb30f2443a70fec.jpg" alt="怎么用u盘安装ubuntu"></a><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/a3761b2b66fe141577f9aa51.html?picindex=6" target="_blank" rel="noopener"><img src="http://e.hiphotos.baidu.com/exp/w=500/sign=7da038ce6e061d957d4637384bf50a5d/bf096b63f6246b60d892f382ebf81a4c500fa2ac.jpg" alt="怎么用u盘安装ubuntu"></a><br><br></div></div></div></div></div><br>5.  <div class="list-icon"><br><div class="content-list-text"><br><br>接着我们就需要最后一步操作了，点击写入按钮，会弹出再次确认是否是你需要写入的U盘，点击确定后开始写入，完成了之后我们就可以使用U盘启动盘了。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/a3761b2b66fe141577f9aa51.html?picindex=7" target="_blank" rel="noopener"><img src="http://e.hiphotos.baidu.com/exp/w=500/sign=2ec622ea11dfa9ecfd2e561752d1f754/d8f9d72a6059252d083f5df2349b033b5bb5b918.jpg" alt="怎么用u盘安装ubuntu"></a><br><br></div></div></div></div><br>6.  <div class="list-icon"><br><div class="content-list-text"><br><br>在进行U盘安装系统之前，我们还需要设置BIOS选项，因为默认的是硬盘启动，因此我们需要进行设置为U盘启动，不同的主板设置U盘启动的方式也不同，因此小编就不在此详述怎么更改BIOS设置，大家查找自己的主板型号然后在网上找相关的设置教程即可。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/a3761b2b66fe141577f9aa51.html?picindex=8" target="_blank" rel="noopener"><img src="http://d.hiphotos.baidu.com/exp/w=500/sign=8ddce8d0fdfaaf5184e381bfbc5594ed/960a304e251f95ca920fd240c9177f3e66095249.jpg" alt="怎么用u盘安装ubuntu"></a><br><br></div></div></div></div><br>7.  <div class="list-icon"><br><div class="content-list-text"><br><br>完成BIOS设置后我们就可以插入U盘，重启电脑了，我们就可以使用U盘进行Ubuntu操作系统的安装了，具体的安装步骤小编就不在详述了，网上有很多相关的教程，大家可以参考下。<br><br><div class="content-list-media"><br><div class="content-list-image clearfix"><a href="http://jingyan.baidu.com/album/a3761b2b66fe141577f9aa51.html?picindex=9" target="_blank" rel="noopener"><img src="http://e.hiphotos.baidu.com/exp/w=500/sign=9683a6640cf431adbcd243397b37ac0f/2cf5e0fe9925bc317854426e5edf8db1cb13703e.jpg" alt="怎么用u盘安装ubuntu"></a><br><br><div class="last-item"><span class="last-item-end">END</span><br></div></div></div></div></div>

<div class="exp-content-block"><br><br>## 注意事项<br><br><div class="exp-content-body"><br><br><em>   <div class="content-list-text"><br><br>下载Ubuntu操作系统的时候一定要注意，如果你对linux操作系统不是很熟悉的情况下，建议你下载桌面版本，小编就是在不知道的情况下下载了服务器版本，都是命令行操作，难为死我了。<br><br></div>
</em>   <div class="content-list-text"><br><br>由于小编的U盘中有东西，所以不便进行U盘启动盘的制作，只是按照网上现有的方法进行，至于效果如何小编没有做确认。<br><br></div>

<p></p></div></div></div></div></div></div></div></div></div></div><p></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/64161217.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/64161217.html" itemprop="url">PowerDesigner使用教程|使用方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-02-18T16:42:00+08:00">
                2016-02-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div><br><div><strong>PowerDesigner安装方法:</strong><br><br> <a href="http://dev.firnow.com/course/3_program/java/javajs/20090908/174375.html" target="_blank" rel="noopener">http://dev.firnow.com/course/3_program/java/javajs/20090908/174375.html</a><br><br>安装完这2个软件了,接着就开始使用吧,还是和以前一样,先提出需求,再做实例,因为我们之所以使用它们,肯定是因为它们能巧妙的解决某种问题,不然我们干嘛花那么多时间和硬盘空间安装它们.<br><br>好,我们现在的需求是:希望当接到一个新的工程项目时,程序员只需要根据项目需求,设计出数据库的结构(表,表的字段,表间关系),之后只要按<strong>一个按键</strong>,就能立刻得到基于该数据库的所有<strong>分层架构代码文件</strong>.也就是说,<strong>我们希望能在不敲一行代码的情况下获取所有我们想要的代码</strong>!而这就是这2个软件能做到的事情,也是我们安装它们的目的.<br><br>好了,角色已经介绍完了,接着看看它们是如何演绎这场精彩的演出的吧:<br><br>首先我们需要创建一个测试数据库,为了简单,我们在这个数据库中只创建一个<strong>Student**</strong>表<strong>和一个</strong>Major<strong>**表</strong>.其表结构和关系如下所示.<br><br><img src="http://pangguoming.com/blog/images/54e8de9e-c5be-48fe-a19b-c1409ba7ec13.jpg" alt=""><br><br>看看怎样用PowerDesigner快速的创建出这个数据库吧.<br><br>1.现在开始使用PowerDesigner创建数据库,首先运行程序,进入主界面:<br><br><img src="http://pangguoming.com/blog/images/8901b18d-2942-44a9-b300-f6a5a0ef4690.jpg" alt=""><br><br><strong>2.File—New Model—Physical Data Model—Physical Diagram—Model name</strong> 设置为<strong>test</strong>,DBMS属性设置为<strong>Microsoft SQL Server 2005</strong>:<br><br><img src="http://pangguoming.com/blog/images/fdea2f1f-aab6-41a1-ad0d-13ce49bb176d.jpg" alt=""><br><br>3.首先用表格工具创建一个表格模板:<br><br><img src="http://pangguoming.com/blog/images/03713b9b-7bee-410b-9b37-b98231cce026.jpg" alt=""><br><br>4.双击表格模板,设置属性,我们首先设置<strong>Major</strong>表:<br><br><img src="http://pangguoming.com/blog/images/2da816a2-b426-4e16-9e43-f83f8e40ebd1.jpg" alt=""><br><br>5.设置好表名,点击<strong>Columns</strong>标签,设置字段属性,设置如图所示:<br><br><img src="http://pangguoming.com/blog/images/bafdcbe2-f5f5-4e82-83c8-810175c543f8.jpg" alt=""><br><br>6.因为MajorID字段我们要设置为<strong>自动增长</strong>,所以要设置它的高级属性,选择MajorID字段,点击属性按钮,在General面板中勾选上Identity复选框:<br><br><img src="http://pangguoming.com/blog/images/5cee6984-dfd9-4c71-aa4f-dfc0aba5f42c.jpg" alt=""><br><br>7.确定后我们再创建一个Student表,字段设置如图所示:<br><br><img src="http://pangguoming.com/blog/images/03204492-2739-4464-8375-c385f4c892b5.jpg" alt=""><br><br>8.接着是为Student创建一个MajorID外键,使用PowerDesigner可以很轻松的完成这个工作,选择关系设置工具,在Student表上按住左键不放,拖拽至Major表,便可为Student表添加一个MajorID的外键:<br><br><img src="http://pangguoming.com/blog/images/8a15fc35-29f4-4e65-a207-e0c847146b86.jpg" alt=""><br><br>9.哈哈,现在测试表已经设置好了,接着设置一下我们要生成的数据库吧,这些表都将被创建到该数据库中,我们在设计面板空白处<strong>右键**</strong>—Properties<strong>,在弹出的属性设置对话框设置如下:<br><br> <img src="http://pangguoming.com/blog/images/3d6d94e1-5dac-4367-94f9-de8c3133cd99.jpg" alt=""><br><br>10好了,在此我们对新数据库的设置已经完成,但是在SQL中还是空空如也啊,我们要怎么把这边设计好的结构移植到SQLServer 2005中呢?执行操作:</strong>Database—Generate Database*<em>,设置好存储过程导出目录和文件名,点击确定即可:<br><br><img src="http://pangguoming.com/blog/images/9224789f-7d3f-4bf3-b46c-cb9e41456201.jpg" alt=""><br><br>11.到你的导出目录,就可以看见导出的数据库创建存储过程了,打开SQL,执行一下,你就会看到数据库被神奇的创建好了:<br><br><img src="http://pangguoming.com/blog/images/50a7df07-bb86-48ba-a450-a5b278d9892b.jpg" alt=""><br><br><img src="http://pangguoming.com/blog/images/f826a651-f5a3-4ae9-9cbb-1b9ca38bf95f.jpg" alt=""><br><br>12.好了,数据库的准备工作做好了,下一篇我们就将使用该数据库结合CodeSmith自动批量生成代码啦~<br><br>上述实践中生成的源代码:<br><br><div><img src="https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="">SQL.sql<br><div id="cnblogs_code_open_e5d1f72f-ed9a-45b0-8ebf-6f56f69faddb"><br><br>/</div></div></em>==============================================================<em>/<br><br>    /</em> Database name:  PD_test                                      <em>/<br><br>    /</em> DBMS name:      Microsoft SQL Server 2005                    <em>/<br><br>    /</em> Created on:     2010/6/13 星期日 17:27:17                       <em>/<br><br>    /</em>==============================================================<em>/<br><br>    drop database PD_test<br><br>    go<br><br>    /</em>==============================================================<em>/<br><br>    /</em> Database: PD_test                                            <em>/<br><br>    /</em>==============================================================<em>/<br><br>    create database PD_test<br><br>    go<br><br>    use PD_test<br><br>    go<br><br>    /</em>==============================================================<em>/<br><br>    /</em> Table: Major                                                 <em>/<br><br>    /</em>==============================================================<em>/<br><br>    create table Major (<br><br>    MajorID              int identity,<br><br>    Name                 nvarchar(20)         not null,<br><br>    Remark               nvarchar(Max)        null,<br><br>    constraint PK_MAJOR primary key (MajorID)<br><br>    )<br><br>    go<br><br>    /</em>==============================================================<em>/<br><br>    /</em> Table: Student                                               <em>/<br><br>    /</em>==============================================================*/<br><br>    create table Student (<br><br>    StudentID            nvarchar(20)         not null,<br><br>    MajorID              int null,<br><br>    Name                 nvarchar(20)         not null,<br><br>    Sex                  bit not null,<br><br>    Age                  int null,<br><br>    Remark               nvarchar(Max)        null,<br><br>    constraint PK_STUDENT primary key (StudentID)<br><br>    )<br><br>    go<br><br>    alter table Student<br><br>    add constraint FK_STUDENT_REFERENCE_MAJOR foreign key (MajorID)<br><br>    references Major (MajorID)<br><br>    go<code>`</code><br><br></div></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/b1f13d4b.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/b1f13d4b.html" itemprop="url">使用ServiceStack构建Web服务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-02-18T13:31:00+08:00">
                2016-02-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>提到构建WebService服务，大家肯定第一个想到的是使用WCF，因为简单快捷嘛。首先要说明的是，本人对WCF不太了解，但是想快速建立一个WebService，于是看到了MSDN上的这一篇文章 <a href="http://msdn.microsoft.com/zh-cn/magazine/dn342871.aspx" target="_blank" rel="noopener">Building Cross-Platform Web Services with ServiceStack</a>，所以这里简要介绍一下如何使用ServiceStack快速建立一个WebService服务。</p>
<p>当然，在开始之前，首先要说明一下ServiceStack是个什么东西。 在国内用ServiceStack的似乎很少，大部分都是WCF或者ASP.NET WebAPI，唯一接触ServiceStack的可能是在C# 中调用Redis的时候，有个<a href="https://github.com/ServiceStack/ServiceStack.Redis" target="_blank" rel="noopener">ServiceStack.Redis</a>，之前还写过一篇<a href="http://www.cnblogs.com/yangecnu/p/Introduct-Redis-in-DotNET.html" target="_blank" rel="noopener"> .NET中使用Redis</a> 的拙文。这个ServiceStack.Redis其实就是ServiceStack的一个组件，专门用来跟Redis进行交互的。</p>
<h1 id="一-关于WebService"><a href="#一-关于WebService" class="headerlink" title="一 关于WebService"></a>一 关于WebService</h1><p>在谈论ServiceStack之前，先看看构成一个WebService的基本框架：</p>
<p><a href="https://images0.cnblogs.com/blog/94031/201409/090119591849664.png" target="_blank" rel="noopener"><img src="https://images0.cnblogs.com/blog/94031/201409/090120011689792.png" alt="Print" title="Print"></a></p>
<p>服务层就是定义WebService接口的地方，这一层也是客户端使用WebService唯一需要与之交互的一层。</p>
<p>业务层通常包含有大量的业务逻辑。他也是实现接口层定义的接口的地方，也是保持服务层的轻量以及关注服务端客户端的契约以及通讯的地方。</p>
<p>数据层通常就是封装数据访问方法并给业务层提供抽象数据模型。</p>
<p>现在我们来看Service这一层。一些WebService使用远程过程调用的方法来实现(RPC)，比如会定义如下函数调用：</p>
<p>public interface IService<br>    {<br>        string DoSomething(int input);<br>    }<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这种RPC的方式使得服务不能很好的应对变化。比如，在上面的代码中，如果后续版本的接口需要接受两个参数来执行DoSomething方法，或者说除了返回一个string外还需要返回其他信息。如果在原接口上修改的话，就会使得老版本的客户端无法使用。当然，我们可以创建一个平行的DoSomething_v2来接受两个参数。但是随着时间的迁移，我们的接口中会充斥着越来越多这样的定义，不管是新用户还是老用户都会感到困惑。</span><br><span class="line"></span><br><span class="line">面对这种情况，可以使用数据传输对象(DTO) 来定义前面的接口中的相关参数。上面的RPC方式转换为对应的DTO模型如下：</span><br><span class="line"></span><br><span class="line">    &lt;pre class=&quot;code&quot;&gt;public class DoSomethingRequest</span><br><span class="line">    &#123;</span><br><span class="line">        public int Input &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public class DoSomethingResponse</span><br><span class="line">    &#123;</span><br><span class="line">        public string Result &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public interface IService</span><br><span class="line">    &#123;</span><br><span class="line">        DoSomethingResponse DoSomething(DoSomethingRequest request);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>每个服务接受一个DTO请求参数，返回一个DTO响应。在请求和相应的DTO对象中添加字段，不会破坏旧的客户端。</p>
<p>在WCF中RPC和DTO风格的WebService均支持，但是在ServiceStack中仅支持DTO风格。ServiceStack为了减少繁琐和注重接口设计从而仅拥抱的DTO风格的远程 WebService接口。 这是了解 ServiceStack的关键，也是ServiceStack框架的设计原则。</p>
<p>了解了ServiceStack的设计理念后，来看看ServiceStack是什么。</p>
<pre><code># 二 ServiceStack是什么
</code></pre><p>ServiceStack是一个开源的十分流行的WebService框架，引用其<a href="https://github.com/ServiceStack/ServiceStack" target="_blank" rel="noopener">官网</a>的介绍：</p>
<p>“Service Stack is a high-performance .NET web services platform that simplifies the development of high-performance REST (JSON, XML, JSV, HTML, MsgPack, ProtoBuf, CSV) and WCF SOAP <a href="https://github.com/ServiceStack/ServiceStack/wiki/Service-Stack-Web-Services" target="_blank" rel="noopener">Web Services</a>.”</p>
<p>“ServiceStack是一个高性能的.NET Web Service 平台，他能够简化开发高性能的REST (支持JSON,XML,JSV,HTML,MsgPack,ProtoBuf,CSV等消息格式)以及WCF SOAP风格的WebService”。</p>
<p>在其<a href="https://servicestack.net/" target="_blank" rel="noopener">主页</a>上也有一篇名为<a href="https://www.slideshare.net/slideshow/embed_code/14819151" target="_blank" rel="noopener">What is the ServiceStack</a>的介绍。建议您直接看，这里从里面截取了几张图：</p>
<p><a href="https://images0.cnblogs.com/blog/94031/201409/090120042316789.png" target="_blank" rel="noopener"><img src="https://images0.cnblogs.com/blog/94031/201409/090120348872023.png" alt="more than service" title="more than service"></a></p>
<p>可以看到ServiceStack除了在其底层是一个精简的WebService框架之外，在其上还有与之相关的一些组件，比如号称.NET 上最快的JSON序列化工具，.NET中流行的Redis访问模块，轻量级快速Orm框架OrmLite等诸多功能。</p>
<p><a href="https://images0.cnblogs.com/blog/94031/201409/090120383098677.png" target="_blank" rel="noopener"><img src="https://images0.cnblogs.com/blog/94031/201409/090120427311161.png" alt="what is service stack" title="what is service stack"></a></p>
<p>可以看到这些组件基本提供了一个WebService框架必需的一些功能。</p>
<p><a href="https://images0.cnblogs.com/blog/94031/201409/090121062622871.png" target="_blank" rel="noopener"><img src="https://images0.cnblogs.com/blog/94031/201409/090121548401966.png" alt="Visualizing ServiceStack" title="Visualizing ServiceStack"></a></p>
<p>在内部实现上ServiceStack建立在原生的ASP.NET IHttpHandler之上，他能够允许在.NET Framework和Mono之上。</p>
<p>下面来看如何使用ServiceStack建立一个WebService：</p>
<pre><code># 三 使用ServiceStack
</code></pre><p>要创建服务，首先要定义接口。这里以一个售票系统为例来说明如何使用ServiceStack来创建服务:</p>
<pre><code>## 创建服务接口层
</code></pre><p>首先新建一个TicketSystem.ServiceContract的类库，我们定义DTO对象。必需要有一个Ticket实体类：</p>
<pre><code>&lt;pre class=&quot;code&quot;&gt;public class Ticket
{
    public int TicketId { get; set; }
    public int TableNumber { get; set; }
    public int ServerId { get; set; }
    public List&lt;Order&gt; Orders { get; set; }
    public DateTime Timestamp { get; set; }
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">在WCF中需要在实体类和字段上面添加DataContract和DataMember来表示序列化时需要的字段，如果没有添加这些标签，在序列化的时候就会忽略。</span><br><span class="line"></span><br><span class="line">而在ServiceStack中，这些标记都不需要，ServiceStack会序列化所有的Plain Old CLR Objects（POCOs）,并且这些对象对客户端都可见。</span><br><span class="line"></span><br><span class="line">然后开始定义Service中需要用到的对外提供服务的接口：</span><br><span class="line"></span><br><span class="line">    &lt;pre class=&quot;code&quot;&gt;public interface ITicketService</span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;Ticket&gt; Any(GetAllTicketsInQueueRequest request);</span><br><span class="line"></span><br><span class="line">        void Any(QueueTicketRequest request);</span><br><span class="line"></span><br><span class="line">        Ticket Any(PullTicketRequest request);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</code></pre><p>在ITickertService中，我们定义了三个操作，第一次看到这样的操作可能有些奇怪，因为方法名称都一样。这是ServiceStack和WCF不一样的地方。在WCF中以上接口可能是这样的：</p>
<pre><code>&lt;pre class=&quot;code&quot;&gt;[ServiceContract]
public interface ITicketService
{
    [OperationContract]
    List&lt;Ticket&gt; GetAllTicketsInQueue(GetAllTicketsInQueueRequest request);
    [OperationContract]
    void QueueTicket(QueueTicketRequest request);
    [OperationContract]
    Ticket PullTicket(PullTicketRequest request);
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">WCF中接口需要使用ServiceContract来表明，其中的方法需要使用OperationContract来标记。方法的名称就是服务的名称。</span><br><span class="line"></span><br><span class="line">ServiceStack中的服务方法名为Any，Get以及Post，这也是ServiceStack支持的请求类型，Any表示服务可以通过HTTP Get和HTTP Post两种方式调用。这强化和简化了RESTFull风格的WebService的实现。只需要在这些方法上添加爱[Route(…)]属性即可。在ServiceStack中，方法和方法之间的区别是通过服务的参数及请求对象Request DTO来区分的，而不是像WCF中通过方法名称来区分。这就表示一个请求DTO对象不能在ServiceStack的多个Service中复用。</span><br><span class="line"></span><br><span class="line">    ## 创建服务端</span><br><span class="line"></span><br><span class="line">有了服务接口层之后，需要编写服务端以实现这些逻辑，也就是前面定义的ITicketService接口。首先创建名为ServiceStackServer的空的ASP.NET 应用程序，然后新建TicketService类，是该类实现ITicketService接口并继承自Service类。Service类是ServiceStack中的，可以通过NuGet来安装和引用ServiceStack相关类库：</span><br><span class="line"></span><br><span class="line">[![Managet NuGet Packages](https://images0.cnblogs.com/blog/94031/201409/090122079342997.png &quot;Managet NuGet Packages&quot;)](https://images0.cnblogs.com/blog/94031/201409/090122029658316.png)</span><br><span class="line"></span><br><span class="line">实现后TicketService类如下：</span><br><span class="line"></span><br><span class="line">    &lt;pre class=&quot;code&quot;&gt;public class TicketService : Service, ITicketService</span><br><span class="line">    &#123;</span><br><span class="line">        private static readonly TicketSystem.TicketProcessor.TicketProcessor</span><br><span class="line">            _ticketProcessor = new TicketSystem.TicketProcessor.TicketProcessor();</span><br><span class="line"></span><br><span class="line">        public List&lt;Ticket&gt; Any(GetAllTicketsInQueueRequest request)</span><br><span class="line">        &#123;</span><br><span class="line">            return _ticketProcessor.GetTicketsInQueue()</span><br><span class="line">                .Select(TicketTranslator.TranslateTicket).ToList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void Any(QueueTicketRequest request)</span><br><span class="line">        &#123;</span><br><span class="line">            _ticketProcessor.QueueTicket(</span><br><span class="line">                TicketTranslator.TranslateTicket(request.Ticket));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Ticket Any(PullTicketRequest request)</span><br><span class="line">        &#123;</span><br><span class="line">            TicketSystem.TicketProcessor.Ticket nextTicket =</span><br><span class="line">                _ticketProcessor.PullTicket();</span><br><span class="line"></span><br><span class="line">            if (nextTicket != null)</span><br><span class="line">            &#123;</span><br><span class="line">                return TicketTranslator.TranslateTicket(nextTicket);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</code></pre><p>这里面我们定义了一个私有了TicketProcessor 变量，接口中的所有方法都通过该类实现，在接口对象到该方法的调用中，我们对实体进行了转换。该对象在其他程序集中定义，这样能保证服务端代码简洁。</p>
<p>有了服务端之后，需要把服务端Host起来对外提供服务，ServiceStack提供了通过IIS，Self-Host等多种形式。因为我们之前创建的ASP.NET程序，所以，只需要再添加一个Global.asax文件，然后在启动的事件Application_Start中初始化即可。</p>
<pre><code>&lt;pre class=&quot;code&quot;&gt;protected void Application_Start(object sender, EventArgs e)
{
    //Initialize your web service on startup.
    new TicketServiceHost().Init();
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;pre class=&quot;code&quot;&gt;public class TicketServiceHost : AppHostBase</span><br><span class="line">&#123;</span><br><span class="line">    //Register your web service with ServiceStack.</span><br><span class="line">    public TicketServiceHost() </span><br><span class="line">        : base(&quot;Ticket Service&quot;, typeof(TicketService).Assembly) </span><br><span class="line">    &#123; &#125;</span><br><span class="line"></span><br><span class="line">    public override void Configure(Funq.Container container)</span><br><span class="line">    &#123;</span><br><span class="line">        //Register any dependencies your services use here.</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><p>只需要实现ApphostBase基类，提供服务显示名称，以及实现了Service接口的服务所在的程序集即可。</p>
<p>当然也可以通过控制台应用程序来Host我们的WebService，这时TicketServiceHost需要实现AppSelfHostBase，实现如下：</p>
<pre><code>&lt;pre class=&quot;code&quot;&gt;public class TicketServiceHost : AppSelfHostBase
{
    /// &lt;summary&gt;
    /// Default constructor.
    /// Base constructor requires a name and assembly to locate web service classes. 
    /// &lt;/summary&gt;
    public TicketServiceHost()
        : base(&quot;WebApplication1&quot;, typeof(TicketService).Assembly)
    {

    }

    /// &lt;summary&gt;
    /// Application specific configuration
    /// This method should initialize any IoC resources utilized by your web service classes.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;container&quot;&gt;&lt;/param&gt;
    public override void Configure(Container container)
    {
        //Config examples
        //this.AddPlugin(new PostmanFeature());
        //this.AddPlugin(new CorsFeature());
    }
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">然后在Main函数中，启动即可：</span><br><span class="line"></span><br><span class="line">    &lt;pre class=&quot;code&quot;&gt;static void Main(string[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        var listeningOn = args.Length == 0 ? &quot;http://*:1337/&quot; : args[0];</span><br><span class="line">        var appHost = new TicketServiceHost()</span><br><span class="line">            .Init()</span><br><span class="line">            .Start(listeningOn);</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(&quot;AppHost Created at &#123;0&#125;, listening on &#123;1&#125;&quot;,</span><br><span class="line">            DateTime.Now, listeningOn);</span><br><span class="line"></span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</code></pre><p>现在，我们运行前面创建的ASP.NET或者运行Console托管的TicketServiceHost， 在浏览器中访问<a href="http://localhost:1337/" target="_blank" rel="noopener">http://localhost:1337/</a>即可看到我们定义好的服务：</p>
<p><a href="https://images0.cnblogs.com/blog/94031/201409/090122098563910.png" target="_blank" rel="noopener"><img src="https://images0.cnblogs.com/blog/94031/201409/090122103719053.png" alt="AppSelfHost" title="AppSelfHost"></a></p>
<p><a href="https://images0.cnblogs.com/blog/94031/201409/090122129344136.png" target="_blank" rel="noopener"><img src="https://images0.cnblogs.com/blog/94031/201409/090122148718278.png" alt="service page" title="service page"></a> </p>
<pre><code>## 服务客户端
</code></pre><p>服务端创建和托管好之后， 服务使用者就可以直接编写HttpWebRequest对象对这些服务通过Get或者Post方式进行直接访问了。</p>
<p>除此之外，ServiceStack也内置了一些便捷访问的客户端，这些对象位于ServiceStack.ServiceClient.Web命名空间中。所有的内置的客户端都实现了ServiceStack.Service.IServiceClient 放，这些支持REST的客户端都实现了ServiceStack.Service.IRestClient.这些客户端对象包括：</p>
<pre><code>*   JsonServiceClient
*   JsvServiceClient
*   XmlServiceClient
*   MsgPackServiceClient
*   ProtoBufServiceClient
*   Soap11ServiceClient
*   Soap12ServiceClient
</code></pre><p>从名称可以看出，这几种不同之处在于支持的序列化和反序列化格式不同。因为他们实现的是一系列相同的接口，所以他们的用法相同，也可以相互替换。</p>
<p>这里我们不演示如何通过HttpWebRequest像请求普通的网页那样请求我们之前托管好的WebService，现在假设我们有一个Console程序需要使用WebService程序。只需要新建一个ServiceStack的Service，然后将Host的地址传入即可。这些方法在内部会为我们将代码转化为传统的使用HttpWebRequest的方式请求，目前这些方法还都是同步的。</p>
<p>比如，如果我们想使用WCF中使用的Soap11来请求，只需如下代码：</p>
<pre><code>&lt;pre class=&quot;code&quot;&gt;static void Main(string[] args)
{
    Console.Title = &quot;ServiceStack Console Client&quot;;

    using (var client = new Soap11ServiceClient(&quot;http://localhost:1337&quot;))
    {
        List&lt;Ticket&gt; queuedTickets = client.Send&lt;List&lt;Ticket&gt;&gt;(
            new GetAllTicketsInQueueRequest()) ;
        if (queuedTickets != null)
        {
            foreach (Ticket ticket in queuedTickets)
            {
                PrintTicket(ticket);
            }
        }
    }

    Console.ReadKey();
}```
</code></pre><p>这里的Soap11ServiceClient 对象可以换成ServiceStack支持的其他数据序列化格式。</p>
<pre><code># 四 结语
</code></pre><p>本文介绍了开源的比较流行的WebService框架ServiceStack，并通过一个简单的例子展现了如何使用ServiceStack创建出一个WebService。</p>
<p>它能够比较方便快捷的搭建高效的具有RESTFull风格的WebService应用程序。其框架的设计思路也非常值得学习，通过类似“约定大于配置”的方式，减少了WCF中创建WebService需要的各种标记，强制用户使用DTO的方式来建立服务接口。ServiceStack也提供了名为ServiceStackVS的VisualStudio插件能够帮助您方便的创建ServiceStack模板。</p>
<p><a href="https://images0.cnblogs.com/blog/94031/201409/090122291372853.png" target="_blank" rel="noopener"><img src="https://images0.cnblogs.com/blog/94031/201409/090122321528565.png" alt="ServiceStack Template" title="ServiceStack Template"></a></p>
<p>WCF可以实现ServiceStack所有的功能。但是ServiceStack为您快速创建一个高效WebService提供了另外一种选择，他可以运行于不同的平台。ServiceStack也是开源社区比较活跃的一个WebService框架，通过研究其代码也可以借鉴其思路，提高自己的编码和架构水平。比如可以修改Client以支持异步方法调用等等，可以自己动手添加自己想要的功能。</p>
<p>希望本文对您了解ServiceStack有所帮助。<br></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/964c775f.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/964c775f.html" itemprop="url">WAMP 403 Forbidden禁止访问 的解决办法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-02-05T15:43:00+08:00">
                2016-02-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>修改httpd.conf文件</p>
<pre><code>    #   onlineoffline tag - don&apos;t remove
    Require local

```
</code></pre><p>To</p>
<pre><code>&lt;pre&gt;
    #   onlineoffline tag - don&apos;t remove
    Require all granted
</code></pre><p>参考：<a href="http://stackoverflow.com/questions/28560452/403-forbidden-wamp-server-2-5```" target="_blank" rel="noopener">http://stackoverflow.com/questions/28560452/403-forbidden-wamp-server-2-5```</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/fc6596ae.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/fc6596ae.html" itemprop="url">php_curl.dll libssh2.dll 始终无法加载的原因 及解决办法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-29T07:52:00+08:00">
                2016-01-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在StackOverflow得到最终原因及解决办法</p>
<p><a href="http://stackoverflow.com/questions/16424117/php-unable-to-load-php-curl-dll-extension" target="_blank" rel="noopener">http://stackoverflow.com/questions/16424117/php-unable-to-load-php-curl-dll-extension</a></p>
<p><code>libeay32.dll</code> and <code>ssleay32.dll</code> have to be path-accessible for <code>php_curl.dll</code> loading to succeed. Copying them into <code>System32</code> (or even into the Windows main directory) is a bad hack and does not even work with newer PHP versions.</p>
<p>The right way to do it is to add the PHP path to the Windows <code>Path</code> variable. In <code>Control Panel -&gt; System</code> click on <strong>Advanced System Settings</strong> and use the button <strong>Environment Variables</strong>. Under<strong>System Variables</strong> you will find the <code>Path</code> variable. Edit it and append <code>;C:\PHP</code> to it - or whatever the path to your PHP folder is. Then restart Apache.</p>
<p>就是在环境变量里面添加PHP的路径。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/da5828ad.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/da5828ad.html" itemprop="url">如何使用Retrofit获取服务器返回来的JSON字符串</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-21T13:59:00+08:00">
                2016-01-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>有关Retrofit的简单集成攻略，大家可以参考我此前的一篇文章<br>有关更多API文档的查阅请大家到<a href="http://square.github.io/retrofit/" target="_blank" rel="noopener">Retrofit官网</a>查看。</p>
<p>在大家使用网络请求的时候，往往会出现一种情况：需要在拿到服务器返回来的JSON字符串，而Retrofit会默认将Json解析，而又没有直接暴露出拿到Json字符串的方法，经过在网上一定的查阅，再次给大家一个简单的办法，就能够拿到Json字符串。</p>
<p>以下是我们在Api接口中的定义方法</p>
<table><br><tbody><br><tr><br><td class="gutter"><br><br><span class="line">1<br><span class="line">2<br><span class="line">3<br><span class="line">4<br><span class="line">5<br><span class="line">6<br><span class="line">7<br></span></span></span></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;td class=&quot;code&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//以前我们使用我们定义好的POJO或javabean类作为callback的泛型，以便Retrofit帮我们解析  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@POST(&lt;span class=&quot;string&quot;&gt;&quot;/interface/xxxxxx&quot;)  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void &lt;span class=&quot;title&quot;&gt;getCouponList&lt;span class=&quot;params&quot;&gt;(Callback&lt;Coupon&gt; reponse);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//但如果我们想获得JSON字符串，Callback的泛型里就不能写POJO类了，要写Response（retrofit.client包下）  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@POST(&lt;span class=&quot;string&quot;&gt;&quot;/interface/xxxxxx&quot;)  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void &lt;span class=&quot;title&quot;&gt;getCouponList&lt;span class=&quot;params&quot;&gt;(Callback&lt;Response&gt; reponse);  </span><br><span class="line">&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br></td><br></tr><br></tbody><br></table>

<p>那么在我们请求接口的时候，只需简单一行代码，就能拿到服务器返回的JSON字符串了</p>
<table><br><tbody><br><tr><br><td class="gutter"><br><br><span class="line">1<br><span class="line">2<br><span class="line">3<br><span class="line">4<br><span class="line">5<br><span class="line">6<br><span class="line">7<br><span class="line">8<br><span class="line">9<br><span class="line">10<br><span class="line">11<br><span class="line">12<br><span class="line">13<br><span class="line">14<br><span class="line">15<br><span class="line">16<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;td class=&quot;code&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;line&quot;&gt;ZhixueApiUtil.getInstance().getZhixueApi().getCouponList(&lt;span class=&quot;keyword&quot;&gt;new Callback&lt;Response&gt;() &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public &lt;span class=&quot;keyword&quot;&gt;void &lt;span class=&quot;title&quot;&gt;success&lt;span class=&quot;params&quot;&gt;(Response response, Response response1) &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//注意这里用第一个Response参数的  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        String jsonString = &lt;span class=&quot;keyword&quot;&gt;new String(((TypedByteArray) response.getBody()).getBytes());  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//再使用Retrofit自带的JSON解析（或者别的什么）  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        Coupon coupon = &lt;span class=&quot;keyword&quot;&gt;new Gson().fromJson(jsonString, Coupon.class);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        ......  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &#125;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public &lt;span class=&quot;keyword&quot;&gt;void &lt;span class=&quot;title&quot;&gt;failure&lt;span class=&quot;params&quot;&gt;(RetrofitError error) &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        ......  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &#125;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&#125;);  </span><br><span class="line">&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br></td><br></tr><br></tbody><br></table>

<p>至此，我们就能拿到JSON字符串了，在需要的时候可以用这种办法。<br>当然，也希望Retrofit以后能够加入相应的API。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/ac85fa6b.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/ac85fa6b.html" itemprop="url">Java Annotation 及几个常用开源项目注解原理简析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-03T22:42:00+08:00">
                2015-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>PDF 版: <a href="http://wugengxin.cn/download/pdf/android/java-annotation.pdf" target="_blank" rel="noopener">Java Annotation.pdf</a>, PPT 版：<a href="http://wugengxin.cn/download/pdf/android/java-annotation.pptx" target="_blank" rel="noopener">Java Annotation.pptx</a>, Keynote 版：<a href="https://github.com/Trinea/trinea.github.com/tree/master/download/pdf/android/java-annotation.key" target="_blank" rel="noopener">Java Annotation.key</a></p>
<h3 id="一、Annotation-示例"><a href="#一、Annotation-示例" class="headerlink" title="一、Annotation 示例"></a>一、Annotation 示例</h3><p>Override Annotation</p>
<div id="crayon-5638beb759d55737389229" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d55737389229-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d55737389229-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d55737389229-3">3<br><br></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d55737389229-1" class="crayon-line"><span class="crayon-n">@Override</span><br><div id="crayon-5638beb759d55737389229-2" class="crayon-line crayon-striped-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">void<span class="crayon-h"> <span class="crayon-e">onCreate<span class="crayon-sy">(<span class="crayon-e">Bundle <span class="crayon-v">savedInstanceState<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d55737389229-3" class="crayon-line"><br><br></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>Retrofit Annotation<br><br><div id="crayon-5638beb759d6a290188146" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d6a290188146-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d6a290188146-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d6a290188146-3">3<br><br></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d6a290188146-1" class="crayon-line"><span class="crayon-n">@GET<span class="crayon-sy">(<span class="crayon-s">“/users/{username}”<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759d6a290188146-2" class="crayon-line crayon-striped-line"><span class="crayon-e">User <span class="crayon-e">getUser<span class="crayon-sy">(<span class="crayon-n">@Path<span class="crayon-sy">(<span class="crayon-s">“username”<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">username<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d6a290188146-3" class="crayon-line"><br><br></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>Butter Knife Annotation<br><br><div id="crayon-5638beb759d70828829286" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d70828829286-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d70828829286-2">2<br><br></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d70828829286-1" class="crayon-line"><span class="crayon-n">@InjectView<span class="crayon-sy">(<span class="crayon-v">R<span class="crayon-sy">.<span class="crayon-v">id<span class="crayon-sy">.<span class="crayon-v">user<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-e">EditText <span class="crayon-v">username<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d70828829286-2" class="crayon-line crayon-striped-line"><br><br></div></div></div></td><br></tr><br></tbody><br></table><br><br>ActiveAndroid Annotation<br><br><div id="crayon-5638beb759d74089343673" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d74089343673-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d74089343673-2">2<br><br></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d74089343673-1" class="crayon-line"><span class="crayon-n">@Column<span class="crayon-sy">(<span class="crayon-v">name<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> “<span class="crayon-i">Name”<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">name<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d74089343673-2" class="crayon-line crayon-striped-line"><br><br></div></div></div></td><br></tr><br></tbody><br></table><br><br>Retrofit 为符合 RESTful 规范的网络请求框架<br>Butter Knife 为 View 及事件等依赖注入框架<br>Active Android 为 ORM 框架<br>更多见：<a href="https://github.com/Trinea/android-open-project" target="_blank" rel="noopener">Android 开源项目汇总</a><br><br>### 二、Annotation 概念及作用<br><br>#### 1 概念<br><br>&gt; An annotation is a form of metadata, that can be added to Java source code. Classes, methods, variables, parameters and packages may be annotated. Annotations have no direct effect on the operation of the code they annotate.<br><br>能够添加到 Java 源代码的语法元数据。类、方法、变量、参数、包都可以被注解，可用来将信息元数据与程序元素进行关联。Annotation 中文常译为“注解”<br><br>#### 2 作用<br><br>a. 标记，用于告诉编译器一些信息<br>b. 编译时动态处理，如动态生成代码<br>c. 运行时动态处理，如得到注解信息<br>这里的三个作用实际对应着后面自定义 Annotation 时说的 @Retention 三种值分别表示的 Annotation<br>看看下面一段代码的运行结果是多少？<br><br><div id="crayon-5638beb759d7a404361265" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-4">4<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-6">6<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-8">8<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-10">10<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-12">12<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-14">14<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-15">15<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-16">16<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-17">17<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-18">18<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-19">19<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-20">20<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-21">21<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-22">22<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-23">23<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-24">24<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-25">25<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-26">26<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-27">27<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-28">28<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d7a404361265-1" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">class<span class="crayon-h"> <span class="crayon-e">Person<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-2" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d7a404361265-3" class="crayon-line"><span class="crayon-h">    <span class="crayon-m">private<span class="crayon-h"> <span class="crayon-t">int<span class="crayon-h">    <span class="crayon-v">id<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-4" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-m">private<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">name<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-5" class="crayon-line"><br><div id="crayon-5638beb759d7a404361265-6" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-e">Person<span class="crayon-sy">(<span class="crayon-t">int<span class="crayon-h"> <span class="crayon-v">id<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">name<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-7" class="crayon-line"><span class="crayon-h">        <span class="crayon-r">this<span class="crayon-sy">.<span class="crayon-v">id<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">id<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-8" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-r">this<span class="crayon-sy">.<span class="crayon-v">name<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">name<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-9" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d7a404361265-10" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d7a404361265-11" class="crayon-line"><span class="crayon-h">    <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">boolean<span class="crayon-h"> <span class="crayon-e">equals<span class="crayon-sy">(<span class="crayon-e">Person <span class="crayon-v">person<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-12" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-st">return<span class="crayon-h"> <span class="crayon-v">person<span class="crayon-sy">.<span class="crayon-v">id<span class="crayon-h"> <span class="crayon-o">==<span class="crayon-h"> <span class="crayon-v">id<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-13" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d7a404361265-14" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d7a404361265-15" class="crayon-line"><span class="crayon-h">    <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">int<span class="crayon-h"> <span class="crayon-e">hashCode<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-16" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-st">return<span class="crayon-h"> <span class="crayon-v">id<span class="crayon-sy">;</span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-17" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d7a404361265-18" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d7a404361265-19" class="crayon-line"><span class="crayon-h">    <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-m">static<span class="crayon-h"> <span class="crayon-t">void<span class="crayon-h"> <span class="crayon-e">main<span class="crayon-sy">(<span class="crayon-t">String<span class="crayon-sy">[<span class="crayon-sy">]<span class="crayon-h"> <span class="crayon-v">args<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-20" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d7a404361265-21" class="crayon-line"><span class="crayon-h">        <span class="crayon-v">Set<span class="crayon-e "><person><span class="crayon-h"> <span class="crayon-v">set<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-r">new<span class="crayon-h"> <span class="crayon-v">HashSet<span class="crayon-e "><person><span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></person></span></span></span></span></span></span></span></span></span></person></span></span></span><br><div id="crayon-5638beb759d7a404361265-22" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-t">int<span class="crayon-h"> <span class="crayon-v">i<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-cn">0<span class="crayon-sy">;<span class="crayon-h"> <span class="crayon-v">i<span class="crayon-h"> <span class="crayon-o">&lt;<span class="crayon-h"> <span class="crayon-cn">10<span class="crayon-sy">;<span class="crayon-h"> <span class="crayon-v">i<span class="crayon-o">++<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-23" class="crayon-line"><span class="crayon-h">            <span class="crayon-v">set<span class="crayon-sy">.<span class="crayon-e">add<span class="crayon-sy">(<span class="crayon-r">new<span class="crayon-h"> <span class="crayon-e">Person<span class="crayon-sy">(<span class="crayon-cn">1<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-s">“Jim”<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-24" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d7a404361265-25" class="crayon-line"><span class="crayon-h">        <span class="crayon-v">System<span class="crayon-sy">.<span class="crayon-v">out<span class="crayon-sy">.<span class="crayon-e">println<span class="crayon-sy">(<span class="crayon-v">set<span class="crayon-sy">.<span class="crayon-e">size<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-26" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d7a404361265-27" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759d7a404361265-28" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>答案见本文最后<br><br>### 三、Annotation 分类<br><br>#### 1 标准 Annotation<br><br>包括Override, Deprecated, SuppressWarnings，标准 Annotation 是指 Java 自带的几个 Annotation，上面三个分别表示重写函数，函数已经被禁止使用，忽略某项 Warning<br><br>#### 2 元 Annotation<br><br>@Retention, @Target, @Inherited, @Documented，元 Annotation 是指用来定义 Annotation 的 Annotation，在后面 Annotation 自定义部分会详细介绍含义<br><br>#### 3 自定义 Annotation<br><br>自定义 Annotation 表示自己根据需要定义的 Annotation，定义时需要用到上面的元 Annotation<br>这里只是一种分类而已，也可以根据作用域分为源码时、编译时、运行时 Annotation，后面在自定义 Annotation 时会具体介绍<br><br>### 四、Annotation 自定义<br><br>#### 1 调用<br><br><div id="crayon-5638beb759d7f039876125" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d7f039876125-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7f039876125-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d7f039876125-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7f039876125-4">4<br><div class="crayon-num" data-line="crayon-5638beb759d7f039876125-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7f039876125-6">6<br><div class="crayon-num" data-line="crayon-5638beb759d7f039876125-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7f039876125-8">8<br><div class="crayon-num" data-line="crayon-5638beb759d7f039876125-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7f039876125-10">10<br><div class="crayon-num" data-line="crayon-5638beb759d7f039876125-11">11<br><br></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d7f039876125-1" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">class<span class="crayon-h"> <span class="crayon-e">App<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7f039876125-2" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d7f039876125-3" class="crayon-line"><span class="crayon-h">    <span class="crayon-n">@MethodInfo<span class="crayon-sy">(</span></span></span><br><div id="crayon-5638beb759d7f039876125-4" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-v">author<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> “<span class="crayon-v">trinea<span class="crayon-sy">.<span class="crayon-v">cn<span class="crayon-o">+<span class="crayon-v">android<span class="crayon-n">@gmail<span class="crayon-sy">.<span class="crayon-i">com”<span class="crayon-sy">,</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7f039876125-5" class="crayon-line"><span class="crayon-h">        <span class="crayon-v">date<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-s">“2014/02/14”<span class="crayon-sy">,</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7f039876125-6" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-v">version<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-cn">2<span class="crayon-sy">)</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7f039876125-7" class="crayon-line"><span class="crayon-h">    <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-e">getAppName<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7f039876125-8" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-st">return<span class="crayon-h"> <span class="crayon-s">“trinea”<span class="crayon-sy">;</span></span></span></span></span><br><div id="crayon-5638beb759d7f039876125-9" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d7f039876125-10" class="crayon-line crayon-striped-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759d7f039876125-11" class="crayon-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>这里是调用自定义 Annotation——MethodInfo 的示例，MethodInfo Annotation 作用为给方法添加相关信息，包括 author、date、version<br><br>#### 2 定义<br><br><div id="crayon-5638beb759d84447280122" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d84447280122-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d84447280122-4">4<br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d84447280122-6">6<br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d84447280122-8">8<br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d84447280122-10">10<br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d84447280122-12">12<br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-13">13<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d84447280122-1" class="crayon-line"><span class="crayon-n">@Documented</span><br><div id="crayon-5638beb759d84447280122-2" class="crayon-line crayon-striped-line"><span class="crayon-n">@Retention<span class="crayon-sy">(<span class="crayon-v">RetentionPolicy<span class="crayon-sy">.<span class="crayon-v">RUNTIME<span class="crayon-sy">)</span></span></span></span></span></span><br><div id="crayon-5638beb759d84447280122-3" class="crayon-line"><span class="crayon-n">@Target<span class="crayon-sy">(<span class="crayon-v">ElementType<span class="crayon-sy">.<span class="crayon-v">METHOD<span class="crayon-sy">)</span></span></span></span></span></span><br><div id="crayon-5638beb759d84447280122-4" class="crayon-line crayon-striped-line"><span class="crayon-n">@Inherited</span><br><div id="crayon-5638beb759d84447280122-5" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-n">@interface<span class="crayon-h"> <span class="crayon-e">MethodInfo<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d84447280122-6" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d84447280122-7" class="crayon-line"><span class="crayon-h">    <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-e">author<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-st">default<span class="crayon-h"> <span class="crayon-s">“<a href="mailto:trinea@gmail.com" target="_blank" rel="noopener">trinea@gmail.com</a>“<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d84447280122-8" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d84447280122-9" class="crayon-line"><span class="crayon-h">    <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-e">date<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d84447280122-10" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d84447280122-11" class="crayon-line"><span class="crayon-h">    <span class="crayon-t">int<span class="crayon-h"> <span class="crayon-e">version<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-st">default<span class="crayon-h"> <span class="crayon-cn">1<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d84447280122-12" class="crayon-line crayon-striped-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759d84447280122-13" class="crayon-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>这里是 MethodInfo 的实现部分<br>(1). 通过 @interface 定义，注解名即为自定义注解名<br>(2). 注解配置参数名为注解类的方法名，且：<br>a. 所有方法没有方法体，没有参数没有修饰符，实际只允许 public &amp; abstract 修饰符，默认为 public ，不允许抛异常<br>b. 方法返回值只能是基本类型，String, Class, annotation, enumeration 或者是他们的一维数组<br>c. 若只有一个默认属性，可直接用 value() 函数。一个属性都没有表示该 Annotation 为 Mark Annotation<br>(3). 可以加 default 表示默认值<br><br>#### 3 元 Annotation<br><br>@Documented 是否会保存到 Javadoc 文档中<br>@Retention 保留时间，可选值 SOURCE（源码时），CLASS（编译时），RUNTIME（运行时），默认为 CLASS，值为 SOURCE 大都为 Mark Annotation，这类 Annotation 大都用来校验，比如 Override, Deprecated, SuppressWarnings<br>@Target 可以用来修饰哪些程序元素，如 TYPE, METHOD, CONSTRUCTOR, FIELD, PARAMETER 等，未标注则表示可修饰所有<br>@Inherited 是否可以被继承，默认为 false<br><br>### 五、Annotation 解析<br><br>#### 1 运行时 Annotation 解析<br><br>(1) 运行时 Annotation 指 @Retention 为 RUNTIME 的 Annotation，可手动调用下面常用 API 解析<br><br><div id="crayon-5638beb759d8a844088324" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d8a844088324-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8a844088324-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d8a844088324-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8a844088324-4">4<br><br></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d8a844088324-1" class="crayon-line"><span class="crayon-v">method<span class="crayon-sy">.<span class="crayon-e">getAnnotation<span class="crayon-sy">(<span class="crayon-v">AnnotationName<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8a844088324-2" class="crayon-line crayon-striped-line"><span class="crayon-v">method<span class="crayon-sy">.<span class="crayon-e">getAnnotations<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span><br><div id="crayon-5638beb759d8a844088324-3" class="crayon-line"><span class="crayon-v">method<span class="crayon-sy">.<span class="crayon-e">isAnnotationPresent<span class="crayon-sy">(<span class="crayon-v">AnnotationName<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8a844088324-4" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>其他 @Target 如 Field，Class 方法类似<br>getAnnotation(AnnotationName.class) 表示得到该 Target 某个 Annotation 的信息，因为一个 Target 可以被多个 Annotation 修饰<br>getAnnotations() 则表示得到该 Target 所有 Annotation<br>isAnnotationPresent(AnnotationName.class) 表示该 Target 是否被某个 Annotation 修饰<br>(2) 解析示例如下：<br><br><div id="crayon-5638beb759d8e948564502" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-4">4<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-6">6<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-8">8<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-10">10<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-12">12<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-14">14<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-15">15<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-16">16<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-17">17<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-18">18<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d8e948564502-1" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-m">static<span class="crayon-h"> <span class="crayon-t">void<span class="crayon-h"> <span class="crayon-e">main<span class="crayon-sy">(<span class="crayon-t">String<span class="crayon-sy">[<span class="crayon-sy">]<span class="crayon-h"> <span class="crayon-v">args<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-2" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-st">try<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span><br><div id="crayon-5638beb759d8e948564502-3" class="crayon-line"><span class="crayon-h">        <span class="crayon-t">Class<span class="crayon-h"> <span class="crayon-v">cls<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-t">Class<span class="crayon-sy">.<span class="crayon-e">forName<span class="crayon-sy">(<span class="crayon-s">“cn.trinea.java.test.annotation.App”<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-4" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-e">Method <span class="crayon-v">method<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">cls<span class="crayon-sy">.<span class="crayon-e">getMethods<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-5" class="crayon-line"><span class="crayon-h">            <span class="crayon-e">MethodInfo <span class="crayon-v">methodInfo<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">method<span class="crayon-sy">.<span class="crayon-e">getAnnotation<span class="crayon-sy">(</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-6" class="crayon-line crayon-striped-line"><span class="crayon-v">MethodInfo<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-7" class="crayon-line"><span class="crayon-h">            <span class="crayon-st">if<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-v">methodInfo<span class="crayon-h"> <span class="crayon-o">!=<span class="crayon-h"> <span class="crayon-t">null<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-8" class="crayon-line crayon-striped-line"><span class="crayon-h">                <span class="crayon-v">System<span class="crayon-sy">.<span class="crayon-v">out<span class="crayon-sy">.<span class="crayon-e">println<span class="crayon-sy">(<span class="crayon-s">“method name:”<span class="crayon-h"> <span class="crayon-o">+<span class="crayon-h"> <span class="crayon-v">method<span class="crayon-sy">.<span class="crayon-e">getName<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-9" class="crayon-line"><span class="crayon-h">                <span class="crayon-v">System<span class="crayon-sy">.<span class="crayon-v">out<span class="crayon-sy">.<span class="crayon-e">println<span class="crayon-sy">(<span class="crayon-s">“method author:”<span class="crayon-h"> <span class="crayon-o">+<span class="crayon-h"> <span class="crayon-v">methodInfo<span class="crayon-sy">.<span class="crayon-e">author<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-10" class="crayon-line crayon-striped-line"><span class="crayon-h">                <span class="crayon-v">System<span class="crayon-sy">.<span class="crayon-v">out<span class="crayon-sy">.<span class="crayon-e">println<span class="crayon-sy">(<span class="crayon-s">“method version:”<span class="crayon-h"> <span class="crayon-o">+<span class="crayon-h"> <span class="crayon-v">methodInfo<span class="crayon-sy">.<span class="crayon-e">version<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-11" class="crayon-line"><span class="crayon-h">                <span class="crayon-v">System<span class="crayon-sy">.<span class="crayon-v">out<span class="crayon-sy">.<span class="crayon-e">println<span class="crayon-sy">(<span class="crayon-s">“method date:”<span class="crayon-h"> <span class="crayon-o">+<span class="crayon-h"> <span class="crayon-v">methodInfo<span class="crayon-sy">.<span class="crayon-e">date<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-12" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d8e948564502-13" class="crayon-line"><span class="crayon-h">        <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d8e948564502-14" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}<span class="crayon-h"> <span class="crayon-st">catch<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-i">ClassNotFoundException<span class="crayon-h"> <span class="crayon-v">e<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-15" class="crayon-line"><span class="crayon-h">        <span class="crayon-v">e<span class="crayon-sy">.<span class="crayon-e">printStackTrace<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-16" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d8e948564502-17" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759d8e948564502-18" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>以之前自定义的 MethodInfo 为例，利用 Target（这里是 Method）getAnnotation 函数得到 Annotation 信息，然后就可以调用 Annotation 的方法得到响应属性值<br><br>#### 2 编译时 Annotation 解析<br><br>(1) 编译时 Annotation 指 @Retention 为 CLASS 的 Annotation，甴 <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/apt/GettingStarted.html" target="_blank" rel="noopener">apt(Annotation Processing Tool)</a> 解析自动解析。需要做的<br>a. 自定义类集成自 AbstractProcessor<br>b. 重写其中的 process 函数<br>这块很多同学不理解，实际是 <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/apt/GettingStarted.html" target="_blank" rel="noopener">apt(Annotation Processing Tool)</a> 在编译时自动查找所有继承自 AbstractProcessor 的类，然后调用他们的 process 方法去处理<br>(2) 假设之前自定义的 MethodInfo 的 @Retention 为 CLASS，解析示例如下：<br><br><div id="crayon-5638beb759d94519330602" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-4">4<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-6">6<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-8">8<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-10">10<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-12">12<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-14">14<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-15">15<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-16">16<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d94519330602-1" class="crayon-line"><span class="crayon-n">@SupportedAnnotationTypes<span class="crayon-sy">(<span class="crayon-sy">{<span class="crayon-h"> <span class="crayon-s">“cn.trinea.java.test.annotation.MethodInfo”<span class="crayon-h"> <span class="crayon-sy">}<span class="crayon-sy">)</span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-2" class="crayon-line crayon-striped-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">class<span class="crayon-h"> <span class="crayon-e">MethodInfoProcessor<span class="crayon-h"> <span class="crayon-r">extends<span class="crayon-h"> <span class="crayon-e">AbstractProcessor<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-3" class="crayon-line"><br><div id="crayon-5638beb759d94519330602-4" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-n">@Override</span></span><br><div id="crayon-5638beb759d94519330602-5" class="crayon-line"><span class="crayon-h">    <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">boolean<span class="crayon-h"> <span class="crayon-e">process<span class="crayon-sy">(<span class="crayon-v">Set<span class="crayon-o">&lt;<span class="crayon-sy">?<span class="crayon-h"> <span class="crayon-r">extends<span class="crayon-h"> <span class="crayon-v">TypeElement<span class="crayon-o">&gt;<span class="crayon-h"> <span class="crayon-v">annotations<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-e">RoundEnvironment <span class="crayon-v">env<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-6" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-v">HashMap<span class="crayon-o">&lt;<span class="crayon-t">String<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-o">&gt;<span class="crayon-h"> <span class="crayon-v">map<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-r">new<span class="crayon-h"> <span class="crayon-v">HashMap<span class="crayon-o">&lt;<span class="crayon-t">String<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-o">&gt;<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-7" class="crayon-line"><span class="crayon-h">        <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-e">TypeElement <span class="crayon-v">te<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">annotations<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-8" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-e">Element <span class="crayon-v">element<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">env<span class="crayon-sy">.<span class="crayon-e">getElementsAnnotatedWith<span class="crayon-sy">(<span class="crayon-v">te<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-9" class="crayon-line"><span class="crayon-h">                <span class="crayon-e">MethodInfo <span class="crayon-v">methodInfo<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">element<span class="crayon-sy">.<span class="crayon-e">getAnnotation<span class="crayon-sy">(<span class="crayon-v">MethodInfo<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-10" class="crayon-line crayon-striped-line"><span class="crayon-h">                <span class="crayon-v">map<span class="crayon-sy">.<span class="crayon-e">put<span class="crayon-sy">(<span class="crayon-v">element<span class="crayon-sy">.<span class="crayon-e">getEnclosingElement<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">.<span class="crayon-e">toString<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">methodInfo<span class="crayon-sy">.<span class="crayon-e">author<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-11" class="crayon-line"><span class="crayon-h">            <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d94519330602-12" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d94519330602-13" class="crayon-line"><span class="crayon-h">        <span class="crayon-st">return<span class="crayon-h"> <span class="crayon-t">false<span class="crayon-sy">;</span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-14" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d94519330602-15" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759d94519330602-16" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>SupportedAnnotationTypes 表示这个 Processor 要处理的 Annotation 名字。<br>process 函数中参数 annotations 表示待处理的 Annotations，参数 env 表示当前或是之前的运行环境<br>process 函数返回值表示这组 annotations 是否被这个 Processor 接受，如果接受后续子的 rocessor 不会再对这个 Annotations 进行处理<br><br>### 六、几个 Android 开源库 Annotation 原理简析<br><br>#### 1 Annotation — Retrofit<br><br>(1) 调用<br><br><div id="crayon-5638beb759d99908633814" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d99908633814-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d99908633814-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d99908633814-3">3<br><br></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d99908633814-1" class="crayon-line"><span class="crayon-n">@GET<span class="crayon-sy">(<span class="crayon-s">“/users/{username}”<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759d99908633814-2" class="crayon-line crayon-striped-line"><span class="crayon-e">User <span class="crayon-e">getUser<span class="crayon-sy">(<span class="crayon-n">@Path<span class="crayon-sy">(<span class="crayon-s">“username”<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">username<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d99908633814-3" class="crayon-line"><br><br></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>(2) 定义<br><br><div id="crayon-5638beb759d9e313610539" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d9e313610539-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d9e313610539-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d9e313610539-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d9e313610539-4">4<br><div class="crayon-num" data-line="crayon-5638beb759d9e313610539-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d9e313610539-6">6<br><div class="crayon-num" data-line="crayon-5638beb759d9e313610539-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d9e313610539-8">8<br><br></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d9e313610539-1" class="crayon-line"><span class="crayon-n">@Documented</span><br><div id="crayon-5638beb759d9e313610539-2" class="crayon-line crayon-striped-line"><span class="crayon-n">@Target<span class="crayon-sy">(<span class="crayon-v">METHOD<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759d9e313610539-3" class="crayon-line"><span class="crayon-n">@Retention<span class="crayon-sy">(<span class="crayon-v">RUNTIME<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759d9e313610539-4" class="crayon-line crayon-striped-line"><span class="crayon-n">@RestMethod<span class="crayon-sy">(<span class="crayon-s">“GET”<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759d9e313610539-5" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-n">@interface<span class="crayon-h"> <span class="crayon-e">GET<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d9e313610539-6" class="crayon-line crayon-striped-line"><span class="crayon-h">  <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-e">value<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d9e313610539-7" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759d9e313610539-8" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>从定义可看出 Retrofit 的 Get Annotation 是运行时 Annotation，并且只能用于修饰 Method<br>(3) 原理<br><br><div id="crayon-5638beb759da2719832831" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-2">2<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-4">4<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-6">6<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-8">8<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-10">10<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-12">12<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-14">14<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-15">15<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759da2719832831-1" class="crayon-line"><span class="crayon-m">private<span class="crayon-h"> <span class="crayon-t">void<span class="crayon-h"> <span class="crayon-e">parseMethodAnnotations<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-2" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-e">Annotation <span class="crayon-v">methodAnnotation<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">method<span class="crayon-sy">.<span class="crayon-e">getAnnotations<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-3" class="crayon-line"><span class="crayon-h">    <span class="crayon-t">Class<span class="crayon-o">&lt;<span class="crayon-sy">?<span class="crayon-h"> <span class="crayon-r">extends<span class="crayon-h"> <span class="crayon-v">Annotation<span class="crayon-o">&gt;<span class="crayon-h"> <span class="crayon-v">annotationType<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">methodAnnotation<span class="crayon-sy">.<span class="crayon-e">annotationType<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-4" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-e">RestMethod <span class="crayon-v">methodInfo<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-t">null<span class="crayon-sy">;</span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-5" class="crayon-line"><br><div id="crayon-5638beb759da2719832831-6" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-e">Annotation <span class="crayon-v">innerAnnotation<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">annotationType<span class="crayon-sy">.<span class="crayon-e">getAnnotations<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-7" class="crayon-line"><span class="crayon-h">        <span class="crayon-st">if<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-v">RestMethod<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-h"> <span class="crayon-o">==<span class="crayon-h"> <span class="crayon-v">innerAnnotation<span class="crayon-sy">.<span class="crayon-e">annotationType<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-8" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-v">methodInfo<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-v">RestMethod<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-v">innerAnnotation<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-9" class="crayon-line"><span class="crayon-h">            <span class="crayon-st">break<span class="crayon-sy">;</span></span></span><br><div id="crayon-5638beb759da2719832831-10" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759da2719832831-11" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759da2719832831-12" class="crayon-line crayon-striped-line"><span class="crayon-h">    ……</span><br><div id="crayon-5638beb759da2719832831-13" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759da2719832831-14" class="crayon-line crayon-striped-line"><span class="crayon-sy">}<span class="crayon-h">   </span></span><br><div id="crayon-5638beb759da2719832831-15" class="crayon-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br><a href="https://github.com/square/retrofit/blob/master/retrofit/src/main/java/retrofit/RestMethodInfo.java" target="_blank" rel="noopener">RestMethodInfo.java</a> 的 parseMethodAnnotations 方法如上，会检查每个方法的每个 Annotation， 看是否被 RestMethod 这个 Annotation 修饰的 Annotation 修饰，这个有点绕，就是是否被 GET、DELETE、POST、PUT、HEAD、PATCH 这些 Annotation 修饰，然后得到 Annotation 信息，在对接口进行动态代理时会掉用到这些 Annotation 信息从而完成调用。 因为 Retrofit 原理设计到动态代理，这里只介绍 Annotation，具体原理分析请等待 <a href="https://github.com/android-cn/android-open-project-analysis" target="_blank" rel="noopener">Android 优秀开源项目实现原理解析</a> 项目的完成<br><br>#### 2 Annotation — Butter Knife<br><br>(1) 调用<br><br><div id="crayon-5638beb759da8856652783" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759da8856652783-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da8856652783-2">2<br><div class="crayon-num" data-line="crayon-5638beb759da8856652783-3">3<br><br></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759da8856652783-1" class="crayon-line"><span class="crayon-n">@InjectView<span class="crayon-sy">(<span class="crayon-v">R<span class="crayon-sy">.<span class="crayon-v">id<span class="crayon-sy">.<span class="crayon-v">user<span class="crayon-sy">)</span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da8856652783-2" class="crayon-line crayon-striped-line"><span class="crayon-e">EditText <span class="crayon-v">username<span class="crayon-sy">;</span></span></span><br><div id="crayon-5638beb759da8856652783-3" class="crayon-line"><br><br></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>(2) 定义<br><br><div id="crayon-5638beb759dac990857224" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759dac990857224-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dac990857224-2">2<br><div class="crayon-num" data-line="crayon-5638beb759dac990857224-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dac990857224-4">4<br><div class="crayon-num" data-line="crayon-5638beb759dac990857224-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dac990857224-6">6<br><br></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759dac990857224-1" class="crayon-line"><span class="crayon-n">@Retention<span class="crayon-sy">(<span class="crayon-t">CLASS<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759dac990857224-2" class="crayon-line crayon-striped-line"><span class="crayon-n">@Target<span class="crayon-sy">(<span class="crayon-v">FIELD<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759dac990857224-3" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-n">@interface<span class="crayon-h"> <span class="crayon-e">InjectView<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span><br><div id="crayon-5638beb759dac990857224-4" class="crayon-line crayon-striped-line"><span class="crayon-h">  <span class="crayon-t">int<span class="crayon-h"> <span class="crayon-e">value<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759dac990857224-5" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759dac990857224-6" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>可看出 Butter Knife 的 InjectView Annotation 是编译时 Annotation，并且只能用于修饰属性<br>(3) 原理<br><br><div id="crayon-5638beb759db0433843098" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-2">2<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-4">4<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-6">6<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-8">8<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-10">10<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-12">12<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-14">14<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-15">15<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-16">16<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-17">17<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-18">18<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-19">19<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-20">20<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-21">21<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-22">22<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759db0433843098-1" class="crayon-line"><span class="crayon-n">@Override</span><br><div id="crayon-5638beb759db0433843098-2" class="crayon-line crayon-striped-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">boolean<span class="crayon-h"> <span class="crayon-e">process<span class="crayon-sy">(<span class="crayon-v">Set<span class="crayon-o">&lt;<span class="crayon-sy">?<span class="crayon-h"> <span class="crayon-r">extends<span class="crayon-h"> <span class="crayon-v">TypeElement<span class="crayon-o">&gt;<span class="crayon-h"> <span class="crayon-v">elements<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-e">RoundEnvironment <span class="crayon-v">env<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-3" class="crayon-line"><span class="crayon-h">    <span class="crayon-v">Map<span class="crayon-o">&lt;<span class="crayon-v">TypeElement<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">ViewInjector<span class="crayon-o">&gt;<span class="crayon-h"> <span class="crayon-v">targetClassMap<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-e">findAndParseTargets<span class="crayon-sy">(<span class="crayon-v">env<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-4" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759db0433843098-5" class="crayon-line"><span class="crayon-h">    <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-v">Map<span class="crayon-sy">.<span class="crayon-v">Entry<span class="crayon-o">&lt;<span class="crayon-v">TypeElement<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">ViewInjector<span class="crayon-o">&gt;<span class="crayon-h"> <span class="crayon-v">entry<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">targetClassMap<span class="crayon-sy">.<span class="crayon-e">entrySet<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-6" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-e">TypeElement <span class="crayon-v">typeElement<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">entry<span class="crayon-sy">.<span class="crayon-e">getKey<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-7" class="crayon-line"><span class="crayon-h">        <span class="crayon-e">ViewInjector <span class="crayon-v">viewInjector<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">entry<span class="crayon-sy">.<span class="crayon-e">getValue<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-8" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759db0433843098-9" class="crayon-line"><span class="crayon-h">        <span class="crayon-st">try<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span><br><div id="crayon-5638beb759db0433843098-10" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-e">JavaFileObject <span class="crayon-v">jfo<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">filer<span class="crayon-sy">.<span class="crayon-e">createSourceFile<span class="crayon-sy">(<span class="crayon-v">viewInjector<span class="crayon-sy">.<span class="crayon-e">getFqcn<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">typeElement<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-11" class="crayon-line"><span class="crayon-h">            <span class="crayon-e">Writer <span class="crayon-v">writer<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">jfo<span class="crayon-sy">.<span class="crayon-e">openWriter<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-12" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-v">writer<span class="crayon-sy">.<span class="crayon-e">write<span class="crayon-sy">(<span class="crayon-v">viewInjector<span class="crayon-sy">.<span class="crayon-e">brewJava<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-13" class="crayon-line"><span class="crayon-h">            <span class="crayon-v">writer<span class="crayon-sy">.<span class="crayon-e">flush<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-14" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-v">writer<span class="crayon-sy">.<span class="crayon-e">close<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-15" class="crayon-line"><span class="crayon-h">        <span class="crayon-sy">}<span class="crayon-h"> <span class="crayon-st">catch<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-i">IOException<span class="crayon-h"> <span class="crayon-v">e<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-16" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-e">error<span class="crayon-sy">(<span class="crayon-v">typeElement<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-s">“Unable to write injector for type %s: %s”<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">typeElement<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">e<span class="crayon-sy">.<span class="crayon-e">getMessage<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-17" class="crayon-line"><span class="crayon-h">        <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759db0433843098-18" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759db0433843098-19" class="crayon-line"><br><div id="crayon-5638beb759db0433843098-20" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-st">return<span class="crayon-h"> <span class="crayon-t">true<span class="crayon-sy">;</span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-21" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759db0433843098-22" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br><a href="https://github.com/JakeWharton/butterknife/blob/master/butterknife/src/main/java/butterknife/internal/ButterKnifeProcessor.java" target="_blank" rel="noopener">ButterKnifeProcessor.java</a> 的 process 方法如上，编译时，在此方法中过滤 InjectView 这个 Annotation 到 targetClassMap 后，会根据 targetClassMap 中元素生成不同的 class 文件到最终的 APK 中，然后在运行时调用 ButterKnife.inject(x) 函数时会到之前编译时生成的类中去找。 这里只介绍 Annotation，具体原理分析请等待 <a href="https://github.com/android-cn/android-open-project-analysis" target="_blank" rel="noopener">Android 优秀开源项目实现原理解析</a> 项目的完成<br><br>#### 3 Annotation — ActiveAndroid<br><br>(1) 调用<br><br><div id="crayon-5638beb759db6452205042" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759db6452205042-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db6452205042-2">2<br><div class="crayon-num" data-line="crayon-5638beb759db6452205042-3">3<br><br></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759db6452205042-1" class="crayon-line"><span class="crayon-n">@Column<span class="crayon-sy">(<span class="crayon-v">name<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> “<span class="crayon-i">Name”<span class="crayon-sy">)</span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db6452205042-2" class="crayon-line crayon-striped-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">name<span class="crayon-sy">;</span></span></span></span></span></span><br><div id="crayon-5638beb759db6452205042-3" class="crayon-line"><br><br></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>(2) 定义<br><br><div id="crayon-5638beb759dba247022951" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759dba247022951-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dba247022951-2">2<br><div class="crayon-num" data-line="crayon-5638beb759dba247022951-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dba247022951-4">4<br><div class="crayon-num" data-line="crayon-5638beb759dba247022951-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dba247022951-6">6<br><br></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759dba247022951-1" class="crayon-line"><span class="crayon-n">@Target<span class="crayon-sy">(<span class="crayon-v">ElementType<span class="crayon-sy">.<span class="crayon-v">FIELD<span class="crayon-sy">)</span></span></span></span></span></span><br><div id="crayon-5638beb759dba247022951-2" class="crayon-line crayon-striped-line"><span class="crayon-n">@Retention<span class="crayon-sy">(<span class="crayon-v">RetentionPolicy<span class="crayon-sy">.<span class="crayon-v">RUNTIME<span class="crayon-sy">)</span></span></span></span></span></span><br><div id="crayon-5638beb759dba247022951-3" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-n">@interface<span class="crayon-h"> <span class="crayon-e">Column<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span><br><div id="crayon-5638beb759dba247022951-4" class="crayon-line crayon-striped-line"><span class="crayon-h">  ……</span><br><div id="crayon-5638beb759dba247022951-5" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759dba247022951-6" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>可看出 ActiveAndroid 的 Column Annotation 是运行时 Annotation，并且只能用于修饰属性<br>(3) 原理<br><br><div id="crayon-5638beb759dbe145106477" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-2">2<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-4">4<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-6">6<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-8">8<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-10">10<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-12">12<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-14">14<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-15">15<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-16">16<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-17">17<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-18">18<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759dbe145106477-1" class="crayon-line"><span class="crayon-e">Field <span class="crayon-v">idField<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-e">getIdField<span class="crayon-sy">(<span class="crayon-v">type<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-2" class="crayon-line crayon-striped-line"><span class="crayon-v">mColumnNames<span class="crayon-sy">.<span class="crayon-e">put<span class="crayon-sy">(<span class="crayon-v">idField<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">mIdName<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-3" class="crayon-line"><br><div id="crayon-5638beb759dbe145106477-4" class="crayon-line crayon-striped-line"><span class="crayon-v">List<span class="crayon-e "><field><span class="crayon-h"> <span class="crayon-v">fields<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-r">new<span class="crayon-h"> <span class="crayon-v">LinkedList<span class="crayon-e "><field><span class="crayon-sy">(<span class="crayon-v">ReflectionUtils<span class="crayon-sy">.<span class="crayon-e">getDeclaredColumnFields<span class="crayon-sy">(<span class="crayon-v">type<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></field></span></span></span></span></span></span></span></span></span></field></span></span><br><div id="crayon-5638beb759dbe145106477-5" class="crayon-line"><span class="crayon-v">Collections<span class="crayon-sy">.<span class="crayon-e">reverse<span class="crayon-sy">(<span class="crayon-v">fields<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-6" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759dbe145106477-7" class="crayon-line"><span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-e">Field <span class="crayon-v">field<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">fields<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-8" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-st">if<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-v">field<span class="crayon-sy">.<span class="crayon-e">isAnnotationPresent<span class="crayon-sy">(<span class="crayon-v">Column<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-9" class="crayon-line"><span class="crayon-h">        <span class="crayon-m">final<span class="crayon-h"> <span class="crayon-e">Column <span class="crayon-v">columnAnnotation<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">field<span class="crayon-sy">.<span class="crayon-e">getAnnotation<span class="crayon-sy">(<span class="crayon-v">Column<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-10" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">columnName<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">columnAnnotation<span class="crayon-sy">.<span class="crayon-e">name<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-11" class="crayon-line"><span class="crayon-h">        <span class="crayon-st">if<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-v">TextUtils<span class="crayon-sy">.<span class="crayon-e">isEmpty<span class="crayon-sy">(<span class="crayon-v">columnName<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-12" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-v">columnName<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">field<span class="crayon-sy">.<span class="crayon-e">getName<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-13" class="crayon-line"><span class="crayon-h">        <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759dbe145106477-14" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759dbe145106477-15" class="crayon-line"><span class="crayon-h">        <span class="crayon-v">mColumnNames<span class="crayon-sy">.<span class="crayon-e">put<span class="crayon-sy">(<span class="crayon-v">field<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">columnName<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-16" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759dbe145106477-17" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759dbe145106477-18" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br><a href="https://github.com/pardom/ActiveAndroid/blob/master/src/com/activeandroid/TableInfo.java" target="_blank" rel="noopener">TableInfo.java</a> 的构造函数如上，运行时，得到所有行信息并存储起来用来构件表信息。<br><br>这里原理都只介绍 Annotation，具体原理分析请等待 <a href="https://github.com/android-cn/android-open-project-analysis" target="_blank" rel="noopener">Android 优秀开源项目实现原理解析</a> 项目的完成<br><br>最后留下一个小问题：<strong>如何判断一个 Annotation 是运行时还是编译时生效以及如何快速找到它的解析代码</strong><br><br>前面的示例代码运行结果应该是 10 而不是 1，这个示例代码程序实际想说明的是标记型注解 Override 的作用，为 equals 方法加上 Override 注解就知道 equals 方法的重载是错误的，参数不对<br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/4ed8b0f.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/4ed8b0f.html" itemprop="url">Android 使用dagger2进行依赖注入(基础篇）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-03T22:35:00+08:00">
                2015-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="0-前言"><a href="#0-前言" class="headerlink" title="0. 前言"></a>0. 前言</h1><p>Dagger2是首个使用生成代码实现完整依赖注入的框架，极大减少了使用者的编码负担，<br>本文主要介绍如何使用dagger2进行依赖注入。如果你不还不了解依赖注入，请看<a href="http://codethink.me/2015/08/01/dependency-injection-theory/" target="_blank" rel="noopener">这一篇</a>。</p>
<h1 id="1-简单的依赖注入"><a href="#1-简单的依赖注入" class="headerlink" title="1. 简单的依赖注入"></a>1. 简单的依赖注入</h1><p>首先我们构建一个简单Android应用。我们创建一个UserModel，然后将它显示到TextView中。这里的问题是，在创建UserModel的时候，我们使用了<a href="http://codethink.me/2015/08/01/dependency-injection-theory/" target="_blank" rel="noopener">前文</a>所说的hard init。一旦我们的UserModel的创建方式发生了改变（比如需要传入Context对象到构造函数），我们就需要修改所有创建UserModel的代码。而我们希望的是，对于UserModel的修改不影响其他模块的代码（比如这里的MainActivity）。  </p>
<table><br><tbody><br><tr><br><td class="gutter"><br><br><span class="line">1<br><span class="line">2<br><span class="line">3<br><span class="line">4<br><span class="line">5<br><span class="line">6<br><span class="line">7<br><span class="line">8<br><span class="line">9<br><span class="line">10<br><span class="line">11<br></span></span></span></span></span></span></span></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;td class=&quot;code&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class &lt;span class=&quot;title&quot;&gt;MainActivity &lt;span class=&quot;keyword&quot;&gt;extends &lt;span class=&quot;title&quot;&gt;ActionBarActivity &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected &lt;span class=&quot;keyword&quot;&gt;void &lt;span class=&quot;title&quot;&gt;onCreate&lt;span class=&quot;params&quot;&gt;(Bundle savedInstanceState) &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super.onCreate(savedInstanceState);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        setContentView(R.layout.activity_main);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        UserModel user = &lt;span class=&quot;keyword&quot;&gt;new UserModel();  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        ((TextView) findViewById(R.id.user_desc_line)).setText(user.id + &lt;span class=&quot;string&quot;&gt;&quot;\n&quot; + user.name + &lt;span class=&quot;string&quot;&gt;&quot;\n&quot; + user.gender);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &#125;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    ...  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&#125;  </span><br><span class="line">&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br></td><br></tr><br></tbody><br></table>

<h2 id="1-1-构建依赖"><a href="#1-1-构建依赖" class="headerlink" title="1.1 构建依赖"></a>1.1 构建依赖</h2><p>我们首先想到的是，将创建UserModel的代码独立出来，这样可以保证MainActivity的代码不被修改。dagger2中，这个负责提供依赖的组件被称为Module。我们构建的ActivityModule代码如下所示。</p>
<table><br><tbody><br><tr><br><td class="gutter"><br><br><span class="line">1<br><span class="line">2<br><span class="line">3<br><span class="line">4<br><span class="line">5<br><span class="line">6<br><span class="line">7<br></span></span></span></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;td class=&quot;code&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Module  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class &lt;span class=&quot;title&quot;&gt;ActivityModule &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Provides &lt;span class=&quot;function&quot;&gt;UserModel &lt;span class=&quot;title&quot;&gt;provideUserModel&lt;span class=&quot;params&quot;&gt;() &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return &lt;span class=&quot;keyword&quot;&gt;new UserModel();  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &#125;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&#125;  </span><br><span class="line">&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br></td><br></tr><br></tbody><br></table>

<p>可以看到，我们使用@Module标识类型为module，并用@Provides标识提供依赖的方法。</p>
<h2 id="1-2-构建Injector"><a href="#1-2-构建Injector" class="headerlink" title="1.2 构建Injector"></a>1.2 构建Injector</h2><p>有了提供依赖的组件，我们还需要将依赖注入到需要的对象中。连接提供依赖和消费依赖对象的组件被称为Injector。dagger2中，我们将其称为component。ActivityComponent代码如下：</p>
<table><br><tbody><br><tr><br><td class="gutter"><br><br><span class="line">1<br><span class="line">2<br><span class="line">3<br><span class="line">4<br></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;td class=&quot;code&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Component(modules = ActivityModule.class)  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface &lt;span class=&quot;title&quot;&gt;ActivityComponent &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void &lt;span class=&quot;title&quot;&gt;inject&lt;span class=&quot;params&quot;&gt;(MainActivity activity);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&#125;  </span><br><span class="line">&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br></td><br></tr><br></tbody><br></table>

<p>可以看到，Component是一个使用@Component标识的Java interface。interface的inject方法需要一个消耗依赖的类型对象作为参数。<br><strong>注意：这里必须是真正消耗依赖的类型MainActivity，而不可以写成其父类，比如Activity。因为dagger2在编译时生成依赖注入的代码，会到inject方法的参数类型中寻找可以注入的对象，但是实际上这些对象存在于MainActivity，而不是Activity中。如果函数声明参数为Activity，dagger2会认为没有需要注入的对象。当真正在MainActivity中创建Component实例进行注入时，会直接执行按照Activity作为参数生成的inject方法，导致所有注入都失败。(是的，我是掉进这个坑了。)</strong></p>
<h2 id="1-3-完成依赖注入"><a href="#1-3-完成依赖注入" class="headerlink" title="1.3 完成依赖注入"></a>1.3 完成依赖注入</h2><p>最后，我们需要在MainActivity中构建Injector对象，完成注入。这部分代码如下所示。</p>
<table><br><tbody><br><tr><br><td class="gutter"><br><br><span class="line">1<br><span class="line">2<br><span class="line">3<br><span class="line">4<br><span class="line">5<br><span class="line">6<br><span class="line">7<br><span class="line">8<br><span class="line">9<br><span class="line">10<br><span class="line">11<br><span class="line">12<br><span class="line">13<br><span class="line">14<br><span class="line">15<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;td class=&quot;code&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class &lt;span class=&quot;title&quot;&gt;MainActivity &lt;span class=&quot;keyword&quot;&gt;extends &lt;span class=&quot;title&quot;&gt;ActionBarActivity &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private ActivityComponent mActivityComponent;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Inject UserModel userModel;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected &lt;span class=&quot;keyword&quot;&gt;void &lt;span class=&quot;title&quot;&gt;onCreate&lt;span class=&quot;params&quot;&gt;(Bundle savedInstanceState) &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super.onCreate(savedInstanceState);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        setContentView(R.layout.activity_main);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        mActivityComponent = DaggerActivityComponent.builder().activityModule(&lt;span class=&quot;keyword&quot;&gt;new ActivityModule()).build();  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        mActivityComponent.inject(&lt;span class=&quot;keyword&quot;&gt;this);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        ((TextView) findViewById(R.id.user_desc_line)).setText(userModel.id + &lt;span class=&quot;string&quot;&gt;&quot;\n&quot; + userModel.name + &lt;span class=&quot;string&quot;&gt;&quot;\n&quot; + userModel.gender);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &#125;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    ...  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&#125;  </span><br><span class="line">&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br></td><br></tr><br></tbody><br></table>

<p>首先，我们使用@Inject标志被注入的对象userModel（注意userModel不能为private），之后通过dagger2生成的实现了我们提供的ActivityComponent接口类DaggerActivityComponent创建component，调用其inject方法完成注入。</p>
<p>至此，我们使用dagger实现了最简单的依赖注入。</p>
<h1 id="2-多层依赖"><a href="#2-多层依赖" class="headerlink" title="2. 多层依赖"></a>2. 多层依赖</h1><p>除了上面这种最简单的形式，dagger2还可以使用component作为component的依赖，实现多层级的依赖注入。</p>
<h2 id="2-1-构建依赖"><a href="#2-1-构建依赖" class="headerlink" title="2.1 构建依赖"></a>2.1 构建依赖</h2><p>我们新创建一个名为ShoppingCartModel的Domain Model。并按照1.1的方法构建其Module如下。</p>
<table><br><tbody><br><tr><br><td class="gutter"><br><br><span class="line">1<br><span class="line">2<br><span class="line">3<br><span class="line">4<br><span class="line">5<br><span class="line">6<br></span></span></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;td class=&quot;code&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Module  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class &lt;span class=&quot;title&quot;&gt;ContainerModule &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Provides &lt;span class=&quot;function&quot;&gt;ShoppingCartModel &lt;span class=&quot;title&quot;&gt;provideCartModel&lt;span class=&quot;params&quot;&gt;() &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return &lt;span class=&quot;keyword&quot;&gt;new ShoppingCartModel();  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &#125;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&#125;  </span><br><span class="line">&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br></td><br></tr><br></tbody><br></table>

<h2 id="2-2-构建Injector"><a href="#2-2-构建Injector" class="headerlink" title="2.2 构建Injector"></a>2.2 构建Injector</h2><p>与1.2不同的是，我们的Injector提供的依赖不仅来自ContainerModule，我们还需要使用之前的ActivityComponent提供的UserModel依赖。</p>
<table><br><tbody><br><tr><br><td class="gutter"><br><br><span class="line">1<br><span class="line">2<br><span class="line">3<br><span class="line">4<br></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;td class=&quot;code&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Component(dependencies = ActivityComponent.class, modules = ContainerModule.class)  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface &lt;span class=&quot;title&quot;&gt;ContainerComponent &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void &lt;span class=&quot;title&quot;&gt;inject&lt;span class=&quot;params&quot;&gt;(MainActivity mainActivity);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&#125;  </span><br><span class="line">&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br></td><br></tr><br></tbody><br></table>

<p>所以如代码所示，我们在component后增加ActivityComponent了dependencies参数，使得一个Component成为了另一个Component的依赖。</p>
<h2 id="2-3-低级Component提供依赖"><a href="#2-3-低级Component提供依赖" class="headerlink" title="2.3 低级Component提供依赖"></a>2.3 低级Component提供依赖</h2><p>目前的ActivityComponent代码如下所示。可以看到其只提供了inject方法，而没有提供需要的UserModel依赖。我们需要的是将ActivityModule提供的UserModel传递给依赖ActivityComponent的ContainerComponent。</p>
<p><span style="line-height: 1.5;">修改后代码如下：</span> </p>
<table><br><tbody><br><tr><br><td class="gutter"><br><br><span class="line">1<br><span class="line">2<br><span class="line">3<br><span class="line">4<br><span class="line">5<br></span></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;td class=&quot;code&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;annotation&quot;&gt;@Component(modules = ActivityModule.class)  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface &lt;span class=&quot;title&quot;&gt;ActivityComponent &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//    void inject(MainActivity activity);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;UserModel &lt;span class=&quot;title&quot;&gt;userModel&lt;span class=&quot;params&quot;&gt;();  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&#125;  </span><br><span class="line">&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br></td><br></tr><br></tbody><br></table>

<p>可以看到，我们为接口增加了提供UserModel依赖的方法，同时，如果不需要使它直接进行注入，可以去掉其inject方法，此时该Component只作为一种依赖的组织模块。</p>
<p>最后，MainActivity中进行依赖注入的代码如下。</p>
<table><br><tbody><br><tr><br><td class="gutter"><br><br><span class="line">1<br><span class="line">2<br><span class="line">3<br><span class="line">4<br><span class="line">5<br><span class="line">6<br><span class="line">7<br><span class="line">8<br><span class="line">9<br><span class="line">10<br><span class="line">11<br><span class="line">12<br><span class="line">13<br><span class="line">14<br><span class="line">15<br><span class="line">16<br><span class="line">17<br><span class="line">18<br><span class="line">19<br><span class="line">20<br><span class="line">21<br><span class="line">22<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;td class=&quot;code&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class &lt;span class=&quot;title&quot;&gt;MainActivity &lt;span class=&quot;keyword&quot;&gt;extends &lt;span class=&quot;title&quot;&gt;ActionBarActivity &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private ActivityComponent mActivityComponent;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Inject  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    UserModel userModel;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Inject  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    ShoppingCartModel cartModel;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;annotation&quot;&gt;@Override  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected &lt;span class=&quot;keyword&quot;&gt;void &lt;span class=&quot;title&quot;&gt;onCreate&lt;span class=&quot;params&quot;&gt;(Bundle savedInstanceState) &#123;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super.onCreate(savedInstanceState);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        setContentView(R.layout.activity_main);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        mActivityComponent = DaggerActivityComponent.builder().activityModule(&lt;span class=&quot;keyword&quot;&gt;new ActivityModule()).build();  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        ContainerComponent containerComponent = DaggerContainerComponent.builder().activityComponent(mActivityComponent).containerModule(&lt;span class=&quot;keyword&quot;&gt;new ContainerModule()).build();  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        containerComponent.inject(&lt;span class=&quot;keyword&quot;&gt;this);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;        ((TextView) findViewById(R.id.user_desc_line)).setText(userModel.id + &lt;span class=&quot;string&quot;&gt;&quot;\n&quot; + userModel.name + &lt;span class=&quot;string&quot;&gt;&quot;\n&quot; + userModel.gender + &lt;span class=&quot;string&quot;&gt;&quot;\n&quot; + cartModel.total);  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    &#125;  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;    ...  </span><br><span class="line">&lt;span class=&quot;line&quot;&gt;&#125;  </span><br><span class="line">&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure><br><br></td><br></tr><br></tbody><br></table>

<h1 id="3-最后"><a href="#3-最后" class="headerlink" title="3. 最后"></a>3. 最后</h1><p>本文试图用最简单的例子介绍Android中如何使用dagger2进行依赖注入，因此有很多dagger2的特性并未涉及，比如@Scope注释，以及dagger2自动生成代码的分析调试。关于dagger2更深入的特性的分析，还需要在大量使用后再做出总结。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="http://google.github.io/dagger/" target="_blank" rel="noopener">Dagger 2</a></li>
<li><a href="http://fernandocejas.com/2015/04/11/tasting-dagger-2-on-android/" target="_blank" rel="noopener">Tasting Dagger 2 on Android</a></li>
<li><a href="http://frogermcs.github.io/dependency-injection-with-dagger-2-the-api/" target="_blank" rel="noopener">Dependency injection with Dagger 2 - the API</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/36/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/36/">36</a><span class="page-number current">37</span><a class="page-number" href="/page/38/">38</a><span class="space">&hellip;</span><a class="page-number" href="/page/42/">42</a><a class="extend next" rel="next" href="/page/38/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4" alt="庞国明">
            
              <p class="site-author-name" itemprop="name">庞国明</p>
              <p class="site-description motion-element" itemprop="description">Software make the information world run, and programer make the softeware run.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">420</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">267</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/pangguoming" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:pangguoming@yeah.net" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/pangguoming" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/1570700/pangguoming" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/pangguoming" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i>Instagram</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">庞国明</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  

  

  
  

  

  

  

</body>
</html>
