<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Android,annotation,">










<meta name="description" content="PDF 版: Java Annotation.pdf, PPT 版：Java Annotation.pptx, Keynote 版：Java Annotation.key 一、Annotation 示例Override Annotation Java123@Overridepublic void onCreate(Bundle savedInstanceState);Retrofit Annota">
<meta name="keywords" content="Android,annotation">
<meta property="og:type" content="article">
<meta property="og:title" content="Java Annotation 及几个常用开源项目注解原理简析">
<meta property="og:url" content="http://pangguoming.com/post/ac85fa6b.html">
<meta property="og:site_name" content="庞国明-博客">
<meta property="og:description" content="PDF 版: Java Annotation.pdf, PPT 版：Java Annotation.pptx, Keynote 版：Java Annotation.key 一、Annotation 示例Override Annotation Java123@Overridepublic void onCreate(Bundle savedInstanceState);Retrofit Annota">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-07-10T03:30:55.787Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java Annotation 及几个常用开源项目注解原理简析">
<meta name="twitter:description" content="PDF 版: Java Annotation.pdf, PPT 版：Java Annotation.pptx, Keynote 版：Java Annotation.key 一、Annotation 示例Override Annotation Java123@Overridepublic void onCreate(Bundle savedInstanceState);Retrofit Annota">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://pangguoming.com/post/ac85fa6b.html">





  <title>Java Annotation 及几个常用开源项目注解原理简析 | 庞国明-博客</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">庞国明-博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">此心用度八千遍，不曾厌倦</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pangguoming.com/post/ac85fa6b.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="庞国明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庞国明-博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Java Annotation 及几个常用开源项目注解原理简析</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-03T22:42:00+08:00">
                2015-11-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/post/ac85fa6b.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/post/ac85fa6b.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>PDF 版: <a href="http://wugengxin.cn/download/pdf/android/java-annotation.pdf" target="_blank" rel="noopener">Java Annotation.pdf</a>, PPT 版：<a href="http://wugengxin.cn/download/pdf/android/java-annotation.pptx" target="_blank" rel="noopener">Java Annotation.pptx</a>, Keynote 版：<a href="https://github.com/Trinea/trinea.github.com/tree/master/download/pdf/android/java-annotation.key" target="_blank" rel="noopener">Java Annotation.key</a></p>
<h3 id="一、Annotation-示例"><a href="#一、Annotation-示例" class="headerlink" title="一、Annotation 示例"></a>一、Annotation 示例</h3><p>Override Annotation</p>
<div id="crayon-5638beb759d55737389229" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d55737389229-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d55737389229-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d55737389229-3">3<br><br></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d55737389229-1" class="crayon-line"><span class="crayon-n">@Override</span><br><div id="crayon-5638beb759d55737389229-2" class="crayon-line crayon-striped-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">void<span class="crayon-h"> <span class="crayon-e">onCreate<span class="crayon-sy">(<span class="crayon-e">Bundle <span class="crayon-v">savedInstanceState<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d55737389229-3" class="crayon-line"><br><br></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>Retrofit Annotation<br><br><div id="crayon-5638beb759d6a290188146" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d6a290188146-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d6a290188146-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d6a290188146-3">3<br><br></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d6a290188146-1" class="crayon-line"><span class="crayon-n">@GET<span class="crayon-sy">(<span class="crayon-s">“/users/{username}”<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759d6a290188146-2" class="crayon-line crayon-striped-line"><span class="crayon-e">User <span class="crayon-e">getUser<span class="crayon-sy">(<span class="crayon-n">@Path<span class="crayon-sy">(<span class="crayon-s">“username”<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">username<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d6a290188146-3" class="crayon-line"><br><br></div></div></div></div></td><br></tr><br></tbody><br></table><br><br>Butter Knife Annotation<br><br><div id="crayon-5638beb759d70828829286" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d70828829286-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d70828829286-2">2<br><br></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d70828829286-1" class="crayon-line"><span class="crayon-n">@InjectView<span class="crayon-sy">(<span class="crayon-v">R<span class="crayon-sy">.<span class="crayon-v">id<span class="crayon-sy">.<span class="crayon-v">user<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-e">EditText <span class="crayon-v">username<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d70828829286-2" class="crayon-line crayon-striped-line"><br><br></div></div></div></td><br></tr><br></tbody><br></table><br><br>ActiveAndroid Annotation<br><br><div id="crayon-5638beb759d74089343673" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d74089343673-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d74089343673-2">2<br><br></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d74089343673-1" class="crayon-line"><span class="crayon-n">@Column<span class="crayon-sy">(<span class="crayon-v">name<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> “<span class="crayon-i">Name”<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">name<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d74089343673-2" class="crayon-line crayon-striped-line"><br><br></div></div></div></td><br></tr><br></tbody><br></table><br><br>Retrofit 为符合 RESTful 规范的网络请求框架<br>Butter Knife 为 View 及事件等依赖注入框架<br>Active Android 为 ORM 框架<br>更多见：<a href="https://github.com/Trinea/android-open-project" target="_blank" rel="noopener">Android 开源项目汇总</a><br><br>### 二、Annotation 概念及作用<br><br>#### 1 概念<br><br>&gt; An annotation is a form of metadata, that can be added to Java source code. Classes, methods, variables, parameters and packages may be annotated. Annotations have no direct effect on the operation of the code they annotate.<br><br>能够添加到 Java 源代码的语法元数据。类、方法、变量、参数、包都可以被注解，可用来将信息元数据与程序元素进行关联。Annotation 中文常译为“注解”<br><br>#### 2 作用<br><br>a. 标记，用于告诉编译器一些信息<br>b. 编译时动态处理，如动态生成代码<br>c. 运行时动态处理，如得到注解信息<br>这里的三个作用实际对应着后面自定义 Annotation 时说的 @Retention 三种值分别表示的 Annotation<br>看看下面一段代码的运行结果是多少？<br><br><div id="crayon-5638beb759d7a404361265" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-4">4<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-6">6<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-8">8<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-10">10<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-12">12<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-14">14<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-15">15<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-16">16<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-17">17<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-18">18<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-19">19<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-20">20<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-21">21<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-22">22<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-23">23<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-24">24<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-25">25<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-26">26<br><div class="crayon-num" data-line="crayon-5638beb759d7a404361265-27">27<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7a404361265-28">28<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d7a404361265-1" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">class<span class="crayon-h"> <span class="crayon-e">Person<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-2" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d7a404361265-3" class="crayon-line"><span class="crayon-h">    <span class="crayon-m">private<span class="crayon-h"> <span class="crayon-t">int<span class="crayon-h">    <span class="crayon-v">id<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-4" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-m">private<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">name<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-5" class="crayon-line"><br><div id="crayon-5638beb759d7a404361265-6" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-e">Person<span class="crayon-sy">(<span class="crayon-t">int<span class="crayon-h"> <span class="crayon-v">id<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">name<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-7" class="crayon-line"><span class="crayon-h">        <span class="crayon-r">this<span class="crayon-sy">.<span class="crayon-v">id<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">id<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-8" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-r">this<span class="crayon-sy">.<span class="crayon-v">name<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">name<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-9" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d7a404361265-10" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d7a404361265-11" class="crayon-line"><span class="crayon-h">    <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">boolean<span class="crayon-h"> <span class="crayon-e">equals<span class="crayon-sy">(<span class="crayon-e">Person <span class="crayon-v">person<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-12" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-st">return<span class="crayon-h"> <span class="crayon-v">person<span class="crayon-sy">.<span class="crayon-v">id<span class="crayon-h"> <span class="crayon-o">==<span class="crayon-h"> <span class="crayon-v">id<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-13" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d7a404361265-14" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d7a404361265-15" class="crayon-line"><span class="crayon-h">    <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">int<span class="crayon-h"> <span class="crayon-e">hashCode<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-16" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-st">return<span class="crayon-h"> <span class="crayon-v">id<span class="crayon-sy">;</span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-17" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d7a404361265-18" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d7a404361265-19" class="crayon-line"><span class="crayon-h">    <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-m">static<span class="crayon-h"> <span class="crayon-t">void<span class="crayon-h"> <span class="crayon-e">main<span class="crayon-sy">(<span class="crayon-t">String<span class="crayon-sy">[<span class="crayon-sy">]<span class="crayon-h"> <span class="crayon-v">args<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-20" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d7a404361265-21" class="crayon-line"><span class="crayon-h">        <span class="crayon-v">Set<span class="crayon-e "><person><span class="crayon-h"> <span class="crayon-v">set<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-r">new<span class="crayon-h"> <span class="crayon-v">HashSet<span class="crayon-e "><person><span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></person></span></span></span></span></span></span></span></span></span></person></span></span></span><br><div id="crayon-5638beb759d7a404361265-22" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-t">int<span class="crayon-h"> <span class="crayon-v">i<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-cn">0<span class="crayon-sy">;<span class="crayon-h"> <span class="crayon-v">i<span class="crayon-h"> <span class="crayon-o">&lt;<span class="crayon-h"> <span class="crayon-cn">10<span class="crayon-sy">;<span class="crayon-h"> <span class="crayon-v">i<span class="crayon-o">++<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-23" class="crayon-line"><span class="crayon-h">            <span class="crayon-v">set<span class="crayon-sy">.<span class="crayon-e">add<span class="crayon-sy">(<span class="crayon-r">new<span class="crayon-h"> <span class="crayon-e">Person<span class="crayon-sy">(<span class="crayon-cn">1<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-s">“Jim”<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-24" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d7a404361265-25" class="crayon-line"><span class="crayon-h">        <span class="crayon-v">System<span class="crayon-sy">.<span class="crayon-v">out<span class="crayon-sy">.<span class="crayon-e">println<span class="crayon-sy">(<span class="crayon-v">set<span class="crayon-sy">.<span class="crayon-e">size<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7a404361265-26" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d7a404361265-27" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759d7a404361265-28" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>答案见本文最后<br><br>### 三、Annotation 分类<br><br>#### 1 标准 Annotation<br><br>包括Override, Deprecated, SuppressWarnings，标准 Annotation 是指 Java 自带的几个 Annotation，上面三个分别表示重写函数，函数已经被禁止使用，忽略某项 Warning<br><br>#### 2 元 Annotation<br><br>@Retention, @Target, @Inherited, @Documented，元 Annotation 是指用来定义 Annotation 的 Annotation，在后面 Annotation 自定义部分会详细介绍含义<br><br>#### 3 自定义 Annotation<br><br>自定义 Annotation 表示自己根据需要定义的 Annotation，定义时需要用到上面的元 Annotation<br>这里只是一种分类而已，也可以根据作用域分为源码时、编译时、运行时 Annotation，后面在自定义 Annotation 时会具体介绍<br><br>### 四、Annotation 自定义<br><br>#### 1 调用<br><br><div id="crayon-5638beb759d7f039876125" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d7f039876125-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7f039876125-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d7f039876125-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7f039876125-4">4<br><div class="crayon-num" data-line="crayon-5638beb759d7f039876125-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7f039876125-6">6<br><div class="crayon-num" data-line="crayon-5638beb759d7f039876125-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7f039876125-8">8<br><div class="crayon-num" data-line="crayon-5638beb759d7f039876125-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d7f039876125-10">10<br><div class="crayon-num" data-line="crayon-5638beb759d7f039876125-11">11<br><br></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d7f039876125-1" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">class<span class="crayon-h"> <span class="crayon-e">App<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7f039876125-2" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d7f039876125-3" class="crayon-line"><span class="crayon-h">    <span class="crayon-n">@MethodInfo<span class="crayon-sy">(</span></span></span><br><div id="crayon-5638beb759d7f039876125-4" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-v">author<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> “<span class="crayon-v">trinea<span class="crayon-sy">.<span class="crayon-v">cn<span class="crayon-o">+<span class="crayon-v">android<span class="crayon-n">@gmail<span class="crayon-sy">.<span class="crayon-i">com”<span class="crayon-sy">,</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7f039876125-5" class="crayon-line"><span class="crayon-h">        <span class="crayon-v">date<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-s">“2014/02/14”<span class="crayon-sy">,</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7f039876125-6" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-v">version<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-cn">2<span class="crayon-sy">)</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7f039876125-7" class="crayon-line"><span class="crayon-h">    <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-e">getAppName<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d7f039876125-8" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-st">return<span class="crayon-h"> <span class="crayon-s">“trinea”<span class="crayon-sy">;</span></span></span></span></span><br><div id="crayon-5638beb759d7f039876125-9" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d7f039876125-10" class="crayon-line crayon-striped-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759d7f039876125-11" class="crayon-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>这里是调用自定义 Annotation——MethodInfo 的示例，MethodInfo Annotation 作用为给方法添加相关信息，包括 author、date、version<br><br>#### 2 定义<br><br><div id="crayon-5638beb759d84447280122" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d84447280122-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d84447280122-4">4<br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d84447280122-6">6<br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d84447280122-8">8<br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d84447280122-10">10<br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d84447280122-12">12<br><div class="crayon-num" data-line="crayon-5638beb759d84447280122-13">13<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d84447280122-1" class="crayon-line"><span class="crayon-n">@Documented</span><br><div id="crayon-5638beb759d84447280122-2" class="crayon-line crayon-striped-line"><span class="crayon-n">@Retention<span class="crayon-sy">(<span class="crayon-v">RetentionPolicy<span class="crayon-sy">.<span class="crayon-v">RUNTIME<span class="crayon-sy">)</span></span></span></span></span></span><br><div id="crayon-5638beb759d84447280122-3" class="crayon-line"><span class="crayon-n">@Target<span class="crayon-sy">(<span class="crayon-v">ElementType<span class="crayon-sy">.<span class="crayon-v">METHOD<span class="crayon-sy">)</span></span></span></span></span></span><br><div id="crayon-5638beb759d84447280122-4" class="crayon-line crayon-striped-line"><span class="crayon-n">@Inherited</span><br><div id="crayon-5638beb759d84447280122-5" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-n">@interface<span class="crayon-h"> <span class="crayon-e">MethodInfo<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d84447280122-6" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d84447280122-7" class="crayon-line"><span class="crayon-h">    <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-e">author<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-st">default<span class="crayon-h"> <span class="crayon-s">“<a href="mailto:trinea@gmail.com" target="_blank" rel="noopener">trinea@gmail.com</a>“<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d84447280122-8" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d84447280122-9" class="crayon-line"><span class="crayon-h">    <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-e">date<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d84447280122-10" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759d84447280122-11" class="crayon-line"><span class="crayon-h">    <span class="crayon-t">int<span class="crayon-h"> <span class="crayon-e">version<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-st">default<span class="crayon-h"> <span class="crayon-cn">1<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d84447280122-12" class="crayon-line crayon-striped-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759d84447280122-13" class="crayon-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>这里是 MethodInfo 的实现部分<br>(1). 通过 @interface 定义，注解名即为自定义注解名<br>(2). 注解配置参数名为注解类的方法名，且：<br>a. 所有方法没有方法体，没有参数没有修饰符，实际只允许 public &amp; abstract 修饰符，默认为 public ，不允许抛异常<br>b. 方法返回值只能是基本类型，String, Class, annotation, enumeration 或者是他们的一维数组<br>c. 若只有一个默认属性，可直接用 value() 函数。一个属性都没有表示该 Annotation 为 Mark Annotation<br>(3). 可以加 default 表示默认值<br><br>#### 3 元 Annotation<br><br>@Documented 是否会保存到 Javadoc 文档中<br>@Retention 保留时间，可选值 SOURCE（源码时），CLASS（编译时），RUNTIME（运行时），默认为 CLASS，值为 SOURCE 大都为 Mark Annotation，这类 Annotation 大都用来校验，比如 Override, Deprecated, SuppressWarnings<br>@Target 可以用来修饰哪些程序元素，如 TYPE, METHOD, CONSTRUCTOR, FIELD, PARAMETER 等，未标注则表示可修饰所有<br>@Inherited 是否可以被继承，默认为 false<br><br>### 五、Annotation 解析<br><br>#### 1 运行时 Annotation 解析<br><br>(1) 运行时 Annotation 指 @Retention 为 RUNTIME 的 Annotation，可手动调用下面常用 API 解析<br><br><div id="crayon-5638beb759d8a844088324" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d8a844088324-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8a844088324-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d8a844088324-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8a844088324-4">4<br><br></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d8a844088324-1" class="crayon-line"><span class="crayon-v">method<span class="crayon-sy">.<span class="crayon-e">getAnnotation<span class="crayon-sy">(<span class="crayon-v">AnnotationName<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8a844088324-2" class="crayon-line crayon-striped-line"><span class="crayon-v">method<span class="crayon-sy">.<span class="crayon-e">getAnnotations<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span><br><div id="crayon-5638beb759d8a844088324-3" class="crayon-line"><span class="crayon-v">method<span class="crayon-sy">.<span class="crayon-e">isAnnotationPresent<span class="crayon-sy">(<span class="crayon-v">AnnotationName<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8a844088324-4" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>其他 @Target 如 Field，Class 方法类似<br>getAnnotation(AnnotationName.class) 表示得到该 Target 某个 Annotation 的信息，因为一个 Target 可以被多个 Annotation 修饰<br>getAnnotations() 则表示得到该 Target 所有 Annotation<br>isAnnotationPresent(AnnotationName.class) 表示该 Target 是否被某个 Annotation 修饰<br>(2) 解析示例如下：<br><br><div id="crayon-5638beb759d8e948564502" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-4">4<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-6">6<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-8">8<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-10">10<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-12">12<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-14">14<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-15">15<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-16">16<br><div class="crayon-num" data-line="crayon-5638beb759d8e948564502-17">17<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d8e948564502-18">18<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d8e948564502-1" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-m">static<span class="crayon-h"> <span class="crayon-t">void<span class="crayon-h"> <span class="crayon-e">main<span class="crayon-sy">(<span class="crayon-t">String<span class="crayon-sy">[<span class="crayon-sy">]<span class="crayon-h"> <span class="crayon-v">args<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-2" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-st">try<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span><br><div id="crayon-5638beb759d8e948564502-3" class="crayon-line"><span class="crayon-h">        <span class="crayon-t">Class<span class="crayon-h"> <span class="crayon-v">cls<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-t">Class<span class="crayon-sy">.<span class="crayon-e">forName<span class="crayon-sy">(<span class="crayon-s">“cn.trinea.java.test.annotation.App”<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-4" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-e">Method <span class="crayon-v">method<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">cls<span class="crayon-sy">.<span class="crayon-e">getMethods<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-5" class="crayon-line"><span class="crayon-h">            <span class="crayon-e">MethodInfo <span class="crayon-v">methodInfo<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">method<span class="crayon-sy">.<span class="crayon-e">getAnnotation<span class="crayon-sy">(</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-6" class="crayon-line crayon-striped-line"><span class="crayon-v">MethodInfo<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-7" class="crayon-line"><span class="crayon-h">            <span class="crayon-st">if<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-v">methodInfo<span class="crayon-h"> <span class="crayon-o">!=<span class="crayon-h"> <span class="crayon-t">null<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-8" class="crayon-line crayon-striped-line"><span class="crayon-h">                <span class="crayon-v">System<span class="crayon-sy">.<span class="crayon-v">out<span class="crayon-sy">.<span class="crayon-e">println<span class="crayon-sy">(<span class="crayon-s">“method name:”<span class="crayon-h"> <span class="crayon-o">+<span class="crayon-h"> <span class="crayon-v">method<span class="crayon-sy">.<span class="crayon-e">getName<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-9" class="crayon-line"><span class="crayon-h">                <span class="crayon-v">System<span class="crayon-sy">.<span class="crayon-v">out<span class="crayon-sy">.<span class="crayon-e">println<span class="crayon-sy">(<span class="crayon-s">“method author:”<span class="crayon-h"> <span class="crayon-o">+<span class="crayon-h"> <span class="crayon-v">methodInfo<span class="crayon-sy">.<span class="crayon-e">author<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-10" class="crayon-line crayon-striped-line"><span class="crayon-h">                <span class="crayon-v">System<span class="crayon-sy">.<span class="crayon-v">out<span class="crayon-sy">.<span class="crayon-e">println<span class="crayon-sy">(<span class="crayon-s">“method version:”<span class="crayon-h"> <span class="crayon-o">+<span class="crayon-h"> <span class="crayon-v">methodInfo<span class="crayon-sy">.<span class="crayon-e">version<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-11" class="crayon-line"><span class="crayon-h">                <span class="crayon-v">System<span class="crayon-sy">.<span class="crayon-v">out<span class="crayon-sy">.<span class="crayon-e">println<span class="crayon-sy">(<span class="crayon-s">“method date:”<span class="crayon-h"> <span class="crayon-o">+<span class="crayon-h"> <span class="crayon-v">methodInfo<span class="crayon-sy">.<span class="crayon-e">date<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-12" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d8e948564502-13" class="crayon-line"><span class="crayon-h">        <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d8e948564502-14" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}<span class="crayon-h"> <span class="crayon-st">catch<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-i">ClassNotFoundException<span class="crayon-h"> <span class="crayon-v">e<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-15" class="crayon-line"><span class="crayon-h">        <span class="crayon-v">e<span class="crayon-sy">.<span class="crayon-e">printStackTrace<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d8e948564502-16" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d8e948564502-17" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759d8e948564502-18" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>以之前自定义的 MethodInfo 为例，利用 Target（这里是 Method）getAnnotation 函数得到 Annotation 信息，然后就可以调用 Annotation 的方法得到响应属性值<br><br>#### 2 编译时 Annotation 解析<br><br>(1) 编译时 Annotation 指 @Retention 为 CLASS 的 Annotation，甴 <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/apt/GettingStarted.html" target="_blank" rel="noopener">apt(Annotation Processing Tool)</a> 解析自动解析。需要做的<br>a. 自定义类集成自 AbstractProcessor<br>b. 重写其中的 process 函数<br>这块很多同学不理解，实际是 <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/apt/GettingStarted.html" target="_blank" rel="noopener">apt(Annotation Processing Tool)</a> 在编译时自动查找所有继承自 AbstractProcessor 的类，然后调用他们的 process 方法去处理<br>(2) 假设之前自定义的 MethodInfo 的 @Retention 为 CLASS，解析示例如下：<br><br><div id="crayon-5638beb759d94519330602" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-4">4<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-6">6<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-8">8<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-10">10<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-12">12<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-14">14<br><div class="crayon-num" data-line="crayon-5638beb759d94519330602-15">15<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d94519330602-16">16<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d94519330602-1" class="crayon-line"><span class="crayon-n">@SupportedAnnotationTypes<span class="crayon-sy">(<span class="crayon-sy">{<span class="crayon-h"> <span class="crayon-s">“cn.trinea.java.test.annotation.MethodInfo”<span class="crayon-h"> <span class="crayon-sy">}<span class="crayon-sy">)</span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-2" class="crayon-line crayon-striped-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">class<span class="crayon-h"> <span class="crayon-e">MethodInfoProcessor<span class="crayon-h"> <span class="crayon-r">extends<span class="crayon-h"> <span class="crayon-e">AbstractProcessor<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-3" class="crayon-line"><br><div id="crayon-5638beb759d94519330602-4" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-n">@Override</span></span><br><div id="crayon-5638beb759d94519330602-5" class="crayon-line"><span class="crayon-h">    <span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">boolean<span class="crayon-h"> <span class="crayon-e">process<span class="crayon-sy">(<span class="crayon-v">Set<span class="crayon-o">&lt;<span class="crayon-sy">?<span class="crayon-h"> <span class="crayon-r">extends<span class="crayon-h"> <span class="crayon-v">TypeElement<span class="crayon-o">&gt;<span class="crayon-h"> <span class="crayon-v">annotations<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-e">RoundEnvironment <span class="crayon-v">env<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-6" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-v">HashMap<span class="crayon-o">&lt;<span class="crayon-t">String<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-o">&gt;<span class="crayon-h"> <span class="crayon-v">map<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-r">new<span class="crayon-h"> <span class="crayon-v">HashMap<span class="crayon-o">&lt;<span class="crayon-t">String<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-o">&gt;<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-7" class="crayon-line"><span class="crayon-h">        <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-e">TypeElement <span class="crayon-v">te<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">annotations<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-8" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-e">Element <span class="crayon-v">element<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">env<span class="crayon-sy">.<span class="crayon-e">getElementsAnnotatedWith<span class="crayon-sy">(<span class="crayon-v">te<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-9" class="crayon-line"><span class="crayon-h">                <span class="crayon-e">MethodInfo <span class="crayon-v">methodInfo<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">element<span class="crayon-sy">.<span class="crayon-e">getAnnotation<span class="crayon-sy">(<span class="crayon-v">MethodInfo<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-10" class="crayon-line crayon-striped-line"><span class="crayon-h">                <span class="crayon-v">map<span class="crayon-sy">.<span class="crayon-e">put<span class="crayon-sy">(<span class="crayon-v">element<span class="crayon-sy">.<span class="crayon-e">getEnclosingElement<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">.<span class="crayon-e">toString<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">methodInfo<span class="crayon-sy">.<span class="crayon-e">author<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-11" class="crayon-line"><span class="crayon-h">            <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d94519330602-12" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d94519330602-13" class="crayon-line"><span class="crayon-h">        <span class="crayon-st">return<span class="crayon-h"> <span class="crayon-t">false<span class="crayon-sy">;</span></span></span></span></span><br><div id="crayon-5638beb759d94519330602-14" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759d94519330602-15" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759d94519330602-16" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>SupportedAnnotationTypes 表示这个 Processor 要处理的 Annotation 名字。<br>process 函数中参数 annotations 表示待处理的 Annotations，参数 env 表示当前或是之前的运行环境<br>process 函数返回值表示这组 annotations 是否被这个 Processor 接受，如果接受后续子的 rocessor 不会再对这个 Annotations 进行处理<br><br>### 六、几个 Android 开源库 Annotation 原理简析<br><br>#### 1 Annotation — Retrofit<br><br>(1) 调用<br><br><div id="crayon-5638beb759d99908633814" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d99908633814-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d99908633814-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d99908633814-3">3<br><br></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d99908633814-1" class="crayon-line"><span class="crayon-n">@GET<span class="crayon-sy">(<span class="crayon-s">“/users/{username}”<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759d99908633814-2" class="crayon-line crayon-striped-line"><span class="crayon-e">User <span class="crayon-e">getUser<span class="crayon-sy">(<span class="crayon-n">@Path<span class="crayon-sy">(<span class="crayon-s">“username”<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">username<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759d99908633814-3" class="crayon-line"><br><br></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>(2) 定义<br><br><div id="crayon-5638beb759d9e313610539" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759d9e313610539-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d9e313610539-2">2<br><div class="crayon-num" data-line="crayon-5638beb759d9e313610539-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d9e313610539-4">4<br><div class="crayon-num" data-line="crayon-5638beb759d9e313610539-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d9e313610539-6">6<br><div class="crayon-num" data-line="crayon-5638beb759d9e313610539-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759d9e313610539-8">8<br><br></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759d9e313610539-1" class="crayon-line"><span class="crayon-n">@Documented</span><br><div id="crayon-5638beb759d9e313610539-2" class="crayon-line crayon-striped-line"><span class="crayon-n">@Target<span class="crayon-sy">(<span class="crayon-v">METHOD<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759d9e313610539-3" class="crayon-line"><span class="crayon-n">@Retention<span class="crayon-sy">(<span class="crayon-v">RUNTIME<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759d9e313610539-4" class="crayon-line crayon-striped-line"><span class="crayon-n">@RestMethod<span class="crayon-sy">(<span class="crayon-s">“GET”<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759d9e313610539-5" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-n">@interface<span class="crayon-h"> <span class="crayon-e">GET<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d9e313610539-6" class="crayon-line crayon-striped-line"><span class="crayon-h">  <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-e">value<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759d9e313610539-7" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759d9e313610539-8" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>从定义可看出 Retrofit 的 Get Annotation 是运行时 Annotation，并且只能用于修饰 Method<br>(3) 原理<br><br><div id="crayon-5638beb759da2719832831" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-2">2<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-4">4<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-6">6<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-8">8<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-10">10<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-12">12<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da2719832831-14">14<br><div class="crayon-num" data-line="crayon-5638beb759da2719832831-15">15<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759da2719832831-1" class="crayon-line"><span class="crayon-m">private<span class="crayon-h"> <span class="crayon-t">void<span class="crayon-h"> <span class="crayon-e">parseMethodAnnotations<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-2" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-e">Annotation <span class="crayon-v">methodAnnotation<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">method<span class="crayon-sy">.<span class="crayon-e">getAnnotations<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-3" class="crayon-line"><span class="crayon-h">    <span class="crayon-t">Class<span class="crayon-o">&lt;<span class="crayon-sy">?<span class="crayon-h"> <span class="crayon-r">extends<span class="crayon-h"> <span class="crayon-v">Annotation<span class="crayon-o">&gt;<span class="crayon-h"> <span class="crayon-v">annotationType<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">methodAnnotation<span class="crayon-sy">.<span class="crayon-e">annotationType<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-4" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-e">RestMethod <span class="crayon-v">methodInfo<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-t">null<span class="crayon-sy">;</span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-5" class="crayon-line"><br><div id="crayon-5638beb759da2719832831-6" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-e">Annotation <span class="crayon-v">innerAnnotation<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">annotationType<span class="crayon-sy">.<span class="crayon-e">getAnnotations<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-7" class="crayon-line"><span class="crayon-h">        <span class="crayon-st">if<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-v">RestMethod<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-h"> <span class="crayon-o">==<span class="crayon-h"> <span class="crayon-v">innerAnnotation<span class="crayon-sy">.<span class="crayon-e">annotationType<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-8" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-v">methodInfo<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-v">RestMethod<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-v">innerAnnotation<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da2719832831-9" class="crayon-line"><span class="crayon-h">            <span class="crayon-st">break<span class="crayon-sy">;</span></span></span><br><div id="crayon-5638beb759da2719832831-10" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759da2719832831-11" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759da2719832831-12" class="crayon-line crayon-striped-line"><span class="crayon-h">    ……</span><br><div id="crayon-5638beb759da2719832831-13" class="crayon-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759da2719832831-14" class="crayon-line crayon-striped-line"><span class="crayon-sy">}<span class="crayon-h">   </span></span><br><div id="crayon-5638beb759da2719832831-15" class="crayon-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br><a href="https://github.com/square/retrofit/blob/master/retrofit/src/main/java/retrofit/RestMethodInfo.java" target="_blank" rel="noopener">RestMethodInfo.java</a> 的 parseMethodAnnotations 方法如上，会检查每个方法的每个 Annotation， 看是否被 RestMethod 这个 Annotation 修饰的 Annotation 修饰，这个有点绕，就是是否被 GET、DELETE、POST、PUT、HEAD、PATCH 这些 Annotation 修饰，然后得到 Annotation 信息，在对接口进行动态代理时会掉用到这些 Annotation 信息从而完成调用。 因为 Retrofit 原理设计到动态代理，这里只介绍 Annotation，具体原理分析请等待 <a href="https://github.com/android-cn/android-open-project-analysis" target="_blank" rel="noopener">Android 优秀开源项目实现原理解析</a> 项目的完成<br><br>#### 2 Annotation — Butter Knife<br><br>(1) 调用<br><br><div id="crayon-5638beb759da8856652783" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759da8856652783-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759da8856652783-2">2<br><div class="crayon-num" data-line="crayon-5638beb759da8856652783-3">3<br><br></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759da8856652783-1" class="crayon-line"><span class="crayon-n">@InjectView<span class="crayon-sy">(<span class="crayon-v">R<span class="crayon-sy">.<span class="crayon-v">id<span class="crayon-sy">.<span class="crayon-v">user<span class="crayon-sy">)</span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759da8856652783-2" class="crayon-line crayon-striped-line"><span class="crayon-e">EditText <span class="crayon-v">username<span class="crayon-sy">;</span></span></span><br><div id="crayon-5638beb759da8856652783-3" class="crayon-line"><br><br></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>(2) 定义<br><br><div id="crayon-5638beb759dac990857224" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759dac990857224-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dac990857224-2">2<br><div class="crayon-num" data-line="crayon-5638beb759dac990857224-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dac990857224-4">4<br><div class="crayon-num" data-line="crayon-5638beb759dac990857224-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dac990857224-6">6<br><br></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759dac990857224-1" class="crayon-line"><span class="crayon-n">@Retention<span class="crayon-sy">(<span class="crayon-t">CLASS<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759dac990857224-2" class="crayon-line crayon-striped-line"><span class="crayon-n">@Target<span class="crayon-sy">(<span class="crayon-v">FIELD<span class="crayon-sy">)</span></span></span></span><br><div id="crayon-5638beb759dac990857224-3" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-n">@interface<span class="crayon-h"> <span class="crayon-e">InjectView<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span><br><div id="crayon-5638beb759dac990857224-4" class="crayon-line crayon-striped-line"><span class="crayon-h">  <span class="crayon-t">int<span class="crayon-h"> <span class="crayon-e">value<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759dac990857224-5" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759dac990857224-6" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>可看出 Butter Knife 的 InjectView Annotation 是编译时 Annotation，并且只能用于修饰属性<br>(3) 原理<br><br><div id="crayon-5638beb759db0433843098" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-2">2<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-4">4<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-6">6<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-8">8<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-10">10<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-12">12<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-14">14<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-15">15<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-16">16<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-17">17<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-18">18<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-19">19<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-20">20<br><div class="crayon-num" data-line="crayon-5638beb759db0433843098-21">21<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db0433843098-22">22<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759db0433843098-1" class="crayon-line"><span class="crayon-n">@Override</span><br><div id="crayon-5638beb759db0433843098-2" class="crayon-line crayon-striped-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">boolean<span class="crayon-h"> <span class="crayon-e">process<span class="crayon-sy">(<span class="crayon-v">Set<span class="crayon-o">&lt;<span class="crayon-sy">?<span class="crayon-h"> <span class="crayon-r">extends<span class="crayon-h"> <span class="crayon-v">TypeElement<span class="crayon-o">&gt;<span class="crayon-h"> <span class="crayon-v">elements<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-e">RoundEnvironment <span class="crayon-v">env<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-3" class="crayon-line"><span class="crayon-h">    <span class="crayon-v">Map<span class="crayon-o">&lt;<span class="crayon-v">TypeElement<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">ViewInjector<span class="crayon-o">&gt;<span class="crayon-h"> <span class="crayon-v">targetClassMap<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-e">findAndParseTargets<span class="crayon-sy">(<span class="crayon-v">env<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-4" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759db0433843098-5" class="crayon-line"><span class="crayon-h">    <span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-v">Map<span class="crayon-sy">.<span class="crayon-v">Entry<span class="crayon-o">&lt;<span class="crayon-v">TypeElement<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">ViewInjector<span class="crayon-o">&gt;<span class="crayon-h"> <span class="crayon-v">entry<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">targetClassMap<span class="crayon-sy">.<span class="crayon-e">entrySet<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-6" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-e">TypeElement <span class="crayon-v">typeElement<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">entry<span class="crayon-sy">.<span class="crayon-e">getKey<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-7" class="crayon-line"><span class="crayon-h">        <span class="crayon-e">ViewInjector <span class="crayon-v">viewInjector<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">entry<span class="crayon-sy">.<span class="crayon-e">getValue<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-8" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759db0433843098-9" class="crayon-line"><span class="crayon-h">        <span class="crayon-st">try<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span><br><div id="crayon-5638beb759db0433843098-10" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-e">JavaFileObject <span class="crayon-v">jfo<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">filer<span class="crayon-sy">.<span class="crayon-e">createSourceFile<span class="crayon-sy">(<span class="crayon-v">viewInjector<span class="crayon-sy">.<span class="crayon-e">getFqcn<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">typeElement<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-11" class="crayon-line"><span class="crayon-h">            <span class="crayon-e">Writer <span class="crayon-v">writer<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">jfo<span class="crayon-sy">.<span class="crayon-e">openWriter<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-12" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-v">writer<span class="crayon-sy">.<span class="crayon-e">write<span class="crayon-sy">(<span class="crayon-v">viewInjector<span class="crayon-sy">.<span class="crayon-e">brewJava<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-13" class="crayon-line"><span class="crayon-h">            <span class="crayon-v">writer<span class="crayon-sy">.<span class="crayon-e">flush<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-14" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-v">writer<span class="crayon-sy">.<span class="crayon-e">close<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-15" class="crayon-line"><span class="crayon-h">        <span class="crayon-sy">}<span class="crayon-h"> <span class="crayon-st">catch<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-i">IOException<span class="crayon-h"> <span class="crayon-v">e<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-16" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-e">error<span class="crayon-sy">(<span class="crayon-v">typeElement<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-s">“Unable to write injector for type %s: %s”<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">typeElement<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">e<span class="crayon-sy">.<span class="crayon-e">getMessage<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-17" class="crayon-line"><span class="crayon-h">        <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759db0433843098-18" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759db0433843098-19" class="crayon-line"><br><div id="crayon-5638beb759db0433843098-20" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-st">return<span class="crayon-h"> <span class="crayon-t">true<span class="crayon-sy">;</span></span></span></span></span><br><div id="crayon-5638beb759db0433843098-21" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759db0433843098-22" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br><a href="https://github.com/JakeWharton/butterknife/blob/master/butterknife/src/main/java/butterknife/internal/ButterKnifeProcessor.java" target="_blank" rel="noopener">ButterKnifeProcessor.java</a> 的 process 方法如上，编译时，在此方法中过滤 InjectView 这个 Annotation 到 targetClassMap 后，会根据 targetClassMap 中元素生成不同的 class 文件到最终的 APK 中，然后在运行时调用 ButterKnife.inject(x) 函数时会到之前编译时生成的类中去找。 这里只介绍 Annotation，具体原理分析请等待 <a href="https://github.com/android-cn/android-open-project-analysis" target="_blank" rel="noopener">Android 优秀开源项目实现原理解析</a> 项目的完成<br><br>#### 3 Annotation — ActiveAndroid<br><br>(1) 调用<br><br><div id="crayon-5638beb759db6452205042" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759db6452205042-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759db6452205042-2">2<br><div class="crayon-num" data-line="crayon-5638beb759db6452205042-3">3<br><br></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759db6452205042-1" class="crayon-line"><span class="crayon-n">@Column<span class="crayon-sy">(<span class="crayon-v">name<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> “<span class="crayon-i">Name”<span class="crayon-sy">)</span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759db6452205042-2" class="crayon-line crayon-striped-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">name<span class="crayon-sy">;</span></span></span></span></span></span><br><div id="crayon-5638beb759db6452205042-3" class="crayon-line"><br><br></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>(2) 定义<br><br><div id="crayon-5638beb759dba247022951" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759dba247022951-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dba247022951-2">2<br><div class="crayon-num" data-line="crayon-5638beb759dba247022951-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dba247022951-4">4<br><div class="crayon-num" data-line="crayon-5638beb759dba247022951-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dba247022951-6">6<br><br></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759dba247022951-1" class="crayon-line"><span class="crayon-n">@Target<span class="crayon-sy">(<span class="crayon-v">ElementType<span class="crayon-sy">.<span class="crayon-v">FIELD<span class="crayon-sy">)</span></span></span></span></span></span><br><div id="crayon-5638beb759dba247022951-2" class="crayon-line crayon-striped-line"><span class="crayon-n">@Retention<span class="crayon-sy">(<span class="crayon-v">RetentionPolicy<span class="crayon-sy">.<span class="crayon-v">RUNTIME<span class="crayon-sy">)</span></span></span></span></span></span><br><div id="crayon-5638beb759dba247022951-3" class="crayon-line"><span class="crayon-m">public<span class="crayon-h"> <span class="crayon-n">@interface<span class="crayon-h"> <span class="crayon-e">Column<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span><br><div id="crayon-5638beb759dba247022951-4" class="crayon-line crayon-striped-line"><span class="crayon-h">  ……</span><br><div id="crayon-5638beb759dba247022951-5" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759dba247022951-6" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br>可看出 ActiveAndroid 的 Column Annotation 是运行时 Annotation，并且只能用于修饰属性<br>(3) 原理<br><br><div id="crayon-5638beb759dbe145106477" class="crayon-syntax crayon-theme-arduino-ide crayon-font-monaco crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-mouseover wrap"><br><div class="crayon-toolbar" data-settings=" show"><br><div class="crayon-tools"><br><div class="crayon-button crayon-copy-button" title="复制代码"><br><br><span class="crayon-language">Java</span><br><br><div class="crayon-plain-wrap"><br><div class="crayon-main"><br><table class="crayon-table"><br><tbody><br><tr class="crayon-row"><br><td class="crayon-nums " data-settings="show"><br><div class="crayon-nums-content"><br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-1">1<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-2">2<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-3">3<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-4">4<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-5">5<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-6">6<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-7">7<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-8">8<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-9">9<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-10">10<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-11">11<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-12">12<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-13">13<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-14">14<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-15">15<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-16">16<br><div class="crayon-num" data-line="crayon-5638beb759dbe145106477-17">17<br><div class="crayon-num crayon-striped-num" data-line="crayon-5638beb759dbe145106477-18">18<br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><td class="crayon-code"><br><div class="crayon-pre"><br><div id="crayon-5638beb759dbe145106477-1" class="crayon-line"><span class="crayon-e">Field <span class="crayon-v">idField<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-e">getIdField<span class="crayon-sy">(<span class="crayon-v">type<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-2" class="crayon-line crayon-striped-line"><span class="crayon-v">mColumnNames<span class="crayon-sy">.<span class="crayon-e">put<span class="crayon-sy">(<span class="crayon-v">idField<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">mIdName<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-3" class="crayon-line"><br><div id="crayon-5638beb759dbe145106477-4" class="crayon-line crayon-striped-line"><span class="crayon-v">List<span class="crayon-e "><field><span class="crayon-h"> <span class="crayon-v">fields<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-r">new<span class="crayon-h"> <span class="crayon-v">LinkedList<span class="crayon-e "><field><span class="crayon-sy">(<span class="crayon-v">ReflectionUtils<span class="crayon-sy">.<span class="crayon-e">getDeclaredColumnFields<span class="crayon-sy">(<span class="crayon-v">type<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></field></span></span></span></span></span></span></span></span></span></field></span></span><br><div id="crayon-5638beb759dbe145106477-5" class="crayon-line"><span class="crayon-v">Collections<span class="crayon-sy">.<span class="crayon-e">reverse<span class="crayon-sy">(<span class="crayon-v">fields<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-6" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759dbe145106477-7" class="crayon-line"><span class="crayon-st">for<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-e">Field <span class="crayon-v">field<span class="crayon-h"> <span class="crayon-o">:<span class="crayon-h"> <span class="crayon-v">fields<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-8" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-st">if<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-v">field<span class="crayon-sy">.<span class="crayon-e">isAnnotationPresent<span class="crayon-sy">(<span class="crayon-v">Column<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-9" class="crayon-line"><span class="crayon-h">        <span class="crayon-m">final<span class="crayon-h"> <span class="crayon-e">Column <span class="crayon-v">columnAnnotation<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">field<span class="crayon-sy">.<span class="crayon-e">getAnnotation<span class="crayon-sy">(<span class="crayon-v">Column<span class="crayon-sy">.<span class="crayon-t">class<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-10" class="crayon-line crayon-striped-line"><span class="crayon-h">        <span class="crayon-t">String<span class="crayon-h"> <span class="crayon-v">columnName<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">columnAnnotation<span class="crayon-sy">.<span class="crayon-e">name<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-11" class="crayon-line"><span class="crayon-h">        <span class="crayon-st">if<span class="crayon-h"> <span class="crayon-sy">(<span class="crayon-v">TextUtils<span class="crayon-sy">.<span class="crayon-e">isEmpty<span class="crayon-sy">(<span class="crayon-v">columnName<span class="crayon-sy">)<span class="crayon-sy">)<span class="crayon-h"> <span class="crayon-sy">{</span></span></span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-12" class="crayon-line crayon-striped-line"><span class="crayon-h">            <span class="crayon-v">columnName<span class="crayon-h"> <span class="crayon-o">=<span class="crayon-h"> <span class="crayon-v">field<span class="crayon-sy">.<span class="crayon-e">getName<span class="crayon-sy">(<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-13" class="crayon-line"><span class="crayon-h">        <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759dbe145106477-14" class="crayon-line crayon-striped-line"><br><div id="crayon-5638beb759dbe145106477-15" class="crayon-line"><span class="crayon-h">        <span class="crayon-v">mColumnNames<span class="crayon-sy">.<span class="crayon-e">put<span class="crayon-sy">(<span class="crayon-v">field<span class="crayon-sy">,<span class="crayon-h"> <span class="crayon-v">columnName<span class="crayon-sy">)<span class="crayon-sy">;</span></span></span></span></span></span></span></span></span></span></span><br><div id="crayon-5638beb759dbe145106477-16" class="crayon-line crayon-striped-line"><span class="crayon-h">    <span class="crayon-sy">}</span></span><br><div id="crayon-5638beb759dbe145106477-17" class="crayon-line"><span class="crayon-sy">}</span><br><div id="crayon-5638beb759dbe145106477-18" class="crayon-line crayon-striped-line"><br><br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td><br><br></tr><br><br></tbody><br><br></table><br><br><a href="https://github.com/pardom/ActiveAndroid/blob/master/src/com/activeandroid/TableInfo.java" target="_blank" rel="noopener">TableInfo.java</a> 的构造函数如上，运行时，得到所有行信息并存储起来用来构件表信息。<br><br>这里原理都只介绍 Annotation，具体原理分析请等待 <a href="https://github.com/android-cn/android-open-project-analysis" target="_blank" rel="noopener">Android 优秀开源项目实现原理解析</a> 项目的完成<br><br>最后留下一个小问题：<strong>如何判断一个 Annotation 是运行时还是编译时生效以及如何快速找到它的解析代码</strong><br><br>前面的示例代码运行结果应该是 10 而不是 1，这个示例代码程序实际想说明的是标记型注解 Override 的作用，为 equals 方法加上 Override 注解就知道 equals 方法的重载是错误的，参数不对<br></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>感谢支持原创技术分享</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/repo/wechatpay.png" alt="庞国明 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/repo/alipay.jpg" alt="庞国明 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
            <a href="/tags/annotation/" rel="tag"># annotation</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/post/4ed8b0f.html" rel="next" title="Android 使用dagger2进行依赖注入(基础篇）">
                <i class="fa fa-chevron-left"></i> Android 使用dagger2进行依赖注入(基础篇）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/post/da5828ad.html" rel="prev" title="如何使用Retrofit获取服务器返回来的JSON字符串">
                如何使用Retrofit获取服务器返回来的JSON字符串 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/7269202?s=460&v=4" alt="庞国明">
            
              <p class="site-author-name" itemprop="name">庞国明</p>
              <p class="site-description motion-element" itemprop="description">Software make the information world run, and programer make the softeware run.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">420</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">267</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/pangguoming" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:pangguoming@yeah.net" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/pangguoming" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/1570700/pangguoming" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/pangguoming" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i>Instagram</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、Annotation-示例"><span class="nav-number">1.</span> <span class="nav-text">一、Annotation 示例</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">庞国明</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    
      <script type="text/javascript">
      function renderGitment(){
        var gitment = new Gitmint({
            id: window.location.pathname, 
            owner: 'pangguoming',
            repo: 'pangguoming.github.io',
            
            lang: "" || navigator.language || navigator.systemLanguage || navigator.userLanguage,
            
            oauth: {
            
            
                client_secret: '51f66abac54ca9e1b5a5608d706ce6af47ffaa51',
            
                client_id: '1e9770fed2b4d227cd0a'
            }});
        gitment.render('gitment-container');
      }

      
      renderGitment();
      
      </script>
    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  

  

  
  

  

  

  

</body>
</html>
